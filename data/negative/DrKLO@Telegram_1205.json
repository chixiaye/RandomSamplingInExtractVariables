{
  "id" : 1205,
  "expression" : "cursor",
  "projectName" : "DrKLO@Telegram",
  "commitID" : "11fbfb1329df700b203e1852a71c4c11b5ab12f4",
  "filePath" : "TMessagesProj/src/main/java/org/telegram/messenger/MessagesStorage.java",
  "occurrences" : 28,
  "isArithmeticExpression" : 0,
  "isGetTypeMethod" : 0,
  "expressionList" : [ {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8888,
      "startColumnNumber" : 27,
      "endLineNumber" : 8888,
      "endColumnNumber" : 33
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 8888,
        "startColumnNumber" : 27,
        "endLineNumber" : 8888,
        "endColumnNumber" : 40
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 243,
        "startLineNumber" : 8888,
        "startColumnNumber" : 20,
        "endLineNumber" : 8893,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long did=cursor.longValue(0);\n  if (!dialogsToUpdate.contains(did)) {\n    dialogsToUpdate.add(did);\n  }\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 25,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 283,
        "startLineNumber" : 8887,
        "startColumnNumber" : 20,
        "endLineNumber" : 8894,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    if (!dialogsToUpdate.contains(did)) {\n      dialogsToUpdate.add(did);\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 26,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 361,
        "startLineNumber" : 8887,
        "startColumnNumber" : 16,
        "endLineNumber" : 8896,
        "endColumnNumber" : 17
      },
      "nodeContext" : "try {\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    if (!dialogsToUpdate.contains(did)) {\n      dialogsToUpdate.add(did);\n    }\n  }\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 38,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1636,
        "startLineNumber" : 8867,
        "startColumnNumber" : 27,
        "endLineNumber" : 8903,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 195,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 8888,
        "startColumnNumber" : 27,
        "endLineNumber" : 8888,
        "endColumnNumber" : 40
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8889,
      "startColumnNumber" : 35,
      "endLineNumber" : 8889,
      "endColumnNumber" : 41
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 19,
        "startLineNumber" : 8889,
        "startColumnNumber" : 35,
        "endLineNumber" : 8889,
        "endColumnNumber" : 54
      },
      "nodeContext" : "cursor.longValue(0)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 8889,
        "startColumnNumber" : 29,
        "endLineNumber" : 8889,
        "endColumnNumber" : 54
      },
      "nodeContext" : "did=cursor.longValue(0)",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 8889,
        "startColumnNumber" : 24,
        "endLineNumber" : 8889,
        "endColumnNumber" : 55
      },
      "nodeContext" : "long did=cursor.longValue(0);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,body]",
      "nodePosition" : {
        "charLength" : 221,
        "startLineNumber" : 8888,
        "startColumnNumber" : 42,
        "endLineNumber" : 8893,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  long did=cursor.longValue(0);\n  if (!dialogsToUpdate.contains(did)) {\n    dialogsToUpdate.add(did);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 21,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 243,
        "startLineNumber" : 8888,
        "startColumnNumber" : 20,
        "endLineNumber" : 8893,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long did=cursor.longValue(0);\n  if (!dialogsToUpdate.contains(did)) {\n    dialogsToUpdate.add(did);\n  }\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 25,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 283,
        "startLineNumber" : 8887,
        "startColumnNumber" : 20,
        "endLineNumber" : 8894,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    if (!dialogsToUpdate.contains(did)) {\n      dialogsToUpdate.add(did);\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 26,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 361,
        "startLineNumber" : 8887,
        "startColumnNumber" : 16,
        "endLineNumber" : 8896,
        "endColumnNumber" : 17
      },
      "nodeContext" : "try {\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    if (!dialogsToUpdate.contains(did)) {\n      dialogsToUpdate.add(did);\n    }\n  }\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 38,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1636,
        "startLineNumber" : 8867,
        "startColumnNumber" : 27,
        "endLineNumber" : 8903,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 195,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 8889,
        "startColumnNumber" : 24,
        "endLineNumber" : 8889,
        "endColumnNumber" : 55
      },
      "nodeContext" : "long did=cursor.longValue(0);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8897,
      "startColumnNumber" : 16,
      "endLineNumber" : 8897,
      "endColumnNumber" : 22
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 16,
        "startLineNumber" : 8897,
        "startColumnNumber" : 16,
        "endLineNumber" : 8897,
        "endColumnNumber" : 32
      },
      "nodeContext" : "cursor.dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 8897,
        "startColumnNumber" : 16,
        "endLineNumber" : 8897,
        "endColumnNumber" : 33
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1636,
        "startLineNumber" : 8867,
        "startColumnNumber" : 27,
        "endLineNumber" : 8903,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 195,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 8897,
        "startColumnNumber" : 16,
        "endLineNumber" : 8897,
        "endColumnNumber" : 33
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8929,
      "startColumnNumber" : 27,
      "endLineNumber" : 8929,
      "endColumnNumber" : 33
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 8929,
        "startColumnNumber" : 27,
        "endLineNumber" : 8929,
        "endColumnNumber" : 40
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1994,
        "startLineNumber" : 8929,
        "startColumnNumber" : 20,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 206,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 2034,
        "startLineNumber" : 8928,
        "startColumnNumber" : 20,
        "endLineNumber" : 8966,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 207,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2112,
        "startLineNumber" : 8928,
        "startColumnNumber" : 16,
        "endLineNumber" : 8968,
        "endColumnNumber" : 17
      },
      "nodeContext" : "try {\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 219,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 8929,
        "startColumnNumber" : 27,
        "endLineNumber" : 8929,
        "endColumnNumber" : 40
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8930,
      "startColumnNumber" : 35,
      "endLineNumber" : 8930,
      "endColumnNumber" : 41
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 19,
        "startLineNumber" : 8930,
        "startColumnNumber" : 35,
        "endLineNumber" : 8930,
        "endColumnNumber" : 54
      },
      "nodeContext" : "cursor.longValue(0)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 8930,
        "startColumnNumber" : 29,
        "endLineNumber" : 8930,
        "endColumnNumber" : 54
      },
      "nodeContext" : "did=cursor.longValue(0)",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 8930,
        "startColumnNumber" : 24,
        "endLineNumber" : 8930,
        "endColumnNumber" : 55
      },
      "nodeContext" : "long did=cursor.longValue(0);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,body]",
      "nodePosition" : {
        "charLength" : 1972,
        "startLineNumber" : 8929,
        "startColumnNumber" : 42,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 202,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1994,
        "startLineNumber" : 8929,
        "startColumnNumber" : 20,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 206,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 2034,
        "startLineNumber" : 8928,
        "startColumnNumber" : 20,
        "endLineNumber" : 8966,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 207,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2112,
        "startLineNumber" : 8928,
        "startColumnNumber" : 16,
        "endLineNumber" : 8968,
        "endColumnNumber" : 17
      },
      "nodeContext" : "try {\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 219,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 8930,
        "startColumnNumber" : 24,
        "endLineNumber" : 8930,
        "endColumnNumber" : 55
      },
      "nodeContext" : "long did=cursor.longValue(0);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8931,
      "startColumnNumber" : 34,
      "endLineNumber" : 8931,
      "endColumnNumber" : 40
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 8931,
        "startColumnNumber" : 34,
        "endLineNumber" : 8931,
        "endColumnNumber" : 52
      },
      "nodeContext" : "cursor.intValue(5)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 24,
        "startLineNumber" : 8931,
        "startColumnNumber" : 28,
        "endLineNumber" : 8931,
        "endColumnNumber" : 52
      },
      "nodeContext" : "mid=cursor.intValue(5)",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 29,
        "startLineNumber" : 8931,
        "startColumnNumber" : 24,
        "endLineNumber" : 8931,
        "endColumnNumber" : 53
      },
      "nodeContext" : "int mid=cursor.intValue(5);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,body]",
      "nodePosition" : {
        "charLength" : 1972,
        "startLineNumber" : 8929,
        "startColumnNumber" : 42,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 202,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1994,
        "startLineNumber" : 8929,
        "startColumnNumber" : 20,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 206,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 2034,
        "startLineNumber" : 8928,
        "startColumnNumber" : 20,
        "endLineNumber" : 8966,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 207,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2112,
        "startLineNumber" : 8928,
        "startColumnNumber" : 16,
        "endLineNumber" : 8968,
        "endColumnNumber" : 17
      },
      "nodeContext" : "try {\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 219,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 29,
        "startLineNumber" : 8931,
        "startColumnNumber" : 24,
        "endLineNumber" : 8931,
        "endColumnNumber" : 53
      },
      "nodeContext" : "int mid=cursor.intValue(5);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8940,
      "startColumnNumber" : 45,
      "endLineNumber" : 8940,
      "endColumnNumber" : 51
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 8940,
        "startColumnNumber" : 45,
        "endLineNumber" : 8940,
        "endColumnNumber" : 63
      },
      "nodeContext" : "cursor.intValue(2)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 8940,
        "startColumnNumber" : 32,
        "endLineNumber" : 8940,
        "endColumnNumber" : 63
      },
      "nodeContext" : "read_state=cursor.intValue(2)",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 36,
        "startLineNumber" : 8940,
        "startColumnNumber" : 28,
        "endLineNumber" : 8940,
        "endColumnNumber" : 64
      },
      "nodeContext" : "int read_state=cursor.intValue(2);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 812,
        "startLineNumber" : 8939,
        "startColumnNumber" : 48,
        "endLineNumber" : 8954,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  int read_state=cursor.intValue(2);\n  if (cursor.intValue(3) == 0) {\n    Integer[] unread_count=dialogsToUpdate.get(did);\n    if (unread_count == null) {\n      unread_count=new Integer[]{0,0};\n      dialogsToUpdate.put(did,unread_count);\n    }\n    if (read_state < 2) {\n      unread_count[1]++;\n    }\n    if (read_state == 0 || read_state == 2) {\n      unread_count[0]++;\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 74,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 836,
        "startLineNumber" : 8939,
        "startColumnNumber" : 24,
        "endLineNumber" : 8954,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (did != currentUser) {\n  int read_state=cursor.intValue(2);\n  if (cursor.intValue(3) == 0) {\n    Integer[] unread_count=dialogsToUpdate.get(did);\n    if (unread_count == null) {\n      unread_count=new Integer[]{0,0};\n      dialogsToUpdate.put(did,unread_count);\n    }\n    if (read_state < 2) {\n      unread_count[1]++;\n    }\n    if (read_state == 0 || read_state == 2) {\n      unread_count[0]++;\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 78,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,body]",
      "nodePosition" : {
        "charLength" : 1972,
        "startLineNumber" : 8929,
        "startColumnNumber" : 42,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 202,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1994,
        "startLineNumber" : 8929,
        "startColumnNumber" : 20,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 206,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 2034,
        "startLineNumber" : 8928,
        "startColumnNumber" : 20,
        "endLineNumber" : 8966,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 207,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2112,
        "startLineNumber" : 8928,
        "startColumnNumber" : 16,
        "endLineNumber" : 8968,
        "endColumnNumber" : 17
      },
      "nodeContext" : "try {\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 219,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 36,
        "startLineNumber" : 8940,
        "startColumnNumber" : 28,
        "endLineNumber" : 8940,
        "endColumnNumber" : 64
      },
      "nodeContext" : "int read_state=cursor.intValue(2);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8941,
      "startColumnNumber" : 32,
      "endLineNumber" : 8941,
      "endColumnNumber" : 38
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 8941,
        "startColumnNumber" : 32,
        "endLineNumber" : 8941,
        "endColumnNumber" : 50
      },
      "nodeContext" : "cursor.intValue(3)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 23,
        "startLineNumber" : 8941,
        "startColumnNumber" : 32,
        "endLineNumber" : 8941,
        "endColumnNumber" : 55
      },
      "nodeContext" : "cursor.intValue(3) == 0",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 691,
        "startLineNumber" : 8941,
        "startColumnNumber" : 28,
        "endLineNumber" : 8953,
        "endColumnNumber" : 29
      },
      "nodeContext" : "if (cursor.intValue(3) == 0) {\n  Integer[] unread_count=dialogsToUpdate.get(did);\n  if (unread_count == null) {\n    unread_count=new Integer[]{0,0};\n    dialogsToUpdate.put(did,unread_count);\n  }\n  if (read_state < 2) {\n    unread_count[1]++;\n  }\n  if (read_state == 0 || read_state == 2) {\n    unread_count[0]++;\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 65,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 812,
        "startLineNumber" : 8939,
        "startColumnNumber" : 48,
        "endLineNumber" : 8954,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  int read_state=cursor.intValue(2);\n  if (cursor.intValue(3) == 0) {\n    Integer[] unread_count=dialogsToUpdate.get(did);\n    if (unread_count == null) {\n      unread_count=new Integer[]{0,0};\n      dialogsToUpdate.put(did,unread_count);\n    }\n    if (read_state < 2) {\n      unread_count[1]++;\n    }\n    if (read_state == 0 || read_state == 2) {\n      unread_count[0]++;\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 74,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 836,
        "startLineNumber" : 8939,
        "startColumnNumber" : 24,
        "endLineNumber" : 8954,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (did != currentUser) {\n  int read_state=cursor.intValue(2);\n  if (cursor.intValue(3) == 0) {\n    Integer[] unread_count=dialogsToUpdate.get(did);\n    if (unread_count == null) {\n      unread_count=new Integer[]{0,0};\n      dialogsToUpdate.put(did,unread_count);\n    }\n    if (read_state < 2) {\n      unread_count[1]++;\n    }\n    if (read_state == 0 || read_state == 2) {\n      unread_count[0]++;\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 78,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,body]",
      "nodePosition" : {
        "charLength" : 1972,
        "startLineNumber" : 8929,
        "startColumnNumber" : 42,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 202,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1994,
        "startLineNumber" : 8929,
        "startColumnNumber" : 20,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 206,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 2034,
        "startLineNumber" : 8928,
        "startColumnNumber" : 20,
        "endLineNumber" : 8966,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 207,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2112,
        "startLineNumber" : 8928,
        "startColumnNumber" : 16,
        "endLineNumber" : 8968,
        "endColumnNumber" : 17
      },
      "nodeContext" : "try {\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 219,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 23,
        "startLineNumber" : 8941,
        "startColumnNumber" : 32,
        "endLineNumber" : 8941,
        "endColumnNumber" : 55
      },
      "nodeContext" : "cursor.intValue(3) == 0",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 6,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8958,
      "startColumnNumber" : 48,
      "endLineNumber" : 8958,
      "endColumnNumber" : 54
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 8958,
        "startColumnNumber" : 48,
        "endLineNumber" : 8958,
        "endColumnNumber" : 73
      },
      "nodeContext" : "cursor.byteBufferValue(1)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 32,
        "startLineNumber" : 8958,
        "startColumnNumber" : 41,
        "endLineNumber" : 8958,
        "endColumnNumber" : 73
      },
      "nodeContext" : "data=cursor.byteBufferValue(1)",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 50,
        "startLineNumber" : 8958,
        "startColumnNumber" : 24,
        "endLineNumber" : 8958,
        "endColumnNumber" : 74
      },
      "nodeContext" : "NativeByteBuffer data=cursor.byteBufferValue(1);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 9,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,body]",
      "nodePosition" : {
        "charLength" : 1972,
        "startLineNumber" : 8929,
        "startColumnNumber" : 42,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 202,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1994,
        "startLineNumber" : 8929,
        "startColumnNumber" : 20,
        "endLineNumber" : 8965,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long did=cursor.longValue(0);\n  int mid=cursor.intValue(5);\n  temp.remove((Integer)mid);\n  ArrayList<Integer> mids=messagesByDialogs.get(did);\n  if (mids == null) {\n    mids=new ArrayList<>();\n    messagesByDialogs.put(did,mids);\n  }\n  mids.add(mid);\n  if (did != currentUser) {\n    int read_state=cursor.intValue(2);\n    if (cursor.intValue(3) == 0) {\n      Integer[] unread_count=dialogsToUpdate.get(did);\n      if (unread_count == null) {\n        unread_count=new Integer[]{0,0};\n        dialogsToUpdate.put(did,unread_count);\n      }\n      if (read_state < 2) {\n        unread_count[1]++;\n      }\n      if (read_state == 0 || read_state == 2) {\n        unread_count[0]++;\n      }\n    }\n  }\n  if ((int)did != 0 && !deleteFiles) {\n    continue;\n  }\n  NativeByteBuffer data=cursor.byteBufferValue(1);\n  if (data != null) {\n    TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n    message.readAttachPath(data,getUserConfig().clientUserId);\n    data.reuse();\n    addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n  }\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 206,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 2034,
        "startLineNumber" : 8928,
        "startColumnNumber" : 20,
        "endLineNumber" : 8966,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 207,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2112,
        "startLineNumber" : 8928,
        "startColumnNumber" : 16,
        "endLineNumber" : 8968,
        "endColumnNumber" : 17
      },
      "nodeContext" : "try {\n  while (cursor.next()) {\n    long did=cursor.longValue(0);\n    int mid=cursor.intValue(5);\n    temp.remove((Integer)mid);\n    ArrayList<Integer> mids=messagesByDialogs.get(did);\n    if (mids == null) {\n      mids=new ArrayList<>();\n      messagesByDialogs.put(did,mids);\n    }\n    mids.add(mid);\n    if (did != currentUser) {\n      int read_state=cursor.intValue(2);\n      if (cursor.intValue(3) == 0) {\n        Integer[] unread_count=dialogsToUpdate.get(did);\n        if (unread_count == null) {\n          unread_count=new Integer[]{0,0};\n          dialogsToUpdate.put(did,unread_count);\n        }\n        if (read_state < 2) {\n          unread_count[1]++;\n        }\n        if (read_state == 0 || read_state == 2) {\n          unread_count[0]++;\n        }\n      }\n    }\n    if ((int)did != 0 && !deleteFiles) {\n      continue;\n    }\n    NativeByteBuffer data=cursor.byteBufferValue(1);\n    if (data != null) {\n      TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n      message.readAttachPath(data,getUserConfig().clientUserId);\n      data.reuse();\n      addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n    }\n  }\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 219,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 50,
        "startLineNumber" : 8958,
        "startColumnNumber" : 24,
        "endLineNumber" : 8958,
        "endColumnNumber" : 74
      },
      "nodeContext" : "NativeByteBuffer data=cursor.byteBufferValue(1);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 9,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8969,
      "startColumnNumber" : 16,
      "endLineNumber" : 8969,
      "endColumnNumber" : 22
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 16,
        "startLineNumber" : 8969,
        "startColumnNumber" : 16,
        "endLineNumber" : 8969,
        "endColumnNumber" : 32
      },
      "nodeContext" : "cursor.dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 8969,
        "startColumnNumber" : 16,
        "endLineNumber" : 8969,
        "endColumnNumber" : 33
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 8969,
        "startColumnNumber" : 16,
        "endLineNumber" : 8969,
        "endColumnNumber" : 33
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8981,
      "startColumnNumber" : 24,
      "endLineNumber" : 8981,
      "endColumnNumber" : 30
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 8981,
        "startColumnNumber" : 24,
        "endLineNumber" : 8981,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 170,
        "startLineNumber" : 8981,
        "startColumnNumber" : 20,
        "endLineNumber" : 8984,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (cursor.next()) {\n  old_unread_count=cursor.intValue(0);\n  old_mentions_count=cursor.intValue(1);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 19,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1105,
        "startLineNumber" : 8974,
        "startColumnNumber" : 65,
        "endLineNumber" : 8995,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=dialogsToUpdate.keyAt(a);\n  Integer[] counts=dialogsToUpdate.valueAt(a);\n  cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n  int old_unread_count=0;\n  int old_mentions_count=0;\n  if (cursor.next()) {\n    old_unread_count=cursor.intValue(0);\n    old_mentions_count=cursor.intValue(1);\n  }\n  cursor.dispose();\n  dialogsIds.add(did);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n  state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n  state.bindLong(3,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 122,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1154,
        "startLineNumber" : 8974,
        "startColumnNumber" : 16,
        "endLineNumber" : 8995,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0; a < dialogsToUpdate.size(); a++) {\n  long did=dialogsToUpdate.keyAt(a);\n  Integer[] counts=dialogsToUpdate.valueAt(a);\n  cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n  int old_unread_count=0;\n  int old_mentions_count=0;\n  if (cursor.next()) {\n    old_unread_count=cursor.intValue(0);\n    old_mentions_count=cursor.intValue(1);\n  }\n  cursor.dispose();\n  dialogsIds.add(did);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n  state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n  state.bindLong(3,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 135,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 8981,
        "startColumnNumber" : 24,
        "endLineNumber" : 8981,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8982,
      "startColumnNumber" : 43,
      "endLineNumber" : 8982,
      "endColumnNumber" : 49
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.Assignment,rightHandSide]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 8982,
        "startColumnNumber" : 43,
        "endLineNumber" : 8982,
        "endColumnNumber" : 61
      },
      "nodeContext" : "cursor.intValue(0)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 37,
        "startLineNumber" : 8982,
        "startColumnNumber" : 24,
        "endLineNumber" : 8982,
        "endColumnNumber" : 61
      },
      "nodeContext" : "old_unread_count=cursor.intValue(0)",
      "nodeType" : "Assignment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 38,
        "startLineNumber" : 8982,
        "startColumnNumber" : 24,
        "endLineNumber" : 8982,
        "endColumnNumber" : 62
      },
      "nodeContext" : "old_unread_count=cursor.intValue(0);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 151,
        "startLineNumber" : 8981,
        "startColumnNumber" : 39,
        "endLineNumber" : 8984,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  old_unread_count=cursor.intValue(0);\n  old_mentions_count=cursor.intValue(1);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 15,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 170,
        "startLineNumber" : 8981,
        "startColumnNumber" : 20,
        "endLineNumber" : 8984,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (cursor.next()) {\n  old_unread_count=cursor.intValue(0);\n  old_mentions_count=cursor.intValue(1);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 19,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1105,
        "startLineNumber" : 8974,
        "startColumnNumber" : 65,
        "endLineNumber" : 8995,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=dialogsToUpdate.keyAt(a);\n  Integer[] counts=dialogsToUpdate.valueAt(a);\n  cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n  int old_unread_count=0;\n  int old_mentions_count=0;\n  if (cursor.next()) {\n    old_unread_count=cursor.intValue(0);\n    old_mentions_count=cursor.intValue(1);\n  }\n  cursor.dispose();\n  dialogsIds.add(did);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n  state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n  state.bindLong(3,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 122,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1154,
        "startLineNumber" : 8974,
        "startColumnNumber" : 16,
        "endLineNumber" : 8995,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0; a < dialogsToUpdate.size(); a++) {\n  long did=dialogsToUpdate.keyAt(a);\n  Integer[] counts=dialogsToUpdate.valueAt(a);\n  cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n  int old_unread_count=0;\n  int old_mentions_count=0;\n  if (cursor.next()) {\n    old_unread_count=cursor.intValue(0);\n    old_mentions_count=cursor.intValue(1);\n  }\n  cursor.dispose();\n  dialogsIds.add(did);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n  state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n  state.bindLong(3,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 135,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 38,
        "startLineNumber" : 8982,
        "startColumnNumber" : 24,
        "endLineNumber" : 8982,
        "endColumnNumber" : 62
      },
      "nodeContext" : "old_unread_count=cursor.intValue(0);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8983,
      "startColumnNumber" : 45,
      "endLineNumber" : 8983,
      "endColumnNumber" : 51
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.Assignment,rightHandSide]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 8983,
        "startColumnNumber" : 45,
        "endLineNumber" : 8983,
        "endColumnNumber" : 63
      },
      "nodeContext" : "cursor.intValue(1)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 39,
        "startLineNumber" : 8983,
        "startColumnNumber" : 24,
        "endLineNumber" : 8983,
        "endColumnNumber" : 63
      },
      "nodeContext" : "old_mentions_count=cursor.intValue(1)",
      "nodeType" : "Assignment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 40,
        "startLineNumber" : 8983,
        "startColumnNumber" : 24,
        "endLineNumber" : 8983,
        "endColumnNumber" : 64
      },
      "nodeContext" : "old_mentions_count=cursor.intValue(1);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 151,
        "startLineNumber" : 8981,
        "startColumnNumber" : 39,
        "endLineNumber" : 8984,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  old_unread_count=cursor.intValue(0);\n  old_mentions_count=cursor.intValue(1);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 15,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 170,
        "startLineNumber" : 8981,
        "startColumnNumber" : 20,
        "endLineNumber" : 8984,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (cursor.next()) {\n  old_unread_count=cursor.intValue(0);\n  old_mentions_count=cursor.intValue(1);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 19,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1105,
        "startLineNumber" : 8974,
        "startColumnNumber" : 65,
        "endLineNumber" : 8995,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=dialogsToUpdate.keyAt(a);\n  Integer[] counts=dialogsToUpdate.valueAt(a);\n  cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n  int old_unread_count=0;\n  int old_mentions_count=0;\n  if (cursor.next()) {\n    old_unread_count=cursor.intValue(0);\n    old_mentions_count=cursor.intValue(1);\n  }\n  cursor.dispose();\n  dialogsIds.add(did);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n  state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n  state.bindLong(3,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 122,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1154,
        "startLineNumber" : 8974,
        "startColumnNumber" : 16,
        "endLineNumber" : 8995,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0; a < dialogsToUpdate.size(); a++) {\n  long did=dialogsToUpdate.keyAt(a);\n  Integer[] counts=dialogsToUpdate.valueAt(a);\n  cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n  int old_unread_count=0;\n  int old_mentions_count=0;\n  if (cursor.next()) {\n    old_unread_count=cursor.intValue(0);\n    old_mentions_count=cursor.intValue(1);\n  }\n  cursor.dispose();\n  dialogsIds.add(did);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n  state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n  state.bindLong(3,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 135,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 40,
        "startLineNumber" : 8983,
        "startColumnNumber" : 24,
        "endLineNumber" : 8983,
        "endColumnNumber" : 64
      },
      "nodeContext" : "old_mentions_count=cursor.intValue(1);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 8985,
      "startColumnNumber" : 20,
      "endLineNumber" : 8985,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 16,
        "startLineNumber" : 8985,
        "startColumnNumber" : 20,
        "endLineNumber" : 8985,
        "endColumnNumber" : 36
      },
      "nodeContext" : "cursor.dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 8985,
        "startColumnNumber" : 20,
        "endLineNumber" : 8985,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1105,
        "startLineNumber" : 8974,
        "startColumnNumber" : 65,
        "endLineNumber" : 8995,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=dialogsToUpdate.keyAt(a);\n  Integer[] counts=dialogsToUpdate.valueAt(a);\n  cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n  int old_unread_count=0;\n  int old_mentions_count=0;\n  if (cursor.next()) {\n    old_unread_count=cursor.intValue(0);\n    old_mentions_count=cursor.intValue(1);\n  }\n  cursor.dispose();\n  dialogsIds.add(did);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n  state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n  state.bindLong(3,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 122,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1154,
        "startLineNumber" : 8974,
        "startColumnNumber" : 16,
        "endLineNumber" : 8995,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0; a < dialogsToUpdate.size(); a++) {\n  long did=dialogsToUpdate.keyAt(a);\n  Integer[] counts=dialogsToUpdate.valueAt(a);\n  cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n  int old_unread_count=0;\n  int old_mentions_count=0;\n  if (cursor.next()) {\n    old_unread_count=cursor.intValue(0);\n    old_mentions_count=cursor.intValue(1);\n  }\n  cursor.dispose();\n  dialogsIds.add(did);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n  state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n  state.bindLong(3,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 135,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 8985,
        "startColumnNumber" : 20,
        "endLineNumber" : 8985,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9012,
      "startColumnNumber" : 24,
      "endLineNumber" : 9012,
      "endColumnNumber" : 30
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 9012,
        "startColumnNumber" : 24,
        "endLineNumber" : 9012,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 101,
        "startLineNumber" : 9012,
        "startColumnNumber" : 20,
        "endLineNumber" : 9014,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (cursor.next()) {\n  updatedCount=cursor.intValue(0);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 12,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 2031,
        "startLineNumber" : 8997,
        "startColumnNumber" : 74,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 204,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2089,
        "startLineNumber" : 8997,
        "startColumnNumber" : 16,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 220,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 9012,
        "startColumnNumber" : 24,
        "endLineNumber" : 9012,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9013,
      "startColumnNumber" : 39,
      "endLineNumber" : 9013,
      "endColumnNumber" : 45
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.Assignment,rightHandSide]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 9013,
        "startColumnNumber" : 39,
        "endLineNumber" : 9013,
        "endColumnNumber" : 57
      },
      "nodeContext" : "cursor.intValue(0)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 33,
        "startLineNumber" : 9013,
        "startColumnNumber" : 24,
        "endLineNumber" : 9013,
        "endColumnNumber" : 57
      },
      "nodeContext" : "updatedCount=cursor.intValue(0)",
      "nodeType" : "Assignment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 34,
        "startLineNumber" : 9013,
        "startColumnNumber" : 24,
        "endLineNumber" : 9013,
        "endColumnNumber" : 58
      },
      "nodeContext" : "updatedCount=cursor.intValue(0);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 82,
        "startLineNumber" : 9012,
        "startColumnNumber" : 39,
        "endLineNumber" : 9014,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  updatedCount=cursor.intValue(0);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 101,
        "startLineNumber" : 9012,
        "startColumnNumber" : 20,
        "endLineNumber" : 9014,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (cursor.next()) {\n  updatedCount=cursor.intValue(0);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 12,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 2031,
        "startLineNumber" : 8997,
        "startColumnNumber" : 74,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 204,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2089,
        "startLineNumber" : 8997,
        "startColumnNumber" : 16,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 220,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 34,
        "startLineNumber" : 9013,
        "startColumnNumber" : 24,
        "endLineNumber" : 9013,
        "endColumnNumber" : 58
      },
      "nodeContext" : "updatedCount=cursor.intValue(0);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9015,
      "startColumnNumber" : 20,
      "endLineNumber" : 9015,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 16,
        "startLineNumber" : 9015,
        "startColumnNumber" : 20,
        "endLineNumber" : 9015,
        "endColumnNumber" : 36
      },
      "nodeContext" : "cursor.dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 9015,
        "startColumnNumber" : 20,
        "endLineNumber" : 9015,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 2031,
        "startLineNumber" : 8997,
        "startColumnNumber" : 74,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 204,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2089,
        "startLineNumber" : 8997,
        "startColumnNumber" : 16,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 220,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 9015,
        "startColumnNumber" : 20,
        "endLineNumber" : 9015,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9018,
      "startColumnNumber" : 28,
      "endLineNumber" : 9018,
      "endColumnNumber" : 34
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 9018,
        "startColumnNumber" : 28,
        "endLineNumber" : 9018,
        "endColumnNumber" : 41
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 513,
        "startLineNumber" : 9018,
        "startColumnNumber" : 24,
        "endLineNumber" : 9026,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (cursor.next()) {\n  int count=cursor.intValue(0);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,count - updatedCount));\n  state.bindLong(2,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 52,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 746,
        "startLineNumber" : 9016,
        "startColumnNumber" : 42,
        "endLineNumber" : 9028,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n  if (cursor.next()) {\n    int count=cursor.intValue(0);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,count - updatedCount));\n    state.bindLong(2,did);\n    state.step();\n    state.dispose();\n  }\n  cursor.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 71,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 768,
        "startLineNumber" : 9016,
        "startColumnNumber" : 20,
        "endLineNumber" : 9028,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (updatedCount > 0) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n  if (cursor.next()) {\n    int count=cursor.intValue(0);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,count - updatedCount));\n    state.bindLong(2,did);\n    state.step();\n    state.dispose();\n  }\n  cursor.dispose();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 75,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 2031,
        "startLineNumber" : 8997,
        "startColumnNumber" : 74,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 204,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2089,
        "startLineNumber" : 8997,
        "startColumnNumber" : 16,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 220,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 9018,
        "startColumnNumber" : 28,
        "endLineNumber" : 9018,
        "endColumnNumber" : 41
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9019,
      "startColumnNumber" : 40,
      "endLineNumber" : 9019,
      "endColumnNumber" : 46
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 9019,
        "startColumnNumber" : 40,
        "endLineNumber" : 9019,
        "endColumnNumber" : 58
      },
      "nodeContext" : "cursor.intValue(0)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 26,
        "startLineNumber" : 9019,
        "startColumnNumber" : 32,
        "endLineNumber" : 9019,
        "endColumnNumber" : 58
      },
      "nodeContext" : "count=cursor.intValue(0)",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 9019,
        "startColumnNumber" : 28,
        "endLineNumber" : 9019,
        "endColumnNumber" : 59
      },
      "nodeContext" : "int count=cursor.intValue(0);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 494,
        "startLineNumber" : 9018,
        "startColumnNumber" : 43,
        "endLineNumber" : 9026,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  int count=cursor.intValue(0);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,count - updatedCount));\n  state.bindLong(2,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 48,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 513,
        "startLineNumber" : 9018,
        "startColumnNumber" : 24,
        "endLineNumber" : 9026,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (cursor.next()) {\n  int count=cursor.intValue(0);\n  SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n  state.requery();\n  state.bindInteger(1,Math.max(0,count - updatedCount));\n  state.bindLong(2,did);\n  state.step();\n  state.dispose();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 52,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 746,
        "startLineNumber" : 9016,
        "startColumnNumber" : 42,
        "endLineNumber" : 9028,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n  if (cursor.next()) {\n    int count=cursor.intValue(0);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,count - updatedCount));\n    state.bindLong(2,did);\n    state.step();\n    state.dispose();\n  }\n  cursor.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 71,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 768,
        "startLineNumber" : 9016,
        "startColumnNumber" : 20,
        "endLineNumber" : 9028,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (updatedCount > 0) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n  if (cursor.next()) {\n    int count=cursor.intValue(0);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,count - updatedCount));\n    state.bindLong(2,did);\n    state.step();\n    state.dispose();\n  }\n  cursor.dispose();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 75,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 2031,
        "startLineNumber" : 8997,
        "startColumnNumber" : 74,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 204,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2089,
        "startLineNumber" : 8997,
        "startColumnNumber" : 16,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 220,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 9019,
        "startColumnNumber" : 28,
        "endLineNumber" : 9019,
        "endColumnNumber" : 59
      },
      "nodeContext" : "int count=cursor.intValue(0);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9027,
      "startColumnNumber" : 24,
      "endLineNumber" : 9027,
      "endColumnNumber" : 30
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 16,
        "startLineNumber" : 9027,
        "startColumnNumber" : 24,
        "endLineNumber" : 9027,
        "endColumnNumber" : 40
      },
      "nodeContext" : "cursor.dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 9027,
        "startColumnNumber" : 24,
        "endLineNumber" : 9027,
        "endColumnNumber" : 41
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 746,
        "startLineNumber" : 9016,
        "startColumnNumber" : 42,
        "endLineNumber" : 9028,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n  if (cursor.next()) {\n    int count=cursor.intValue(0);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,count - updatedCount));\n    state.bindLong(2,did);\n    state.step();\n    state.dispose();\n  }\n  cursor.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 71,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 768,
        "startLineNumber" : 9016,
        "startColumnNumber" : 20,
        "endLineNumber" : 9028,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (updatedCount > 0) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n  if (cursor.next()) {\n    int count=cursor.intValue(0);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,count - updatedCount));\n    state.bindLong(2,did);\n    state.step();\n    state.dispose();\n  }\n  cursor.dispose();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 75,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 2031,
        "startLineNumber" : 8997,
        "startColumnNumber" : 74,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 204,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2089,
        "startLineNumber" : 8997,
        "startColumnNumber" : 16,
        "endLineNumber" : 9029,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n  long did=messagesByDialogs.keyAt(a);\n  ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n  int lowerId=(int)did;\n  String idsStr=TextUtils.join(\",\",mids);\n  if (lowerId != 0) {\n    if (lowerId < 0) {\n      database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n  int updatedCount=0;\n  cursor=database.queryFinalized(\"SELECT changes()\");\n  if (cursor.next()) {\n    updatedCount=cursor.intValue(0);\n  }\n  cursor.dispose();\n  if (updatedCount > 0) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n    if (cursor.next()) {\n      int count=cursor.intValue(0);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,count - updatedCount));\n      state.bindLong(2,did);\n      state.step();\n      state.dispose();\n    }\n    cursor.dispose();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 220,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 9027,
        "startColumnNumber" : 24,
        "endLineNumber" : 9027,
        "endColumnNumber" : 41
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9037,
      "startColumnNumber" : 27,
      "endLineNumber" : 9037,
      "endColumnNumber" : 33
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 9037,
        "startColumnNumber" : 27,
        "endLineNumber" : 9037,
        "endColumnNumber" : 40
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 925,
        "startLineNumber" : 9037,
        "startColumnNumber" : 20,
        "endLineNumber" : 9057,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long uid=cursor.longValue(0);\n  int type=cursor.intValue(1);\n  if (mediaCounts == null) {\n    mediaCounts=new SparseArray<>();\n  }\n  LongSparseArray<Integer> counts=mediaCounts.get(type);\n  Integer count;\n  if (counts == null) {\n    counts=new LongSparseArray<>();\n    count=0;\n    mediaCounts.put(type,counts);\n  }\n else {\n    count=counts.get(uid);\n  }\n  if (count == null) {\n    count=0;\n  }\n  count++;\n  counts.put(uid,count);\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 98,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2978,
        "startLineNumber" : 9034,
        "startColumnNumber" : 36,
        "endLineNumber" : 9088,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 310,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 3387,
        "startLineNumber" : 9034,
        "startColumnNumber" : 16,
        "endLineNumber" : 9094,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (temp.isEmpty()) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n else {\n  if (channelId == 0) {\n    database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n  }\n else {\n    database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 347,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 9037,
        "startColumnNumber" : 27,
        "endLineNumber" : 9037,
        "endColumnNumber" : 40
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9038,
      "startColumnNumber" : 35,
      "endLineNumber" : 9038,
      "endColumnNumber" : 41
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 19,
        "startLineNumber" : 9038,
        "startColumnNumber" : 35,
        "endLineNumber" : 9038,
        "endColumnNumber" : 54
      },
      "nodeContext" : "cursor.longValue(0)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 9038,
        "startColumnNumber" : 29,
        "endLineNumber" : 9038,
        "endColumnNumber" : 54
      },
      "nodeContext" : "uid=cursor.longValue(0)",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 9038,
        "startColumnNumber" : 24,
        "endLineNumber" : 9038,
        "endColumnNumber" : 55
      },
      "nodeContext" : "long uid=cursor.longValue(0);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,body]",
      "nodePosition" : {
        "charLength" : 903,
        "startLineNumber" : 9037,
        "startColumnNumber" : 42,
        "endLineNumber" : 9057,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  long uid=cursor.longValue(0);\n  int type=cursor.intValue(1);\n  if (mediaCounts == null) {\n    mediaCounts=new SparseArray<>();\n  }\n  LongSparseArray<Integer> counts=mediaCounts.get(type);\n  Integer count;\n  if (counts == null) {\n    counts=new LongSparseArray<>();\n    count=0;\n    mediaCounts.put(type,counts);\n  }\n else {\n    count=counts.get(uid);\n  }\n  if (count == null) {\n    count=0;\n  }\n  count++;\n  counts.put(uid,count);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 94,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 925,
        "startLineNumber" : 9037,
        "startColumnNumber" : 20,
        "endLineNumber" : 9057,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long uid=cursor.longValue(0);\n  int type=cursor.intValue(1);\n  if (mediaCounts == null) {\n    mediaCounts=new SparseArray<>();\n  }\n  LongSparseArray<Integer> counts=mediaCounts.get(type);\n  Integer count;\n  if (counts == null) {\n    counts=new LongSparseArray<>();\n    count=0;\n    mediaCounts.put(type,counts);\n  }\n else {\n    count=counts.get(uid);\n  }\n  if (count == null) {\n    count=0;\n  }\n  count++;\n  counts.put(uid,count);\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 98,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2978,
        "startLineNumber" : 9034,
        "startColumnNumber" : 36,
        "endLineNumber" : 9088,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 310,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 3387,
        "startLineNumber" : 9034,
        "startColumnNumber" : 16,
        "endLineNumber" : 9094,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (temp.isEmpty()) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n else {\n  if (channelId == 0) {\n    database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n  }\n else {\n    database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 347,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 9038,
        "startColumnNumber" : 24,
        "endLineNumber" : 9038,
        "endColumnNumber" : 55
      },
      "nodeContext" : "long uid=cursor.longValue(0);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9039,
      "startColumnNumber" : 35,
      "endLineNumber" : 9039,
      "endColumnNumber" : 41
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 9039,
        "startColumnNumber" : 35,
        "endLineNumber" : 9039,
        "endColumnNumber" : 53
      },
      "nodeContext" : "cursor.intValue(1)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 9039,
        "startColumnNumber" : 28,
        "endLineNumber" : 9039,
        "endColumnNumber" : 53
      },
      "nodeContext" : "type=cursor.intValue(1)",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 30,
        "startLineNumber" : 9039,
        "startColumnNumber" : 24,
        "endLineNumber" : 9039,
        "endColumnNumber" : 54
      },
      "nodeContext" : "int type=cursor.intValue(1);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,body]",
      "nodePosition" : {
        "charLength" : 903,
        "startLineNumber" : 9037,
        "startColumnNumber" : 42,
        "endLineNumber" : 9057,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  long uid=cursor.longValue(0);\n  int type=cursor.intValue(1);\n  if (mediaCounts == null) {\n    mediaCounts=new SparseArray<>();\n  }\n  LongSparseArray<Integer> counts=mediaCounts.get(type);\n  Integer count;\n  if (counts == null) {\n    counts=new LongSparseArray<>();\n    count=0;\n    mediaCounts.put(type,counts);\n  }\n else {\n    count=counts.get(uid);\n  }\n  if (count == null) {\n    count=0;\n  }\n  count++;\n  counts.put(uid,count);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 94,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 925,
        "startLineNumber" : 9037,
        "startColumnNumber" : 20,
        "endLineNumber" : 9057,
        "endColumnNumber" : 21
      },
      "nodeContext" : "while (cursor.next()) {\n  long uid=cursor.longValue(0);\n  int type=cursor.intValue(1);\n  if (mediaCounts == null) {\n    mediaCounts=new SparseArray<>();\n  }\n  LongSparseArray<Integer> counts=mediaCounts.get(type);\n  Integer count;\n  if (counts == null) {\n    counts=new LongSparseArray<>();\n    count=0;\n    mediaCounts.put(type,counts);\n  }\n else {\n    count=counts.get(uid);\n  }\n  if (count == null) {\n    count=0;\n  }\n  count++;\n  counts.put(uid,count);\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 98,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2978,
        "startLineNumber" : 9034,
        "startColumnNumber" : 36,
        "endLineNumber" : 9088,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 310,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 3387,
        "startLineNumber" : 9034,
        "startColumnNumber" : 16,
        "endLineNumber" : 9094,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (temp.isEmpty()) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n else {\n  if (channelId == 0) {\n    database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n  }\n else {\n    database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 347,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 30,
        "startLineNumber" : 9039,
        "startColumnNumber" : 24,
        "endLineNumber" : 9039,
        "endColumnNumber" : 54
      },
      "nodeContext" : "int type=cursor.intValue(1);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9058,
      "startColumnNumber" : 20,
      "endLineNumber" : 9058,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 16,
        "startLineNumber" : 9058,
        "startColumnNumber" : 20,
        "endLineNumber" : 9058,
        "endColumnNumber" : 36
      },
      "nodeContext" : "cursor.dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 9058,
        "startColumnNumber" : 20,
        "endLineNumber" : 9058,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2978,
        "startLineNumber" : 9034,
        "startColumnNumber" : 36,
        "endLineNumber" : 9088,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 310,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 3387,
        "startLineNumber" : 9034,
        "startColumnNumber" : 16,
        "endLineNumber" : 9094,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (temp.isEmpty()) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n else {\n  if (channelId == 0) {\n    database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n  }\n else {\n    database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 347,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 9058,
        "startColumnNumber" : 20,
        "endLineNumber" : 9058,
        "endColumnNumber" : 37
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9070,
      "startColumnNumber" : 36,
      "endLineNumber" : 9070,
      "endColumnNumber" : 42
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 9070,
        "startColumnNumber" : 36,
        "endLineNumber" : 9070,
        "endColumnNumber" : 49
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 180,
        "startLineNumber" : 9070,
        "startColumnNumber" : 32,
        "endLineNumber" : 9073,
        "endColumnNumber" : 33
      },
      "nodeContext" : "if (cursor.next()) {\n  count=cursor.intValue(0);\n  old=cursor.intValue(1);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 19,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1211,
        "startLineNumber" : 9064,
        "startColumnNumber" : 67,
        "endLineNumber" : 9084,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  long uid=value.keyAt(b);\n  int lower_part=(int)uid;\n  int count=-1;\n  int old=0;\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n  if (cursor.next()) {\n    count=cursor.intValue(0);\n    old=cursor.intValue(1);\n  }\n  cursor.dispose();\n  if (count != -1) {\n    state.requery();\n    count=Math.max(0,count - value.valueAt(b));\n    state.bindLong(1,uid);\n    state.bindInteger(2,type);\n    state.bindInteger(3,count);\n    state.bindInteger(4,old);\n    state.step();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 116,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1250,
        "startLineNumber" : 9064,
        "startColumnNumber" : 28,
        "endLineNumber" : 9084,
        "endColumnNumber" : 29
      },
      "nodeContext" : "for (int b=0; b < value.size(); b++) {\n  long uid=value.keyAt(b);\n  int lower_part=(int)uid;\n  int count=-1;\n  int old=0;\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n  if (cursor.next()) {\n    count=cursor.intValue(0);\n    old=cursor.intValue(1);\n  }\n  cursor.dispose();\n  if (count != -1) {\n    state.requery();\n    count=Math.max(0,count - value.valueAt(b));\n    state.bindLong(1,uid);\n    state.bindInteger(2,type);\n    state.bindInteger(3,count);\n    state.bindInteger(4,old);\n    state.step();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 129,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1452,
        "startLineNumber" : 9061,
        "startColumnNumber" : 69,
        "endLineNumber" : 9085,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  int type=mediaCounts.keyAt(a);\n  LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n  for (int b=0; b < value.size(); b++) {\n    long uid=value.keyAt(b);\n    int lower_part=(int)uid;\n    int count=-1;\n    int old=0;\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n    if (cursor.next()) {\n      count=cursor.intValue(0);\n      old=cursor.intValue(1);\n    }\n    cursor.dispose();\n    if (count != -1) {\n      state.requery();\n      count=Math.max(0,count - value.valueAt(b));\n      state.bindLong(1,uid);\n      state.bindInteger(2,type);\n      state.bindInteger(3,count);\n      state.bindInteger(4,old);\n      state.step();\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 150,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1497,
        "startLineNumber" : 9061,
        "startColumnNumber" : 24,
        "endLineNumber" : 9085,
        "endColumnNumber" : 25
      },
      "nodeContext" : "for (int a=0; a < mediaCounts.size(); a++) {\n  int type=mediaCounts.keyAt(a);\n  LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n  for (int b=0; b < value.size(); b++) {\n    long uid=value.keyAt(b);\n    int lower_part=(int)uid;\n    int count=-1;\n    int old=0;\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n    if (cursor.next()) {\n      count=cursor.intValue(0);\n      old=cursor.intValue(1);\n    }\n    cursor.dispose();\n    if (count != -1) {\n      state.requery();\n      count=Math.max(0,count - value.valueAt(b));\n      state.bindLong(1,uid);\n      state.bindInteger(2,type);\n      state.bindInteger(3,count);\n      state.bindInteger(4,old);\n      state.step();\n    }\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 163,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1715,
        "startLineNumber" : 9059,
        "startColumnNumber" : 45,
        "endLineNumber" : 9087,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n  for (int a=0; a < mediaCounts.size(); a++) {\n    int type=mediaCounts.keyAt(a);\n    LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n    for (int b=0; b < value.size(); b++) {\n      long uid=value.keyAt(b);\n      int lower_part=(int)uid;\n      int count=-1;\n      int old=0;\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n      if (cursor.next()) {\n        count=cursor.intValue(0);\n        old=cursor.intValue(1);\n      }\n      cursor.dispose();\n      if (count != -1) {\n        state.requery();\n        count=Math.max(0,count - value.valueAt(b));\n        state.bindLong(1,uid);\n        state.bindInteger(2,type);\n        state.bindInteger(3,count);\n        state.bindInteger(4,old);\n        state.step();\n      }\n    }\n  }\n  state.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 177,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1740,
        "startLineNumber" : 9059,
        "startColumnNumber" : 20,
        "endLineNumber" : 9087,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (mediaCounts != null) {\n  SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n  for (int a=0; a < mediaCounts.size(); a++) {\n    int type=mediaCounts.keyAt(a);\n    LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n    for (int b=0; b < value.size(); b++) {\n      long uid=value.keyAt(b);\n      int lower_part=(int)uid;\n      int count=-1;\n      int old=0;\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n      if (cursor.next()) {\n        count=cursor.intValue(0);\n        old=cursor.intValue(1);\n      }\n      cursor.dispose();\n      if (count != -1) {\n        state.requery();\n        count=Math.max(0,count - value.valueAt(b));\n        state.bindLong(1,uid);\n        state.bindInteger(2,type);\n        state.bindInteger(3,count);\n        state.bindInteger(4,old);\n        state.step();\n      }\n    }\n  }\n  state.dispose();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 181,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2978,
        "startLineNumber" : 9034,
        "startColumnNumber" : 36,
        "endLineNumber" : 9088,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 310,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 3387,
        "startLineNumber" : 9034,
        "startColumnNumber" : 16,
        "endLineNumber" : 9094,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (temp.isEmpty()) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n else {\n  if (channelId == 0) {\n    database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n  }\n else {\n    database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 347,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 13,
        "startLineNumber" : 9070,
        "startColumnNumber" : 36,
        "endLineNumber" : 9070,
        "endColumnNumber" : 49
      },
      "nodeContext" : "cursor.next()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9071,
      "startColumnNumber" : 44,
      "endLineNumber" : 9071,
      "endColumnNumber" : 50
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.Assignment,rightHandSide]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 9071,
        "startColumnNumber" : 44,
        "endLineNumber" : 9071,
        "endColumnNumber" : 62
      },
      "nodeContext" : "cursor.intValue(0)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 26,
        "startLineNumber" : 9071,
        "startColumnNumber" : 36,
        "endLineNumber" : 9071,
        "endColumnNumber" : 62
      },
      "nodeContext" : "count=cursor.intValue(0)",
      "nodeType" : "Assignment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 27,
        "startLineNumber" : 9071,
        "startColumnNumber" : 36,
        "endLineNumber" : 9071,
        "endColumnNumber" : 63
      },
      "nodeContext" : "count=cursor.intValue(0);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 161,
        "startLineNumber" : 9070,
        "startColumnNumber" : 51,
        "endLineNumber" : 9073,
        "endColumnNumber" : 33
      },
      "nodeContext" : "{\n  count=cursor.intValue(0);\n  old=cursor.intValue(1);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 15,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 180,
        "startLineNumber" : 9070,
        "startColumnNumber" : 32,
        "endLineNumber" : 9073,
        "endColumnNumber" : 33
      },
      "nodeContext" : "if (cursor.next()) {\n  count=cursor.intValue(0);\n  old=cursor.intValue(1);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 19,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1211,
        "startLineNumber" : 9064,
        "startColumnNumber" : 67,
        "endLineNumber" : 9084,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  long uid=value.keyAt(b);\n  int lower_part=(int)uid;\n  int count=-1;\n  int old=0;\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n  if (cursor.next()) {\n    count=cursor.intValue(0);\n    old=cursor.intValue(1);\n  }\n  cursor.dispose();\n  if (count != -1) {\n    state.requery();\n    count=Math.max(0,count - value.valueAt(b));\n    state.bindLong(1,uid);\n    state.bindInteger(2,type);\n    state.bindInteger(3,count);\n    state.bindInteger(4,old);\n    state.step();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 116,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1250,
        "startLineNumber" : 9064,
        "startColumnNumber" : 28,
        "endLineNumber" : 9084,
        "endColumnNumber" : 29
      },
      "nodeContext" : "for (int b=0; b < value.size(); b++) {\n  long uid=value.keyAt(b);\n  int lower_part=(int)uid;\n  int count=-1;\n  int old=0;\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n  if (cursor.next()) {\n    count=cursor.intValue(0);\n    old=cursor.intValue(1);\n  }\n  cursor.dispose();\n  if (count != -1) {\n    state.requery();\n    count=Math.max(0,count - value.valueAt(b));\n    state.bindLong(1,uid);\n    state.bindInteger(2,type);\n    state.bindInteger(3,count);\n    state.bindInteger(4,old);\n    state.step();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 129,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1452,
        "startLineNumber" : 9061,
        "startColumnNumber" : 69,
        "endLineNumber" : 9085,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  int type=mediaCounts.keyAt(a);\n  LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n  for (int b=0; b < value.size(); b++) {\n    long uid=value.keyAt(b);\n    int lower_part=(int)uid;\n    int count=-1;\n    int old=0;\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n    if (cursor.next()) {\n      count=cursor.intValue(0);\n      old=cursor.intValue(1);\n    }\n    cursor.dispose();\n    if (count != -1) {\n      state.requery();\n      count=Math.max(0,count - value.valueAt(b));\n      state.bindLong(1,uid);\n      state.bindInteger(2,type);\n      state.bindInteger(3,count);\n      state.bindInteger(4,old);\n      state.step();\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 150,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1497,
        "startLineNumber" : 9061,
        "startColumnNumber" : 24,
        "endLineNumber" : 9085,
        "endColumnNumber" : 25
      },
      "nodeContext" : "for (int a=0; a < mediaCounts.size(); a++) {\n  int type=mediaCounts.keyAt(a);\n  LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n  for (int b=0; b < value.size(); b++) {\n    long uid=value.keyAt(b);\n    int lower_part=(int)uid;\n    int count=-1;\n    int old=0;\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n    if (cursor.next()) {\n      count=cursor.intValue(0);\n      old=cursor.intValue(1);\n    }\n    cursor.dispose();\n    if (count != -1) {\n      state.requery();\n      count=Math.max(0,count - value.valueAt(b));\n      state.bindLong(1,uid);\n      state.bindInteger(2,type);\n      state.bindInteger(3,count);\n      state.bindInteger(4,old);\n      state.step();\n    }\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 163,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1715,
        "startLineNumber" : 9059,
        "startColumnNumber" : 45,
        "endLineNumber" : 9087,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n  for (int a=0; a < mediaCounts.size(); a++) {\n    int type=mediaCounts.keyAt(a);\n    LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n    for (int b=0; b < value.size(); b++) {\n      long uid=value.keyAt(b);\n      int lower_part=(int)uid;\n      int count=-1;\n      int old=0;\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n      if (cursor.next()) {\n        count=cursor.intValue(0);\n        old=cursor.intValue(1);\n      }\n      cursor.dispose();\n      if (count != -1) {\n        state.requery();\n        count=Math.max(0,count - value.valueAt(b));\n        state.bindLong(1,uid);\n        state.bindInteger(2,type);\n        state.bindInteger(3,count);\n        state.bindInteger(4,old);\n        state.step();\n      }\n    }\n  }\n  state.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 177,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1740,
        "startLineNumber" : 9059,
        "startColumnNumber" : 20,
        "endLineNumber" : 9087,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (mediaCounts != null) {\n  SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n  for (int a=0; a < mediaCounts.size(); a++) {\n    int type=mediaCounts.keyAt(a);\n    LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n    for (int b=0; b < value.size(); b++) {\n      long uid=value.keyAt(b);\n      int lower_part=(int)uid;\n      int count=-1;\n      int old=0;\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n      if (cursor.next()) {\n        count=cursor.intValue(0);\n        old=cursor.intValue(1);\n      }\n      cursor.dispose();\n      if (count != -1) {\n        state.requery();\n        count=Math.max(0,count - value.valueAt(b));\n        state.bindLong(1,uid);\n        state.bindInteger(2,type);\n        state.bindInteger(3,count);\n        state.bindInteger(4,old);\n        state.step();\n      }\n    }\n  }\n  state.dispose();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 181,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2978,
        "startLineNumber" : 9034,
        "startColumnNumber" : 36,
        "endLineNumber" : 9088,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 310,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 3387,
        "startLineNumber" : 9034,
        "startColumnNumber" : 16,
        "endLineNumber" : 9094,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (temp.isEmpty()) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n else {\n  if (channelId == 0) {\n    database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n  }\n else {\n    database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 347,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 27,
        "startLineNumber" : 9071,
        "startColumnNumber" : 36,
        "endLineNumber" : 9071,
        "endColumnNumber" : 63
      },
      "nodeContext" : "count=cursor.intValue(0);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9072,
      "startColumnNumber" : 42,
      "endLineNumber" : 9072,
      "endColumnNumber" : 48
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.Assignment,rightHandSide]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 9072,
        "startColumnNumber" : 42,
        "endLineNumber" : 9072,
        "endColumnNumber" : 60
      },
      "nodeContext" : "cursor.intValue(1)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 24,
        "startLineNumber" : 9072,
        "startColumnNumber" : 36,
        "endLineNumber" : 9072,
        "endColumnNumber" : 60
      },
      "nodeContext" : "old=cursor.intValue(1)",
      "nodeType" : "Assignment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 9072,
        "startColumnNumber" : 36,
        "endLineNumber" : 9072,
        "endColumnNumber" : 61
      },
      "nodeContext" : "old=cursor.intValue(1);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 161,
        "startLineNumber" : 9070,
        "startColumnNumber" : 51,
        "endLineNumber" : 9073,
        "endColumnNumber" : 33
      },
      "nodeContext" : "{\n  count=cursor.intValue(0);\n  old=cursor.intValue(1);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 15,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 180,
        "startLineNumber" : 9070,
        "startColumnNumber" : 32,
        "endLineNumber" : 9073,
        "endColumnNumber" : 33
      },
      "nodeContext" : "if (cursor.next()) {\n  count=cursor.intValue(0);\n  old=cursor.intValue(1);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 19,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1211,
        "startLineNumber" : 9064,
        "startColumnNumber" : 67,
        "endLineNumber" : 9084,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  long uid=value.keyAt(b);\n  int lower_part=(int)uid;\n  int count=-1;\n  int old=0;\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n  if (cursor.next()) {\n    count=cursor.intValue(0);\n    old=cursor.intValue(1);\n  }\n  cursor.dispose();\n  if (count != -1) {\n    state.requery();\n    count=Math.max(0,count - value.valueAt(b));\n    state.bindLong(1,uid);\n    state.bindInteger(2,type);\n    state.bindInteger(3,count);\n    state.bindInteger(4,old);\n    state.step();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 116,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1250,
        "startLineNumber" : 9064,
        "startColumnNumber" : 28,
        "endLineNumber" : 9084,
        "endColumnNumber" : 29
      },
      "nodeContext" : "for (int b=0; b < value.size(); b++) {\n  long uid=value.keyAt(b);\n  int lower_part=(int)uid;\n  int count=-1;\n  int old=0;\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n  if (cursor.next()) {\n    count=cursor.intValue(0);\n    old=cursor.intValue(1);\n  }\n  cursor.dispose();\n  if (count != -1) {\n    state.requery();\n    count=Math.max(0,count - value.valueAt(b));\n    state.bindLong(1,uid);\n    state.bindInteger(2,type);\n    state.bindInteger(3,count);\n    state.bindInteger(4,old);\n    state.step();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 129,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1452,
        "startLineNumber" : 9061,
        "startColumnNumber" : 69,
        "endLineNumber" : 9085,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  int type=mediaCounts.keyAt(a);\n  LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n  for (int b=0; b < value.size(); b++) {\n    long uid=value.keyAt(b);\n    int lower_part=(int)uid;\n    int count=-1;\n    int old=0;\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n    if (cursor.next()) {\n      count=cursor.intValue(0);\n      old=cursor.intValue(1);\n    }\n    cursor.dispose();\n    if (count != -1) {\n      state.requery();\n      count=Math.max(0,count - value.valueAt(b));\n      state.bindLong(1,uid);\n      state.bindInteger(2,type);\n      state.bindInteger(3,count);\n      state.bindInteger(4,old);\n      state.step();\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 150,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1497,
        "startLineNumber" : 9061,
        "startColumnNumber" : 24,
        "endLineNumber" : 9085,
        "endColumnNumber" : 25
      },
      "nodeContext" : "for (int a=0; a < mediaCounts.size(); a++) {\n  int type=mediaCounts.keyAt(a);\n  LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n  for (int b=0; b < value.size(); b++) {\n    long uid=value.keyAt(b);\n    int lower_part=(int)uid;\n    int count=-1;\n    int old=0;\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n    if (cursor.next()) {\n      count=cursor.intValue(0);\n      old=cursor.intValue(1);\n    }\n    cursor.dispose();\n    if (count != -1) {\n      state.requery();\n      count=Math.max(0,count - value.valueAt(b));\n      state.bindLong(1,uid);\n      state.bindInteger(2,type);\n      state.bindInteger(3,count);\n      state.bindInteger(4,old);\n      state.step();\n    }\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 163,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1715,
        "startLineNumber" : 9059,
        "startColumnNumber" : 45,
        "endLineNumber" : 9087,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n  for (int a=0; a < mediaCounts.size(); a++) {\n    int type=mediaCounts.keyAt(a);\n    LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n    for (int b=0; b < value.size(); b++) {\n      long uid=value.keyAt(b);\n      int lower_part=(int)uid;\n      int count=-1;\n      int old=0;\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n      if (cursor.next()) {\n        count=cursor.intValue(0);\n        old=cursor.intValue(1);\n      }\n      cursor.dispose();\n      if (count != -1) {\n        state.requery();\n        count=Math.max(0,count - value.valueAt(b));\n        state.bindLong(1,uid);\n        state.bindInteger(2,type);\n        state.bindInteger(3,count);\n        state.bindInteger(4,old);\n        state.step();\n      }\n    }\n  }\n  state.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 177,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1740,
        "startLineNumber" : 9059,
        "startColumnNumber" : 20,
        "endLineNumber" : 9087,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (mediaCounts != null) {\n  SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n  for (int a=0; a < mediaCounts.size(); a++) {\n    int type=mediaCounts.keyAt(a);\n    LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n    for (int b=0; b < value.size(); b++) {\n      long uid=value.keyAt(b);\n      int lower_part=(int)uid;\n      int count=-1;\n      int old=0;\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n      if (cursor.next()) {\n        count=cursor.intValue(0);\n        old=cursor.intValue(1);\n      }\n      cursor.dispose();\n      if (count != -1) {\n        state.requery();\n        count=Math.max(0,count - value.valueAt(b));\n        state.bindLong(1,uid);\n        state.bindInteger(2,type);\n        state.bindInteger(3,count);\n        state.bindInteger(4,old);\n        state.step();\n      }\n    }\n  }\n  state.dispose();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 181,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2978,
        "startLineNumber" : 9034,
        "startColumnNumber" : 36,
        "endLineNumber" : 9088,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 310,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 3387,
        "startLineNumber" : 9034,
        "startColumnNumber" : 16,
        "endLineNumber" : 9094,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (temp.isEmpty()) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n else {\n  if (channelId == 0) {\n    database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n  }\n else {\n    database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 347,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 9072,
        "startColumnNumber" : 36,
        "endLineNumber" : 9072,
        "endColumnNumber" : 61
      },
      "nodeContext" : "old=cursor.intValue(1);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  }, {
    "nodeContext" : "cursor",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 6,
      "startLineNumber" : 9074,
      "startColumnNumber" : 32,
      "endLineNumber" : 9074,
      "endColumnNumber" : 38
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 16,
        "startLineNumber" : 9074,
        "startColumnNumber" : 32,
        "endLineNumber" : 9074,
        "endColumnNumber" : 48
      },
      "nodeContext" : "cursor.dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 9074,
        "startColumnNumber" : 32,
        "endLineNumber" : 9074,
        "endColumnNumber" : 49
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1211,
        "startLineNumber" : 9064,
        "startColumnNumber" : 67,
        "endLineNumber" : 9084,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  long uid=value.keyAt(b);\n  int lower_part=(int)uid;\n  int count=-1;\n  int old=0;\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n  if (cursor.next()) {\n    count=cursor.intValue(0);\n    old=cursor.intValue(1);\n  }\n  cursor.dispose();\n  if (count != -1) {\n    state.requery();\n    count=Math.max(0,count - value.valueAt(b));\n    state.bindLong(1,uid);\n    state.bindInteger(2,type);\n    state.bindInteger(3,count);\n    state.bindInteger(4,old);\n    state.step();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 116,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1250,
        "startLineNumber" : 9064,
        "startColumnNumber" : 28,
        "endLineNumber" : 9084,
        "endColumnNumber" : 29
      },
      "nodeContext" : "for (int b=0; b < value.size(); b++) {\n  long uid=value.keyAt(b);\n  int lower_part=(int)uid;\n  int count=-1;\n  int old=0;\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n  if (cursor.next()) {\n    count=cursor.intValue(0);\n    old=cursor.intValue(1);\n  }\n  cursor.dispose();\n  if (count != -1) {\n    state.requery();\n    count=Math.max(0,count - value.valueAt(b));\n    state.bindLong(1,uid);\n    state.bindInteger(2,type);\n    state.bindInteger(3,count);\n    state.bindInteger(4,old);\n    state.step();\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 129,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ForStatement,body]",
      "nodePosition" : {
        "charLength" : 1452,
        "startLineNumber" : 9061,
        "startColumnNumber" : 69,
        "endLineNumber" : 9085,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  int type=mediaCounts.keyAt(a);\n  LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n  for (int b=0; b < value.size(); b++) {\n    long uid=value.keyAt(b);\n    int lower_part=(int)uid;\n    int count=-1;\n    int old=0;\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n    if (cursor.next()) {\n      count=cursor.intValue(0);\n      old=cursor.intValue(1);\n    }\n    cursor.dispose();\n    if (count != -1) {\n      state.requery();\n      count=Math.max(0,count - value.valueAt(b));\n      state.bindLong(1,uid);\n      state.bindInteger(2,type);\n      state.bindInteger(3,count);\n      state.bindInteger(4,old);\n      state.step();\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 150,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1497,
        "startLineNumber" : 9061,
        "startColumnNumber" : 24,
        "endLineNumber" : 9085,
        "endColumnNumber" : 25
      },
      "nodeContext" : "for (int a=0; a < mediaCounts.size(); a++) {\n  int type=mediaCounts.keyAt(a);\n  LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n  for (int b=0; b < value.size(); b++) {\n    long uid=value.keyAt(b);\n    int lower_part=(int)uid;\n    int count=-1;\n    int old=0;\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n    if (cursor.next()) {\n      count=cursor.intValue(0);\n      old=cursor.intValue(1);\n    }\n    cursor.dispose();\n    if (count != -1) {\n      state.requery();\n      count=Math.max(0,count - value.valueAt(b));\n      state.bindLong(1,uid);\n      state.bindInteger(2,type);\n      state.bindInteger(3,count);\n      state.bindInteger(4,old);\n      state.step();\n    }\n  }\n}\n",
      "nodeType" : "ForStatement",
      "astNodeNumber" : 163,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1715,
        "startLineNumber" : 9059,
        "startColumnNumber" : 45,
        "endLineNumber" : 9087,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n  for (int a=0; a < mediaCounts.size(); a++) {\n    int type=mediaCounts.keyAt(a);\n    LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n    for (int b=0; b < value.size(); b++) {\n      long uid=value.keyAt(b);\n      int lower_part=(int)uid;\n      int count=-1;\n      int old=0;\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n      if (cursor.next()) {\n        count=cursor.intValue(0);\n        old=cursor.intValue(1);\n      }\n      cursor.dispose();\n      if (count != -1) {\n        state.requery();\n        count=Math.max(0,count - value.valueAt(b));\n        state.bindLong(1,uid);\n        state.bindInteger(2,type);\n        state.bindInteger(3,count);\n        state.bindInteger(4,old);\n        state.step();\n      }\n    }\n  }\n  state.dispose();\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 177,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1740,
        "startLineNumber" : 9059,
        "startColumnNumber" : 20,
        "endLineNumber" : 9087,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (mediaCounts != null) {\n  SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n  for (int a=0; a < mediaCounts.size(); a++) {\n    int type=mediaCounts.keyAt(a);\n    LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n    for (int b=0; b < value.size(); b++) {\n      long uid=value.keyAt(b);\n      int lower_part=(int)uid;\n      int count=-1;\n      int old=0;\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n      if (cursor.next()) {\n        count=cursor.intValue(0);\n        old=cursor.intValue(1);\n      }\n      cursor.dispose();\n      if (count != -1) {\n        state.requery();\n        count=Math.max(0,count - value.valueAt(b));\n        state.bindLong(1,uid);\n        state.bindInteger(2,type);\n        state.bindInteger(3,count);\n        state.bindInteger(4,old);\n        state.step();\n      }\n    }\n  }\n  state.dispose();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 181,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2978,
        "startLineNumber" : 9034,
        "startColumnNumber" : 36,
        "endLineNumber" : 9088,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 310,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 3387,
        "startLineNumber" : 9034,
        "startColumnNumber" : 16,
        "endLineNumber" : 9094,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (temp.isEmpty()) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n else {\n  if (channelId == 0) {\n    database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n  }\n else {\n    database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 347,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 9074,
        "startColumnNumber" : 32,
        "endLineNumber" : 9074,
        "endColumnNumber" : 49
      },
      "nodeContext" : "cursor.dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.SQLite.SQLiteCursor"
  } ],
  "positionList" : [ {
    "charLength" : 6,
    "startLineNumber" : 8888,
    "startColumnNumber" : 27,
    "endLineNumber" : 8888,
    "endColumnNumber" : 33
  }, {
    "charLength" : 6,
    "startLineNumber" : 8889,
    "startColumnNumber" : 35,
    "endLineNumber" : 8889,
    "endColumnNumber" : 41
  }, {
    "charLength" : 6,
    "startLineNumber" : 8897,
    "startColumnNumber" : 16,
    "endLineNumber" : 8897,
    "endColumnNumber" : 22
  }, {
    "charLength" : 6,
    "startLineNumber" : 8929,
    "startColumnNumber" : 27,
    "endLineNumber" : 8929,
    "endColumnNumber" : 33
  }, {
    "charLength" : 6,
    "startLineNumber" : 8930,
    "startColumnNumber" : 35,
    "endLineNumber" : 8930,
    "endColumnNumber" : 41
  }, {
    "charLength" : 6,
    "startLineNumber" : 8931,
    "startColumnNumber" : 34,
    "endLineNumber" : 8931,
    "endColumnNumber" : 40
  }, {
    "charLength" : 6,
    "startLineNumber" : 8940,
    "startColumnNumber" : 45,
    "endLineNumber" : 8940,
    "endColumnNumber" : 51
  }, {
    "charLength" : 6,
    "startLineNumber" : 8941,
    "startColumnNumber" : 32,
    "endLineNumber" : 8941,
    "endColumnNumber" : 38
  }, {
    "charLength" : 6,
    "startLineNumber" : 8958,
    "startColumnNumber" : 48,
    "endLineNumber" : 8958,
    "endColumnNumber" : 54
  }, {
    "charLength" : 6,
    "startLineNumber" : 8969,
    "startColumnNumber" : 16,
    "endLineNumber" : 8969,
    "endColumnNumber" : 22
  }, {
    "charLength" : 6,
    "startLineNumber" : 8981,
    "startColumnNumber" : 24,
    "endLineNumber" : 8981,
    "endColumnNumber" : 30
  }, {
    "charLength" : 6,
    "startLineNumber" : 8982,
    "startColumnNumber" : 43,
    "endLineNumber" : 8982,
    "endColumnNumber" : 49
  }, {
    "charLength" : 6,
    "startLineNumber" : 8983,
    "startColumnNumber" : 45,
    "endLineNumber" : 8983,
    "endColumnNumber" : 51
  }, {
    "charLength" : 6,
    "startLineNumber" : 8985,
    "startColumnNumber" : 20,
    "endLineNumber" : 8985,
    "endColumnNumber" : 26
  }, {
    "charLength" : 6,
    "startLineNumber" : 9012,
    "startColumnNumber" : 24,
    "endLineNumber" : 9012,
    "endColumnNumber" : 30
  }, {
    "charLength" : 6,
    "startLineNumber" : 9013,
    "startColumnNumber" : 39,
    "endLineNumber" : 9013,
    "endColumnNumber" : 45
  }, {
    "charLength" : 6,
    "startLineNumber" : 9015,
    "startColumnNumber" : 20,
    "endLineNumber" : 9015,
    "endColumnNumber" : 26
  }, {
    "charLength" : 6,
    "startLineNumber" : 9018,
    "startColumnNumber" : 28,
    "endLineNumber" : 9018,
    "endColumnNumber" : 34
  }, {
    "charLength" : 6,
    "startLineNumber" : 9019,
    "startColumnNumber" : 40,
    "endLineNumber" : 9019,
    "endColumnNumber" : 46
  }, {
    "charLength" : 6,
    "startLineNumber" : 9027,
    "startColumnNumber" : 24,
    "endLineNumber" : 9027,
    "endColumnNumber" : 30
  }, {
    "charLength" : 6,
    "startLineNumber" : 9037,
    "startColumnNumber" : 27,
    "endLineNumber" : 9037,
    "endColumnNumber" : 33
  }, {
    "charLength" : 6,
    "startLineNumber" : 9038,
    "startColumnNumber" : 35,
    "endLineNumber" : 9038,
    "endColumnNumber" : 41
  }, {
    "charLength" : 6,
    "startLineNumber" : 9039,
    "startColumnNumber" : 35,
    "endLineNumber" : 9039,
    "endColumnNumber" : 41
  }, {
    "charLength" : 6,
    "startLineNumber" : 9058,
    "startColumnNumber" : 20,
    "endLineNumber" : 9058,
    "endColumnNumber" : 26
  }, {
    "charLength" : 6,
    "startLineNumber" : 9070,
    "startColumnNumber" : 36,
    "endLineNumber" : 9070,
    "endColumnNumber" : 42
  }, {
    "charLength" : 6,
    "startLineNumber" : 9071,
    "startColumnNumber" : 44,
    "endLineNumber" : 9071,
    "endColumnNumber" : 50
  }, {
    "charLength" : 6,
    "startLineNumber" : 9072,
    "startColumnNumber" : 42,
    "endLineNumber" : 9072,
    "endColumnNumber" : 48
  }, {
    "charLength" : 6,
    "startLineNumber" : 9074,
    "startColumnNumber" : 32,
    "endLineNumber" : 9074,
    "endColumnNumber" : 38
  } ],
  "layoutRelationDataList" : [ {
    "firstKey" : 0,
    "secondKey" : 1,
    "layout" : 1
  }, {
    "firstKey" : 0,
    "secondKey" : 2,
    "layout" : 4
  }, {
    "firstKey" : 0,
    "secondKey" : 3,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 7,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 9,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 10,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 11,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 12,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 13,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 14,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 15,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 16,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 17,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 18,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 19,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 20,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 21,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 22,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 23,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 24,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 25,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 26,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 27,
    "layout" : 5
  }, {
    "firstKey" : 1,
    "secondKey" : 0,
    "layout" : 4
  }, {
    "firstKey" : 1,
    "secondKey" : 2,
    "layout" : 7
  }, {
    "firstKey" : 1,
    "secondKey" : 3,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 5,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 6,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 7,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 8,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 10,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 11,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 12,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 13,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 14,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 15,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 16,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 17,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 18,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 19,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 20,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 21,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 22,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 23,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 24,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 25,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 26,
    "layout" : 8
  }, {
    "firstKey" : 1,
    "secondKey" : 27,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 0,
    "layout" : 2
  }, {
    "firstKey" : 2,
    "secondKey" : 1,
    "layout" : 2
  }, {
    "firstKey" : 2,
    "secondKey" : 3,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 4,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 5,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 6,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 7,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 8,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 9,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 10,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 11,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 12,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 13,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 14,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 15,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 16,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 17,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 18,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 19,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 20,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 21,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 22,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 23,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 24,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 25,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 26,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 27,
    "layout" : 3
  }, {
    "firstKey" : 3,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 4,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 5,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 6,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 7,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 8,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 25,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 26,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 27,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 4,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 4,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 4,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 5,
    "layout" : 3
  }, {
    "firstKey" : 4,
    "secondKey" : 6,
    "layout" : 3
  }, {
    "firstKey" : 4,
    "secondKey" : 7,
    "layout" : 3
  }, {
    "firstKey" : 4,
    "secondKey" : 8,
    "layout" : 3
  }, {
    "firstKey" : 4,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 10,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 11,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 12,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 13,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 14,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 15,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 16,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 17,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 18,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 19,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 20,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 21,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 22,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 23,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 24,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 25,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 26,
    "layout" : 7
  }, {
    "firstKey" : 4,
    "secondKey" : 27,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 5,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 5,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 5,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 5,
    "secondKey" : 4,
    "layout" : 3
  }, {
    "firstKey" : 5,
    "secondKey" : 6,
    "layout" : 3
  }, {
    "firstKey" : 5,
    "secondKey" : 7,
    "layout" : 3
  }, {
    "firstKey" : 5,
    "secondKey" : 8,
    "layout" : 3
  }, {
    "firstKey" : 5,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 10,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 11,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 12,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 13,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 14,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 15,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 16,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 17,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 18,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 19,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 20,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 21,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 22,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 23,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 24,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 25,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 26,
    "layout" : 7
  }, {
    "firstKey" : 5,
    "secondKey" : 27,
    "layout" : 7
  }, {
    "firstKey" : 6,
    "secondKey" : 0,
    "layout" : 10
  }, {
    "firstKey" : 6,
    "secondKey" : 1,
    "layout" : 10
  }, {
    "firstKey" : 6,
    "secondKey" : 2,
    "layout" : 10
  }, {
    "firstKey" : 6,
    "secondKey" : 3,
    "layout" : 6
  }, {
    "firstKey" : 6,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 7,
    "layout" : 3
  }, {
    "firstKey" : 6,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 9,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 10,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 11,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 12,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 13,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 14,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 15,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 16,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 17,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 18,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 19,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 20,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 21,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 22,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 23,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 24,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 25,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 26,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 27,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 0,
    "layout" : 10
  }, {
    "firstKey" : 7,
    "secondKey" : 1,
    "layout" : 10
  }, {
    "firstKey" : 7,
    "secondKey" : 2,
    "layout" : 10
  }, {
    "firstKey" : 7,
    "secondKey" : 3,
    "layout" : 6
  }, {
    "firstKey" : 7,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 7,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 7,
    "secondKey" : 6,
    "layout" : 3
  }, {
    "firstKey" : 7,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 7,
    "secondKey" : 9,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 10,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 11,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 12,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 13,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 14,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 15,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 16,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 17,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 18,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 19,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 20,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 21,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 22,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 23,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 24,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 25,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 26,
    "layout" : 9
  }, {
    "firstKey" : 7,
    "secondKey" : 27,
    "layout" : 9
  }, {
    "firstKey" : 8,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 8,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 8,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 8,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 4,
    "layout" : 3
  }, {
    "firstKey" : 8,
    "secondKey" : 5,
    "layout" : 3
  }, {
    "firstKey" : 8,
    "secondKey" : 6,
    "layout" : 3
  }, {
    "firstKey" : 8,
    "secondKey" : 7,
    "layout" : 3
  }, {
    "firstKey" : 8,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 10,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 11,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 12,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 13,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 14,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 15,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 16,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 17,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 18,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 19,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 20,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 21,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 22,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 23,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 24,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 25,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 26,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 27,
    "layout" : 7
  }, {
    "firstKey" : 9,
    "secondKey" : 0,
    "layout" : 3
  }, {
    "firstKey" : 9,
    "secondKey" : 1,
    "layout" : 3
  }, {
    "firstKey" : 9,
    "secondKey" : 2,
    "layout" : 3
  }, {
    "firstKey" : 9,
    "secondKey" : 3,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 4,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 5,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 6,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 7,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 8,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 10,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 11,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 12,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 13,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 14,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 15,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 16,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 18,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 19,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 20,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 21,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 22,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 23,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 24,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 25,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 26,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 27,
    "layout" : 2
  }, {
    "firstKey" : 10,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 10,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 10,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 10,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 11,
    "layout" : 1
  }, {
    "firstKey" : 10,
    "secondKey" : 12,
    "layout" : 1
  }, {
    "firstKey" : 10,
    "secondKey" : 13,
    "layout" : 2
  }, {
    "firstKey" : 10,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 25,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 26,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 27,
    "layout" : 4
  }, {
    "firstKey" : 11,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 11,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 11,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 11,
    "secondKey" : 3,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 8,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 11,
    "secondKey" : 12,
    "layout" : 3
  }, {
    "firstKey" : 11,
    "secondKey" : 13,
    "layout" : 5
  }, {
    "firstKey" : 11,
    "secondKey" : 14,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 15,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 16,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 17,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 18,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 19,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 20,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 21,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 22,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 23,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 24,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 25,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 26,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 27,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 3,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 8,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 11,
    "layout" : 3
  }, {
    "firstKey" : 12,
    "secondKey" : 13,
    "layout" : 5
  }, {
    "firstKey" : 12,
    "secondKey" : 14,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 15,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 16,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 17,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 18,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 19,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 20,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 21,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 22,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 23,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 24,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 25,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 26,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 27,
    "layout" : 7
  }, {
    "firstKey" : 13,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 13,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 13,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 13,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 10,
    "layout" : 2
  }, {
    "firstKey" : 13,
    "secondKey" : 11,
    "layout" : 2
  }, {
    "firstKey" : 13,
    "secondKey" : 12,
    "layout" : 2
  }, {
    "firstKey" : 13,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 25,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 26,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 27,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 14,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 14,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 14,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 15,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 16,
    "layout" : 2
  }, {
    "firstKey" : 14,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 14,
    "secondKey" : 18,
    "layout" : 2
  }, {
    "firstKey" : 14,
    "secondKey" : 19,
    "layout" : 2
  }, {
    "firstKey" : 14,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 25,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 26,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 27,
    "layout" : 4
  }, {
    "firstKey" : 15,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 15,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 15,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 15,
    "secondKey" : 3,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 8,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 10,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 11,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 12,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 13,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 15,
    "secondKey" : 16,
    "layout" : 5
  }, {
    "firstKey" : 15,
    "secondKey" : 17,
    "layout" : 5
  }, {
    "firstKey" : 15,
    "secondKey" : 18,
    "layout" : 5
  }, {
    "firstKey" : 15,
    "secondKey" : 19,
    "layout" : 5
  }, {
    "firstKey" : 15,
    "secondKey" : 20,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 21,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 22,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 23,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 24,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 25,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 26,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 27,
    "layout" : 7
  }, {
    "firstKey" : 16,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 16,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 16,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 16,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 14,
    "layout" : 2
  }, {
    "firstKey" : 16,
    "secondKey" : 15,
    "layout" : 2
  }, {
    "firstKey" : 16,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 16,
    "secondKey" : 18,
    "layout" : 2
  }, {
    "firstKey" : 16,
    "secondKey" : 19,
    "layout" : 2
  }, {
    "firstKey" : 16,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 25,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 26,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 27,
    "layout" : 4
  }, {
    "firstKey" : 17,
    "secondKey" : 0,
    "layout" : 7
  }, {
    "firstKey" : 17,
    "secondKey" : 1,
    "layout" : 7
  }, {
    "firstKey" : 17,
    "secondKey" : 2,
    "layout" : 7
  }, {
    "firstKey" : 17,
    "secondKey" : 3,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 4,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 5,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 6,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 7,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 8,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 9,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 10,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 11,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 12,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 13,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 17,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 17,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 17,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 17,
    "secondKey" : 19,
    "layout" : 2
  }, {
    "firstKey" : 17,
    "secondKey" : 20,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 21,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 22,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 23,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 24,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 25,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 26,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 27,
    "layout" : 6
  }, {
    "firstKey" : 18,
    "secondKey" : 0,
    "layout" : 10
  }, {
    "firstKey" : 18,
    "secondKey" : 1,
    "layout" : 10
  }, {
    "firstKey" : 18,
    "secondKey" : 2,
    "layout" : 10
  }, {
    "firstKey" : 18,
    "secondKey" : 3,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 4,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 5,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 6,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 7,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 8,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 9,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 10,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 11,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 12,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 13,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 14,
    "layout" : 7
  }, {
    "firstKey" : 18,
    "secondKey" : 15,
    "layout" : 7
  }, {
    "firstKey" : 18,
    "secondKey" : 16,
    "layout" : 7
  }, {
    "firstKey" : 18,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 18,
    "secondKey" : 19,
    "layout" : 5
  }, {
    "firstKey" : 18,
    "secondKey" : 20,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 21,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 22,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 23,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 24,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 25,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 26,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 27,
    "layout" : 9
  }, {
    "firstKey" : 19,
    "secondKey" : 0,
    "layout" : 7
  }, {
    "firstKey" : 19,
    "secondKey" : 1,
    "layout" : 7
  }, {
    "firstKey" : 19,
    "secondKey" : 2,
    "layout" : 7
  }, {
    "firstKey" : 19,
    "secondKey" : 3,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 4,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 5,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 6,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 7,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 8,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 9,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 10,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 11,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 12,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 13,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 19,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 19,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 19,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 19,
    "secondKey" : 18,
    "layout" : 2
  }, {
    "firstKey" : 19,
    "secondKey" : 20,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 21,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 22,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 23,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 24,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 25,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 26,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 27,
    "layout" : 6
  }, {
    "firstKey" : 20,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 20,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 20,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 20,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 20,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 20,
    "secondKey" : 23,
    "layout" : 2
  }, {
    "firstKey" : 20,
    "secondKey" : 24,
    "layout" : 2
  }, {
    "firstKey" : 20,
    "secondKey" : 25,
    "layout" : 2
  }, {
    "firstKey" : 20,
    "secondKey" : 26,
    "layout" : 2
  }, {
    "firstKey" : 20,
    "secondKey" : 27,
    "layout" : 2
  }, {
    "firstKey" : 21,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 21,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 21,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 21,
    "secondKey" : 3,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 8,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 10,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 11,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 12,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 13,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 14,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 15,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 16,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 17,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 18,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 19,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 21,
    "secondKey" : 22,
    "layout" : 3
  }, {
    "firstKey" : 21,
    "secondKey" : 23,
    "layout" : 5
  }, {
    "firstKey" : 21,
    "secondKey" : 24,
    "layout" : 5
  }, {
    "firstKey" : 21,
    "secondKey" : 25,
    "layout" : 5
  }, {
    "firstKey" : 21,
    "secondKey" : 26,
    "layout" : 5
  }, {
    "firstKey" : 21,
    "secondKey" : 27,
    "layout" : 5
  }, {
    "firstKey" : 22,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 22,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 22,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 22,
    "secondKey" : 3,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 8,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 10,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 11,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 12,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 13,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 14,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 15,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 16,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 17,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 18,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 19,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 22,
    "secondKey" : 21,
    "layout" : 3
  }, {
    "firstKey" : 22,
    "secondKey" : 23,
    "layout" : 5
  }, {
    "firstKey" : 22,
    "secondKey" : 24,
    "layout" : 5
  }, {
    "firstKey" : 22,
    "secondKey" : 25,
    "layout" : 5
  }, {
    "firstKey" : 22,
    "secondKey" : 26,
    "layout" : 5
  }, {
    "firstKey" : 22,
    "secondKey" : 27,
    "layout" : 5
  }, {
    "firstKey" : 23,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 23,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 23,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 23,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 20,
    "layout" : 2
  }, {
    "firstKey" : 23,
    "secondKey" : 21,
    "layout" : 2
  }, {
    "firstKey" : 23,
    "secondKey" : 22,
    "layout" : 2
  }, {
    "firstKey" : 23,
    "secondKey" : 24,
    "layout" : 2
  }, {
    "firstKey" : 23,
    "secondKey" : 25,
    "layout" : 2
  }, {
    "firstKey" : 23,
    "secondKey" : 26,
    "layout" : 2
  }, {
    "firstKey" : 23,
    "secondKey" : 27,
    "layout" : 2
  }, {
    "firstKey" : 24,
    "secondKey" : 0,
    "layout" : 11
  }, {
    "firstKey" : 24,
    "secondKey" : 1,
    "layout" : 11
  }, {
    "firstKey" : 24,
    "secondKey" : 2,
    "layout" : 11
  }, {
    "firstKey" : 24,
    "secondKey" : 3,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 4,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 5,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 6,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 7,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 8,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 9,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 10,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 11,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 12,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 13,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 14,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 15,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 16,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 17,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 18,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 19,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 20,
    "layout" : 8
  }, {
    "firstKey" : 24,
    "secondKey" : 21,
    "layout" : 8
  }, {
    "firstKey" : 24,
    "secondKey" : 22,
    "layout" : 8
  }, {
    "firstKey" : 24,
    "secondKey" : 23,
    "layout" : 8
  }, {
    "firstKey" : 24,
    "secondKey" : 25,
    "layout" : 1
  }, {
    "firstKey" : 24,
    "secondKey" : 26,
    "layout" : 1
  }, {
    "firstKey" : 24,
    "secondKey" : 27,
    "layout" : 2
  }, {
    "firstKey" : 25,
    "secondKey" : 0,
    "layout" : 14
  }, {
    "firstKey" : 25,
    "secondKey" : 1,
    "layout" : 14
  }, {
    "firstKey" : 25,
    "secondKey" : 2,
    "layout" : 14
  }, {
    "firstKey" : 25,
    "secondKey" : 3,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 4,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 5,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 6,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 7,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 8,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 9,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 10,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 11,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 12,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 13,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 14,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 15,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 16,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 17,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 18,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 19,
    "layout" : 13
  }, {
    "firstKey" : 25,
    "secondKey" : 20,
    "layout" : 11
  }, {
    "firstKey" : 25,
    "secondKey" : 21,
    "layout" : 11
  }, {
    "firstKey" : 25,
    "secondKey" : 22,
    "layout" : 11
  }, {
    "firstKey" : 25,
    "secondKey" : 23,
    "layout" : 11
  }, {
    "firstKey" : 25,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 25,
    "secondKey" : 26,
    "layout" : 3
  }, {
    "firstKey" : 25,
    "secondKey" : 27,
    "layout" : 5
  }, {
    "firstKey" : 26,
    "secondKey" : 0,
    "layout" : 14
  }, {
    "firstKey" : 26,
    "secondKey" : 1,
    "layout" : 14
  }, {
    "firstKey" : 26,
    "secondKey" : 2,
    "layout" : 14
  }, {
    "firstKey" : 26,
    "secondKey" : 3,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 4,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 5,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 6,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 7,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 8,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 9,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 10,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 11,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 12,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 13,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 14,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 15,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 16,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 17,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 18,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 19,
    "layout" : 13
  }, {
    "firstKey" : 26,
    "secondKey" : 20,
    "layout" : 11
  }, {
    "firstKey" : 26,
    "secondKey" : 21,
    "layout" : 11
  }, {
    "firstKey" : 26,
    "secondKey" : 22,
    "layout" : 11
  }, {
    "firstKey" : 26,
    "secondKey" : 23,
    "layout" : 11
  }, {
    "firstKey" : 26,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 26,
    "secondKey" : 25,
    "layout" : 3
  }, {
    "firstKey" : 26,
    "secondKey" : 27,
    "layout" : 5
  }, {
    "firstKey" : 27,
    "secondKey" : 0,
    "layout" : 11
  }, {
    "firstKey" : 27,
    "secondKey" : 1,
    "layout" : 11
  }, {
    "firstKey" : 27,
    "secondKey" : 2,
    "layout" : 11
  }, {
    "firstKey" : 27,
    "secondKey" : 3,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 4,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 5,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 6,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 7,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 8,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 9,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 10,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 11,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 12,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 13,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 14,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 15,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 16,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 17,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 18,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 19,
    "layout" : 10
  }, {
    "firstKey" : 27,
    "secondKey" : 20,
    "layout" : 8
  }, {
    "firstKey" : 27,
    "secondKey" : 21,
    "layout" : 8
  }, {
    "firstKey" : 27,
    "secondKey" : 22,
    "layout" : 8
  }, {
    "firstKey" : 27,
    "secondKey" : 23,
    "layout" : 8
  }, {
    "firstKey" : 27,
    "secondKey" : 24,
    "layout" : 2
  }, {
    "firstKey" : 27,
    "secondKey" : 25,
    "layout" : 2
  }, {
    "firstKey" : 27,
    "secondKey" : 26,
    "layout" : 2
  } ]
}