{
  "id" : 392,
  "expression" : "messageId",
  "projectName" : "signalapp@Signal-Android",
  "commitID" : "665d9e31f6ce67e4fa24ca8ca5dc21eaa4a4d8d1",
  "filePath" : "app/src/main/java/org/thoughtcrime/securesms/database/MmsDatabase.java",
  "occurrences" : 5,
  "isArithmeticExpression" : 0,
  "isGetTypeMethod" : 0,
  "expressionList" : [ {
    "nodeContext" : "messageId",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 9,
      "startLineNumber" : 1614,
      "startColumnNumber" : 39,
      "endLineNumber" : 1614,
      "endColumnNumber" : 48
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 53,
        "startLineNumber" : 1614,
        "startColumnNumber" : 6,
        "endLineNumber" : 1614,
        "endColumnNumber" : 59
      },
      "nodeContext" : "mentionDatabase.insert(threadId,messageId,mentions)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 6,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 54,
        "startLineNumber" : 1614,
        "startColumnNumber" : 6,
        "endLineNumber" : 1614,
        "endColumnNumber" : 60
      },
      "nodeContext" : "mentionDatabase.insert(threadId,messageId,mentions);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 1573,
        "startLineNumber" : 1611,
        "startColumnNumber" : 8,
        "endLineNumber" : 1646,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 182,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1979,
        "startLineNumber" : 1611,
        "startColumnNumber" : 4,
        "endLineNumber" : 1658,
        "endColumnNumber" : 5
      },
      "nodeContext" : "try {\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n  finally {\n  db.endTransaction();\n  if (insertListener != null) {\n    insertListener.onComplete();\n  }\n  long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n  notifyConversationListeners(contentValuesThreadId);\n  DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n  ThreadUpdateJob.enqueue(contentValuesThreadId);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 223,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 3053,
        "startLineNumber" : 1591,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "{\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 390,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 3710,
        "startLineNumber" : 1581,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "private long insertMediaMessage(long threadId,@Nullable String body,@NonNull List<Attachment> attachments,@NonNull List<Attachment> quoteAttachments,@NonNull List<Contact> sharedContacts,@NonNull List<LinkPreview> linkPreviews,@NonNull List<Mention> mentions,@NonNull ContentValues contentValues,@Nullable SmsDatabase.InsertListener insertListener) throws MmsException {\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 464,
      "astHeight" : 13
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 54,
        "startLineNumber" : 1614,
        "startColumnNumber" : 6,
        "endLineNumber" : 1614,
        "endColumnNumber" : 60
      },
      "nodeContext" : "mentionDatabase.insert(threadId,messageId,mentions);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "long"
  }, {
    "nodeContext" : "messageId",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 9,
      "startLineNumber" : 1616,
      "startColumnNumber" : 100,
      "endLineNumber" : 1616,
      "endColumnNumber" : 109
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 86,
        "startLineNumber" : 1616,
        "startColumnNumber" : 58,
        "endLineNumber" : 1616,
        "endColumnNumber" : 144
      },
      "nodeContext" : "partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 6,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 108,
        "startLineNumber" : 1616,
        "startColumnNumber" : 36,
        "endLineNumber" : 1616,
        "endColumnNumber" : 144
      },
      "nodeContext" : "insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments)",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 139,
        "startLineNumber" : 1616,
        "startColumnNumber" : 6,
        "endLineNumber" : 1616,
        "endColumnNumber" : 145
      },
      "nodeContext" : "Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 16,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 1573,
        "startLineNumber" : 1611,
        "startColumnNumber" : 8,
        "endLineNumber" : 1646,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 182,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1979,
        "startLineNumber" : 1611,
        "startColumnNumber" : 4,
        "endLineNumber" : 1658,
        "endColumnNumber" : 5
      },
      "nodeContext" : "try {\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n  finally {\n  db.endTransaction();\n  if (insertListener != null) {\n    insertListener.onComplete();\n  }\n  long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n  notifyConversationListeners(contentValuesThreadId);\n  DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n  ThreadUpdateJob.enqueue(contentValuesThreadId);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 223,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 3053,
        "startLineNumber" : 1591,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "{\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 390,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 3710,
        "startLineNumber" : 1581,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "private long insertMediaMessage(long threadId,@Nullable String body,@NonNull List<Attachment> attachments,@NonNull List<Attachment> quoteAttachments,@NonNull List<Contact> sharedContacts,@NonNull List<LinkPreview> linkPreviews,@NonNull List<Mention> mentions,@NonNull ContentValues contentValues,@Nullable SmsDatabase.InsertListener insertListener) throws MmsException {\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 464,
      "astHeight" : 13
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 139,
        "startLineNumber" : 1616,
        "startColumnNumber" : 6,
        "endLineNumber" : 1616,
        "endColumnNumber" : 145
      },
      "nodeContext" : "Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 16,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "long"
  }, {
    "nodeContext" : "messageId",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 9,
      "startLineNumber" : 1625,
      "startColumnNumber" : 104,
      "endLineNumber" : 1625,
      "endColumnNumber" : 113
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.ArrayInitializer,expressions]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 1625,
        "startColumnNumber" : 89,
        "endLineNumber" : 1625,
        "endColumnNumber" : 114
      },
      "nodeContext" : "String.valueOf(messageId)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ArrayCreation,initializer]",
      "nodePosition" : {
        "charLength" : 29,
        "startLineNumber" : 1625,
        "startColumnNumber" : 87,
        "endLineNumber" : 1625,
        "endColumnNumber" : 116
      },
      "nodeContext" : "{String.valueOf(messageId)}",
      "nodeType" : "ArrayInitializer",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 41,
        "startLineNumber" : 1625,
        "startColumnNumber" : 75,
        "endLineNumber" : 1625,
        "endColumnNumber" : 116
      },
      "nodeContext" : "new String[]{String.valueOf(messageId)}",
      "nodeType" : "ArrayCreation",
      "astNodeNumber" : 10,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 98,
        "startLineNumber" : 1625,
        "startColumnNumber" : 19,
        "endLineNumber" : 1625,
        "endColumnNumber" : 117
      },
      "nodeContext" : "database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)})",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 18,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 105,
        "startLineNumber" : 1625,
        "startColumnNumber" : 12,
        "endLineNumber" : 1625,
        "endColumnNumber" : 117
      },
      "nodeContext" : "rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)})",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 20,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 110,
        "startLineNumber" : 1625,
        "startColumnNumber" : 8,
        "endLineNumber" : 1625,
        "endColumnNumber" : 118
      },
      "nodeContext" : "int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 22,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 442,
        "startLineNumber" : 1620,
        "startColumnNumber" : 50,
        "endLineNumber" : 1630,
        "endColumnNumber" : 7
      },
      "nodeContext" : "{\n  ContentValues contactValues=new ContentValues();\n  contactValues.put(SHARED_CONTACTS,serializedContacts);\n  SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n  int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n  if (rows <= 0) {\n    Log.w(TAG,\"Failed to update message with shared contact data.\");\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 56,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 486,
        "startLineNumber" : 1620,
        "startColumnNumber" : 6,
        "endLineNumber" : 1630,
        "endColumnNumber" : 7
      },
      "nodeContext" : "if (!TextUtils.isEmpty(serializedContacts)) {\n  ContentValues contactValues=new ContentValues();\n  contactValues.put(SHARED_CONTACTS,serializedContacts);\n  SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n  int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n  if (rows <= 0) {\n    Log.w(TAG,\"Failed to update message with shared contact data.\");\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 62,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 1573,
        "startLineNumber" : 1611,
        "startColumnNumber" : 8,
        "endLineNumber" : 1646,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 182,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1979,
        "startLineNumber" : 1611,
        "startColumnNumber" : 4,
        "endLineNumber" : 1658,
        "endColumnNumber" : 5
      },
      "nodeContext" : "try {\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n  finally {\n  db.endTransaction();\n  if (insertListener != null) {\n    insertListener.onComplete();\n  }\n  long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n  notifyConversationListeners(contentValuesThreadId);\n  DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n  ThreadUpdateJob.enqueue(contentValuesThreadId);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 223,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 3053,
        "startLineNumber" : 1591,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "{\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 390,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 3710,
        "startLineNumber" : 1581,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "private long insertMediaMessage(long threadId,@Nullable String body,@NonNull List<Attachment> attachments,@NonNull List<Attachment> quoteAttachments,@NonNull List<Contact> sharedContacts,@NonNull List<LinkPreview> linkPreviews,@NonNull List<Mention> mentions,@NonNull ContentValues contentValues,@Nullable SmsDatabase.InsertListener insertListener) throws MmsException {\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 464,
      "astHeight" : 13
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 110,
        "startLineNumber" : 1625,
        "startColumnNumber" : 8,
        "endLineNumber" : 1625,
        "endColumnNumber" : 118
      },
      "nodeContext" : "int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 22,
      "astHeight" : 7
    },
    "tokenLength" : 1,
    "type" : "long"
  }, {
    "nodeContext" : "messageId",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 9,
      "startLineNumber" : 1637,
      "startColumnNumber" : 104,
      "endLineNumber" : 1637,
      "endColumnNumber" : 113
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.ArrayInitializer,expressions]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 1637,
        "startColumnNumber" : 89,
        "endLineNumber" : 1637,
        "endColumnNumber" : 114
      },
      "nodeContext" : "String.valueOf(messageId)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ArrayCreation,initializer]",
      "nodePosition" : {
        "charLength" : 29,
        "startLineNumber" : 1637,
        "startColumnNumber" : 87,
        "endLineNumber" : 1637,
        "endColumnNumber" : 116
      },
      "nodeContext" : "{String.valueOf(messageId)}",
      "nodeType" : "ArrayInitializer",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 41,
        "startLineNumber" : 1637,
        "startColumnNumber" : 75,
        "endLineNumber" : 1637,
        "endColumnNumber" : 116
      },
      "nodeContext" : "new String[]{String.valueOf(messageId)}",
      "nodeType" : "ArrayCreation",
      "astNodeNumber" : 10,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 98,
        "startLineNumber" : 1637,
        "startColumnNumber" : 19,
        "endLineNumber" : 1637,
        "endColumnNumber" : 117
      },
      "nodeContext" : "database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)})",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 18,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 105,
        "startLineNumber" : 1637,
        "startColumnNumber" : 12,
        "endLineNumber" : 1637,
        "endColumnNumber" : 117
      },
      "nodeContext" : "rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)})",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 20,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 110,
        "startLineNumber" : 1637,
        "startColumnNumber" : 8,
        "endLineNumber" : 1637,
        "endColumnNumber" : 118
      },
      "nodeContext" : "int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 22,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 438,
        "startLineNumber" : 1632,
        "startColumnNumber" : 50,
        "endLineNumber" : 1642,
        "endColumnNumber" : 7
      },
      "nodeContext" : "{\n  ContentValues contactValues=new ContentValues();\n  contactValues.put(LINK_PREVIEWS,serializedPreviews);\n  SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n  int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n  if (rows <= 0) {\n    Log.w(TAG,\"Failed to update message with link preview data.\");\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 56,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 482,
        "startLineNumber" : 1632,
        "startColumnNumber" : 6,
        "endLineNumber" : 1642,
        "endColumnNumber" : 7
      },
      "nodeContext" : "if (!TextUtils.isEmpty(serializedPreviews)) {\n  ContentValues contactValues=new ContentValues();\n  contactValues.put(LINK_PREVIEWS,serializedPreviews);\n  SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n  int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n  if (rows <= 0) {\n    Log.w(TAG,\"Failed to update message with link preview data.\");\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 62,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 1573,
        "startLineNumber" : 1611,
        "startColumnNumber" : 8,
        "endLineNumber" : 1646,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 182,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1979,
        "startLineNumber" : 1611,
        "startColumnNumber" : 4,
        "endLineNumber" : 1658,
        "endColumnNumber" : 5
      },
      "nodeContext" : "try {\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n  finally {\n  db.endTransaction();\n  if (insertListener != null) {\n    insertListener.onComplete();\n  }\n  long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n  notifyConversationListeners(contentValuesThreadId);\n  DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n  ThreadUpdateJob.enqueue(contentValuesThreadId);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 223,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 3053,
        "startLineNumber" : 1591,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "{\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 390,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 3710,
        "startLineNumber" : 1581,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "private long insertMediaMessage(long threadId,@Nullable String body,@NonNull List<Attachment> attachments,@NonNull List<Attachment> quoteAttachments,@NonNull List<Contact> sharedContacts,@NonNull List<LinkPreview> linkPreviews,@NonNull List<Mention> mentions,@NonNull ContentValues contentValues,@Nullable SmsDatabase.InsertListener insertListener) throws MmsException {\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 464,
      "astHeight" : 13
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 110,
        "startLineNumber" : 1637,
        "startColumnNumber" : 8,
        "endLineNumber" : 1637,
        "endColumnNumber" : 118
      },
      "nodeContext" : "int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 22,
      "astHeight" : 7
    },
    "tokenLength" : 1,
    "type" : "long"
  }, {
    "nodeContext" : "messageId",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 9,
      "startLineNumber" : 1645,
      "startColumnNumber" : 13,
      "endLineNumber" : 1645,
      "endColumnNumber" : 22
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 1645,
        "startColumnNumber" : 6,
        "endLineNumber" : 1645,
        "endColumnNumber" : 23
      },
      "nodeContext" : "return messageId;\n",
      "nodeType" : "ReturnStatement",
      "astNodeNumber" : 2,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 1573,
        "startLineNumber" : 1611,
        "startColumnNumber" : 8,
        "endLineNumber" : 1646,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 182,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1979,
        "startLineNumber" : 1611,
        "startColumnNumber" : 4,
        "endLineNumber" : 1658,
        "endColumnNumber" : 5
      },
      "nodeContext" : "try {\n  long messageId=db.insert(TABLE_NAME,null,contentValues);\n  mentionDatabase.insert(threadId,messageId,mentions);\n  Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n  String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n  String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n  if (!TextUtils.isEmpty(serializedContacts)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(SHARED_CONTACTS,serializedContacts);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with shared contact data.\");\n    }\n  }\n  if (!TextUtils.isEmpty(serializedPreviews)) {\n    ContentValues contactValues=new ContentValues();\n    contactValues.put(LINK_PREVIEWS,serializedPreviews);\n    SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n    int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n    if (rows <= 0) {\n      Log.w(TAG,\"Failed to update message with link preview data.\");\n    }\n  }\n  db.setTransactionSuccessful();\n  return messageId;\n}\n  finally {\n  db.endTransaction();\n  if (insertListener != null) {\n    insertListener.onComplete();\n  }\n  long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n  notifyConversationListeners(contentValuesThreadId);\n  DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n  ThreadUpdateJob.enqueue(contentValuesThreadId);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 223,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 3053,
        "startLineNumber" : 1591,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "{\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 390,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 3710,
        "startLineNumber" : 1581,
        "startColumnNumber" : 2,
        "endLineNumber" : 1659,
        "endColumnNumber" : 3
      },
      "nodeContext" : "private long insertMediaMessage(long threadId,@Nullable String body,@NonNull List<Attachment> attachments,@NonNull List<Attachment> quoteAttachments,@NonNull List<Contact> sharedContacts,@NonNull List<LinkPreview> linkPreviews,@NonNull List<Mention> mentions,@NonNull ContentValues contentValues,@Nullable SmsDatabase.InsertListener insertListener) throws MmsException {\n  SQLiteDatabase db=databaseHelper.getSignalWritableDatabase();\n  AttachmentDatabase partsDatabase=DatabaseFactory.getAttachmentDatabase(context);\n  MentionDatabase mentionDatabase=DatabaseFactory.getMentionDatabase(context);\n  boolean mentionsSelf=Stream.of(mentions).filter(m -> Recipient.resolved(m.getRecipientId()).isSelf()).findFirst().isPresent();\n  List<Attachment> allAttachments=new LinkedList<>();\n  List<Attachment> contactAttachments=Stream.of(sharedContacts).map(Contact::getAvatarAttachment).filter(a -> a != null).toList();\n  List<Attachment> previewAttachments=Stream.of(linkPreviews).filter(lp -> lp.getThumbnail().isPresent()).map(lp -> lp.getThumbnail().get()).toList();\n  allAttachments.addAll(attachments);\n  allAttachments.addAll(contactAttachments);\n  allAttachments.addAll(previewAttachments);\n  contentValues.put(BODY,body);\n  contentValues.put(PART_COUNT,allAttachments.size());\n  contentValues.put(MENTIONS_SELF,mentionsSelf ? 1 : 0);\n  db.beginTransaction();\n  try {\n    long messageId=db.insert(TABLE_NAME,null,contentValues);\n    mentionDatabase.insert(threadId,messageId,mentions);\n    Map<Attachment,AttachmentId> insertedAttachments=partsDatabase.insertAttachmentsForMessage(messageId,allAttachments,quoteAttachments);\n    String serializedContacts=getSerializedSharedContacts(insertedAttachments,sharedContacts);\n    String serializedPreviews=getSerializedLinkPreviews(insertedAttachments,linkPreviews);\n    if (!TextUtils.isEmpty(serializedContacts)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(SHARED_CONTACTS,serializedContacts);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with shared contact data.\");\n      }\n    }\n    if (!TextUtils.isEmpty(serializedPreviews)) {\n      ContentValues contactValues=new ContentValues();\n      contactValues.put(LINK_PREVIEWS,serializedPreviews);\n      SQLiteDatabase database=databaseHelper.getSignalReadableDatabase();\n      int rows=database.update(TABLE_NAME,contactValues,ID + \" = ?\",new String[]{String.valueOf(messageId)});\n      if (rows <= 0) {\n        Log.w(TAG,\"Failed to update message with link preview data.\");\n      }\n    }\n    db.setTransactionSuccessful();\n    return messageId;\n  }\n  finally {\n    db.endTransaction();\n    if (insertListener != null) {\n      insertListener.onComplete();\n    }\n    long contentValuesThreadId=contentValues.getAsLong(THREAD_ID);\n    notifyConversationListeners(contentValuesThreadId);\n    DatabaseFactory.getThreadDatabase(context).setLastScrolled(contentValuesThreadId,0);\n    ThreadUpdateJob.enqueue(contentValuesThreadId);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 464,
      "astHeight" : 13
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 17,
        "startLineNumber" : 1645,
        "startColumnNumber" : 6,
        "endLineNumber" : 1645,
        "endColumnNumber" : 23
      },
      "nodeContext" : "return messageId;\n",
      "nodeType" : "ReturnStatement",
      "astNodeNumber" : 2,
      "astHeight" : 2
    },
    "tokenLength" : 1,
    "type" : "long"
  } ],
  "positionList" : [ {
    "charLength" : 9,
    "startLineNumber" : 1614,
    "startColumnNumber" : 39,
    "endLineNumber" : 1614,
    "endColumnNumber" : 48
  }, {
    "charLength" : 9,
    "startLineNumber" : 1616,
    "startColumnNumber" : 100,
    "endLineNumber" : 1616,
    "endColumnNumber" : 109
  }, {
    "charLength" : 9,
    "startLineNumber" : 1625,
    "startColumnNumber" : 104,
    "endLineNumber" : 1625,
    "endColumnNumber" : 113
  }, {
    "charLength" : 9,
    "startLineNumber" : 1637,
    "startColumnNumber" : 104,
    "endLineNumber" : 1637,
    "endColumnNumber" : 113
  }, {
    "charLength" : 9,
    "startLineNumber" : 1645,
    "startColumnNumber" : 13,
    "endLineNumber" : 1645,
    "endColumnNumber" : 22
  } ],
  "layoutRelationDataList" : [ {
    "firstKey" : 0,
    "secondKey" : 1,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 2,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 3,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 4,
    "layout" : 2
  }, {
    "firstKey" : 1,
    "secondKey" : 0,
    "layout" : 3
  }, {
    "firstKey" : 1,
    "secondKey" : 2,
    "layout" : 3
  }, {
    "firstKey" : 1,
    "secondKey" : 3,
    "layout" : 3
  }, {
    "firstKey" : 1,
    "secondKey" : 4,
    "layout" : 3
  }, {
    "firstKey" : 2,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 3,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 4,
    "secondKey" : 0,
    "layout" : 1
  }, {
    "firstKey" : 4,
    "secondKey" : 1,
    "layout" : 1
  }, {
    "firstKey" : 4,
    "secondKey" : 2,
    "layout" : 1
  }, {
    "firstKey" : 4,
    "secondKey" : 3,
    "layout" : 1
  } ]
}