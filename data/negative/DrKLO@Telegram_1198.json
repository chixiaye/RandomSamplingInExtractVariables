{
  "id" : 1198,
  "expression" : "ids",
  "projectName" : "DrKLO@Telegram",
  "commitID" : "11fbfb1329df700b203e1852a71c4c11b5ab12f4",
  "filePath" : "TMessagesProj/src/main/java/org/telegram/messenger/MessagesStorage.java",
  "occurrences" : 9,
  "isArithmeticExpression" : 0,
  "isGetTypeMethod" : 0,
  "expressionList" : [ {
    "nodeContext" : "ids",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 3,
      "startLineNumber" : 8886,
      "startColumnNumber" : 142,
      "endLineNumber" : 8886,
      "endColumnNumber" : 145
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 84,
        "startLineNumber" : 8886,
        "startColumnNumber" : 62,
        "endLineNumber" : 8886,
        "endColumnNumber" : 146
      },
      "nodeContext" : "String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 109,
        "startLineNumber" : 8886,
        "startColumnNumber" : 38,
        "endLineNumber" : 8886,
        "endColumnNumber" : 147
      },
      "nodeContext" : "database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids))",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 118,
        "startLineNumber" : 8886,
        "startColumnNumber" : 29,
        "endLineNumber" : 8886,
        "endColumnNumber" : 147
      },
      "nodeContext" : "cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids))",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 132,
        "startLineNumber" : 8886,
        "startColumnNumber" : 16,
        "endLineNumber" : 8886,
        "endColumnNumber" : 148
      },
      "nodeContext" : "SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 16,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1636,
        "startLineNumber" : 8867,
        "startColumnNumber" : 27,
        "endLineNumber" : 8903,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 195,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 132,
        "startLineNumber" : 8886,
        "startColumnNumber" : 16,
        "endLineNumber" : 8886,
        "endColumnNumber" : 148
      },
      "nodeContext" : "SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 16,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  }, {
    "nodeContext" : "ids",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 3,
      "startLineNumber" : 8899,
      "startColumnNumber" : 113,
      "endLineNumber" : 8899,
      "endColumnNumber" : 116
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 80,
        "startLineNumber" : 8899,
        "startColumnNumber" : 37,
        "endLineNumber" : 8899,
        "endColumnNumber" : 117
      },
      "nodeContext" : "String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 102,
        "startLineNumber" : 8899,
        "startColumnNumber" : 16,
        "endLineNumber" : 8899,
        "endColumnNumber" : 118
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids))",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 113,
        "startLineNumber" : 8899,
        "startColumnNumber" : 16,
        "endLineNumber" : 8899,
        "endColumnNumber" : 129
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 123,
        "startLineNumber" : 8899,
        "startColumnNumber" : 16,
        "endLineNumber" : 8899,
        "endColumnNumber" : 139
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 15,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 124,
        "startLineNumber" : 8899,
        "startColumnNumber" : 16,
        "endLineNumber" : 8899,
        "endColumnNumber" : 140
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1636,
        "startLineNumber" : 8867,
        "startColumnNumber" : 27,
        "endLineNumber" : 8903,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 195,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 124,
        "startLineNumber" : 8899,
        "startColumnNumber" : 16,
        "endLineNumber" : 8899,
        "endColumnNumber" : 140
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  }, {
    "nodeContext" : "ids",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 3,
      "startLineNumber" : 8926,
      "startColumnNumber" : 169,
      "endLineNumber" : 8926,
      "endColumnNumber" : 172
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 111,
        "startLineNumber" : 8926,
        "startColumnNumber" : 62,
        "endLineNumber" : 8926,
        "endColumnNumber" : 173
      },
      "nodeContext" : "String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 136,
        "startLineNumber" : 8926,
        "startColumnNumber" : 38,
        "endLineNumber" : 8926,
        "endColumnNumber" : 174
      },
      "nodeContext" : "database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids))",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 145,
        "startLineNumber" : 8926,
        "startColumnNumber" : 29,
        "endLineNumber" : 8926,
        "endColumnNumber" : 174
      },
      "nodeContext" : "cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids))",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 159,
        "startLineNumber" : 8926,
        "startColumnNumber" : 16,
        "endLineNumber" : 8926,
        "endColumnNumber" : 175
      },
      "nodeContext" : "SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 16,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 159,
        "startLineNumber" : 8926,
        "startColumnNumber" : 16,
        "endLineNumber" : 8926,
        "endColumnNumber" : 175
      },
      "nodeContext" : "SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 16,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  }, {
    "nodeContext" : "ids",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 3,
      "startLineNumber" : 9030,
      "startColumnNumber" : 103,
      "endLineNumber" : 9030,
      "endColumnNumber" : 106
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 70,
        "startLineNumber" : 9030,
        "startColumnNumber" : 37,
        "endLineNumber" : 9030,
        "endColumnNumber" : 107
      },
      "nodeContext" : "String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 92,
        "startLineNumber" : 9030,
        "startColumnNumber" : 16,
        "endLineNumber" : 9030,
        "endColumnNumber" : 108
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids))",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 103,
        "startLineNumber" : 9030,
        "startColumnNumber" : 16,
        "endLineNumber" : 9030,
        "endColumnNumber" : 119
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 113,
        "startLineNumber" : 9030,
        "startColumnNumber" : 16,
        "endLineNumber" : 9030,
        "endColumnNumber" : 129
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 15,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 114,
        "startLineNumber" : 9030,
        "startColumnNumber" : 16,
        "endLineNumber" : 9030,
        "endColumnNumber" : 130
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 114,
        "startLineNumber" : 9030,
        "startColumnNumber" : 16,
        "endLineNumber" : 9030,
        "endColumnNumber" : 130
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  }, {
    "nodeContext" : "ids",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 3,
      "startLineNumber" : 9031,
      "startColumnNumber" : 100,
      "endLineNumber" : 9031,
      "endColumnNumber" : 103
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 67,
        "startLineNumber" : 9031,
        "startColumnNumber" : 37,
        "endLineNumber" : 9031,
        "endColumnNumber" : 104
      },
      "nodeContext" : "String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 89,
        "startLineNumber" : 9031,
        "startColumnNumber" : 16,
        "endLineNumber" : 9031,
        "endColumnNumber" : 105
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids))",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 100,
        "startLineNumber" : 9031,
        "startColumnNumber" : 16,
        "endLineNumber" : 9031,
        "endColumnNumber" : 116
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 110,
        "startLineNumber" : 9031,
        "startColumnNumber" : 16,
        "endLineNumber" : 9031,
        "endColumnNumber" : 126
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 15,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 111,
        "startLineNumber" : 9031,
        "startColumnNumber" : 16,
        "endLineNumber" : 9031,
        "endColumnNumber" : 127
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 111,
        "startLineNumber" : 9031,
        "startColumnNumber" : 16,
        "endLineNumber" : 9031,
        "endColumnNumber" : 127
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  }, {
    "nodeContext" : "ids",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 3,
      "startLineNumber" : 9032,
      "startColumnNumber" : 107,
      "endLineNumber" : 9032,
      "endColumnNumber" : 110
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 74,
        "startLineNumber" : 9032,
        "startColumnNumber" : 37,
        "endLineNumber" : 9032,
        "endColumnNumber" : 111
      },
      "nodeContext" : "String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 96,
        "startLineNumber" : 9032,
        "startColumnNumber" : 16,
        "endLineNumber" : 9032,
        "endColumnNumber" : 112
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids))",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 107,
        "startLineNumber" : 9032,
        "startColumnNumber" : 16,
        "endLineNumber" : 9032,
        "endColumnNumber" : 123
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 117,
        "startLineNumber" : 9032,
        "startColumnNumber" : 16,
        "endLineNumber" : 9032,
        "endColumnNumber" : 133
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 15,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 118,
        "startLineNumber" : 9032,
        "startColumnNumber" : 16,
        "endLineNumber" : 9032,
        "endColumnNumber" : 134
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 118,
        "startLineNumber" : 9032,
        "startColumnNumber" : 16,
        "endLineNumber" : 9032,
        "endColumnNumber" : 134
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  }, {
    "nodeContext" : "ids",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 3,
      "startLineNumber" : 9033,
      "startColumnNumber" : 107,
      "endLineNumber" : 9033,
      "endColumnNumber" : 110
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 74,
        "startLineNumber" : 9033,
        "startColumnNumber" : 37,
        "endLineNumber" : 9033,
        "endColumnNumber" : 111
      },
      "nodeContext" : "String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 96,
        "startLineNumber" : 9033,
        "startColumnNumber" : 16,
        "endLineNumber" : 9033,
        "endColumnNumber" : 112
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids))",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 107,
        "startLineNumber" : 9033,
        "startColumnNumber" : 16,
        "endLineNumber" : 9033,
        "endColumnNumber" : 123
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 117,
        "startLineNumber" : 9033,
        "startColumnNumber" : 16,
        "endLineNumber" : 9033,
        "endColumnNumber" : 133
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 15,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 118,
        "startLineNumber" : 9033,
        "startColumnNumber" : 16,
        "endLineNumber" : 9033,
        "endColumnNumber" : 134
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 118,
        "startLineNumber" : 9033,
        "startColumnNumber" : 16,
        "endLineNumber" : 9033,
        "endColumnNumber" : 134
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  }, {
    "nodeContext" : "ids",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 3,
      "startLineNumber" : 9035,
      "startColumnNumber" : 129,
      "endLineNumber" : 9035,
      "endColumnNumber" : 132
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 80,
        "startLineNumber" : 9035,
        "startColumnNumber" : 53,
        "endLineNumber" : 9035,
        "endColumnNumber" : 133
      },
      "nodeContext" : "String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.Assignment,rightHandSide]",
      "nodePosition" : {
        "charLength" : 105,
        "startLineNumber" : 9035,
        "startColumnNumber" : 29,
        "endLineNumber" : 9035,
        "endColumnNumber" : 134
      },
      "nodeContext" : "database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids))",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 114,
        "startLineNumber" : 9035,
        "startColumnNumber" : 20,
        "endLineNumber" : 9035,
        "endColumnNumber" : 134
      },
      "nodeContext" : "cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids))",
      "nodeType" : "Assignment",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 115,
        "startLineNumber" : 9035,
        "startColumnNumber" : 20,
        "endLineNumber" : 9035,
        "endColumnNumber" : 135
      },
      "nodeContext" : "cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 14,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2978,
        "startLineNumber" : 9034,
        "startColumnNumber" : 36,
        "endLineNumber" : 9088,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 310,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 3387,
        "startLineNumber" : 9034,
        "startColumnNumber" : 16,
        "endLineNumber" : 9094,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (temp.isEmpty()) {\n  cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n  SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n  while (cursor.next()) {\n    long uid=cursor.longValue(0);\n    int type=cursor.intValue(1);\n    if (mediaCounts == null) {\n      mediaCounts=new SparseArray<>();\n    }\n    LongSparseArray<Integer> counts=mediaCounts.get(type);\n    Integer count;\n    if (counts == null) {\n      counts=new LongSparseArray<>();\n      count=0;\n      mediaCounts.put(type,counts);\n    }\n else {\n      count=counts.get(uid);\n    }\n    if (count == null) {\n      count=0;\n    }\n    count++;\n    counts.put(uid,count);\n  }\n  cursor.dispose();\n  if (mediaCounts != null) {\n    SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n    for (int a=0; a < mediaCounts.size(); a++) {\n      int type=mediaCounts.keyAt(a);\n      LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n      for (int b=0; b < value.size(); b++) {\n        long uid=value.keyAt(b);\n        int lower_part=(int)uid;\n        int count=-1;\n        int old=0;\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n        if (cursor.next()) {\n          count=cursor.intValue(0);\n          old=cursor.intValue(1);\n        }\n        cursor.dispose();\n        if (count != -1) {\n          state.requery();\n          count=Math.max(0,count - value.valueAt(b));\n          state.bindLong(1,uid);\n          state.bindInteger(2,type);\n          state.bindInteger(3,count);\n          state.bindInteger(4,old);\n          state.step();\n        }\n      }\n    }\n    state.dispose();\n  }\n}\n else {\n  if (channelId == 0) {\n    database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n  }\n else {\n    database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 347,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 115,
        "startLineNumber" : 9035,
        "startColumnNumber" : 20,
        "endLineNumber" : 9035,
        "endColumnNumber" : 135
      },
      "nodeContext" : "cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 14,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  }, {
    "nodeContext" : "ids",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 3,
      "startLineNumber" : 9095,
      "startColumnNumber" : 103,
      "endLineNumber" : 9095,
      "endColumnNumber" : 106
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 70,
        "startLineNumber" : 9095,
        "startColumnNumber" : 37,
        "endLineNumber" : 9095,
        "endColumnNumber" : 107
      },
      "nodeContext" : "String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 92,
        "startLineNumber" : 9095,
        "startColumnNumber" : 16,
        "endLineNumber" : 9095,
        "endColumnNumber" : 108
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids))",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodInvocation,expression]",
      "nodePosition" : {
        "charLength" : 103,
        "startLineNumber" : 9095,
        "startColumnNumber" : 16,
        "endLineNumber" : 9095,
        "endColumnNumber" : 119
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 113,
        "startLineNumber" : 9095,
        "startColumnNumber" : 16,
        "endLineNumber" : 9095,
        "endColumnNumber" : 129
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 15,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 114,
        "startLineNumber" : 9095,
        "startColumnNumber" : 16,
        "endLineNumber" : 9095,
        "endColumnNumber" : 130
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 11336,
        "startLineNumber" : 8903,
        "startColumnNumber" : 19,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1238,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 12993,
        "startLineNumber" : 8867,
        "startColumnNumber" : 12,
        "endLineNumber" : 9101,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (scheduled) {\n  String ids;\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      if (!dialogsToUpdate.contains(did)) {\n        dialogsToUpdate.add(did);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n    broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n  }\n}\n else {\n  String ids;\n  final ArrayList<Integer> temp=new ArrayList<>(messages);\n  LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n  LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n  if (channelId != 0) {\n    StringBuilder builder=new StringBuilder(messages.size());\n    for (int a=0; a < messages.size(); a++) {\n      long messageId=messages.get(a);\n      messageId|=((long)channelId) << 32;\n      if (builder.length() > 0) {\n        builder.append(',');\n      }\n      builder.append(messageId);\n    }\n    ids=builder.toString();\n  }\n else {\n    ids=TextUtils.join(\",\",messages);\n  }\n  ArrayList<File> filesToDelete=new ArrayList<>();\n  ArrayList<String> namesToDelete=new ArrayList<>();\n  ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n  int currentUser=getUserConfig().getClientUserId();\n  SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n  try {\n    while (cursor.next()) {\n      long did=cursor.longValue(0);\n      int mid=cursor.intValue(5);\n      temp.remove((Integer)mid);\n      ArrayList<Integer> mids=messagesByDialogs.get(did);\n      if (mids == null) {\n        mids=new ArrayList<>();\n        messagesByDialogs.put(did,mids);\n      }\n      mids.add(mid);\n      if (did != currentUser) {\n        int read_state=cursor.intValue(2);\n        if (cursor.intValue(3) == 0) {\n          Integer[] unread_count=dialogsToUpdate.get(did);\n          if (unread_count == null) {\n            unread_count=new Integer[]{0,0};\n            dialogsToUpdate.put(did,unread_count);\n          }\n          if (read_state < 2) {\n            unread_count[1]++;\n          }\n          if (read_state == 0 || read_state == 2) {\n            unread_count[0]++;\n          }\n        }\n      }\n      if ((int)did != 0 && !deleteFiles) {\n        continue;\n      }\n      NativeByteBuffer data=cursor.byteBufferValue(1);\n      if (data != null) {\n        TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n        message.readAttachPath(data,getUserConfig().clientUserId);\n        data.reuse();\n        addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n      }\n    }\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  cursor.dispose();\n  deleteFromDownloadQueue(idsToDelete,true);\n  AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n  getFileLoader().deleteFiles(filesToDelete,0);\n  for (int a=0; a < dialogsToUpdate.size(); a++) {\n    long did=dialogsToUpdate.keyAt(a);\n    Integer[] counts=dialogsToUpdate.valueAt(a);\n    cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n    int old_unread_count=0;\n    int old_mentions_count=0;\n    if (cursor.next()) {\n      old_unread_count=cursor.intValue(0);\n      old_mentions_count=cursor.intValue(1);\n    }\n    cursor.dispose();\n    dialogsIds.add(did);\n    SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n    state.requery();\n    state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n    state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n    state.bindLong(3,did);\n    state.step();\n    state.dispose();\n  }\n  for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n    long did=messagesByDialogs.keyAt(a);\n    ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n    int lowerId=(int)did;\n    String idsStr=TextUtils.join(\",\",mids);\n    if (lowerId != 0) {\n      if (lowerId < 0) {\n        database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n    int updatedCount=0;\n    cursor=database.queryFinalized(\"SELECT changes()\");\n    if (cursor.next()) {\n      updatedCount=cursor.intValue(0);\n    }\n    cursor.dispose();\n    if (updatedCount > 0) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n      if (cursor.next()) {\n        int count=cursor.intValue(0);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,count - updatedCount));\n        state.bindLong(2,did);\n        state.step();\n        state.dispose();\n      }\n      cursor.dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  if (temp.isEmpty()) {\n    cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n    SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n    while (cursor.next()) {\n      long uid=cursor.longValue(0);\n      int type=cursor.intValue(1);\n      if (mediaCounts == null) {\n        mediaCounts=new SparseArray<>();\n      }\n      LongSparseArray<Integer> counts=mediaCounts.get(type);\n      Integer count;\n      if (counts == null) {\n        counts=new LongSparseArray<>();\n        count=0;\n        mediaCounts.put(type,counts);\n      }\n else {\n        count=counts.get(uid);\n      }\n      if (count == null) {\n        count=0;\n      }\n      count++;\n      counts.put(uid,count);\n    }\n    cursor.dispose();\n    if (mediaCounts != null) {\n      SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n      for (int a=0; a < mediaCounts.size(); a++) {\n        int type=mediaCounts.keyAt(a);\n        LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n        for (int b=0; b < value.size(); b++) {\n          long uid=value.keyAt(b);\n          int lower_part=(int)uid;\n          int count=-1;\n          int old=0;\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n          if (cursor.next()) {\n            count=cursor.intValue(0);\n            old=cursor.intValue(1);\n          }\n          cursor.dispose();\n          if (count != -1) {\n            state.requery();\n            count=Math.max(0,count - value.valueAt(b));\n            state.bindLong(1,uid);\n            state.bindInteger(2,type);\n            state.bindInteger(3,count);\n            state.bindInteger(4,old);\n            state.step();\n          }\n        }\n      }\n      state.dispose();\n    }\n  }\n else {\n    if (channelId == 0) {\n      database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n    }\n else {\n      database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n    }\n  }\n  database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n  getMediaDataController().clearBotKeyboard(0,messages);\n  if (dialogsToUpdate.size() != 0) {\n    resetAllUnreadCounters(false);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1435,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 13108,
        "startLineNumber" : 8865,
        "startColumnNumber" : 12,
        "endLineNumber" : 9103,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1450,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 13170,
        "startLineNumber" : 8865,
        "startColumnNumber" : 8,
        "endLineNumber" : 9105,
        "endColumnNumber" : 9
      },
      "nodeContext" : "try {\n  ArrayList<Long> dialogsIds=new ArrayList<>();\n  if (scheduled) {\n    String ids;\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        if (!dialogsToUpdate.contains(did)) {\n          dialogsToUpdate.add(did);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n      broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n    }\n  }\n else {\n    String ids;\n    final ArrayList<Integer> temp=new ArrayList<>(messages);\n    LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n    LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n    if (channelId != 0) {\n      StringBuilder builder=new StringBuilder(messages.size());\n      for (int a=0; a < messages.size(); a++) {\n        long messageId=messages.get(a);\n        messageId|=((long)channelId) << 32;\n        if (builder.length() > 0) {\n          builder.append(',');\n        }\n        builder.append(messageId);\n      }\n      ids=builder.toString();\n    }\n else {\n      ids=TextUtils.join(\",\",messages);\n    }\n    ArrayList<File> filesToDelete=new ArrayList<>();\n    ArrayList<String> namesToDelete=new ArrayList<>();\n    ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n    int currentUser=getUserConfig().getClientUserId();\n    SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n    try {\n      while (cursor.next()) {\n        long did=cursor.longValue(0);\n        int mid=cursor.intValue(5);\n        temp.remove((Integer)mid);\n        ArrayList<Integer> mids=messagesByDialogs.get(did);\n        if (mids == null) {\n          mids=new ArrayList<>();\n          messagesByDialogs.put(did,mids);\n        }\n        mids.add(mid);\n        if (did != currentUser) {\n          int read_state=cursor.intValue(2);\n          if (cursor.intValue(3) == 0) {\n            Integer[] unread_count=dialogsToUpdate.get(did);\n            if (unread_count == null) {\n              unread_count=new Integer[]{0,0};\n              dialogsToUpdate.put(did,unread_count);\n            }\n            if (read_state < 2) {\n              unread_count[1]++;\n            }\n            if (read_state == 0 || read_state == 2) {\n              unread_count[0]++;\n            }\n          }\n        }\n        if ((int)did != 0 && !deleteFiles) {\n          continue;\n        }\n        NativeByteBuffer data=cursor.byteBufferValue(1);\n        if (data != null) {\n          TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n          message.readAttachPath(data,getUserConfig().clientUserId);\n          data.reuse();\n          addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n        }\n      }\n    }\n catch (    Exception e) {\n      FileLog.e(e);\n    }\n    cursor.dispose();\n    deleteFromDownloadQueue(idsToDelete,true);\n    AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n    getFileLoader().deleteFiles(filesToDelete,0);\n    for (int a=0; a < dialogsToUpdate.size(); a++) {\n      long did=dialogsToUpdate.keyAt(a);\n      Integer[] counts=dialogsToUpdate.valueAt(a);\n      cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n      int old_unread_count=0;\n      int old_mentions_count=0;\n      if (cursor.next()) {\n        old_unread_count=cursor.intValue(0);\n        old_mentions_count=cursor.intValue(1);\n      }\n      cursor.dispose();\n      dialogsIds.add(did);\n      SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n      state.requery();\n      state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n      state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n      state.bindLong(3,did);\n      state.step();\n      state.dispose();\n    }\n    for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n      long did=messagesByDialogs.keyAt(a);\n      ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n      int lowerId=(int)did;\n      String idsStr=TextUtils.join(\",\",mids);\n      if (lowerId != 0) {\n        if (lowerId < 0) {\n          database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n      int updatedCount=0;\n      cursor=database.queryFinalized(\"SELECT changes()\");\n      if (cursor.next()) {\n        updatedCount=cursor.intValue(0);\n      }\n      cursor.dispose();\n      if (updatedCount > 0) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n        if (cursor.next()) {\n          int count=cursor.intValue(0);\n          SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n          state.requery();\n          state.bindInteger(1,Math.max(0,count - updatedCount));\n          state.bindLong(2,did);\n          state.step();\n          state.dispose();\n        }\n        cursor.dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    if (temp.isEmpty()) {\n      cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n      SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n      while (cursor.next()) {\n        long uid=cursor.longValue(0);\n        int type=cursor.intValue(1);\n        if (mediaCounts == null) {\n          mediaCounts=new SparseArray<>();\n        }\n        LongSparseArray<Integer> counts=mediaCounts.get(type);\n        Integer count;\n        if (counts == null) {\n          counts=new LongSparseArray<>();\n          count=0;\n          mediaCounts.put(type,counts);\n        }\n else {\n          count=counts.get(uid);\n        }\n        if (count == null) {\n          count=0;\n        }\n        count++;\n        counts.put(uid,count);\n      }\n      cursor.dispose();\n      if (mediaCounts != null) {\n        SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n        for (int a=0; a < mediaCounts.size(); a++) {\n          int type=mediaCounts.keyAt(a);\n          LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n          for (int b=0; b < value.size(); b++) {\n            long uid=value.keyAt(b);\n            int lower_part=(int)uid;\n            int count=-1;\n            int old=0;\n            cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n            if (cursor.next()) {\n              count=cursor.intValue(0);\n              old=cursor.intValue(1);\n            }\n            cursor.dispose();\n            if (count != -1) {\n              state.requery();\n              count=Math.max(0,count - value.valueAt(b));\n              state.bindLong(1,uid);\n              state.bindInteger(2,type);\n              state.bindInteger(3,count);\n              state.bindInteger(4,old);\n              state.step();\n            }\n          }\n        }\n        state.dispose();\n      }\n    }\n else {\n      if (channelId == 0) {\n        database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n      }\n else {\n        database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n      }\n    }\n    database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n    getMediaDataController().clearBotKeyboard(0,messages);\n    if (dialogsToUpdate.size() != 0) {\n      resetAllUnreadCounters(false);\n    }\n  }\n  return dialogsIds;\n}\n catch (Exception e) {\n  FileLog.e(e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 1462,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 13207,
        "startLineNumber" : 8864,
        "startColumnNumber" : 148,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1465,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 13351,
        "startLineNumber" : 8864,
        "startColumnNumber" : 4,
        "endLineNumber" : 9107,
        "endColumnNumber" : 5
      },
      "nodeContext" : "private ArrayList<Long> markMessagesAsDeletedInternal(final ArrayList<Integer> messages,int channelId,boolean deleteFiles,boolean scheduled){\n  try {\n    ArrayList<Long> dialogsIds=new ArrayList<>();\n    if (scheduled) {\n      String ids;\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<Long> dialogsToUpdate=new ArrayList<>();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid FROM scheduled_messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          if (!dialogsToUpdate.contains(did)) {\n            dialogsToUpdate.add(did);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM scheduled_messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      for (int a=0, N=dialogsToUpdate.size(); a < N; a++) {\n        broadcastScheduledMessagesChange(dialogsToUpdate.get(a));\n      }\n    }\n else {\n      String ids;\n      final ArrayList<Integer> temp=new ArrayList<>(messages);\n      LongSparseArray<Integer[]> dialogsToUpdate=new LongSparseArray<>();\n      LongSparseArray<ArrayList<Integer>> messagesByDialogs=new LongSparseArray<>();\n      if (channelId != 0) {\n        StringBuilder builder=new StringBuilder(messages.size());\n        for (int a=0; a < messages.size(); a++) {\n          long messageId=messages.get(a);\n          messageId|=((long)channelId) << 32;\n          if (builder.length() > 0) {\n            builder.append(',');\n          }\n          builder.append(messageId);\n        }\n        ids=builder.toString();\n      }\n else {\n        ids=TextUtils.join(\",\",messages);\n      }\n      ArrayList<File> filesToDelete=new ArrayList<>();\n      ArrayList<String> namesToDelete=new ArrayList<>();\n      ArrayList<Pair<Long,Integer>> idsToDelete=new ArrayList<>();\n      int currentUser=getUserConfig().getClientUserId();\n      SQLiteCursor cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, data, read_state, out, mention, mid FROM messages WHERE mid IN(%s)\",ids));\n      try {\n        while (cursor.next()) {\n          long did=cursor.longValue(0);\n          int mid=cursor.intValue(5);\n          temp.remove((Integer)mid);\n          ArrayList<Integer> mids=messagesByDialogs.get(did);\n          if (mids == null) {\n            mids=new ArrayList<>();\n            messagesByDialogs.put(did,mids);\n          }\n          mids.add(mid);\n          if (did != currentUser) {\n            int read_state=cursor.intValue(2);\n            if (cursor.intValue(3) == 0) {\n              Integer[] unread_count=dialogsToUpdate.get(did);\n              if (unread_count == null) {\n                unread_count=new Integer[]{0,0};\n                dialogsToUpdate.put(did,unread_count);\n              }\n              if (read_state < 2) {\n                unread_count[1]++;\n              }\n              if (read_state == 0 || read_state == 2) {\n                unread_count[0]++;\n              }\n            }\n          }\n          if ((int)did != 0 && !deleteFiles) {\n            continue;\n          }\n          NativeByteBuffer data=cursor.byteBufferValue(1);\n          if (data != null) {\n            TLRPC.Message message=TLRPC.Message.TLdeserialize(data,data.readInt32(false),false);\n            message.readAttachPath(data,getUserConfig().clientUserId);\n            data.reuse();\n            addFilesToDelete(message,filesToDelete,idsToDelete,namesToDelete,false);\n          }\n        }\n      }\n catch (      Exception e) {\n        FileLog.e(e);\n      }\n      cursor.dispose();\n      deleteFromDownloadQueue(idsToDelete,true);\n      AndroidUtilities.runOnUIThread(() -> getFileLoader().cancelLoadFiles(namesToDelete));\n      getFileLoader().deleteFiles(filesToDelete,0);\n      for (int a=0; a < dialogsToUpdate.size(); a++) {\n        long did=dialogsToUpdate.keyAt(a);\n        Integer[] counts=dialogsToUpdate.valueAt(a);\n        cursor=database.queryFinalized(\"SELECT unread_count, unread_count_i FROM dialogs WHERE did = \" + did);\n        int old_unread_count=0;\n        int old_mentions_count=0;\n        if (cursor.next()) {\n          old_unread_count=cursor.intValue(0);\n          old_mentions_count=cursor.intValue(1);\n        }\n        cursor.dispose();\n        dialogsIds.add(did);\n        SQLitePreparedStatement state=database.executeFast(\"UPDATE dialogs SET unread_count = ?, unread_count_i = ? WHERE did = ?\");\n        state.requery();\n        state.bindInteger(1,Math.max(0,old_unread_count - counts[0]));\n        state.bindInteger(2,Math.max(0,old_mentions_count - counts[1]));\n        state.bindLong(3,did);\n        state.step();\n        state.dispose();\n      }\n      for (int a=0, N=messagesByDialogs.size(); a < N; a++) {\n        long did=messagesByDialogs.keyAt(a);\n        ArrayList<Integer> mids=messagesByDialogs.valueAt(a);\n        int lowerId=(int)did;\n        String idsStr=TextUtils.join(\",\",mids);\n        if (lowerId != 0) {\n          if (lowerId < 0) {\n            database.executeFast(String.format(Locale.US,\"UPDATE chat_settings_v2 SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",-lowerId,idsStr)).stepThis().dispose();\n          }\n else {\n            database.executeFast(String.format(Locale.US,\"UPDATE user_settings SET pinned = 0 WHERE uid = %d AND pinned IN (%s)\",lowerId,idsStr)).stepThis().dispose();\n          }\n        }\n        database.executeFast(String.format(Locale.US,\"DELETE FROM chat_pinned_v2 WHERE uid = %d AND mid IN(%s)\",did,idsStr)).stepThis().dispose();\n        int updatedCount=0;\n        cursor=database.queryFinalized(\"SELECT changes()\");\n        if (cursor.next()) {\n          updatedCount=cursor.intValue(0);\n        }\n        cursor.dispose();\n        if (updatedCount > 0) {\n          cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count FROM chat_pinned_count WHERE uid = %d\",did));\n          if (cursor.next()) {\n            int count=cursor.intValue(0);\n            SQLitePreparedStatement state=database.executeFast(\"UPDATE chat_pinned_count SET count = ? WHERE uid = ?\");\n            state.requery();\n            state.bindInteger(1,Math.max(0,count - updatedCount));\n            state.bindLong(2,did);\n            state.step();\n            state.dispose();\n          }\n          cursor.dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM polls WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM bot_keyboard WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      database.executeFast(String.format(Locale.US,\"DELETE FROM messages_seq WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      if (temp.isEmpty()) {\n        cursor=database.queryFinalized(String.format(Locale.US,\"SELECT uid, type FROM media_v2 WHERE mid IN(%s)\",ids));\n        SparseArray<LongSparseArray<Integer>> mediaCounts=null;\n        while (cursor.next()) {\n          long uid=cursor.longValue(0);\n          int type=cursor.intValue(1);\n          if (mediaCounts == null) {\n            mediaCounts=new SparseArray<>();\n          }\n          LongSparseArray<Integer> counts=mediaCounts.get(type);\n          Integer count;\n          if (counts == null) {\n            counts=new LongSparseArray<>();\n            count=0;\n            mediaCounts.put(type,counts);\n          }\n else {\n            count=counts.get(uid);\n          }\n          if (count == null) {\n            count=0;\n          }\n          count++;\n          counts.put(uid,count);\n        }\n        cursor.dispose();\n        if (mediaCounts != null) {\n          SQLitePreparedStatement state=database.executeFast(\"REPLACE INTO media_counts_v2 VALUES(?, ?, ?, ?)\");\n          for (int a=0; a < mediaCounts.size(); a++) {\n            int type=mediaCounts.keyAt(a);\n            LongSparseArray<Integer> value=mediaCounts.valueAt(a);\n            for (int b=0; b < value.size(); b++) {\n              long uid=value.keyAt(b);\n              int lower_part=(int)uid;\n              int count=-1;\n              int old=0;\n              cursor=database.queryFinalized(String.format(Locale.US,\"SELECT count, old FROM media_counts_v2 WHERE uid = %d AND type = %d LIMIT 1\",uid,type));\n              if (cursor.next()) {\n                count=cursor.intValue(0);\n                old=cursor.intValue(1);\n              }\n              cursor.dispose();\n              if (count != -1) {\n                state.requery();\n                count=Math.max(0,count - value.valueAt(b));\n                state.bindLong(1,uid);\n                state.bindInteger(2,type);\n                state.bindInteger(3,count);\n                state.bindInteger(4,old);\n                state.step();\n              }\n            }\n          }\n          state.dispose();\n        }\n      }\n else {\n        if (channelId == 0) {\n          database.executeFast(\"UPDATE media_counts_v2 SET old = 1 WHERE 1\").stepThis().dispose();\n        }\n else {\n          database.executeFast(String.format(Locale.US,\"UPDATE media_counts_v2 SET old = 1 WHERE uid = %d\",-channelId)).stepThis().dispose();\n        }\n      }\n      database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n      getMediaDataController().clearBotKeyboard(0,messages);\n      if (dialogsToUpdate.size() != 0) {\n        resetAllUnreadCounters(false);\n      }\n    }\n    return dialogsIds;\n  }\n catch (  Exception e) {\n    FileLog.e(e);\n  }\n  return null;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1490,
      "astHeight" : 22
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 114,
        "startLineNumber" : 9095,
        "startColumnNumber" : 16,
        "endLineNumber" : 9095,
        "endColumnNumber" : 130
      },
      "nodeContext" : "database.executeFast(String.format(Locale.US,\"DELETE FROM media_v2 WHERE mid IN(%s)\",ids)).stepThis().dispose();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 16,
      "astHeight" : 7
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  } ],
  "positionList" : [ {
    "charLength" : 3,
    "startLineNumber" : 8886,
    "startColumnNumber" : 142,
    "endLineNumber" : 8886,
    "endColumnNumber" : 145
  }, {
    "charLength" : 3,
    "startLineNumber" : 8899,
    "startColumnNumber" : 113,
    "endLineNumber" : 8899,
    "endColumnNumber" : 116
  }, {
    "charLength" : 3,
    "startLineNumber" : 8926,
    "startColumnNumber" : 169,
    "endLineNumber" : 8926,
    "endColumnNumber" : 172
  }, {
    "charLength" : 3,
    "startLineNumber" : 9030,
    "startColumnNumber" : 103,
    "endLineNumber" : 9030,
    "endColumnNumber" : 106
  }, {
    "charLength" : 3,
    "startLineNumber" : 9031,
    "startColumnNumber" : 100,
    "endLineNumber" : 9031,
    "endColumnNumber" : 103
  }, {
    "charLength" : 3,
    "startLineNumber" : 9032,
    "startColumnNumber" : 107,
    "endLineNumber" : 9032,
    "endColumnNumber" : 110
  }, {
    "charLength" : 3,
    "startLineNumber" : 9033,
    "startColumnNumber" : 107,
    "endLineNumber" : 9033,
    "endColumnNumber" : 110
  }, {
    "charLength" : 3,
    "startLineNumber" : 9035,
    "startColumnNumber" : 129,
    "endLineNumber" : 9035,
    "endColumnNumber" : 132
  }, {
    "charLength" : 3,
    "startLineNumber" : 9095,
    "startColumnNumber" : 103,
    "endLineNumber" : 9095,
    "endColumnNumber" : 106
  } ],
  "layoutRelationDataList" : [ {
    "firstKey" : 0,
    "secondKey" : 1,
    "layout" : 4
  }, {
    "firstKey" : 0,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 3,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 7,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 1,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 1,
    "secondKey" : 2,
    "layout" : 6
  }, {
    "firstKey" : 1,
    "secondKey" : 3,
    "layout" : 6
  }, {
    "firstKey" : 1,
    "secondKey" : 4,
    "layout" : 6
  }, {
    "firstKey" : 1,
    "secondKey" : 5,
    "layout" : 6
  }, {
    "firstKey" : 1,
    "secondKey" : 6,
    "layout" : 6
  }, {
    "firstKey" : 1,
    "secondKey" : 7,
    "layout" : 6
  }, {
    "firstKey" : 1,
    "secondKey" : 8,
    "layout" : 6
  }, {
    "firstKey" : 2,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 2,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 2,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 0,
    "layout" : 6
  }, {
    "firstKey" : 3,
    "secondKey" : 1,
    "layout" : 6
  }, {
    "firstKey" : 3,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 7,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 4,
    "secondKey" : 0,
    "layout" : 6
  }, {
    "firstKey" : 4,
    "secondKey" : 1,
    "layout" : 6
  }, {
    "firstKey" : 4,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 4,
    "secondKey" : 3,
    "layout" : 5
  }, {
    "firstKey" : 4,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 4,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 4,
    "secondKey" : 7,
    "layout" : 5
  }, {
    "firstKey" : 4,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 5,
    "secondKey" : 0,
    "layout" : 6
  }, {
    "firstKey" : 5,
    "secondKey" : 1,
    "layout" : 6
  }, {
    "firstKey" : 5,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 5,
    "secondKey" : 3,
    "layout" : 5
  }, {
    "firstKey" : 5,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 5,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 5,
    "secondKey" : 7,
    "layout" : 5
  }, {
    "firstKey" : 5,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 0,
    "layout" : 6
  }, {
    "firstKey" : 6,
    "secondKey" : 1,
    "layout" : 6
  }, {
    "firstKey" : 6,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 3,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 7,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 7,
    "secondKey" : 0,
    "layout" : 7
  }, {
    "firstKey" : 7,
    "secondKey" : 1,
    "layout" : 7
  }, {
    "firstKey" : 7,
    "secondKey" : 2,
    "layout" : 6
  }, {
    "firstKey" : 7,
    "secondKey" : 3,
    "layout" : 6
  }, {
    "firstKey" : 7,
    "secondKey" : 4,
    "layout" : 6
  }, {
    "firstKey" : 7,
    "secondKey" : 5,
    "layout" : 6
  }, {
    "firstKey" : 7,
    "secondKey" : 6,
    "layout" : 6
  }, {
    "firstKey" : 7,
    "secondKey" : 8,
    "layout" : 6
  }, {
    "firstKey" : 8,
    "secondKey" : 0,
    "layout" : 6
  }, {
    "firstKey" : 8,
    "secondKey" : 1,
    "layout" : 6
  }, {
    "firstKey" : 8,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 8,
    "secondKey" : 3,
    "layout" : 5
  }, {
    "firstKey" : 8,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 8,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 8,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 8,
    "secondKey" : 7,
    "layout" : 5
  } ]
}