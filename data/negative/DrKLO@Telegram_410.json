{
  "id" : 410,
  "expression" : "datacenter",
  "projectName" : "DrKLO@Telegram",
  "commitID" : "51aa4141a41a811e87b829f587753f0b20158a9b",
  "filePath" : "TMessagesProj/src/main/java/org/telegram/messenger/ConnectionsManager.java",
  "occurrences" : 18,
  "isArithmeticExpression" : 0,
  "isGetTypeMethod" : 0,
  "expressionList" : [ {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 1858,
      "startColumnNumber" : 16,
      "endLineNumber" : 1858,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 40,
        "startLineNumber" : 1858,
        "startColumnNumber" : 16,
        "endLineNumber" : 1858,
        "endColumnNumber" : 56
      },
      "nodeContext" : "datacenter.addServerSalt(serverSaltDesc)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 41,
        "startLineNumber" : 1858,
        "startColumnNumber" : 16,
        "endLineNumber" : 1858,
        "endColumnNumber" : 57
      },
      "nodeContext" : "datacenter.addServerSalt(serverSaltDesc);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1731,
        "startLineNumber" : 1846,
        "startColumnNumber" : 53,
        "endLineNumber" : 1877,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  FileLog.d(\"tmessages\",\"New session:\");\n  FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n  FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n  FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n  long serverSalt=newSession.server_salt;\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=serverSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  for (  RPCRequest request : runningRequests) {\n    Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n    if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.runningStartTime=0;\n      request.runningMinStartTime=0;\n      request.transportChannelToken=0;\n    }\n  }\n  saveSession();\n  if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n    MessagesController.getInstance().getDifference();\n  }\n  arr.add(newSession.unique_id);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 199,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1772,
        "startLineNumber" : 1846,
        "startColumnNumber" : 12,
        "endLineNumber" : 1877,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!arr.contains(newSession.unique_id)) {\n  FileLog.d(\"tmessages\",\"New session:\");\n  FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n  FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n  FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n  long serverSalt=newSession.server_salt;\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=serverSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  for (  RPCRequest request : runningRequests) {\n    Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n    if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.runningStartTime=0;\n      request.runningMinStartTime=0;\n      request.transportChannelToken=0;\n    }\n  }\n  saveSession();\n  if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n    MessagesController.getInstance().getDifference();\n  }\n  arr.add(newSession.unique_id);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 207,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2114,
        "startLineNumber" : 1839,
        "startColumnNumber" : 61,
        "endLineNumber" : 1878,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 253,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 41,
        "startLineNumber" : 1858,
        "startColumnNumber" : 16,
        "endLineNumber" : 1858,
        "endColumnNumber" : 57
      },
      "nodeContext" : "datacenter.addServerSalt(serverSaltDesc);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 5,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 1862,
      "startColumnNumber" : 180,
      "endLineNumber" : 1862,
      "endColumnNumber" : 190
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,rightOperand]",
      "nodePosition" : {
        "charLength" : 23,
        "startLineNumber" : 1862,
        "startColumnNumber" : 180,
        "endLineNumber" : 1862,
        "endColumnNumber" : 203
      },
      "nodeContext" : "datacenter.datacenterId",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,rightOperand]",
      "nodePosition" : {
        "charLength" : 47,
        "startLineNumber" : 1862,
        "startColumnNumber" : 156,
        "endLineNumber" : 1862,
        "endColumnNumber" : 203
      },
      "nodeContext" : "dcenter.datacenterId == datacenter.datacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 7,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 179,
        "startLineNumber" : 1862,
        "startColumnNumber" : 24,
        "endLineNumber" : 1862,
        "endColumnNumber" : 203
      },
      "nodeContext" : "request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 30,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 489,
        "startLineNumber" : 1862,
        "startColumnNumber" : 20,
        "endLineNumber" : 1868,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n  request.runningMessageId=0;\n  request.runningMessageSeqNo=0;\n  request.runningStartTime=0;\n  request.runningMinStartTime=0;\n  request.transportChannelToken=0;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 62,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.EnhancedForStatement,body]",
      "nodePosition" : {
        "charLength" : 617,
        "startLineNumber" : 1860,
        "startColumnNumber" : 59,
        "endLineNumber" : 1869,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n  if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.runningStartTime=0;\n    request.runningMinStartTime=0;\n    request.transportChannelToken=0;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 73,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 660,
        "startLineNumber" : 1860,
        "startColumnNumber" : 16,
        "endLineNumber" : 1869,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (RPCRequest request : runningRequests) {\n  Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n  if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.runningStartTime=0;\n    request.runningMinStartTime=0;\n    request.transportChannelToken=0;\n  }\n}\n",
      "nodeType" : "EnhancedForStatement",
      "astNodeNumber" : 79,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1731,
        "startLineNumber" : 1846,
        "startColumnNumber" : 53,
        "endLineNumber" : 1877,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  FileLog.d(\"tmessages\",\"New session:\");\n  FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n  FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n  FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n  long serverSalt=newSession.server_salt;\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=serverSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  for (  RPCRequest request : runningRequests) {\n    Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n    if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.runningStartTime=0;\n      request.runningMinStartTime=0;\n      request.transportChannelToken=0;\n    }\n  }\n  saveSession();\n  if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n    MessagesController.getInstance().getDifference();\n  }\n  arr.add(newSession.unique_id);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 199,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1772,
        "startLineNumber" : 1846,
        "startColumnNumber" : 12,
        "endLineNumber" : 1877,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!arr.contains(newSession.unique_id)) {\n  FileLog.d(\"tmessages\",\"New session:\");\n  FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n  FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n  FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n  long serverSalt=newSession.server_salt;\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=serverSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  for (  RPCRequest request : runningRequests) {\n    Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n    if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.runningStartTime=0;\n      request.runningMinStartTime=0;\n      request.transportChannelToken=0;\n    }\n  }\n  saveSession();\n  if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n    MessagesController.getInstance().getDifference();\n  }\n  arr.add(newSession.unique_id);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 207,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2114,
        "startLineNumber" : 1839,
        "startColumnNumber" : 61,
        "endLineNumber" : 1878,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 253,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 179,
        "startLineNumber" : 1862,
        "startColumnNumber" : 24,
        "endLineNumber" : 1862,
        "endColumnNumber" : 203
      },
      "nodeContext" : "request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 30,
      "astHeight" : 8
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 1873,
      "startColumnNumber" : 33,
      "endLineNumber" : 1873,
      "endColumnNumber" : 43
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,rightOperand]",
      "nodePosition" : {
        "charLength" : 24,
        "startLineNumber" : 1873,
        "startColumnNumber" : 33,
        "endLineNumber" : 1873,
        "endColumnNumber" : 57
      },
      "nodeContext" : "datacenter.authSessionId",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 37,
        "startLineNumber" : 1873,
        "startColumnNumber" : 20,
        "endLineNumber" : 1873,
        "endColumnNumber" : 57
      },
      "nodeContext" : "sessionId == datacenter.authSessionId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 87,
        "startLineNumber" : 1873,
        "startColumnNumber" : 20,
        "endLineNumber" : 1873,
        "endColumnNumber" : 107
      },
      "nodeContext" : "sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 117,
        "startLineNumber" : 1873,
        "startColumnNumber" : 20,
        "endLineNumber" : 1873,
        "endColumnNumber" : 137
      },
      "nodeContext" : "sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 15,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 212,
        "startLineNumber" : 1873,
        "startColumnNumber" : 16,
        "endLineNumber" : 1875,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n  MessagesController.getInstance().getDifference();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 23,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1731,
        "startLineNumber" : 1846,
        "startColumnNumber" : 53,
        "endLineNumber" : 1877,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  FileLog.d(\"tmessages\",\"New session:\");\n  FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n  FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n  FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n  long serverSalt=newSession.server_salt;\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=serverSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  for (  RPCRequest request : runningRequests) {\n    Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n    if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.runningStartTime=0;\n      request.runningMinStartTime=0;\n      request.transportChannelToken=0;\n    }\n  }\n  saveSession();\n  if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n    MessagesController.getInstance().getDifference();\n  }\n  arr.add(newSession.unique_id);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 199,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1772,
        "startLineNumber" : 1846,
        "startColumnNumber" : 12,
        "endLineNumber" : 1877,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!arr.contains(newSession.unique_id)) {\n  FileLog.d(\"tmessages\",\"New session:\");\n  FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n  FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n  FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n  long serverSalt=newSession.server_salt;\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=serverSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  for (  RPCRequest request : runningRequests) {\n    Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n    if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.runningStartTime=0;\n      request.runningMinStartTime=0;\n      request.transportChannelToken=0;\n    }\n  }\n  saveSession();\n  if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n    MessagesController.getInstance().getDifference();\n  }\n  arr.add(newSession.unique_id);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 207,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2114,
        "startLineNumber" : 1839,
        "startColumnNumber" : 61,
        "endLineNumber" : 1878,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 253,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 117,
        "startLineNumber" : 1873,
        "startColumnNumber" : 20,
        "endLineNumber" : 1873,
        "endColumnNumber" : 137
      },
      "nodeContext" : "sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 15,
      "astHeight" : 5
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 1873,
      "startColumnNumber" : 61,
      "endLineNumber" : 1873,
      "endColumnNumber" : 71
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 23,
        "startLineNumber" : 1873,
        "startColumnNumber" : 61,
        "endLineNumber" : 1873,
        "endColumnNumber" : 84
      },
      "nodeContext" : "datacenter.datacenterId",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,rightOperand]",
      "nodePosition" : {
        "charLength" : 46,
        "startLineNumber" : 1873,
        "startColumnNumber" : 61,
        "endLineNumber" : 1873,
        "endColumnNumber" : 107
      },
      "nodeContext" : "datacenter.datacenterId == currentDatacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 87,
        "startLineNumber" : 1873,
        "startColumnNumber" : 20,
        "endLineNumber" : 1873,
        "endColumnNumber" : 107
      },
      "nodeContext" : "sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 117,
        "startLineNumber" : 1873,
        "startColumnNumber" : 20,
        "endLineNumber" : 1873,
        "endColumnNumber" : 137
      },
      "nodeContext" : "sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 15,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 212,
        "startLineNumber" : 1873,
        "startColumnNumber" : 16,
        "endLineNumber" : 1875,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n  MessagesController.getInstance().getDifference();\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 23,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1731,
        "startLineNumber" : 1846,
        "startColumnNumber" : 53,
        "endLineNumber" : 1877,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  FileLog.d(\"tmessages\",\"New session:\");\n  FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n  FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n  FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n  long serverSalt=newSession.server_salt;\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=serverSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  for (  RPCRequest request : runningRequests) {\n    Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n    if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.runningStartTime=0;\n      request.runningMinStartTime=0;\n      request.transportChannelToken=0;\n    }\n  }\n  saveSession();\n  if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n    MessagesController.getInstance().getDifference();\n  }\n  arr.add(newSession.unique_id);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 199,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1772,
        "startLineNumber" : 1846,
        "startColumnNumber" : 12,
        "endLineNumber" : 1877,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!arr.contains(newSession.unique_id)) {\n  FileLog.d(\"tmessages\",\"New session:\");\n  FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n  FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n  FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n  long serverSalt=newSession.server_salt;\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=serverSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  for (  RPCRequest request : runningRequests) {\n    Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n    if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.runningStartTime=0;\n      request.runningMinStartTime=0;\n      request.transportChannelToken=0;\n    }\n  }\n  saveSession();\n  if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n    MessagesController.getInstance().getDifference();\n  }\n  arr.add(newSession.unique_id);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 207,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2114,
        "startLineNumber" : 1839,
        "startColumnNumber" : 61,
        "endLineNumber" : 1878,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 253,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 117,
        "startLineNumber" : 1873,
        "startColumnNumber" : 20,
        "endLineNumber" : 1873,
        "endColumnNumber" : 137
      },
      "nodeContext" : "sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 15,
      "astHeight" : 5
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2110,
      "startColumnNumber" : 36,
      "endLineNumber" : 2110,
      "endColumnNumber" : 46
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 23,
        "startLineNumber" : 2110,
        "startColumnNumber" : 36,
        "endLineNumber" : 2110,
        "endColumnNumber" : 59
      },
      "nodeContext" : "datacenter.datacenterId",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 46,
        "startLineNumber" : 2110,
        "startColumnNumber" : 36,
        "endLineNumber" : 2110,
        "endColumnNumber" : 82
      },
      "nodeContext" : "datacenter.datacenterId == currentDatacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 97,
        "startLineNumber" : 2110,
        "startColumnNumber" : 36,
        "endLineNumber" : 2110,
        "endColumnNumber" : 133
      },
      "nodeContext" : "datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1482,
        "startLineNumber" : 2110,
        "startColumnNumber" : 32,
        "endLineNumber" : 2130,
        "endColumnNumber" : 33
      },
      "nodeContext" : "if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n  if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n    if (UserConfig.clientActivated) {\n      UserConfig.clearConfig();\n      Utilities.RunOnUIThread(new Runnable(){\n        @Override public void run(){\n          NotificationCenter.getInstance().postNotificationName(1234);\n        }\n      }\n);\n    }\n  }\n}\n else {\n  datacenter.authorized=false;\n  saveSession();\n  discardResponse=true;\n  if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n    retryRequestsFromDatacenter=datacenter.datacenterId;\n    retryRequestsClass=request.flags;\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 105,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1594,
        "startLineNumber" : 2108,
        "startColumnNumber" : 84,
        "endLineNumber" : 2131,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  isError=true;\n  if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n    if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n      if (UserConfig.clientActivated) {\n        UserConfig.clearConfig();\n        Utilities.RunOnUIThread(new Runnable(){\n          @Override public void run(){\n            NotificationCenter.getInstance().postNotificationName(1234);\n          }\n        }\n);\n      }\n    }\n  }\n else {\n    datacenter.authorized=false;\n    saveSession();\n    discardResponse=true;\n    if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n      retryRequestsFromDatacenter=datacenter.datacenterId;\n      retryRequestsClass=request.flags;\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 110,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1650,
        "startLineNumber" : 2108,
        "startColumnNumber" : 28,
        "endLineNumber" : 2131,
        "endColumnNumber" : 29
      },
      "nodeContext" : "if (implicitError != null && implicitError.code == 401) {\n  isError=true;\n  if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n    if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n      if (UserConfig.clientActivated) {\n        UserConfig.clearConfig();\n        Utilities.RunOnUIThread(new Runnable(){\n          @Override public void run(){\n            NotificationCenter.getInstance().postNotificationName(1234);\n          }\n        }\n);\n      }\n    }\n  }\n else {\n    datacenter.authorized=false;\n    saveSession();\n    discardResponse=true;\n    if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n      retryRequestsFromDatacenter=datacenter.datacenterId;\n      retryRequestsClass=request.flags;\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 120,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 7592,
        "startLineNumber" : 2019,
        "startColumnNumber" : 61,
        "endLineNumber" : 2132,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  TLRPC.TL_error implicitError=null;\n  if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n    TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    if (uncomressed == null) {\n      System.gc();\n      uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    }\n    if (uncomressed == null) {\n      throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n    }\n    resultContainer.result=uncomressed;\n  }\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n    if (errorCode == 500 || errorCode < 0) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n        if (request.serverFailureCount < 1) {\n          discardResponse=true;\n          request.runningMinStartTime=request.runningStartTime + 1;\n        }\n      }\n else {\n        discardResponse=true;\n        int delay=Math.min(1,request.serverFailureCount * 2);\n        request.runningMinStartTime=request.runningStartTime + delay;\n        request.confirmed=false;\n      }\n      request.serverFailureCount++;\n    }\n else     if (errorCode == 420) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n        double waitTime=2.0;\n        if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n          String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            waitTime=val;\n          }\n        }\n        waitTime=Math.min(30,waitTime);\n        discardResponse=true;\n        request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n        request.confirmed=false;\n      }\n    }\n    implicitError=new TLRPC.TL_error();\n    implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n    implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n  }\n else   if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n    if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n      if (request.rawRequest == null) {\n        FileLog.e(\"tmessages\",\"rawRequest is null\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=-1000;\n    }\n  }\n  if (!discardResponse) {\n    if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n      isError=true;\n      request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n    }\n else {\n      request.completionBlock.run(resultContainer.result,null);\n    }\n  }\n  if (implicitError != null && implicitError.code == 401) {\n    isError=true;\n    if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n      if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n        if (UserConfig.clientActivated) {\n          UserConfig.clearConfig();\n          Utilities.RunOnUIThread(new Runnable(){\n            @Override public void run(){\n              NotificationCenter.getInstance().postNotificationName(1234);\n            }\n          }\n);\n        }\n      }\n    }\n else {\n      datacenter.authorized=false;\n      saveSession();\n      discardResponse=true;\n      if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n        retryRequestsFromDatacenter=datacenter.datacenterId;\n        retryRequestsClass=request.flags;\n      }\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 658,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 7629,
        "startLineNumber" : 2019,
        "startColumnNumber" : 24,
        "endLineNumber" : 2132,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (request.completionBlock != null) {\n  TLRPC.TL_error implicitError=null;\n  if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n    TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    if (uncomressed == null) {\n      System.gc();\n      uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    }\n    if (uncomressed == null) {\n      throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n    }\n    resultContainer.result=uncomressed;\n  }\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n    if (errorCode == 500 || errorCode < 0) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n        if (request.serverFailureCount < 1) {\n          discardResponse=true;\n          request.runningMinStartTime=request.runningStartTime + 1;\n        }\n      }\n else {\n        discardResponse=true;\n        int delay=Math.min(1,request.serverFailureCount * 2);\n        request.runningMinStartTime=request.runningStartTime + delay;\n        request.confirmed=false;\n      }\n      request.serverFailureCount++;\n    }\n else     if (errorCode == 420) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n        double waitTime=2.0;\n        if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n          String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            waitTime=val;\n          }\n        }\n        waitTime=Math.min(30,waitTime);\n        discardResponse=true;\n        request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n        request.confirmed=false;\n      }\n    }\n    implicitError=new TLRPC.TL_error();\n    implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n    implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n  }\n else   if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n    if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n      if (request.rawRequest == null) {\n        FileLog.e(\"tmessages\",\"rawRequest is null\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=-1000;\n    }\n  }\n  if (!discardResponse) {\n    if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n      isError=true;\n      request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n    }\n else {\n      request.completionBlock.run(resultContainer.result,null);\n    }\n  }\n  if (implicitError != null && implicitError.code == 401) {\n    isError=true;\n    if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n      if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n        if (UserConfig.clientActivated) {\n          UserConfig.clearConfig();\n          Utilities.RunOnUIThread(new Runnable(){\n            @Override public void run(){\n              NotificationCenter.getInstance().postNotificationName(1234);\n            }\n          }\n);\n        }\n      }\n    }\n else {\n      datacenter.authorized=false;\n      saveSession();\n      discardResponse=true;\n      if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n        retryRequestsFromDatacenter=datacenter.datacenterId;\n        retryRequestsClass=request.flags;\n      }\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 664,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 8793,
        "startLineNumber" : 2014,
        "startColumnNumber" : 64,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 744,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8837,
        "startLineNumber" : 2014,
        "startColumnNumber" : 20,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (request.respondsToMessageId(resultMid)) {\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 749,
      "astHeight" : 22
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.EnhancedForStatement,body]",
      "nodePosition" : {
        "charLength" : 8877,
        "startLineNumber" : 2013,
        "startColumnNumber" : 59,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 750,
      "astHeight" : 23
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8920,
        "startLineNumber" : 2013,
        "startColumnNumber" : 16,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (RPCRequest request : runningRequests) {\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "EnhancedForStatement",
      "astNodeNumber" : 756,
      "astHeight" : 24
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 9275,
        "startLineNumber" : 2010,
        "startColumnNumber" : 31,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 784,
      "astHeight" : 25
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 9294,
        "startLineNumber" : 2010,
        "startColumnNumber" : 12,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!ignoreResult) {\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 787,
      "astHeight" : 26
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 11910,
        "startLineNumber" : 1958,
        "startColumnNumber" : 59,
        "endLineNumber" : 2169,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1050,
      "astHeight" : 27
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 97,
        "startLineNumber" : 2110,
        "startColumnNumber" : 36,
        "endLineNumber" : 2110,
        "endColumnNumber" : 133
      },
      "nodeContext" : "datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 11,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2110,
      "startColumnNumber" : 86,
      "endLineNumber" : 2110,
      "endColumnNumber" : 96
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 23,
        "startLineNumber" : 2110,
        "startColumnNumber" : 86,
        "endLineNumber" : 2110,
        "endColumnNumber" : 109
      },
      "nodeContext" : "datacenter.datacenterId",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,rightOperand]",
      "nodePosition" : {
        "charLength" : 47,
        "startLineNumber" : 2110,
        "startColumnNumber" : 86,
        "endLineNumber" : 2110,
        "endColumnNumber" : 133
      },
      "nodeContext" : "datacenter.datacenterId == movingToDatacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 97,
        "startLineNumber" : 2110,
        "startColumnNumber" : 36,
        "endLineNumber" : 2110,
        "endColumnNumber" : 133
      },
      "nodeContext" : "datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 11,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1482,
        "startLineNumber" : 2110,
        "startColumnNumber" : 32,
        "endLineNumber" : 2130,
        "endColumnNumber" : 33
      },
      "nodeContext" : "if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n  if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n    if (UserConfig.clientActivated) {\n      UserConfig.clearConfig();\n      Utilities.RunOnUIThread(new Runnable(){\n        @Override public void run(){\n          NotificationCenter.getInstance().postNotificationName(1234);\n        }\n      }\n);\n    }\n  }\n}\n else {\n  datacenter.authorized=false;\n  saveSession();\n  discardResponse=true;\n  if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n    retryRequestsFromDatacenter=datacenter.datacenterId;\n    retryRequestsClass=request.flags;\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 105,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1594,
        "startLineNumber" : 2108,
        "startColumnNumber" : 84,
        "endLineNumber" : 2131,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  isError=true;\n  if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n    if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n      if (UserConfig.clientActivated) {\n        UserConfig.clearConfig();\n        Utilities.RunOnUIThread(new Runnable(){\n          @Override public void run(){\n            NotificationCenter.getInstance().postNotificationName(1234);\n          }\n        }\n);\n      }\n    }\n  }\n else {\n    datacenter.authorized=false;\n    saveSession();\n    discardResponse=true;\n    if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n      retryRequestsFromDatacenter=datacenter.datacenterId;\n      retryRequestsClass=request.flags;\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 110,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1650,
        "startLineNumber" : 2108,
        "startColumnNumber" : 28,
        "endLineNumber" : 2131,
        "endColumnNumber" : 29
      },
      "nodeContext" : "if (implicitError != null && implicitError.code == 401) {\n  isError=true;\n  if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n    if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n      if (UserConfig.clientActivated) {\n        UserConfig.clearConfig();\n        Utilities.RunOnUIThread(new Runnable(){\n          @Override public void run(){\n            NotificationCenter.getInstance().postNotificationName(1234);\n          }\n        }\n);\n      }\n    }\n  }\n else {\n    datacenter.authorized=false;\n    saveSession();\n    discardResponse=true;\n    if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n      retryRequestsFromDatacenter=datacenter.datacenterId;\n      retryRequestsClass=request.flags;\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 120,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 7592,
        "startLineNumber" : 2019,
        "startColumnNumber" : 61,
        "endLineNumber" : 2132,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  TLRPC.TL_error implicitError=null;\n  if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n    TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    if (uncomressed == null) {\n      System.gc();\n      uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    }\n    if (uncomressed == null) {\n      throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n    }\n    resultContainer.result=uncomressed;\n  }\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n    if (errorCode == 500 || errorCode < 0) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n        if (request.serverFailureCount < 1) {\n          discardResponse=true;\n          request.runningMinStartTime=request.runningStartTime + 1;\n        }\n      }\n else {\n        discardResponse=true;\n        int delay=Math.min(1,request.serverFailureCount * 2);\n        request.runningMinStartTime=request.runningStartTime + delay;\n        request.confirmed=false;\n      }\n      request.serverFailureCount++;\n    }\n else     if (errorCode == 420) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n        double waitTime=2.0;\n        if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n          String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            waitTime=val;\n          }\n        }\n        waitTime=Math.min(30,waitTime);\n        discardResponse=true;\n        request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n        request.confirmed=false;\n      }\n    }\n    implicitError=new TLRPC.TL_error();\n    implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n    implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n  }\n else   if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n    if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n      if (request.rawRequest == null) {\n        FileLog.e(\"tmessages\",\"rawRequest is null\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=-1000;\n    }\n  }\n  if (!discardResponse) {\n    if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n      isError=true;\n      request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n    }\n else {\n      request.completionBlock.run(resultContainer.result,null);\n    }\n  }\n  if (implicitError != null && implicitError.code == 401) {\n    isError=true;\n    if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n      if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n        if (UserConfig.clientActivated) {\n          UserConfig.clearConfig();\n          Utilities.RunOnUIThread(new Runnable(){\n            @Override public void run(){\n              NotificationCenter.getInstance().postNotificationName(1234);\n            }\n          }\n);\n        }\n      }\n    }\n else {\n      datacenter.authorized=false;\n      saveSession();\n      discardResponse=true;\n      if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n        retryRequestsFromDatacenter=datacenter.datacenterId;\n        retryRequestsClass=request.flags;\n      }\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 658,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 7629,
        "startLineNumber" : 2019,
        "startColumnNumber" : 24,
        "endLineNumber" : 2132,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (request.completionBlock != null) {\n  TLRPC.TL_error implicitError=null;\n  if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n    TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    if (uncomressed == null) {\n      System.gc();\n      uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    }\n    if (uncomressed == null) {\n      throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n    }\n    resultContainer.result=uncomressed;\n  }\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n    if (errorCode == 500 || errorCode < 0) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n        if (request.serverFailureCount < 1) {\n          discardResponse=true;\n          request.runningMinStartTime=request.runningStartTime + 1;\n        }\n      }\n else {\n        discardResponse=true;\n        int delay=Math.min(1,request.serverFailureCount * 2);\n        request.runningMinStartTime=request.runningStartTime + delay;\n        request.confirmed=false;\n      }\n      request.serverFailureCount++;\n    }\n else     if (errorCode == 420) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n        double waitTime=2.0;\n        if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n          String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            waitTime=val;\n          }\n        }\n        waitTime=Math.min(30,waitTime);\n        discardResponse=true;\n        request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n        request.confirmed=false;\n      }\n    }\n    implicitError=new TLRPC.TL_error();\n    implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n    implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n  }\n else   if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n    if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n      if (request.rawRequest == null) {\n        FileLog.e(\"tmessages\",\"rawRequest is null\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=-1000;\n    }\n  }\n  if (!discardResponse) {\n    if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n      isError=true;\n      request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n    }\n else {\n      request.completionBlock.run(resultContainer.result,null);\n    }\n  }\n  if (implicitError != null && implicitError.code == 401) {\n    isError=true;\n    if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n      if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n        if (UserConfig.clientActivated) {\n          UserConfig.clearConfig();\n          Utilities.RunOnUIThread(new Runnable(){\n            @Override public void run(){\n              NotificationCenter.getInstance().postNotificationName(1234);\n            }\n          }\n);\n        }\n      }\n    }\n else {\n      datacenter.authorized=false;\n      saveSession();\n      discardResponse=true;\n      if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n        retryRequestsFromDatacenter=datacenter.datacenterId;\n        retryRequestsClass=request.flags;\n      }\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 664,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 8793,
        "startLineNumber" : 2014,
        "startColumnNumber" : 64,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 744,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8837,
        "startLineNumber" : 2014,
        "startColumnNumber" : 20,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (request.respondsToMessageId(resultMid)) {\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 749,
      "astHeight" : 22
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.EnhancedForStatement,body]",
      "nodePosition" : {
        "charLength" : 8877,
        "startLineNumber" : 2013,
        "startColumnNumber" : 59,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 750,
      "astHeight" : 23
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8920,
        "startLineNumber" : 2013,
        "startColumnNumber" : 16,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (RPCRequest request : runningRequests) {\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "EnhancedForStatement",
      "astNodeNumber" : 756,
      "astHeight" : 24
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 9275,
        "startLineNumber" : 2010,
        "startColumnNumber" : 31,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 784,
      "astHeight" : 25
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 9294,
        "startLineNumber" : 2010,
        "startColumnNumber" : 12,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!ignoreResult) {\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 787,
      "astHeight" : 26
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 11910,
        "startLineNumber" : 1958,
        "startColumnNumber" : 59,
        "endLineNumber" : 2169,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1050,
      "astHeight" : 27
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 97,
        "startLineNumber" : 2110,
        "startColumnNumber" : 36,
        "endLineNumber" : 2110,
        "endColumnNumber" : 133
      },
      "nodeContext" : "datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 11,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2123,
      "startColumnNumber" : 36,
      "endLineNumber" : 2123,
      "endColumnNumber" : 46
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.Assignment,leftHandSide]",
      "nodePosition" : {
        "charLength" : 21,
        "startLineNumber" : 2123,
        "startColumnNumber" : 36,
        "endLineNumber" : 2123,
        "endColumnNumber" : 57
      },
      "nodeContext" : "datacenter.authorized",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 29,
        "startLineNumber" : 2123,
        "startColumnNumber" : 36,
        "endLineNumber" : 2123,
        "endColumnNumber" : 65
      },
      "nodeContext" : "datacenter.authorized=false",
      "nodeType" : "Assignment",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 30,
        "startLineNumber" : 2123,
        "startColumnNumber" : 36,
        "endLineNumber" : 2123,
        "endColumnNumber" : 66
      },
      "nodeContext" : "datacenter.authorized=false;\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 592,
        "startLineNumber" : 2122,
        "startColumnNumber" : 39,
        "endLineNumber" : 2130,
        "endColumnNumber" : 33
      },
      "nodeContext" : "{\n  datacenter.authorized=false;\n  saveSession();\n  discardResponse=true;\n  if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n    retryRequestsFromDatacenter=datacenter.datacenterId;\n    retryRequestsClass=request.flags;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 49,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1482,
        "startLineNumber" : 2110,
        "startColumnNumber" : 32,
        "endLineNumber" : 2130,
        "endColumnNumber" : 33
      },
      "nodeContext" : "if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n  if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n    if (UserConfig.clientActivated) {\n      UserConfig.clearConfig();\n      Utilities.RunOnUIThread(new Runnable(){\n        @Override public void run(){\n          NotificationCenter.getInstance().postNotificationName(1234);\n        }\n      }\n);\n    }\n  }\n}\n else {\n  datacenter.authorized=false;\n  saveSession();\n  discardResponse=true;\n  if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n    retryRequestsFromDatacenter=datacenter.datacenterId;\n    retryRequestsClass=request.flags;\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 105,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1594,
        "startLineNumber" : 2108,
        "startColumnNumber" : 84,
        "endLineNumber" : 2131,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  isError=true;\n  if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n    if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n      if (UserConfig.clientActivated) {\n        UserConfig.clearConfig();\n        Utilities.RunOnUIThread(new Runnable(){\n          @Override public void run(){\n            NotificationCenter.getInstance().postNotificationName(1234);\n          }\n        }\n);\n      }\n    }\n  }\n else {\n    datacenter.authorized=false;\n    saveSession();\n    discardResponse=true;\n    if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n      retryRequestsFromDatacenter=datacenter.datacenterId;\n      retryRequestsClass=request.flags;\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 110,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1650,
        "startLineNumber" : 2108,
        "startColumnNumber" : 28,
        "endLineNumber" : 2131,
        "endColumnNumber" : 29
      },
      "nodeContext" : "if (implicitError != null && implicitError.code == 401) {\n  isError=true;\n  if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n    if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n      if (UserConfig.clientActivated) {\n        UserConfig.clearConfig();\n        Utilities.RunOnUIThread(new Runnable(){\n          @Override public void run(){\n            NotificationCenter.getInstance().postNotificationName(1234);\n          }\n        }\n);\n      }\n    }\n  }\n else {\n    datacenter.authorized=false;\n    saveSession();\n    discardResponse=true;\n    if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n      retryRequestsFromDatacenter=datacenter.datacenterId;\n      retryRequestsClass=request.flags;\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 120,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 7592,
        "startLineNumber" : 2019,
        "startColumnNumber" : 61,
        "endLineNumber" : 2132,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  TLRPC.TL_error implicitError=null;\n  if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n    TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    if (uncomressed == null) {\n      System.gc();\n      uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    }\n    if (uncomressed == null) {\n      throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n    }\n    resultContainer.result=uncomressed;\n  }\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n    if (errorCode == 500 || errorCode < 0) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n        if (request.serverFailureCount < 1) {\n          discardResponse=true;\n          request.runningMinStartTime=request.runningStartTime + 1;\n        }\n      }\n else {\n        discardResponse=true;\n        int delay=Math.min(1,request.serverFailureCount * 2);\n        request.runningMinStartTime=request.runningStartTime + delay;\n        request.confirmed=false;\n      }\n      request.serverFailureCount++;\n    }\n else     if (errorCode == 420) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n        double waitTime=2.0;\n        if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n          String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            waitTime=val;\n          }\n        }\n        waitTime=Math.min(30,waitTime);\n        discardResponse=true;\n        request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n        request.confirmed=false;\n      }\n    }\n    implicitError=new TLRPC.TL_error();\n    implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n    implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n  }\n else   if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n    if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n      if (request.rawRequest == null) {\n        FileLog.e(\"tmessages\",\"rawRequest is null\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=-1000;\n    }\n  }\n  if (!discardResponse) {\n    if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n      isError=true;\n      request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n    }\n else {\n      request.completionBlock.run(resultContainer.result,null);\n    }\n  }\n  if (implicitError != null && implicitError.code == 401) {\n    isError=true;\n    if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n      if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n        if (UserConfig.clientActivated) {\n          UserConfig.clearConfig();\n          Utilities.RunOnUIThread(new Runnable(){\n            @Override public void run(){\n              NotificationCenter.getInstance().postNotificationName(1234);\n            }\n          }\n);\n        }\n      }\n    }\n else {\n      datacenter.authorized=false;\n      saveSession();\n      discardResponse=true;\n      if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n        retryRequestsFromDatacenter=datacenter.datacenterId;\n        retryRequestsClass=request.flags;\n      }\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 658,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 7629,
        "startLineNumber" : 2019,
        "startColumnNumber" : 24,
        "endLineNumber" : 2132,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (request.completionBlock != null) {\n  TLRPC.TL_error implicitError=null;\n  if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n    TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    if (uncomressed == null) {\n      System.gc();\n      uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    }\n    if (uncomressed == null) {\n      throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n    }\n    resultContainer.result=uncomressed;\n  }\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n    if (errorCode == 500 || errorCode < 0) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n        if (request.serverFailureCount < 1) {\n          discardResponse=true;\n          request.runningMinStartTime=request.runningStartTime + 1;\n        }\n      }\n else {\n        discardResponse=true;\n        int delay=Math.min(1,request.serverFailureCount * 2);\n        request.runningMinStartTime=request.runningStartTime + delay;\n        request.confirmed=false;\n      }\n      request.serverFailureCount++;\n    }\n else     if (errorCode == 420) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n        double waitTime=2.0;\n        if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n          String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            waitTime=val;\n          }\n        }\n        waitTime=Math.min(30,waitTime);\n        discardResponse=true;\n        request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n        request.confirmed=false;\n      }\n    }\n    implicitError=new TLRPC.TL_error();\n    implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n    implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n  }\n else   if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n    if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n      if (request.rawRequest == null) {\n        FileLog.e(\"tmessages\",\"rawRequest is null\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=-1000;\n    }\n  }\n  if (!discardResponse) {\n    if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n      isError=true;\n      request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n    }\n else {\n      request.completionBlock.run(resultContainer.result,null);\n    }\n  }\n  if (implicitError != null && implicitError.code == 401) {\n    isError=true;\n    if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n      if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n        if (UserConfig.clientActivated) {\n          UserConfig.clearConfig();\n          Utilities.RunOnUIThread(new Runnable(){\n            @Override public void run(){\n              NotificationCenter.getInstance().postNotificationName(1234);\n            }\n          }\n);\n        }\n      }\n    }\n else {\n      datacenter.authorized=false;\n      saveSession();\n      discardResponse=true;\n      if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n        retryRequestsFromDatacenter=datacenter.datacenterId;\n        retryRequestsClass=request.flags;\n      }\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 664,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 8793,
        "startLineNumber" : 2014,
        "startColumnNumber" : 64,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 744,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8837,
        "startLineNumber" : 2014,
        "startColumnNumber" : 20,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (request.respondsToMessageId(resultMid)) {\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 749,
      "astHeight" : 22
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.EnhancedForStatement,body]",
      "nodePosition" : {
        "charLength" : 8877,
        "startLineNumber" : 2013,
        "startColumnNumber" : 59,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 750,
      "astHeight" : 23
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8920,
        "startLineNumber" : 2013,
        "startColumnNumber" : 16,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (RPCRequest request : runningRequests) {\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "EnhancedForStatement",
      "astNodeNumber" : 756,
      "astHeight" : 24
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 9275,
        "startLineNumber" : 2010,
        "startColumnNumber" : 31,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 784,
      "astHeight" : 25
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 9294,
        "startLineNumber" : 2010,
        "startColumnNumber" : 12,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!ignoreResult) {\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 787,
      "astHeight" : 26
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 11910,
        "startLineNumber" : 1958,
        "startColumnNumber" : 59,
        "endLineNumber" : 2169,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1050,
      "astHeight" : 27
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 30,
        "startLineNumber" : 2123,
        "startColumnNumber" : 36,
        "endLineNumber" : 2123,
        "endColumnNumber" : 66
      },
      "nodeContext" : "datacenter.authorized=false;\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2127,
      "startColumnNumber" : 70,
      "endLineNumber" : 2127,
      "endColumnNumber" : 80
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.Assignment,rightHandSide]",
      "nodePosition" : {
        "charLength" : 23,
        "startLineNumber" : 2127,
        "startColumnNumber" : 70,
        "endLineNumber" : 2127,
        "endColumnNumber" : 93
      },
      "nodeContext" : "datacenter.datacenterId",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 53,
        "startLineNumber" : 2127,
        "startColumnNumber" : 40,
        "endLineNumber" : 2127,
        "endColumnNumber" : 93
      },
      "nodeContext" : "retryRequestsFromDatacenter=datacenter.datacenterId",
      "nodeType" : "Assignment",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 54,
        "startLineNumber" : 2127,
        "startColumnNumber" : 40,
        "endLineNumber" : 2127,
        "endColumnNumber" : 94
      },
      "nodeContext" : "retryRequestsFromDatacenter=datacenter.datacenterId;\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 210,
        "startLineNumber" : 2126,
        "startColumnNumber" : 168,
        "endLineNumber" : 2129,
        "endColumnNumber" : 37
      },
      "nodeContext" : "{\n  retryRequestsFromDatacenter=datacenter.datacenterId;\n  retryRequestsClass=request.flags;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 13,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 342,
        "startLineNumber" : 2126,
        "startColumnNumber" : 36,
        "endLineNumber" : 2129,
        "endColumnNumber" : 37
      },
      "nodeContext" : "if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n  retryRequestsFromDatacenter=datacenter.datacenterId;\n  retryRequestsClass=request.flags;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 35,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 592,
        "startLineNumber" : 2122,
        "startColumnNumber" : 39,
        "endLineNumber" : 2130,
        "endColumnNumber" : 33
      },
      "nodeContext" : "{\n  datacenter.authorized=false;\n  saveSession();\n  discardResponse=true;\n  if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n    retryRequestsFromDatacenter=datacenter.datacenterId;\n    retryRequestsClass=request.flags;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 49,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1482,
        "startLineNumber" : 2110,
        "startColumnNumber" : 32,
        "endLineNumber" : 2130,
        "endColumnNumber" : 33
      },
      "nodeContext" : "if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n  if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n    if (UserConfig.clientActivated) {\n      UserConfig.clearConfig();\n      Utilities.RunOnUIThread(new Runnable(){\n        @Override public void run(){\n          NotificationCenter.getInstance().postNotificationName(1234);\n        }\n      }\n);\n    }\n  }\n}\n else {\n  datacenter.authorized=false;\n  saveSession();\n  discardResponse=true;\n  if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n    retryRequestsFromDatacenter=datacenter.datacenterId;\n    retryRequestsClass=request.flags;\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 105,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1594,
        "startLineNumber" : 2108,
        "startColumnNumber" : 84,
        "endLineNumber" : 2131,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  isError=true;\n  if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n    if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n      if (UserConfig.clientActivated) {\n        UserConfig.clearConfig();\n        Utilities.RunOnUIThread(new Runnable(){\n          @Override public void run(){\n            NotificationCenter.getInstance().postNotificationName(1234);\n          }\n        }\n);\n      }\n    }\n  }\n else {\n    datacenter.authorized=false;\n    saveSession();\n    discardResponse=true;\n    if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n      retryRequestsFromDatacenter=datacenter.datacenterId;\n      retryRequestsClass=request.flags;\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 110,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1650,
        "startLineNumber" : 2108,
        "startColumnNumber" : 28,
        "endLineNumber" : 2131,
        "endColumnNumber" : 29
      },
      "nodeContext" : "if (implicitError != null && implicitError.code == 401) {\n  isError=true;\n  if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n    if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n      if (UserConfig.clientActivated) {\n        UserConfig.clearConfig();\n        Utilities.RunOnUIThread(new Runnable(){\n          @Override public void run(){\n            NotificationCenter.getInstance().postNotificationName(1234);\n          }\n        }\n);\n      }\n    }\n  }\n else {\n    datacenter.authorized=false;\n    saveSession();\n    discardResponse=true;\n    if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n      retryRequestsFromDatacenter=datacenter.datacenterId;\n      retryRequestsClass=request.flags;\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 120,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 7592,
        "startLineNumber" : 2019,
        "startColumnNumber" : 61,
        "endLineNumber" : 2132,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  TLRPC.TL_error implicitError=null;\n  if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n    TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    if (uncomressed == null) {\n      System.gc();\n      uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    }\n    if (uncomressed == null) {\n      throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n    }\n    resultContainer.result=uncomressed;\n  }\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n    if (errorCode == 500 || errorCode < 0) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n        if (request.serverFailureCount < 1) {\n          discardResponse=true;\n          request.runningMinStartTime=request.runningStartTime + 1;\n        }\n      }\n else {\n        discardResponse=true;\n        int delay=Math.min(1,request.serverFailureCount * 2);\n        request.runningMinStartTime=request.runningStartTime + delay;\n        request.confirmed=false;\n      }\n      request.serverFailureCount++;\n    }\n else     if (errorCode == 420) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n        double waitTime=2.0;\n        if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n          String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            waitTime=val;\n          }\n        }\n        waitTime=Math.min(30,waitTime);\n        discardResponse=true;\n        request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n        request.confirmed=false;\n      }\n    }\n    implicitError=new TLRPC.TL_error();\n    implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n    implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n  }\n else   if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n    if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n      if (request.rawRequest == null) {\n        FileLog.e(\"tmessages\",\"rawRequest is null\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=-1000;\n    }\n  }\n  if (!discardResponse) {\n    if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n      isError=true;\n      request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n    }\n else {\n      request.completionBlock.run(resultContainer.result,null);\n    }\n  }\n  if (implicitError != null && implicitError.code == 401) {\n    isError=true;\n    if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n      if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n        if (UserConfig.clientActivated) {\n          UserConfig.clearConfig();\n          Utilities.RunOnUIThread(new Runnable(){\n            @Override public void run(){\n              NotificationCenter.getInstance().postNotificationName(1234);\n            }\n          }\n);\n        }\n      }\n    }\n else {\n      datacenter.authorized=false;\n      saveSession();\n      discardResponse=true;\n      if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n        retryRequestsFromDatacenter=datacenter.datacenterId;\n        retryRequestsClass=request.flags;\n      }\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 658,
      "astHeight" : 19
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 7629,
        "startLineNumber" : 2019,
        "startColumnNumber" : 24,
        "endLineNumber" : 2132,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (request.completionBlock != null) {\n  TLRPC.TL_error implicitError=null;\n  if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n    TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    if (uncomressed == null) {\n      System.gc();\n      uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n    }\n    if (uncomressed == null) {\n      throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n    }\n    resultContainer.result=uncomressed;\n  }\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n    if (errorCode == 500 || errorCode < 0) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n        if (request.serverFailureCount < 1) {\n          discardResponse=true;\n          request.runningMinStartTime=request.runningStartTime + 1;\n        }\n      }\n else {\n        discardResponse=true;\n        int delay=Math.min(1,request.serverFailureCount * 2);\n        request.runningMinStartTime=request.runningStartTime + delay;\n        request.confirmed=false;\n      }\n      request.serverFailureCount++;\n    }\n else     if (errorCode == 420) {\n      if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n        double waitTime=2.0;\n        if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n          String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            waitTime=val;\n          }\n        }\n        waitTime=Math.min(30,waitTime);\n        discardResponse=true;\n        request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n        request.confirmed=false;\n      }\n    }\n    implicitError=new TLRPC.TL_error();\n    implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n    implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n  }\n else   if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n    if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n      if (request.rawRequest == null) {\n        FileLog.e(\"tmessages\",\"rawRequest is null\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=-1000;\n    }\n  }\n  if (!discardResponse) {\n    if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n      isError=true;\n      request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n    }\n else {\n      request.completionBlock.run(resultContainer.result,null);\n    }\n  }\n  if (implicitError != null && implicitError.code == 401) {\n    isError=true;\n    if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n      if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n        if (UserConfig.clientActivated) {\n          UserConfig.clearConfig();\n          Utilities.RunOnUIThread(new Runnable(){\n            @Override public void run(){\n              NotificationCenter.getInstance().postNotificationName(1234);\n            }\n          }\n);\n        }\n      }\n    }\n else {\n      datacenter.authorized=false;\n      saveSession();\n      discardResponse=true;\n      if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n        retryRequestsFromDatacenter=datacenter.datacenterId;\n        retryRequestsClass=request.flags;\n      }\n    }\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 664,
      "astHeight" : 20
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 8793,
        "startLineNumber" : 2014,
        "startColumnNumber" : 64,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 744,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8837,
        "startLineNumber" : 2014,
        "startColumnNumber" : 20,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (request.respondsToMessageId(resultMid)) {\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 749,
      "astHeight" : 22
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.EnhancedForStatement,body]",
      "nodePosition" : {
        "charLength" : 8877,
        "startLineNumber" : 2013,
        "startColumnNumber" : 59,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 750,
      "astHeight" : 23
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8920,
        "startLineNumber" : 2013,
        "startColumnNumber" : 16,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (RPCRequest request : runningRequests) {\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "EnhancedForStatement",
      "astNodeNumber" : 756,
      "astHeight" : 24
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 9275,
        "startLineNumber" : 2010,
        "startColumnNumber" : 31,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 784,
      "astHeight" : 25
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 9294,
        "startLineNumber" : 2010,
        "startColumnNumber" : 12,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!ignoreResult) {\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 787,
      "astHeight" : 26
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 11910,
        "startLineNumber" : 1958,
        "startColumnNumber" : 59,
        "endLineNumber" : 2169,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1050,
      "astHeight" : 27
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 54,
        "startLineNumber" : 2127,
        "startColumnNumber" : 40,
        "endLineNumber" : 2127,
        "endColumnNumber" : 94
      },
      "nodeContext" : "retryRequestsFromDatacenter=datacenter.datacenterId;\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2136,
      "startColumnNumber" : 36,
      "endLineNumber" : 2136,
      "endColumnNumber" : 46
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 26,
        "startLineNumber" : 2136,
        "startColumnNumber" : 36,
        "endLineNumber" : 2136,
        "endColumnNumber" : 62
      },
      "nodeContext" : "datacenter.lastInitVersion",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 47,
        "startLineNumber" : 2136,
        "startColumnNumber" : 36,
        "endLineNumber" : 2136,
        "endColumnNumber" : 83
      },
      "nodeContext" : "datacenter.lastInitVersion != currentAppVersion",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 467,
        "startLineNumber" : 2136,
        "startColumnNumber" : 32,
        "endLineNumber" : 2142,
        "endColumnNumber" : 33
      },
      "nodeContext" : "if (datacenter.lastInitVersion != currentAppVersion) {\n  datacenter.lastInitVersion=currentAppVersion;\n  saveSession();\n  FileLog.e(\"tmessages\",\"init connection completed\");\n}\n else {\n  FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 29,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 531,
        "startLineNumber" : 2135,
        "startColumnNumber" : 65,
        "endLineNumber" : 2143,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  if (datacenter.lastInitVersion != currentAppVersion) {\n    datacenter.lastInitVersion=currentAppVersion;\n    saveSession();\n    FileLog.e(\"tmessages\",\"init connection completed\");\n  }\n else {\n    FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 30,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 568,
        "startLineNumber" : 2135,
        "startColumnNumber" : 28,
        "endLineNumber" : 2143,
        "endColumnNumber" : 29
      },
      "nodeContext" : "if (request.initRequest && !isError) {\n  if (datacenter.lastInitVersion != currentAppVersion) {\n    datacenter.lastInitVersion=currentAppVersion;\n    saveSession();\n    FileLog.e(\"tmessages\",\"init connection completed\");\n  }\n else {\n    FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 37,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 677,
        "startLineNumber" : 2134,
        "startColumnNumber" : 46,
        "endLineNumber" : 2145,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  if (request.initRequest && !isError) {\n    if (datacenter.lastInitVersion != currentAppVersion) {\n      datacenter.lastInitVersion=currentAppVersion;\n      saveSession();\n      FileLog.e(\"tmessages\",\"init connection completed\");\n    }\n else {\n      FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n    }\n  }\n  rpcCompleted(resultMid);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 42,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 914,
        "startLineNumber" : 2134,
        "startColumnNumber" : 24,
        "endLineNumber" : 2149,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (!discardResponse) {\n  if (request.initRequest && !isError) {\n    if (datacenter.lastInitVersion != currentAppVersion) {\n      datacenter.lastInitVersion=currentAppVersion;\n      saveSession();\n      FileLog.e(\"tmessages\",\"init connection completed\");\n    }\n else {\n      FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n    }\n  }\n  rpcCompleted(resultMid);\n}\n else {\n  request.runningMessageId=0;\n  request.runningMessageSeqNo=0;\n  request.transportChannelToken=0;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 64,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 8793,
        "startLineNumber" : 2014,
        "startColumnNumber" : 64,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 744,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8837,
        "startLineNumber" : 2014,
        "startColumnNumber" : 20,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (request.respondsToMessageId(resultMid)) {\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 749,
      "astHeight" : 22
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.EnhancedForStatement,body]",
      "nodePosition" : {
        "charLength" : 8877,
        "startLineNumber" : 2013,
        "startColumnNumber" : 59,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 750,
      "astHeight" : 23
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8920,
        "startLineNumber" : 2013,
        "startColumnNumber" : 16,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (RPCRequest request : runningRequests) {\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "EnhancedForStatement",
      "astNodeNumber" : 756,
      "astHeight" : 24
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 9275,
        "startLineNumber" : 2010,
        "startColumnNumber" : 31,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 784,
      "astHeight" : 25
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 9294,
        "startLineNumber" : 2010,
        "startColumnNumber" : 12,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!ignoreResult) {\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 787,
      "astHeight" : 26
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 11910,
        "startLineNumber" : 1958,
        "startColumnNumber" : 59,
        "endLineNumber" : 2169,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1050,
      "astHeight" : 27
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 47,
        "startLineNumber" : 2136,
        "startColumnNumber" : 36,
        "endLineNumber" : 2136,
        "endColumnNumber" : 83
      },
      "nodeContext" : "datacenter.lastInitVersion != currentAppVersion",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 5,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2137,
      "startColumnNumber" : 36,
      "endLineNumber" : 2137,
      "endColumnNumber" : 46
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.Assignment,leftHandSide]",
      "nodePosition" : {
        "charLength" : 26,
        "startLineNumber" : 2137,
        "startColumnNumber" : 36,
        "endLineNumber" : 2137,
        "endColumnNumber" : 62
      },
      "nodeContext" : "datacenter.lastInitVersion",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 46,
        "startLineNumber" : 2137,
        "startColumnNumber" : 36,
        "endLineNumber" : 2137,
        "endColumnNumber" : 82
      },
      "nodeContext" : "datacenter.lastInitVersion=currentAppVersion",
      "nodeType" : "Assignment",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 47,
        "startLineNumber" : 2137,
        "startColumnNumber" : 36,
        "endLineNumber" : 2137,
        "endColumnNumber" : 83
      },
      "nodeContext" : "datacenter.lastInitVersion=currentAppVersion;\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 259,
        "startLineNumber" : 2136,
        "startColumnNumber" : 85,
        "endLineNumber" : 2140,
        "endColumnNumber" : 33
      },
      "nodeContext" : "{\n  datacenter.lastInitVersion=currentAppVersion;\n  saveSession();\n  FileLog.e(\"tmessages\",\"init connection completed\");\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 16,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 467,
        "startLineNumber" : 2136,
        "startColumnNumber" : 32,
        "endLineNumber" : 2142,
        "endColumnNumber" : 33
      },
      "nodeContext" : "if (datacenter.lastInitVersion != currentAppVersion) {\n  datacenter.lastInitVersion=currentAppVersion;\n  saveSession();\n  FileLog.e(\"tmessages\",\"init connection completed\");\n}\n else {\n  FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 29,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 531,
        "startLineNumber" : 2135,
        "startColumnNumber" : 65,
        "endLineNumber" : 2143,
        "endColumnNumber" : 29
      },
      "nodeContext" : "{\n  if (datacenter.lastInitVersion != currentAppVersion) {\n    datacenter.lastInitVersion=currentAppVersion;\n    saveSession();\n    FileLog.e(\"tmessages\",\"init connection completed\");\n  }\n else {\n    FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 30,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 568,
        "startLineNumber" : 2135,
        "startColumnNumber" : 28,
        "endLineNumber" : 2143,
        "endColumnNumber" : 29
      },
      "nodeContext" : "if (request.initRequest && !isError) {\n  if (datacenter.lastInitVersion != currentAppVersion) {\n    datacenter.lastInitVersion=currentAppVersion;\n    saveSession();\n    FileLog.e(\"tmessages\",\"init connection completed\");\n  }\n else {\n    FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 37,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 677,
        "startLineNumber" : 2134,
        "startColumnNumber" : 46,
        "endLineNumber" : 2145,
        "endColumnNumber" : 25
      },
      "nodeContext" : "{\n  if (request.initRequest && !isError) {\n    if (datacenter.lastInitVersion != currentAppVersion) {\n      datacenter.lastInitVersion=currentAppVersion;\n      saveSession();\n      FileLog.e(\"tmessages\",\"init connection completed\");\n    }\n else {\n      FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n    }\n  }\n  rpcCompleted(resultMid);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 42,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 914,
        "startLineNumber" : 2134,
        "startColumnNumber" : 24,
        "endLineNumber" : 2149,
        "endColumnNumber" : 25
      },
      "nodeContext" : "if (!discardResponse) {\n  if (request.initRequest && !isError) {\n    if (datacenter.lastInitVersion != currentAppVersion) {\n      datacenter.lastInitVersion=currentAppVersion;\n      saveSession();\n      FileLog.e(\"tmessages\",\"init connection completed\");\n    }\n else {\n      FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n    }\n  }\n  rpcCompleted(resultMid);\n}\n else {\n  request.runningMessageId=0;\n  request.runningMessageSeqNo=0;\n  request.transportChannelToken=0;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 64,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 8793,
        "startLineNumber" : 2014,
        "startColumnNumber" : 64,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "{\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 744,
      "astHeight" : 21
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8837,
        "startLineNumber" : 2014,
        "startColumnNumber" : 20,
        "endLineNumber" : 2151,
        "endColumnNumber" : 21
      },
      "nodeContext" : "if (request.respondsToMessageId(resultMid)) {\n  found=true;\n  boolean discardResponse=false;\n  boolean isError=false;\n  if (request.completionBlock != null) {\n    TLRPC.TL_error implicitError=null;\n    if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n      TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n      TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      if (uncomressed == null) {\n        System.gc();\n        uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n      }\n      if (uncomressed == null) {\n        throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n      }\n      resultContainer.result=uncomressed;\n    }\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n      if (errorCode == 500 || errorCode < 0) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n          if (request.serverFailureCount < 1) {\n            discardResponse=true;\n            request.runningMinStartTime=request.runningStartTime + 1;\n          }\n        }\n else {\n          discardResponse=true;\n          int delay=Math.min(1,request.serverFailureCount * 2);\n          request.runningMinStartTime=request.runningStartTime + delay;\n          request.confirmed=false;\n        }\n        request.serverFailureCount++;\n      }\n else       if (errorCode == 420) {\n        if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n          double waitTime=2.0;\n          if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n            String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              waitTime=val;\n            }\n          }\n          waitTime=Math.min(30,waitTime);\n          discardResponse=true;\n          request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n          request.confirmed=false;\n        }\n      }\n      implicitError=new TLRPC.TL_error();\n      implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n      implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n    }\n else     if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n      if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n        if (request.rawRequest == null) {\n          FileLog.e(\"tmessages\",\"rawRequest is null\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=-1000;\n      }\n    }\n    if (!discardResponse) {\n      if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n        isError=true;\n        request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n      }\n else {\n        request.completionBlock.run(resultContainer.result,null);\n      }\n    }\n    if (implicitError != null && implicitError.code == 401) {\n      isError=true;\n      if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n        if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n          if (UserConfig.clientActivated) {\n            UserConfig.clearConfig();\n            Utilities.RunOnUIThread(new Runnable(){\n              @Override public void run(){\n                NotificationCenter.getInstance().postNotificationName(1234);\n              }\n            }\n);\n          }\n        }\n      }\n else {\n        datacenter.authorized=false;\n        saveSession();\n        discardResponse=true;\n        if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n          retryRequestsFromDatacenter=datacenter.datacenterId;\n          retryRequestsClass=request.flags;\n        }\n      }\n    }\n  }\n  if (!discardResponse) {\n    if (request.initRequest && !isError) {\n      if (datacenter.lastInitVersion != currentAppVersion) {\n        datacenter.lastInitVersion=currentAppVersion;\n        saveSession();\n        FileLog.e(\"tmessages\",\"init connection completed\");\n      }\n else {\n        FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n      }\n    }\n    rpcCompleted(resultMid);\n  }\n else {\n    request.runningMessageId=0;\n    request.runningMessageSeqNo=0;\n    request.transportChannelToken=0;\n  }\n  break;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 749,
      "astHeight" : 22
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.EnhancedForStatement,body]",
      "nodePosition" : {
        "charLength" : 8877,
        "startLineNumber" : 2013,
        "startColumnNumber" : 59,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 750,
      "astHeight" : 23
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 8920,
        "startLineNumber" : 2013,
        "startColumnNumber" : 16,
        "endLineNumber" : 2152,
        "endColumnNumber" : 17
      },
      "nodeContext" : "for (RPCRequest request : runningRequests) {\n  if (request.respondsToMessageId(resultMid)) {\n    found=true;\n    boolean discardResponse=false;\n    boolean isError=false;\n    if (request.completionBlock != null) {\n      TLRPC.TL_error implicitError=null;\n      if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n        TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n        TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        if (uncomressed == null) {\n          System.gc();\n          uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n        }\n        if (uncomressed == null) {\n          throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n        }\n        resultContainer.result=uncomressed;\n      }\n      if (resultContainer.result instanceof TLRPC.RpcError) {\n        String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n        FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n        int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n        if (errorCode == 500 || errorCode < 0) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n            if (request.serverFailureCount < 1) {\n              discardResponse=true;\n              request.runningMinStartTime=request.runningStartTime + 1;\n            }\n          }\n else {\n            discardResponse=true;\n            int delay=Math.min(1,request.serverFailureCount * 2);\n            request.runningMinStartTime=request.runningStartTime + delay;\n            request.confirmed=false;\n          }\n          request.serverFailureCount++;\n        }\n else         if (errorCode == 420) {\n          if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n            double waitTime=2.0;\n            if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n              String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n              Pattern pattern=Pattern.compile(\"[0-9]+\");\n              Matcher matcher=pattern.matcher(errorMsg);\n              if (matcher.find()) {\n                errorMsg=matcher.group(0);\n              }\n              Integer val;\n              try {\n                val=Integer.parseInt(errorMsg);\n              }\n catch (              Exception e) {\n                val=null;\n              }\n              if (val != null) {\n                waitTime=val;\n              }\n            }\n            waitTime=Math.min(30,waitTime);\n            discardResponse=true;\n            request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n            request.confirmed=false;\n          }\n        }\n        implicitError=new TLRPC.TL_error();\n        implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n        implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n      }\n else       if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n        if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n          if (request.rawRequest == null) {\n            FileLog.e(\"tmessages\",\"rawRequest is null\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=-1000;\n        }\n      }\n      if (!discardResponse) {\n        if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n          isError=true;\n          request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n        }\n else {\n          request.completionBlock.run(resultContainer.result,null);\n        }\n      }\n      if (implicitError != null && implicitError.code == 401) {\n        isError=true;\n        if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n          if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n            if (UserConfig.clientActivated) {\n              UserConfig.clearConfig();\n              Utilities.RunOnUIThread(new Runnable(){\n                @Override public void run(){\n                  NotificationCenter.getInstance().postNotificationName(1234);\n                }\n              }\n);\n            }\n          }\n        }\n else {\n          datacenter.authorized=false;\n          saveSession();\n          discardResponse=true;\n          if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n            retryRequestsFromDatacenter=datacenter.datacenterId;\n            retryRequestsClass=request.flags;\n          }\n        }\n      }\n    }\n    if (!discardResponse) {\n      if (request.initRequest && !isError) {\n        if (datacenter.lastInitVersion != currentAppVersion) {\n          datacenter.lastInitVersion=currentAppVersion;\n          saveSession();\n          FileLog.e(\"tmessages\",\"init connection completed\");\n        }\n else {\n          FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n        }\n      }\n      rpcCompleted(resultMid);\n    }\n else {\n      request.runningMessageId=0;\n      request.runningMessageSeqNo=0;\n      request.transportChannelToken=0;\n    }\n    break;\n  }\n}\n",
      "nodeType" : "EnhancedForStatement",
      "astNodeNumber" : 756,
      "astHeight" : 24
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 9275,
        "startLineNumber" : 2010,
        "startColumnNumber" : 31,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 784,
      "astHeight" : 25
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 9294,
        "startLineNumber" : 2010,
        "startColumnNumber" : 12,
        "endLineNumber" : 2162,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (!ignoreResult) {\n  boolean found=false;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(resultMid)) {\n      found=true;\n      boolean discardResponse=false;\n      boolean isError=false;\n      if (request.completionBlock != null) {\n        TLRPC.TL_error implicitError=null;\n        if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n          TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n          TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          if (uncomressed == null) {\n            System.gc();\n            uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n          }\n          if (uncomressed == null) {\n            throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n          }\n          resultContainer.result=uncomressed;\n        }\n        if (resultContainer.result instanceof TLRPC.RpcError) {\n          String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n          FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n          int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n          if (errorCode == 500 || errorCode < 0) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n              if (request.serverFailureCount < 1) {\n                discardResponse=true;\n                request.runningMinStartTime=request.runningStartTime + 1;\n              }\n            }\n else {\n              discardResponse=true;\n              int delay=Math.min(1,request.serverFailureCount * 2);\n              request.runningMinStartTime=request.runningStartTime + delay;\n              request.confirmed=false;\n            }\n            request.serverFailureCount++;\n          }\n else           if (errorCode == 420) {\n            if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n              double waitTime=2.0;\n              if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                Pattern pattern=Pattern.compile(\"[0-9]+\");\n                Matcher matcher=pattern.matcher(errorMsg);\n                if (matcher.find()) {\n                  errorMsg=matcher.group(0);\n                }\n                Integer val;\n                try {\n                  val=Integer.parseInt(errorMsg);\n                }\n catch (                Exception e) {\n                  val=null;\n                }\n                if (val != null) {\n                  waitTime=val;\n                }\n              }\n              waitTime=Math.min(30,waitTime);\n              discardResponse=true;\n              request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n              request.confirmed=false;\n            }\n          }\n          implicitError=new TLRPC.TL_error();\n          implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n          implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n        }\n else         if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n          if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n            if (request.rawRequest == null) {\n              FileLog.e(\"tmessages\",\"rawRequest is null\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=-1000;\n          }\n        }\n        if (!discardResponse) {\n          if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n            isError=true;\n            request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n          }\n else {\n            request.completionBlock.run(resultContainer.result,null);\n          }\n        }\n        if (implicitError != null && implicitError.code == 401) {\n          isError=true;\n          if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n            if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n              if (UserConfig.clientActivated) {\n                UserConfig.clearConfig();\n                Utilities.RunOnUIThread(new Runnable(){\n                  @Override public void run(){\n                    NotificationCenter.getInstance().postNotificationName(1234);\n                  }\n                }\n);\n              }\n            }\n          }\n else {\n            datacenter.authorized=false;\n            saveSession();\n            discardResponse=true;\n            if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n              retryRequestsFromDatacenter=datacenter.datacenterId;\n              retryRequestsClass=request.flags;\n            }\n          }\n        }\n      }\n      if (!discardResponse) {\n        if (request.initRequest && !isError) {\n          if (datacenter.lastInitVersion != currentAppVersion) {\n            datacenter.lastInitVersion=currentAppVersion;\n            saveSession();\n            FileLog.e(\"tmessages\",\"init connection completed\");\n          }\n else {\n            FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n          }\n        }\n        rpcCompleted(resultMid);\n      }\n else {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.transportChannelToken=0;\n      }\n      break;\n    }\n  }\n  resultContainer.freeResources();\n  if (!found) {\n    FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n    rpcCompleted(resultMid);\n  }\n  messagesConfirmed(resultMid);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 787,
      "astHeight" : 26
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 11910,
        "startLineNumber" : 1958,
        "startColumnNumber" : 59,
        "endLineNumber" : 2169,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1050,
      "astHeight" : 27
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 47,
        "startLineNumber" : 2137,
        "startColumnNumber" : 36,
        "endLineNumber" : 2137,
        "endColumnNumber" : 83
      },
      "nodeContext" : "datacenter.lastInitVersion=currentAppVersion;\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2190,
      "startColumnNumber" : 32,
      "endLineNumber" : 2190,
      "endColumnNumber" : 42
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 24,
        "startLineNumber" : 2190,
        "startColumnNumber" : 32,
        "endLineNumber" : 2190,
        "endColumnNumber" : 56
      },
      "nodeContext" : "datacenter.authSessionId",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 53,
        "startLineNumber" : 2190,
        "startColumnNumber" : 16,
        "endLineNumber" : 2190,
        "endColumnNumber" : 69
      },
      "nodeContext" : "recreateSession(datacenter.authSessionId,datacenter)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 54,
        "startLineNumber" : 2190,
        "startColumnNumber" : 16,
        "endLineNumber" : 2190,
        "endColumnNumber" : 70
      },
      "nodeContext" : "recreateSession(datacenter.authSessionId,datacenter);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 706,
        "startLineNumber" : 2178,
        "startColumnNumber" : 248,
        "endLineNumber" : 2195,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  long realId=messageId != 0 ? messageId : containerMessageId;\n  if (realId == 0) {\n    realId=innerMsgId;\n  }\n  if (realId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n  }\n  recreateSession(datacenter.authSessionId,datacenter);\n  saveSession();\n  lastOutgoingMessageId=0;\n  clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 76,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 942,
        "startLineNumber" : 2178,
        "startColumnNumber" : 12,
        "endLineNumber" : 2195,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n  long realId=messageId != 0 ? messageId : containerMessageId;\n  if (realId == 0) {\n    realId=innerMsgId;\n  }\n  if (realId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n  }\n  recreateSession(datacenter.authSessionId,datacenter);\n  saveSession();\n  lastOutgoingMessageId=0;\n  clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 112,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1178,
        "startLineNumber" : 2173,
        "startColumnNumber" : 69,
        "endLineNumber" : 2196,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 138,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 54,
        "startLineNumber" : 2190,
        "startColumnNumber" : 16,
        "endLineNumber" : 2190,
        "endColumnNumber" : 70
      },
      "nodeContext" : "recreateSession(datacenter.authSessionId,datacenter);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2190,
      "startColumnNumber" : 58,
      "endLineNumber" : 2190,
      "endColumnNumber" : 68
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 53,
        "startLineNumber" : 2190,
        "startColumnNumber" : 16,
        "endLineNumber" : 2190,
        "endColumnNumber" : 69
      },
      "nodeContext" : "recreateSession(datacenter.authSessionId,datacenter)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 54,
        "startLineNumber" : 2190,
        "startColumnNumber" : 16,
        "endLineNumber" : 2190,
        "endColumnNumber" : 70
      },
      "nodeContext" : "recreateSession(datacenter.authSessionId,datacenter);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 706,
        "startLineNumber" : 2178,
        "startColumnNumber" : 248,
        "endLineNumber" : 2195,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  long realId=messageId != 0 ? messageId : containerMessageId;\n  if (realId == 0) {\n    realId=innerMsgId;\n  }\n  if (realId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n  }\n  recreateSession(datacenter.authSessionId,datacenter);\n  saveSession();\n  lastOutgoingMessageId=0;\n  clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 76,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 942,
        "startLineNumber" : 2178,
        "startColumnNumber" : 12,
        "endLineNumber" : 2195,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n  long realId=messageId != 0 ? messageId : containerMessageId;\n  if (realId == 0) {\n    realId=innerMsgId;\n  }\n  if (realId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n  }\n  recreateSession(datacenter.authSessionId,datacenter);\n  saveSession();\n  lastOutgoingMessageId=0;\n  clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 112,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1178,
        "startLineNumber" : 2173,
        "startColumnNumber" : 69,
        "endLineNumber" : 2196,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 138,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 54,
        "startLineNumber" : 2190,
        "startColumnNumber" : 16,
        "endLineNumber" : 2190,
        "endColumnNumber" : 70
      },
      "nodeContext" : "recreateSession(datacenter.authSessionId,datacenter);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2194,
      "startColumnNumber" : 79,
      "endLineNumber" : 2194,
      "endColumnNumber" : 89
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 74,
        "startLineNumber" : 2194,
        "startColumnNumber" : 16,
        "endLineNumber" : 2194,
        "endColumnNumber" : 90
      },
      "nodeContext" : "clearRequestsForRequestClass(connection.transportRequestClass,datacenter)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 75,
        "startLineNumber" : 2194,
        "startColumnNumber" : 16,
        "endLineNumber" : 2194,
        "endColumnNumber" : 91
      },
      "nodeContext" : "clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 706,
        "startLineNumber" : 2178,
        "startColumnNumber" : 248,
        "endLineNumber" : 2195,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  long realId=messageId != 0 ? messageId : containerMessageId;\n  if (realId == 0) {\n    realId=innerMsgId;\n  }\n  if (realId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n  }\n  recreateSession(datacenter.authSessionId,datacenter);\n  saveSession();\n  lastOutgoingMessageId=0;\n  clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 76,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 942,
        "startLineNumber" : 2178,
        "startColumnNumber" : 12,
        "endLineNumber" : 2195,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n  long realId=messageId != 0 ? messageId : containerMessageId;\n  if (realId == 0) {\n    realId=innerMsgId;\n  }\n  if (realId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n  }\n  recreateSession(datacenter.authSessionId,datacenter);\n  saveSession();\n  lastOutgoingMessageId=0;\n  clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 112,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1178,
        "startLineNumber" : 2173,
        "startColumnNumber" : 69,
        "endLineNumber" : 2196,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 138,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 75,
        "startLineNumber" : 2194,
        "startColumnNumber" : 16,
        "endLineNumber" : 2194,
        "endColumnNumber" : 91
      },
      "nodeContext" : "clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 7,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2205,
      "startColumnNumber" : 12,
      "endLineNumber" : 2205,
      "endColumnNumber" : 22
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 29,
        "startLineNumber" : 2205,
        "startColumnNumber" : 12,
        "endLineNumber" : 2205,
        "endColumnNumber" : 41
      },
      "nodeContext" : "datacenter.clearServerSalts()",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 30,
        "startLineNumber" : 2205,
        "startColumnNumber" : 12,
        "endLineNumber" : 2205,
        "endColumnNumber" : 42
      },
      "nodeContext" : "datacenter.clearServerSalts();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 919,
        "startLineNumber" : 2196,
        "startColumnNumber" : 64,
        "endLineNumber" : 2219,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 108,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 30,
        "startLineNumber" : 2205,
        "startColumnNumber" : 12,
        "endLineNumber" : 2205,
        "endColumnNumber" : 42
      },
      "nodeContext" : "datacenter.clearServerSalts();\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2212,
      "startColumnNumber" : 12,
      "endLineNumber" : 2212,
      "endColumnNumber" : 22
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 40,
        "startLineNumber" : 2212,
        "startColumnNumber" : 12,
        "endLineNumber" : 2212,
        "endColumnNumber" : 52
      },
      "nodeContext" : "datacenter.addServerSalt(serverSaltDesc)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 41,
        "startLineNumber" : 2212,
        "startColumnNumber" : 12,
        "endLineNumber" : 2212,
        "endColumnNumber" : 53
      },
      "nodeContext" : "datacenter.addServerSalt(serverSaltDesc);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 919,
        "startLineNumber" : 2196,
        "startColumnNumber" : 64,
        "endLineNumber" : 2219,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 108,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 41,
        "startLineNumber" : 2212,
        "startColumnNumber" : 12,
        "endLineNumber" : 2212,
        "endColumnNumber" : 53
      },
      "nodeContext" : "datacenter.addServerSalt(serverSaltDesc);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 5,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2215,
      "startColumnNumber" : 26,
      "endLineNumber" : 2215,
      "endColumnNumber" : 36
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 25,
        "startLineNumber" : 2215,
        "startColumnNumber" : 12,
        "endLineNumber" : 2215,
        "endColumnNumber" : 37
      },
      "nodeContext" : "refillSaltSet(datacenter)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 26,
        "startLineNumber" : 2215,
        "startColumnNumber" : 12,
        "endLineNumber" : 2215,
        "endColumnNumber" : 38
      },
      "nodeContext" : "refillSaltSet(datacenter);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 919,
        "startLineNumber" : 2196,
        "startColumnNumber" : 64,
        "endLineNumber" : 2219,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 108,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 26,
        "startLineNumber" : 2215,
        "startColumnNumber" : 12,
        "endLineNumber" : 2215,
        "endColumnNumber" : 38
      },
      "nodeContext" : "refillSaltSet(datacenter);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 4,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2216,
      "startColumnNumber" : 16,
      "endLineNumber" : 2216,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.InfixExpression,leftOperand]",
      "nodePosition" : {
        "charLength" : 18,
        "startLineNumber" : 2216,
        "startColumnNumber" : 16,
        "endLineNumber" : 2216,
        "endColumnNumber" : 34
      },
      "nodeContext" : "datacenter.authKey",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 26,
        "startLineNumber" : 2216,
        "startColumnNumber" : 16,
        "endLineNumber" : 2216,
        "endColumnNumber" : 42
      },
      "nodeContext" : "datacenter.authKey != null",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 5,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 150,
        "startLineNumber" : 2216,
        "startColumnNumber" : 12,
        "endLineNumber" : 2218,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (datacenter.authKey != null) {\n  processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 16,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 919,
        "startLineNumber" : 2196,
        "startColumnNumber" : 64,
        "endLineNumber" : 2219,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 108,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 26,
        "startLineNumber" : 2216,
        "startColumnNumber" : 16,
        "endLineNumber" : 2216,
        "endColumnNumber" : 42
      },
      "nodeContext" : "datacenter.authKey != null",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 5,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  }, {
    "nodeContext" : "datacenter",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 10,
      "startLineNumber" : 2217,
      "startColumnNumber" : 77,
      "endLineNumber" : 2217,
      "endColumnNumber" : 87
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 23,
        "startLineNumber" : 2217,
        "startColumnNumber" : 77,
        "endLineNumber" : 2217,
        "endColumnNumber" : 100
      },
      "nodeContext" : "datacenter.datacenterId",
      "nodeType" : "QualifiedName",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 85,
        "startLineNumber" : 2217,
        "startColumnNumber" : 16,
        "endLineNumber" : 2217,
        "endColumnNumber" : 101
      },
      "nodeContext" : "processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 8,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 86,
        "startLineNumber" : 2217,
        "startColumnNumber" : 16,
        "endLineNumber" : 2217,
        "endColumnNumber" : 102
      },
      "nodeContext" : "processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 9,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 118,
        "startLineNumber" : 2216,
        "startColumnNumber" : 44,
        "endLineNumber" : 2218,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 10,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 150,
        "startLineNumber" : 2216,
        "startColumnNumber" : 12,
        "endLineNumber" : 2218,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (datacenter.authKey != null) {\n  processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 16,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 919,
        "startLineNumber" : 2196,
        "startColumnNumber" : 64,
        "endLineNumber" : 2219,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 108,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 86,
        "startLineNumber" : 2217,
        "startColumnNumber" : 16,
        "endLineNumber" : 2217,
        "endColumnNumber" : 102
      },
      "nodeContext" : "processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 9,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.Datacenter"
  } ],
  "positionList" : [ {
    "charLength" : 10,
    "startLineNumber" : 1858,
    "startColumnNumber" : 16,
    "endLineNumber" : 1858,
    "endColumnNumber" : 26
  }, {
    "charLength" : 10,
    "startLineNumber" : 1862,
    "startColumnNumber" : 180,
    "endLineNumber" : 1862,
    "endColumnNumber" : 190
  }, {
    "charLength" : 10,
    "startLineNumber" : 1873,
    "startColumnNumber" : 33,
    "endLineNumber" : 1873,
    "endColumnNumber" : 43
  }, {
    "charLength" : 10,
    "startLineNumber" : 1873,
    "startColumnNumber" : 61,
    "endLineNumber" : 1873,
    "endColumnNumber" : 71
  }, {
    "charLength" : 10,
    "startLineNumber" : 2110,
    "startColumnNumber" : 36,
    "endLineNumber" : 2110,
    "endColumnNumber" : 46
  }, {
    "charLength" : 10,
    "startLineNumber" : 2110,
    "startColumnNumber" : 86,
    "endLineNumber" : 2110,
    "endColumnNumber" : 96
  }, {
    "charLength" : 10,
    "startLineNumber" : 2123,
    "startColumnNumber" : 36,
    "endLineNumber" : 2123,
    "endColumnNumber" : 46
  }, {
    "charLength" : 10,
    "startLineNumber" : 2127,
    "startColumnNumber" : 70,
    "endLineNumber" : 2127,
    "endColumnNumber" : 80
  }, {
    "charLength" : 10,
    "startLineNumber" : 2136,
    "startColumnNumber" : 36,
    "endLineNumber" : 2136,
    "endColumnNumber" : 46
  }, {
    "charLength" : 10,
    "startLineNumber" : 2137,
    "startColumnNumber" : 36,
    "endLineNumber" : 2137,
    "endColumnNumber" : 46
  }, {
    "charLength" : 10,
    "startLineNumber" : 2190,
    "startColumnNumber" : 32,
    "endLineNumber" : 2190,
    "endColumnNumber" : 42
  }, {
    "charLength" : 10,
    "startLineNumber" : 2190,
    "startColumnNumber" : 58,
    "endLineNumber" : 2190,
    "endColumnNumber" : 68
  }, {
    "charLength" : 10,
    "startLineNumber" : 2194,
    "startColumnNumber" : 79,
    "endLineNumber" : 2194,
    "endColumnNumber" : 89
  }, {
    "charLength" : 10,
    "startLineNumber" : 2205,
    "startColumnNumber" : 12,
    "endLineNumber" : 2205,
    "endColumnNumber" : 22
  }, {
    "charLength" : 10,
    "startLineNumber" : 2212,
    "startColumnNumber" : 12,
    "endLineNumber" : 2212,
    "endColumnNumber" : 22
  }, {
    "charLength" : 10,
    "startLineNumber" : 2215,
    "startColumnNumber" : 26,
    "endLineNumber" : 2215,
    "endColumnNumber" : 36
  }, {
    "charLength" : 10,
    "startLineNumber" : 2216,
    "startColumnNumber" : 16,
    "endLineNumber" : 2216,
    "endColumnNumber" : 26
  }, {
    "charLength" : 10,
    "startLineNumber" : 2217,
    "startColumnNumber" : 77,
    "endLineNumber" : 2217,
    "endColumnNumber" : 87
  } ],
  "layoutRelationDataList" : [ {
    "firstKey" : 0,
    "secondKey" : 1,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 2,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 3,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 7,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 9,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 10,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 11,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 12,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 13,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 14,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 15,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 16,
    "layout" : 5
  }, {
    "firstKey" : 0,
    "secondKey" : 17,
    "layout" : 5
  }, {
    "firstKey" : 1,
    "secondKey" : 0,
    "layout" : 6
  }, {
    "firstKey" : 1,
    "secondKey" : 2,
    "layout" : 6
  }, {
    "firstKey" : 1,
    "secondKey" : 3,
    "layout" : 6
  }, {
    "firstKey" : 1,
    "secondKey" : 4,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 5,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 6,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 7,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 8,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 9,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 10,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 11,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 12,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 13,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 14,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 15,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 16,
    "layout" : 9
  }, {
    "firstKey" : 1,
    "secondKey" : 17,
    "layout" : 9
  }, {
    "firstKey" : 2,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 2,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 2,
    "secondKey" : 3,
    "layout" : 2
  }, {
    "firstKey" : 2,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 5,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 6,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 7,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 8,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 10,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 11,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 12,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 13,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 14,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 15,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 16,
    "layout" : 8
  }, {
    "firstKey" : 2,
    "secondKey" : 17,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 3,
    "secondKey" : 2,
    "layout" : 2
  }, {
    "firstKey" : 3,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 5,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 6,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 7,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 8,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 10,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 11,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 12,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 13,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 14,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 15,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 16,
    "layout" : 8
  }, {
    "firstKey" : 3,
    "secondKey" : 17,
    "layout" : 8
  }, {
    "firstKey" : 4,
    "secondKey" : 0,
    "layout" : 20
  }, {
    "firstKey" : 4,
    "secondKey" : 1,
    "layout" : 20
  }, {
    "firstKey" : 4,
    "secondKey" : 2,
    "layout" : 20
  }, {
    "firstKey" : 4,
    "secondKey" : 3,
    "layout" : 20
  }, {
    "firstKey" : 4,
    "secondKey" : 5,
    "layout" : 2
  }, {
    "firstKey" : 4,
    "secondKey" : 6,
    "layout" : 3
  }, {
    "firstKey" : 4,
    "secondKey" : 7,
    "layout" : 3
  }, {
    "firstKey" : 4,
    "secondKey" : 8,
    "layout" : 8
  }, {
    "firstKey" : 4,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 4,
    "secondKey" : 10,
    "layout" : 15
  }, {
    "firstKey" : 4,
    "secondKey" : 11,
    "layout" : 15
  }, {
    "firstKey" : 4,
    "secondKey" : 12,
    "layout" : 15
  }, {
    "firstKey" : 4,
    "secondKey" : 13,
    "layout" : 15
  }, {
    "firstKey" : 4,
    "secondKey" : 14,
    "layout" : 15
  }, {
    "firstKey" : 4,
    "secondKey" : 15,
    "layout" : 15
  }, {
    "firstKey" : 4,
    "secondKey" : 16,
    "layout" : 15
  }, {
    "firstKey" : 4,
    "secondKey" : 17,
    "layout" : 15
  }, {
    "firstKey" : 5,
    "secondKey" : 0,
    "layout" : 20
  }, {
    "firstKey" : 5,
    "secondKey" : 1,
    "layout" : 20
  }, {
    "firstKey" : 5,
    "secondKey" : 2,
    "layout" : 20
  }, {
    "firstKey" : 5,
    "secondKey" : 3,
    "layout" : 20
  }, {
    "firstKey" : 5,
    "secondKey" : 4,
    "layout" : 2
  }, {
    "firstKey" : 5,
    "secondKey" : 6,
    "layout" : 3
  }, {
    "firstKey" : 5,
    "secondKey" : 7,
    "layout" : 3
  }, {
    "firstKey" : 5,
    "secondKey" : 8,
    "layout" : 8
  }, {
    "firstKey" : 5,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 5,
    "secondKey" : 10,
    "layout" : 15
  }, {
    "firstKey" : 5,
    "secondKey" : 11,
    "layout" : 15
  }, {
    "firstKey" : 5,
    "secondKey" : 12,
    "layout" : 15
  }, {
    "firstKey" : 5,
    "secondKey" : 13,
    "layout" : 15
  }, {
    "firstKey" : 5,
    "secondKey" : 14,
    "layout" : 15
  }, {
    "firstKey" : 5,
    "secondKey" : 15,
    "layout" : 15
  }, {
    "firstKey" : 5,
    "secondKey" : 16,
    "layout" : 15
  }, {
    "firstKey" : 5,
    "secondKey" : 17,
    "layout" : 15
  }, {
    "firstKey" : 6,
    "secondKey" : 0,
    "layout" : 21
  }, {
    "firstKey" : 6,
    "secondKey" : 1,
    "layout" : 21
  }, {
    "firstKey" : 6,
    "secondKey" : 2,
    "layout" : 21
  }, {
    "firstKey" : 6,
    "secondKey" : 3,
    "layout" : 21
  }, {
    "firstKey" : 6,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 7,
    "layout" : 3
  }, {
    "firstKey" : 6,
    "secondKey" : 8,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 9,
    "layout" : 9
  }, {
    "firstKey" : 6,
    "secondKey" : 10,
    "layout" : 16
  }, {
    "firstKey" : 6,
    "secondKey" : 11,
    "layout" : 16
  }, {
    "firstKey" : 6,
    "secondKey" : 12,
    "layout" : 16
  }, {
    "firstKey" : 6,
    "secondKey" : 13,
    "layout" : 16
  }, {
    "firstKey" : 6,
    "secondKey" : 14,
    "layout" : 16
  }, {
    "firstKey" : 6,
    "secondKey" : 15,
    "layout" : 16
  }, {
    "firstKey" : 6,
    "secondKey" : 16,
    "layout" : 16
  }, {
    "firstKey" : 6,
    "secondKey" : 17,
    "layout" : 16
  }, {
    "firstKey" : 7,
    "secondKey" : 0,
    "layout" : 23
  }, {
    "firstKey" : 7,
    "secondKey" : 1,
    "layout" : 23
  }, {
    "firstKey" : 7,
    "secondKey" : 2,
    "layout" : 23
  }, {
    "firstKey" : 7,
    "secondKey" : 3,
    "layout" : 23
  }, {
    "firstKey" : 7,
    "secondKey" : 4,
    "layout" : 6
  }, {
    "firstKey" : 7,
    "secondKey" : 5,
    "layout" : 6
  }, {
    "firstKey" : 7,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 7,
    "secondKey" : 8,
    "layout" : 11
  }, {
    "firstKey" : 7,
    "secondKey" : 9,
    "layout" : 11
  }, {
    "firstKey" : 7,
    "secondKey" : 10,
    "layout" : 18
  }, {
    "firstKey" : 7,
    "secondKey" : 11,
    "layout" : 18
  }, {
    "firstKey" : 7,
    "secondKey" : 12,
    "layout" : 18
  }, {
    "firstKey" : 7,
    "secondKey" : 13,
    "layout" : 18
  }, {
    "firstKey" : 7,
    "secondKey" : 14,
    "layout" : 18
  }, {
    "firstKey" : 7,
    "secondKey" : 15,
    "layout" : 18
  }, {
    "firstKey" : 7,
    "secondKey" : 16,
    "layout" : 18
  }, {
    "firstKey" : 7,
    "secondKey" : 17,
    "layout" : 18
  }, {
    "firstKey" : 8,
    "secondKey" : 0,
    "layout" : 19
  }, {
    "firstKey" : 8,
    "secondKey" : 1,
    "layout" : 19
  }, {
    "firstKey" : 8,
    "secondKey" : 2,
    "layout" : 19
  }, {
    "firstKey" : 8,
    "secondKey" : 3,
    "layout" : 19
  }, {
    "firstKey" : 8,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 9,
    "layout" : 2
  }, {
    "firstKey" : 8,
    "secondKey" : 10,
    "layout" : 14
  }, {
    "firstKey" : 8,
    "secondKey" : 11,
    "layout" : 14
  }, {
    "firstKey" : 8,
    "secondKey" : 12,
    "layout" : 14
  }, {
    "firstKey" : 8,
    "secondKey" : 13,
    "layout" : 14
  }, {
    "firstKey" : 8,
    "secondKey" : 14,
    "layout" : 14
  }, {
    "firstKey" : 8,
    "secondKey" : 15,
    "layout" : 14
  }, {
    "firstKey" : 8,
    "secondKey" : 16,
    "layout" : 14
  }, {
    "firstKey" : 8,
    "secondKey" : 17,
    "layout" : 14
  }, {
    "firstKey" : 9,
    "secondKey" : 0,
    "layout" : 21
  }, {
    "firstKey" : 9,
    "secondKey" : 1,
    "layout" : 21
  }, {
    "firstKey" : 9,
    "secondKey" : 2,
    "layout" : 21
  }, {
    "firstKey" : 9,
    "secondKey" : 3,
    "layout" : 21
  }, {
    "firstKey" : 9,
    "secondKey" : 4,
    "layout" : 9
  }, {
    "firstKey" : 9,
    "secondKey" : 5,
    "layout" : 9
  }, {
    "firstKey" : 9,
    "secondKey" : 6,
    "layout" : 9
  }, {
    "firstKey" : 9,
    "secondKey" : 7,
    "layout" : 9
  }, {
    "firstKey" : 9,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 9,
    "secondKey" : 10,
    "layout" : 16
  }, {
    "firstKey" : 9,
    "secondKey" : 11,
    "layout" : 16
  }, {
    "firstKey" : 9,
    "secondKey" : 12,
    "layout" : 16
  }, {
    "firstKey" : 9,
    "secondKey" : 13,
    "layout" : 16
  }, {
    "firstKey" : 9,
    "secondKey" : 14,
    "layout" : 16
  }, {
    "firstKey" : 9,
    "secondKey" : 15,
    "layout" : 16
  }, {
    "firstKey" : 9,
    "secondKey" : 16,
    "layout" : 16
  }, {
    "firstKey" : 9,
    "secondKey" : 17,
    "layout" : 16
  }, {
    "firstKey" : 10,
    "secondKey" : 0,
    "layout" : 14
  }, {
    "firstKey" : 10,
    "secondKey" : 1,
    "layout" : 14
  }, {
    "firstKey" : 10,
    "secondKey" : 2,
    "layout" : 14
  }, {
    "firstKey" : 10,
    "secondKey" : 3,
    "layout" : 14
  }, {
    "firstKey" : 10,
    "secondKey" : 4,
    "layout" : 9
  }, {
    "firstKey" : 10,
    "secondKey" : 5,
    "layout" : 9
  }, {
    "firstKey" : 10,
    "secondKey" : 6,
    "layout" : 9
  }, {
    "firstKey" : 10,
    "secondKey" : 7,
    "layout" : 9
  }, {
    "firstKey" : 10,
    "secondKey" : 8,
    "layout" : 9
  }, {
    "firstKey" : 10,
    "secondKey" : 9,
    "layout" : 9
  }, {
    "firstKey" : 10,
    "secondKey" : 11,
    "layout" : 1
  }, {
    "firstKey" : 10,
    "secondKey" : 12,
    "layout" : 3
  }, {
    "firstKey" : 10,
    "secondKey" : 13,
    "layout" : 6
  }, {
    "firstKey" : 10,
    "secondKey" : 14,
    "layout" : 6
  }, {
    "firstKey" : 10,
    "secondKey" : 15,
    "layout" : 6
  }, {
    "firstKey" : 10,
    "secondKey" : 16,
    "layout" : 6
  }, {
    "firstKey" : 10,
    "secondKey" : 17,
    "layout" : 6
  }, {
    "firstKey" : 11,
    "secondKey" : 0,
    "layout" : 13
  }, {
    "firstKey" : 11,
    "secondKey" : 1,
    "layout" : 13
  }, {
    "firstKey" : 11,
    "secondKey" : 2,
    "layout" : 13
  }, {
    "firstKey" : 11,
    "secondKey" : 3,
    "layout" : 13
  }, {
    "firstKey" : 11,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 11,
    "secondKey" : 5,
    "layout" : 8
  }, {
    "firstKey" : 11,
    "secondKey" : 6,
    "layout" : 8
  }, {
    "firstKey" : 11,
    "secondKey" : 7,
    "layout" : 8
  }, {
    "firstKey" : 11,
    "secondKey" : 8,
    "layout" : 8
  }, {
    "firstKey" : 11,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 11,
    "secondKey" : 10,
    "layout" : 0
  }, {
    "firstKey" : 11,
    "secondKey" : 12,
    "layout" : 2
  }, {
    "firstKey" : 11,
    "secondKey" : 13,
    "layout" : 5
  }, {
    "firstKey" : 11,
    "secondKey" : 14,
    "layout" : 5
  }, {
    "firstKey" : 11,
    "secondKey" : 15,
    "layout" : 5
  }, {
    "firstKey" : 11,
    "secondKey" : 16,
    "layout" : 5
  }, {
    "firstKey" : 11,
    "secondKey" : 17,
    "layout" : 5
  }, {
    "firstKey" : 12,
    "secondKey" : 0,
    "layout" : 13
  }, {
    "firstKey" : 12,
    "secondKey" : 1,
    "layout" : 13
  }, {
    "firstKey" : 12,
    "secondKey" : 2,
    "layout" : 13
  }, {
    "firstKey" : 12,
    "secondKey" : 3,
    "layout" : 13
  }, {
    "firstKey" : 12,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 5,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 6,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 7,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 8,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 10,
    "layout" : 2
  }, {
    "firstKey" : 12,
    "secondKey" : 11,
    "layout" : 2
  }, {
    "firstKey" : 12,
    "secondKey" : 13,
    "layout" : 5
  }, {
    "firstKey" : 12,
    "secondKey" : 14,
    "layout" : 5
  }, {
    "firstKey" : 12,
    "secondKey" : 15,
    "layout" : 5
  }, {
    "firstKey" : 12,
    "secondKey" : 16,
    "layout" : 5
  }, {
    "firstKey" : 12,
    "secondKey" : 17,
    "layout" : 5
  }, {
    "firstKey" : 13,
    "secondKey" : 0,
    "layout" : 12
  }, {
    "firstKey" : 13,
    "secondKey" : 1,
    "layout" : 12
  }, {
    "firstKey" : 13,
    "secondKey" : 2,
    "layout" : 12
  }, {
    "firstKey" : 13,
    "secondKey" : 3,
    "layout" : 12
  }, {
    "firstKey" : 13,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 13,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 13,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 13,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 13,
    "secondKey" : 8,
    "layout" : 7
  }, {
    "firstKey" : 13,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 13,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 14,
    "layout" : 2
  }, {
    "firstKey" : 13,
    "secondKey" : 15,
    "layout" : 2
  }, {
    "firstKey" : 13,
    "secondKey" : 16,
    "layout" : 2
  }, {
    "firstKey" : 13,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 14,
    "secondKey" : 0,
    "layout" : 12
  }, {
    "firstKey" : 14,
    "secondKey" : 1,
    "layout" : 12
  }, {
    "firstKey" : 14,
    "secondKey" : 2,
    "layout" : 12
  }, {
    "firstKey" : 14,
    "secondKey" : 3,
    "layout" : 12
  }, {
    "firstKey" : 14,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 14,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 14,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 14,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 14,
    "secondKey" : 8,
    "layout" : 7
  }, {
    "firstKey" : 14,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 14,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 13,
    "layout" : 2
  }, {
    "firstKey" : 14,
    "secondKey" : 15,
    "layout" : 2
  }, {
    "firstKey" : 14,
    "secondKey" : 16,
    "layout" : 2
  }, {
    "firstKey" : 14,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 15,
    "secondKey" : 0,
    "layout" : 12
  }, {
    "firstKey" : 15,
    "secondKey" : 1,
    "layout" : 12
  }, {
    "firstKey" : 15,
    "secondKey" : 2,
    "layout" : 12
  }, {
    "firstKey" : 15,
    "secondKey" : 3,
    "layout" : 12
  }, {
    "firstKey" : 15,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 8,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 15,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 15,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 15,
    "secondKey" : 13,
    "layout" : 2
  }, {
    "firstKey" : 15,
    "secondKey" : 14,
    "layout" : 2
  }, {
    "firstKey" : 15,
    "secondKey" : 16,
    "layout" : 2
  }, {
    "firstKey" : 15,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 16,
    "secondKey" : 0,
    "layout" : 13
  }, {
    "firstKey" : 16,
    "secondKey" : 1,
    "layout" : 13
  }, {
    "firstKey" : 16,
    "secondKey" : 2,
    "layout" : 13
  }, {
    "firstKey" : 16,
    "secondKey" : 3,
    "layout" : 13
  }, {
    "firstKey" : 16,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 16,
    "secondKey" : 5,
    "layout" : 8
  }, {
    "firstKey" : 16,
    "secondKey" : 6,
    "layout" : 8
  }, {
    "firstKey" : 16,
    "secondKey" : 7,
    "layout" : 8
  }, {
    "firstKey" : 16,
    "secondKey" : 8,
    "layout" : 8
  }, {
    "firstKey" : 16,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 16,
    "secondKey" : 10,
    "layout" : 5
  }, {
    "firstKey" : 16,
    "secondKey" : 11,
    "layout" : 5
  }, {
    "firstKey" : 16,
    "secondKey" : 12,
    "layout" : 5
  }, {
    "firstKey" : 16,
    "secondKey" : 13,
    "layout" : 3
  }, {
    "firstKey" : 16,
    "secondKey" : 14,
    "layout" : 3
  }, {
    "firstKey" : 16,
    "secondKey" : 15,
    "layout" : 3
  }, {
    "firstKey" : 16,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 17,
    "secondKey" : 0,
    "layout" : 15
  }, {
    "firstKey" : 17,
    "secondKey" : 1,
    "layout" : 15
  }, {
    "firstKey" : 17,
    "secondKey" : 2,
    "layout" : 15
  }, {
    "firstKey" : 17,
    "secondKey" : 3,
    "layout" : 15
  }, {
    "firstKey" : 17,
    "secondKey" : 4,
    "layout" : 10
  }, {
    "firstKey" : 17,
    "secondKey" : 5,
    "layout" : 10
  }, {
    "firstKey" : 17,
    "secondKey" : 6,
    "layout" : 10
  }, {
    "firstKey" : 17,
    "secondKey" : 7,
    "layout" : 10
  }, {
    "firstKey" : 17,
    "secondKey" : 8,
    "layout" : 10
  }, {
    "firstKey" : 17,
    "secondKey" : 9,
    "layout" : 10
  }, {
    "firstKey" : 17,
    "secondKey" : 10,
    "layout" : 7
  }, {
    "firstKey" : 17,
    "secondKey" : 11,
    "layout" : 7
  }, {
    "firstKey" : 17,
    "secondKey" : 12,
    "layout" : 7
  }, {
    "firstKey" : 17,
    "secondKey" : 13,
    "layout" : 5
  }, {
    "firstKey" : 17,
    "secondKey" : 14,
    "layout" : 5
  }, {
    "firstKey" : 17,
    "secondKey" : 15,
    "layout" : 5
  }, {
    "firstKey" : 17,
    "secondKey" : 16,
    "layout" : 4
  } ]
}