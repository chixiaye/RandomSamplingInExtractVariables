{
  "id" : 224,
  "expression" : "message",
  "projectName" : "DrKLO@Telegram",
  "commitID" : "51aa4141a41a811e87b829f587753f0b20158a9b",
  "filePath" : "TMessagesProj/src/main/java/org/telegram/messenger/ConnectionsManager.java",
  "occurrences" : 25,
  "isArithmeticExpression" : 0,
  "isGetTypeMethod" : 0,
  "expressionList" : [ {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1833,
      "startColumnNumber" : 12,
      "endLineNumber" : 1833,
      "endColumnNumber" : 19
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 15,
        "startLineNumber" : 1833,
        "startColumnNumber" : 12,
        "endLineNumber" : 1833,
        "endColumnNumber" : 27
      },
      "nodeContext" : "message == null",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 107,
        "startLineNumber" : 1833,
        "startColumnNumber" : 8,
        "endLineNumber" : 1836,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message == null) {\n  FileLog.e(\"tmessages\",\"message is null\");\n  return;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 12,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 15,
        "startLineNumber" : 1833,
        "startColumnNumber" : 12,
        "endLineNumber" : 1833,
        "endColumnNumber" : 27
      },
      "nodeContext" : "message == null",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 3,
      "astHeight" : 2
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1839,
      "startColumnNumber" : 12,
      "endLineNumber" : 1839,
      "endColumnNumber" : 19
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 47,
        "startLineNumber" : 1839,
        "startColumnNumber" : 12,
        "endLineNumber" : 1839,
        "endColumnNumber" : 59
      },
      "nodeContext" : "message instanceof TLRPC.TL_new_session_created",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 47,
        "startLineNumber" : 1839,
        "startColumnNumber" : 12,
        "endLineNumber" : 1839,
        "endColumnNumber" : 59
      },
      "nodeContext" : "message instanceof TLRPC.TL_new_session_created",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1840,
      "startColumnNumber" : 84,
      "endLineNumber" : 1840,
      "endColumnNumber" : 91
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 37,
        "startLineNumber" : 1840,
        "startColumnNumber" : 54,
        "endLineNumber" : 1840,
        "endColumnNumber" : 91
      },
      "nodeContext" : "(TLRPC.TL_new_session_created)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 50,
        "startLineNumber" : 1840,
        "startColumnNumber" : 41,
        "endLineNumber" : 1840,
        "endColumnNumber" : 91
      },
      "nodeContext" : "newSession=(TLRPC.TL_new_session_created)message",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 80,
        "startLineNumber" : 1840,
        "startColumnNumber" : 12,
        "endLineNumber" : 1840,
        "endColumnNumber" : 92
      },
      "nodeContext" : "TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 2114,
        "startLineNumber" : 1839,
        "startColumnNumber" : 61,
        "endLineNumber" : 1878,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 253,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 80,
        "startLineNumber" : 1840,
        "startColumnNumber" : 12,
        "endLineNumber" : 1840,
        "endColumnNumber" : 92
      },
      "nodeContext" : "TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1878,
      "startColumnNumber" : 19,
      "endLineNumber" : 1878,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 41,
        "startLineNumber" : 1878,
        "startColumnNumber" : 19,
        "endLineNumber" : 1878,
        "endColumnNumber" : 60
      },
      "nodeContext" : "message instanceof TLRPC.TL_msg_container",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 41,
        "startLineNumber" : 1878,
        "startColumnNumber" : 19,
        "endLineNumber" : 1878,
        "endColumnNumber" : 60
      },
      "nodeContext" : "message instanceof TLRPC.TL_msg_container",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1885,
      "startColumnNumber" : 78,
      "endLineNumber" : 1885,
      "endColumnNumber" : 85
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 31,
        "startLineNumber" : 1885,
        "startColumnNumber" : 54,
        "endLineNumber" : 1885,
        "endColumnNumber" : 85
      },
      "nodeContext" : "(TLRPC.TL_msg_container)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 50,
        "startLineNumber" : 1885,
        "startColumnNumber" : 35,
        "endLineNumber" : 1885,
        "endColumnNumber" : 85
      },
      "nodeContext" : "messageContainer=(TLRPC.TL_msg_container)message",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 74,
        "startLineNumber" : 1885,
        "startColumnNumber" : 12,
        "endLineNumber" : 1885,
        "endColumnNumber" : 86
      },
      "nodeContext" : "TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1227,
        "startLineNumber" : 1878,
        "startColumnNumber" : 62,
        "endLineNumber" : 1902,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 105,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 74,
        "startLineNumber" : 1885,
        "startColumnNumber" : 12,
        "endLineNumber" : 1885,
        "endColumnNumber" : 86
      },
      "nodeContext" : "TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1902,
      "startColumnNumber" : 19,
      "endLineNumber" : 1902,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 32,
        "startLineNumber" : 1902,
        "startColumnNumber" : 19,
        "endLineNumber" : 1902,
        "endColumnNumber" : 51
      },
      "nodeContext" : "message instanceof TLRPC.TL_pong",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 32,
        "startLineNumber" : 1902,
        "startColumnNumber" : 19,
        "endLineNumber" : 1902,
        "endColumnNumber" : 51
      },
      "nodeContext" : "message instanceof TLRPC.TL_pong",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1903,
      "startColumnNumber" : 48,
      "endLineNumber" : 1903,
      "endColumnNumber" : 55
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 22,
        "startLineNumber" : 1903,
        "startColumnNumber" : 33,
        "endLineNumber" : 1903,
        "endColumnNumber" : 55
      },
      "nodeContext" : "(TLRPC.TL_pong)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 29,
        "startLineNumber" : 1903,
        "startColumnNumber" : 26,
        "endLineNumber" : 1903,
        "endColumnNumber" : 55
      },
      "nodeContext" : "pong=(TLRPC.TL_pong)message",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 44,
        "startLineNumber" : 1903,
        "startColumnNumber" : 12,
        "endLineNumber" : 1903,
        "endColumnNumber" : 56
      },
      "nodeContext" : "TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1154,
        "startLineNumber" : 1902,
        "startColumnNumber" : 53,
        "endLineNumber" : 1929,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 150,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 44,
        "startLineNumber" : 1903,
        "startColumnNumber" : 12,
        "endLineNumber" : 1903,
        "endColumnNumber" : 56
      },
      "nodeContext" : "TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1929,
      "startColumnNumber" : 19,
      "endLineNumber" : 1929,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 39,
        "startLineNumber" : 1929,
        "startColumnNumber" : 19,
        "endLineNumber" : 1929,
        "endColumnNumber" : 58
      },
      "nodeContext" : "message instanceof TLRPC.TL_futuresalts",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 39,
        "startLineNumber" : 1929,
        "startColumnNumber" : 19,
        "endLineNumber" : 1929,
        "endColumnNumber" : 58
      },
      "nodeContext" : "message instanceof TLRPC.TL_futuresalts",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1930,
      "startColumnNumber" : 69,
      "endLineNumber" : 1930,
      "endColumnNumber" : 76
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 29,
        "startLineNumber" : 1930,
        "startColumnNumber" : 47,
        "endLineNumber" : 1930,
        "endColumnNumber" : 76
      },
      "nodeContext" : "(TLRPC.TL_futuresalts)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 43,
        "startLineNumber" : 1930,
        "startColumnNumber" : 33,
        "endLineNumber" : 1930,
        "endColumnNumber" : 76
      },
      "nodeContext" : "futureSalts=(TLRPC.TL_futuresalts)message",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 65,
        "startLineNumber" : 1930,
        "startColumnNumber" : 12,
        "endLineNumber" : 1930,
        "endColumnNumber" : 77
      },
      "nodeContext" : "TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 624,
        "startLineNumber" : 1929,
        "startColumnNumber" : 60,
        "endLineNumber" : 1946,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 62,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 65,
        "startLineNumber" : 1930,
        "startColumnNumber" : 12,
        "endLineNumber" : 1930,
        "endColumnNumber" : 77
      },
      "nodeContext" : "TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1946,
      "startColumnNumber" : 19,
      "endLineNumber" : 1946,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 42,
        "startLineNumber" : 1946,
        "startColumnNumber" : 19,
        "endLineNumber" : 1946,
        "endColumnNumber" : 61
      },
      "nodeContext" : "message instanceof TLRPC.DestroySessionRes",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 42,
        "startLineNumber" : 1946,
        "startColumnNumber" : 19,
        "endLineNumber" : 1946,
        "endColumnNumber" : 61
      },
      "nodeContext" : "message instanceof TLRPC.DestroySessionRes",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1947,
      "startColumnNumber" : 67,
      "endLineNumber" : 1947,
      "endColumnNumber" : 74
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 32,
        "startLineNumber" : 1947,
        "startColumnNumber" : 42,
        "endLineNumber" : 1947,
        "endColumnNumber" : 74
      },
      "nodeContext" : "(TLRPC.DestroySessionRes)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 38,
        "startLineNumber" : 1947,
        "startColumnNumber" : 36,
        "endLineNumber" : 1947,
        "endColumnNumber" : 74
      },
      "nodeContext" : "res=(TLRPC.DestroySessionRes)message",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 63,
        "startLineNumber" : 1947,
        "startColumnNumber" : 12,
        "endLineNumber" : 1947,
        "endColumnNumber" : 75
      },
      "nodeContext" : "TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 613,
        "startLineNumber" : 1946,
        "startColumnNumber" : 63,
        "endLineNumber" : 1958,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 80,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 63,
        "startLineNumber" : 1947,
        "startColumnNumber" : 12,
        "endLineNumber" : 1947,
        "endColumnNumber" : 75
      },
      "nodeContext" : "TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1958,
      "startColumnNumber" : 19,
      "endLineNumber" : 1958,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 38,
        "startLineNumber" : 1958,
        "startColumnNumber" : 19,
        "endLineNumber" : 1958,
        "endColumnNumber" : 57
      },
      "nodeContext" : "message instanceof TLRPC.TL_rpc_result",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 38,
        "startLineNumber" : 1958,
        "startColumnNumber" : 19,
        "endLineNumber" : 1958,
        "endColumnNumber" : 57
      },
      "nodeContext" : "message instanceof TLRPC.TL_rpc_result",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 1959,
      "startColumnNumber" : 71,
      "endLineNumber" : 1959,
      "endColumnNumber" : 78
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 28,
        "startLineNumber" : 1959,
        "startColumnNumber" : 50,
        "endLineNumber" : 1959,
        "endColumnNumber" : 78
      },
      "nodeContext" : "(TLRPC.TL_rpc_result)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 46,
        "startLineNumber" : 1959,
        "startColumnNumber" : 32,
        "endLineNumber" : 1959,
        "endColumnNumber" : 78
      },
      "nodeContext" : "resultContainer=(TLRPC.TL_rpc_result)message",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 67,
        "startLineNumber" : 1959,
        "startColumnNumber" : 12,
        "endLineNumber" : 1959,
        "endColumnNumber" : 79
      },
      "nodeContext" : "TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 11910,
        "startLineNumber" : 1958,
        "startColumnNumber" : 59,
        "endLineNumber" : 2169,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1050,
      "astHeight" : 27
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 67,
        "startLineNumber" : 1959,
        "startColumnNumber" : 12,
        "endLineNumber" : 1959,
        "endColumnNumber" : 79
      },
      "nodeContext" : "TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2169,
      "startColumnNumber" : 19,
      "endLineNumber" : 2169,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 36,
        "startLineNumber" : 2169,
        "startColumnNumber" : 19,
        "endLineNumber" : 2169,
        "endColumnNumber" : 55
      },
      "nodeContext" : "message instanceof TLRPC.TL_msgs_ack",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 36,
        "startLineNumber" : 2169,
        "startColumnNumber" : 19,
        "endLineNumber" : 2169,
        "endColumnNumber" : 55
      },
      "nodeContext" : "message instanceof TLRPC.TL_msgs_ack",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2171,
      "startColumnNumber" : 19,
      "endLineNumber" : 2171,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 32,
        "startLineNumber" : 2171,
        "startColumnNumber" : 19,
        "endLineNumber" : 2171,
        "endColumnNumber" : 51
      },
      "nodeContext" : "message instanceof TLRPC.TL_ping",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 32,
        "startLineNumber" : 2171,
        "startColumnNumber" : 19,
        "endLineNumber" : 2171,
        "endColumnNumber" : 51
      },
      "nodeContext" : "message instanceof TLRPC.TL_ping",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2173,
      "startColumnNumber" : 19,
      "endLineNumber" : 2173,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 48,
        "startLineNumber" : 2173,
        "startColumnNumber" : 19,
        "endLineNumber" : 2173,
        "endColumnNumber" : 67
      },
      "nodeContext" : "message instanceof TLRPC.TL_bad_msg_notification",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 48,
        "startLineNumber" : 2173,
        "startColumnNumber" : 19,
        "endLineNumber" : 2173,
        "endColumnNumber" : 67
      },
      "nodeContext" : "message instanceof TLRPC.TL_bad_msg_notification",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2174,
      "startColumnNumber" : 94,
      "endLineNumber" : 2174,
      "endColumnNumber" : 101
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 38,
        "startLineNumber" : 2174,
        "startColumnNumber" : 63,
        "endLineNumber" : 2174,
        "endColumnNumber" : 101
      },
      "nodeContext" : "(TLRPC.TL_bad_msg_notification)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 59,
        "startLineNumber" : 2174,
        "startColumnNumber" : 42,
        "endLineNumber" : 2174,
        "endColumnNumber" : 101
      },
      "nodeContext" : "badMsgNotification=(TLRPC.TL_bad_msg_notification)message",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 90,
        "startLineNumber" : 2174,
        "startColumnNumber" : 12,
        "endLineNumber" : 2174,
        "endColumnNumber" : 102
      },
      "nodeContext" : "TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1178,
        "startLineNumber" : 2173,
        "startColumnNumber" : 69,
        "endLineNumber" : 2196,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 138,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 90,
        "startLineNumber" : 2174,
        "startColumnNumber" : 12,
        "endLineNumber" : 2174,
        "endColumnNumber" : 102
      },
      "nodeContext" : "TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2196,
      "startColumnNumber" : 19,
      "endLineNumber" : 2196,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 43,
        "startLineNumber" : 2196,
        "startColumnNumber" : 19,
        "endLineNumber" : 2196,
        "endColumnNumber" : 62
      },
      "nodeContext" : "message instanceof TLRPC.TL_bad_server_salt",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 43,
        "startLineNumber" : 2196,
        "startColumnNumber" : 19,
        "endLineNumber" : 2196,
        "endColumnNumber" : 62
      },
      "nodeContext" : "message instanceof TLRPC.TL_bad_server_salt",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2219,
      "startColumnNumber" : 19,
      "endLineNumber" : 2219,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 40,
        "startLineNumber" : 2219,
        "startColumnNumber" : 19,
        "endLineNumber" : 2219,
        "endColumnNumber" : 59
      },
      "nodeContext" : "message instanceof TLRPC.MsgDetailedInfo",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 2253,
        "startLineNumber" : 2219,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 262,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 40,
        "startLineNumber" : 2219,
        "startColumnNumber" : 19,
        "endLineNumber" : 2219,
        "endColumnNumber" : 59
      },
      "nodeContext" : "message instanceof TLRPC.MsgDetailedInfo",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2220,
      "startColumnNumber" : 72,
      "endLineNumber" : 2220,
      "endColumnNumber" : 79
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 30,
        "startLineNumber" : 2220,
        "startColumnNumber" : 49,
        "endLineNumber" : 2220,
        "endColumnNumber" : 79
      },
      "nodeContext" : "(TLRPC.MsgDetailedInfo)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 45,
        "startLineNumber" : 2220,
        "startColumnNumber" : 34,
        "endLineNumber" : 2220,
        "endColumnNumber" : 79
      },
      "nodeContext" : "detailedInfo=(TLRPC.MsgDetailedInfo)message",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 68,
        "startLineNumber" : 2220,
        "startColumnNumber" : 12,
        "endLineNumber" : 2220,
        "endColumnNumber" : 80
      },
      "nodeContext" : "TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1586,
        "startLineNumber" : 2219,
        "startColumnNumber" : 61,
        "endLineNumber" : 2256,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 179,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 2253,
        "startLineNumber" : 2219,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 262,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 68,
        "startLineNumber" : 2220,
        "startColumnNumber" : 12,
        "endLineNumber" : 2220,
        "endColumnNumber" : 80
      },
      "nodeContext" : "TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2256,
      "startColumnNumber" : 19,
      "endLineNumber" : 2256,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 39,
        "startLineNumber" : 2256,
        "startColumnNumber" : 19,
        "endLineNumber" : 2256,
        "endColumnNumber" : 58
      },
      "nodeContext" : "message instanceof TLRPC.TL_gzip_packed",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 615,
        "startLineNumber" : 2256,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 76,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 2253,
        "startLineNumber" : 2219,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 262,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 39,
        "startLineNumber" : 2256,
        "startColumnNumber" : 19,
        "endLineNumber" : 2256,
        "endColumnNumber" : 58
      },
      "nodeContext" : "message instanceof TLRPC.TL_gzip_packed",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2257,
      "startColumnNumber" : 64,
      "endLineNumber" : 2257,
      "endColumnNumber" : 71
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 29,
        "startLineNumber" : 2257,
        "startColumnNumber" : 42,
        "endLineNumber" : 2257,
        "endColumnNumber" : 71
      },
      "nodeContext" : "(TLRPC.TL_gzip_packed)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 38,
        "startLineNumber" : 2257,
        "startColumnNumber" : 33,
        "endLineNumber" : 2257,
        "endColumnNumber" : 71
      },
      "nodeContext" : "packet=(TLRPC.TL_gzip_packed)message",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 8,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 60,
        "startLineNumber" : 2257,
        "startColumnNumber" : 12,
        "endLineNumber" : 2257,
        "endColumnNumber" : 72
      },
      "nodeContext" : "TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 321,
        "startLineNumber" : 2256,
        "startColumnNumber" : 60,
        "endLineNumber" : 2260,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 39,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 615,
        "startLineNumber" : 2256,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 76,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 2253,
        "startLineNumber" : 2219,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 262,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 60,
        "startLineNumber" : 2257,
        "startColumnNumber" : 12,
        "endLineNumber" : 2257,
        "endColumnNumber" : 72
      },
      "nodeContext" : "TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2260,
      "startColumnNumber" : 19,
      "endLineNumber" : 2260,
      "endColumnNumber" : 26
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 32,
        "startLineNumber" : 2260,
        "startColumnNumber" : 19,
        "endLineNumber" : 2260,
        "endColumnNumber" : 51
      },
      "nodeContext" : "message instanceof TLRPC.Updates",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 243,
        "startLineNumber" : 2260,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 30,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 615,
        "startLineNumber" : 2256,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 76,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 2253,
        "startLineNumber" : 2219,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 262,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,expression]",
      "nodePosition" : {
        "charLength" : 32,
        "startLineNumber" : 2260,
        "startColumnNumber" : 19,
        "endLineNumber" : 2260,
        "endColumnNumber" : 51
      },
      "nodeContext" : "message instanceof TLRPC.Updates",
      "nodeType" : "InstanceofExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2261,
      "startColumnNumber" : 75,
      "endLineNumber" : 2261,
      "endColumnNumber" : 82
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 22,
        "startLineNumber" : 2261,
        "startColumnNumber" : 60,
        "endLineNumber" : 2261,
        "endColumnNumber" : 82
      },
      "nodeContext" : "(TLRPC.Updates)message",
      "nodeType" : "CastExpression",
      "astNodeNumber" : 6,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 78,
        "startLineNumber" : 2261,
        "startColumnNumber" : 12,
        "endLineNumber" : 2261,
        "endColumnNumber" : 90
      },
      "nodeContext" : "MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 12,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 79,
        "startLineNumber" : 2261,
        "startColumnNumber" : 12,
        "endLineNumber" : 2261,
        "endColumnNumber" : 91
      },
      "nodeContext" : "MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 103,
        "startLineNumber" : 2260,
        "startColumnNumber" : 53,
        "endLineNumber" : 2262,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 14,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 243,
        "startLineNumber" : 2260,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 30,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 615,
        "startLineNumber" : 2256,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 76,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 2253,
        "startLineNumber" : 2219,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 262,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 79,
        "startLineNumber" : 2261,
        "startColumnNumber" : 12,
        "endLineNumber" : 2261,
        "endColumnNumber" : 91
      },
      "nodeContext" : "MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 13,
      "astHeight" : 6
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  }, {
    "nodeContext" : "message",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 7,
      "startLineNumber" : 2263,
      "startColumnNumber" : 75,
      "endLineNumber" : 2263,
      "endColumnNumber" : 82
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.MethodInvocation,arguments]",
      "nodePosition" : {
        "charLength" : 47,
        "startLineNumber" : 2263,
        "startColumnNumber" : 35,
        "endLineNumber" : 2263,
        "endColumnNumber" : 82
      },
      "nodeContext" : "\"***** Error: unknown message class \" + message",
      "nodeType" : "InfixExpression",
      "astNodeNumber" : 3,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 71,
        "startLineNumber" : 2263,
        "startColumnNumber" : 12,
        "endLineNumber" : 2263,
        "endColumnNumber" : 83
      },
      "nodeContext" : "FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 7,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 72,
        "startLineNumber" : 2263,
        "startColumnNumber" : 12,
        "endLineNumber" : 2263,
        "endColumnNumber" : 84
      },
      "nodeContext" : "FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 96,
        "startLineNumber" : 2262,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 9,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 243,
        "startLineNumber" : 2260,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 30,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 615,
        "startLineNumber" : 2256,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 76,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 2253,
        "startLineNumber" : 2219,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 262,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 3227,
        "startLineNumber" : 2196,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 377,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4465,
        "startLineNumber" : 2173,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 522,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4521,
        "startLineNumber" : 2171,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 530,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 4581,
        "startLineNumber" : 2169,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 538,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 16541,
        "startLineNumber" : 1958,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1595,
      "astHeight" : 28
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17208,
        "startLineNumber" : 1946,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1682,
      "astHeight" : 29
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 17883,
        "startLineNumber" : 1929,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1751,
      "astHeight" : 30
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 19081,
        "startLineNumber" : 1902,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 1908,
      "astHeight" : 31
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 20361,
        "startLineNumber" : 1878,
        "startColumnNumber" : 15,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2020,
      "astHeight" : 32
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 22534,
        "startLineNumber" : 1839,
        "startColumnNumber" : 8,
        "endLineNumber" : 2264,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (message instanceof TLRPC.TL_new_session_created) {\n  TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n  ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n  if (arr == null) {\n    arr=new ArrayList<Long>();\n    processedSessionChanges.put(sessionId,arr);\n  }\n  if (!arr.contains(newSession.unique_id)) {\n    FileLog.d(\"tmessages\",\"New session:\");\n    FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n    FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n    FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n    long serverSalt=newSession.server_salt;\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=serverSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    for (    RPCRequest request : runningRequests) {\n      Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n      if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n        request.runningMessageId=0;\n        request.runningMessageSeqNo=0;\n        request.runningStartTime=0;\n        request.runningMinStartTime=0;\n        request.transportChannelToken=0;\n      }\n    }\n    saveSession();\n    if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n      MessagesController.getInstance().getDifference();\n    }\n    arr.add(newSession.unique_id);\n  }\n}\n else if (message instanceof TLRPC.TL_msg_container) {\n  TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n  for (  TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n    long innerMessageId=innerMessage.msg_id;\n    if (innerMessage.seqno % 2 != 0) {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(innerMessageId);\n    }\n    if (isMessageIdProcessed(sessionId,innerMessageId)) {\n      continue;\n    }\n    processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n    addProcessedMessageId(sessionId,innerMessageId);\n  }\n}\n else if (message instanceof TLRPC.TL_pong) {\n  TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n  long pingId=pong.ping_id;\n  ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n  for (  Long pid : pingIdToDate.keySet()) {\n    if (pid == pingId) {\n      int time=pingIdToDate.get(pid);\n      int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n      if (Math.abs(pingTime) < 10) {\n        currentPingTime=(pingTime + currentPingTime) / 2;\n        if (messageId != 0) {\n          long timeMessage=getTimeFromMsgId(messageId);\n          long currentTime=System.currentTimeMillis();\n          timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n        }\n      }\n      itemsToDelete.add(pid);\n    }\n else     if (pid < pingId) {\n      itemsToDelete.add(pid);\n    }\n  }\n  for (  Long pid : itemsToDelete) {\n    pingIdToDate.remove(pid);\n  }\n}\n else if (message instanceof TLRPC.TL_futuresalts) {\n  TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n  long requestMid=futureSalts.req_msg_id;\n  for (  RPCRequest request : runningRequests) {\n    if (request.respondsToMessageId(requestMid)) {\n      if (request.completionBlock != null) {\n        request.completionBlock.run(futureSalts,null);\n      }\n      futureSalts.freeResources();\n      messagesConfirmed(requestMid);\n      rpcCompleted(requestMid);\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.DestroySessionRes) {\n  TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n  ArrayList<Long> lst=new ArrayList<Long>();\n  lst.addAll(sessionsToDestroy);\n  destroyingSessions.remove(res.session_id);\n  for (  long session : lst) {\n    if (session == res.session_id) {\n      sessionsToDestroy.remove(session);\n      FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n      break;\n    }\n  }\n}\n else if (message instanceof TLRPC.TL_rpc_result) {\n  TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n  long resultMid=resultContainer.req_msg_id;\n  boolean ignoreResult=false;\n  FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n  if (resultContainer.result instanceof TLRPC.RpcError) {\n    String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n    FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n    int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n    if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n      ArrayList<String> migrateErrors=new ArrayList<String>();\n      migrateErrors.add(\"NETWORK_MIGRATE_\");\n      migrateErrors.add(\"PHONE_MIGRATE_\");\n      migrateErrors.add(\"USER_MIGRATE_\");\n      for (      String possibleError : migrateErrors) {\n        if (errorMessage.contains(possibleError)) {\n          String errorMsg=errorMessage.replace(possibleError,\"\");\n          Pattern pattern=Pattern.compile(\"[0-9]+\");\n          Matcher matcher=pattern.matcher(errorMsg);\n          if (matcher.find()) {\n            errorMsg=matcher.group(0);\n          }\n          Integer val;\n          try {\n            val=Integer.parseInt(errorMsg);\n          }\n catch (          Exception e) {\n            val=null;\n          }\n          if (val != null) {\n            migrateToDatacenterId=val;\n          }\n else {\n            migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n          }\n        }\n      }\n    }\n    if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n      ignoreResult=true;\n      moveToDatacenter(migrateToDatacenterId);\n    }\n  }\n  int retryRequestsFromDatacenter=-1;\n  int retryRequestsClass=0;\n  if (!ignoreResult) {\n    boolean found=false;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(resultMid)) {\n        found=true;\n        boolean discardResponse=false;\n        boolean isError=false;\n        if (request.completionBlock != null) {\n          TLRPC.TL_error implicitError=null;\n          if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n            TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n            TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            if (uncomressed == null) {\n              System.gc();\n              uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n            }\n            if (uncomressed == null) {\n              throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n            }\n            resultContainer.result=uncomressed;\n          }\n          if (resultContainer.result instanceof TLRPC.RpcError) {\n            String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n            FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n            int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n            if (errorCode == 500 || errorCode < 0) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                if (request.serverFailureCount < 1) {\n                  discardResponse=true;\n                  request.runningMinStartTime=request.runningStartTime + 1;\n                }\n              }\n else {\n                discardResponse=true;\n                int delay=Math.min(1,request.serverFailureCount * 2);\n                request.runningMinStartTime=request.runningStartTime + delay;\n                request.confirmed=false;\n              }\n              request.serverFailureCount++;\n            }\n else             if (errorCode == 420) {\n              if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                double waitTime=2.0;\n                if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                  String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                  Pattern pattern=Pattern.compile(\"[0-9]+\");\n                  Matcher matcher=pattern.matcher(errorMsg);\n                  if (matcher.find()) {\n                    errorMsg=matcher.group(0);\n                  }\n                  Integer val;\n                  try {\n                    val=Integer.parseInt(errorMsg);\n                  }\n catch (                  Exception e) {\n                    val=null;\n                  }\n                  if (val != null) {\n                    waitTime=val;\n                  }\n                }\n                waitTime=Math.min(30,waitTime);\n                discardResponse=true;\n                request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                request.confirmed=false;\n              }\n            }\n            implicitError=new TLRPC.TL_error();\n            implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n            implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n          }\n else           if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n            if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n              if (request.rawRequest == null) {\n                FileLog.e(\"tmessages\",\"rawRequest is null\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=-1000;\n            }\n          }\n          if (!discardResponse) {\n            if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n              isError=true;\n              request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n            }\n else {\n              request.completionBlock.run(resultContainer.result,null);\n            }\n          }\n          if (implicitError != null && implicitError.code == 401) {\n            isError=true;\n            if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n              if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                if (UserConfig.clientActivated) {\n                  UserConfig.clearConfig();\n                  Utilities.RunOnUIThread(new Runnable(){\n                    @Override public void run(){\n                      NotificationCenter.getInstance().postNotificationName(1234);\n                    }\n                  }\n);\n                }\n              }\n            }\n else {\n              datacenter.authorized=false;\n              saveSession();\n              discardResponse=true;\n              if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                retryRequestsFromDatacenter=datacenter.datacenterId;\n                retryRequestsClass=request.flags;\n              }\n            }\n          }\n        }\n        if (!discardResponse) {\n          if (request.initRequest && !isError) {\n            if (datacenter.lastInitVersion != currentAppVersion) {\n              datacenter.lastInitVersion=currentAppVersion;\n              saveSession();\n              FileLog.e(\"tmessages\",\"init connection completed\");\n            }\n else {\n              FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n            }\n          }\n          rpcCompleted(resultMid);\n        }\n else {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.transportChannelToken=0;\n        }\n        break;\n      }\n    }\n    resultContainer.freeResources();\n    if (!found) {\n      FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n      rpcCompleted(resultMid);\n    }\n    messagesConfirmed(resultMid);\n  }\n  if (retryRequestsFromDatacenter >= 0) {\n    processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n  }\n else {\n    processRequestQueue(0,0);\n  }\n}\n else if (message instanceof TLRPC.TL_msgs_ack) {\n}\n else if (message instanceof TLRPC.TL_ping) {\n}\n else if (message instanceof TLRPC.TL_bad_msg_notification) {\n  TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n  FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n  if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n    long realId=messageId != 0 ? messageId : containerMessageId;\n    if (realId == 0) {\n      realId=innerMsgId;\n    }\n    if (realId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    }\n    recreateSession(datacenter.authSessionId,datacenter);\n    saveSession();\n    lastOutgoingMessageId=0;\n    clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n  }\n}\n else if (message instanceof TLRPC.TL_bad_server_salt) {\n  if (messageId != 0) {\n    long time=getTimeFromMsgId(messageId);\n    long currentTime=System.currentTimeMillis();\n    timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n    lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n  }\n  datacenter.clearServerSalts();\n  ServerSalt serverSaltDesc=new ServerSalt();\n  serverSaltDesc.validSince=getCurrentTime();\n  serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n  serverSaltDesc.value=messageSalt;\n  datacenter.addServerSalt(serverSaltDesc);\n  saveSession();\n  refillSaltSet(datacenter);\n  if (datacenter.authKey != null) {\n    processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n  }\n}\n else if (message instanceof TLRPC.MsgDetailedInfo) {\n  TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n  boolean requestResend=false;\n  if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n    long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        requestResend=true;\n        break;\n      }\n    }\n  }\n else {\n    if (!isMessageIdProcessed(sessionId,messageId)) {\n      requestResend=true;\n    }\n  }\n  if (requestResend) {\n    TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n    resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n    NetworkMessage networkMessage=new NetworkMessage();\n    networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n    ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n    arr.add(networkMessage);\n    sendMessagesToTransport(arr,connection,sessionId,false,true);\n  }\n else {\n    ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n    if (set == null) {\n      set=new ArrayList<Long>();\n      messagesIdsForConfirmation.put(sessionId,set);\n    }\n    set.add(detailedInfo.answer_msg_id);\n  }\n}\n else if (message instanceof TLRPC.TL_gzip_packed) {\n  TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n  TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n  processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n}\n else if (message instanceof TLRPC.Updates) {\n  MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n}\n else {\n  FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 2280,
      "astHeight" : 33
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 22747,
        "startLineNumber" : 1832,
        "startColumnNumber" : 178,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 2303,
      "astHeight" : 34
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 22921,
        "startLineNumber" : 1832,
        "startColumnNumber" : 4,
        "endLineNumber" : 2265,
        "endColumnNumber" : 5
      },
      "nodeContext" : "void processMessage(TLObject message,long messageId,int messageSeqNo,long messageSalt,TcpConnection connection,long sessionId,long innerMsgId,long containerMessageId){\n  if (message == null) {\n    FileLog.e(\"tmessages\",\"message is null\");\n    return;\n  }\n  Datacenter datacenter=datacenterWithId(connection.getDatacenterId());\n  if (message instanceof TLRPC.TL_new_session_created) {\n    TLRPC.TL_new_session_created newSession=(TLRPC.TL_new_session_created)message;\n    ArrayList<Long> arr=processedSessionChanges.get(sessionId);\n    if (arr == null) {\n      arr=new ArrayList<Long>();\n      processedSessionChanges.put(sessionId,arr);\n    }\n    if (!arr.contains(newSession.unique_id)) {\n      FileLog.d(\"tmessages\",\"New session:\");\n      FileLog.d(\"tmessages\",String.format(\"    first message id: %d\",newSession.first_msg_id));\n      FileLog.d(\"tmessages\",String.format(\"    server salt: %d\",newSession.server_salt));\n      FileLog.d(\"tmessages\",String.format(\"    unique id: %d\",newSession.unique_id));\n      long serverSalt=newSession.server_salt;\n      ServerSalt serverSaltDesc=new ServerSalt();\n      serverSaltDesc.validSince=getCurrentTime();\n      serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n      serverSaltDesc.value=serverSalt;\n      datacenter.addServerSalt(serverSaltDesc);\n      for (      RPCRequest request : runningRequests) {\n        Datacenter dcenter=datacenterWithId(request.runningDatacenterId);\n        if (request.runningMessageId < newSession.first_msg_id && (request.flags & connection.transportRequestClass) != 0 && dcenter != null && dcenter.datacenterId == datacenter.datacenterId) {\n          request.runningMessageId=0;\n          request.runningMessageSeqNo=0;\n          request.runningStartTime=0;\n          request.runningMinStartTime=0;\n          request.transportChannelToken=0;\n        }\n      }\n      saveSession();\n      if (sessionId == datacenter.authSessionId && datacenter.datacenterId == currentDatacenterId && UserConfig.clientActivated) {\n        MessagesController.getInstance().getDifference();\n      }\n      arr.add(newSession.unique_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msg_container) {\n    TLRPC.TL_msg_container messageContainer=(TLRPC.TL_msg_container)message;\n    for (    TLRPC.TL_protoMessage innerMessage : messageContainer.messages) {\n      long innerMessageId=innerMessage.msg_id;\n      if (innerMessage.seqno % 2 != 0) {\n        ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n        if (set == null) {\n          set=new ArrayList<Long>();\n          messagesIdsForConfirmation.put(sessionId,set);\n        }\n        set.add(innerMessageId);\n      }\n      if (isMessageIdProcessed(sessionId,innerMessageId)) {\n        continue;\n      }\n      processMessage(innerMessage.body,0,innerMessage.seqno,messageSalt,connection,sessionId,innerMessageId,messageId);\n      addProcessedMessageId(sessionId,innerMessageId);\n    }\n  }\n else   if (message instanceof TLRPC.TL_pong) {\n    TLRPC.TL_pong pong=(TLRPC.TL_pong)message;\n    long pingId=pong.ping_id;\n    ArrayList<Long> itemsToDelete=new ArrayList<Long>();\n    for (    Long pid : pingIdToDate.keySet()) {\n      if (pid == pingId) {\n        int time=pingIdToDate.get(pid);\n        int pingTime=(int)(System.currentTimeMillis() / 1000) - time;\n        if (Math.abs(pingTime) < 10) {\n          currentPingTime=(pingTime + currentPingTime) / 2;\n          if (messageId != 0) {\n            long timeMessage=getTimeFromMsgId(messageId);\n            long currentTime=System.currentTimeMillis();\n            timeDifference=(int)((timeMessage - currentTime) / 1000 - currentPingTime / 2.0);\n          }\n        }\n        itemsToDelete.add(pid);\n      }\n else       if (pid < pingId) {\n        itemsToDelete.add(pid);\n      }\n    }\n    for (    Long pid : itemsToDelete) {\n      pingIdToDate.remove(pid);\n    }\n  }\n else   if (message instanceof TLRPC.TL_futuresalts) {\n    TLRPC.TL_futuresalts futureSalts=(TLRPC.TL_futuresalts)message;\n    long requestMid=futureSalts.req_msg_id;\n    for (    RPCRequest request : runningRequests) {\n      if (request.respondsToMessageId(requestMid)) {\n        if (request.completionBlock != null) {\n          request.completionBlock.run(futureSalts,null);\n        }\n        futureSalts.freeResources();\n        messagesConfirmed(requestMid);\n        rpcCompleted(requestMid);\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.DestroySessionRes) {\n    TLRPC.DestroySessionRes res=(TLRPC.DestroySessionRes)message;\n    ArrayList<Long> lst=new ArrayList<Long>();\n    lst.addAll(sessionsToDestroy);\n    destroyingSessions.remove(res.session_id);\n    for (    long session : lst) {\n      if (session == res.session_id) {\n        sessionsToDestroy.remove(session);\n        FileLog.d(\"tmessages\",String.format(\"Destroyed session %d (%s)\",res.session_id,res instanceof TLRPC.TL_destroy_session_ok ? \"ok\" : \"not found\"));\n        break;\n      }\n    }\n  }\n else   if (message instanceof TLRPC.TL_rpc_result) {\n    TLRPC.TL_rpc_result resultContainer=(TLRPC.TL_rpc_result)message;\n    long resultMid=resultContainer.req_msg_id;\n    boolean ignoreResult=false;\n    FileLog.d(\"tmessages\",\"object in rpc_result is \" + resultContainer.result);\n    if (resultContainer.result instanceof TLRPC.RpcError) {\n      String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n      FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n      int migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n      if (((TLRPC.RpcError)resultContainer.result).error_code == 303) {\n        ArrayList<String> migrateErrors=new ArrayList<String>();\n        migrateErrors.add(\"NETWORK_MIGRATE_\");\n        migrateErrors.add(\"PHONE_MIGRATE_\");\n        migrateErrors.add(\"USER_MIGRATE_\");\n        for (        String possibleError : migrateErrors) {\n          if (errorMessage.contains(possibleError)) {\n            String errorMsg=errorMessage.replace(possibleError,\"\");\n            Pattern pattern=Pattern.compile(\"[0-9]+\");\n            Matcher matcher=pattern.matcher(errorMsg);\n            if (matcher.find()) {\n              errorMsg=matcher.group(0);\n            }\n            Integer val;\n            try {\n              val=Integer.parseInt(errorMsg);\n            }\n catch (            Exception e) {\n              val=null;\n            }\n            if (val != null) {\n              migrateToDatacenterId=val;\n            }\n else {\n              migrateToDatacenterId=DEFAULT_DATACENTER_ID;\n            }\n          }\n        }\n      }\n      if (migrateToDatacenterId != DEFAULT_DATACENTER_ID) {\n        ignoreResult=true;\n        moveToDatacenter(migrateToDatacenterId);\n      }\n    }\n    int retryRequestsFromDatacenter=-1;\n    int retryRequestsClass=0;\n    if (!ignoreResult) {\n      boolean found=false;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(resultMid)) {\n          found=true;\n          boolean discardResponse=false;\n          boolean isError=false;\n          if (request.completionBlock != null) {\n            TLRPC.TL_error implicitError=null;\n            if (resultContainer.result instanceof TLRPC.TL_gzip_packed) {\n              TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)resultContainer.result;\n              TLObject uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              if (uncomressed == null) {\n                System.gc();\n                uncomressed=Utilities.decompress(packet.packed_data,request.rawRequest);\n              }\n              if (uncomressed == null) {\n                throw new RuntimeException(\"failed to decomress responce for \" + request.rawRequest);\n              }\n              resultContainer.result=uncomressed;\n            }\n            if (resultContainer.result instanceof TLRPC.RpcError) {\n              String errorMessage=((TLRPC.RpcError)resultContainer.result).error_message;\n              FileLog.e(\"tmessages\",String.format(\"***** RPC error %d: %s\",((TLRPC.RpcError)resultContainer.result).error_code,errorMessage));\n              int errorCode=((TLRPC.RpcError)resultContainer.result).error_code;\n              if (errorCode == 500 || errorCode < 0) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) != 0) {\n                  if (request.serverFailureCount < 1) {\n                    discardResponse=true;\n                    request.runningMinStartTime=request.runningStartTime + 1;\n                  }\n                }\n else {\n                  discardResponse=true;\n                  int delay=Math.min(1,request.serverFailureCount * 2);\n                  request.runningMinStartTime=request.runningStartTime + delay;\n                  request.confirmed=false;\n                }\n                request.serverFailureCount++;\n              }\n else               if (errorCode == 420) {\n                if ((request.flags & RPCRequest.RPCRequestClassFailOnServerErrors) == 0) {\n                  double waitTime=2.0;\n                  if (errorMessage.contains(\"FLOOD_WAIT_\")) {\n                    String errorMsg=errorMessage.replace(\"FLOOD_WAIT_\",\"\");\n                    Pattern pattern=Pattern.compile(\"[0-9]+\");\n                    Matcher matcher=pattern.matcher(errorMsg);\n                    if (matcher.find()) {\n                      errorMsg=matcher.group(0);\n                    }\n                    Integer val;\n                    try {\n                      val=Integer.parseInt(errorMsg);\n                    }\n catch (                    Exception e) {\n                      val=null;\n                    }\n                    if (val != null) {\n                      waitTime=val;\n                    }\n                  }\n                  waitTime=Math.min(30,waitTime);\n                  discardResponse=true;\n                  request.runningMinStartTime=(int)(System.currentTimeMillis() / 1000 + waitTime);\n                  request.confirmed=false;\n                }\n              }\n              implicitError=new TLRPC.TL_error();\n              implicitError.code=((TLRPC.RpcError)resultContainer.result).error_code;\n              implicitError.text=((TLRPC.RpcError)resultContainer.result).error_message;\n            }\n else             if (!(resultContainer.result instanceof TLRPC.TL_error)) {\n              if (request.rawRequest == null || !request.rawRequest.responseClass().isAssignableFrom(resultContainer.result.getClass())) {\n                if (request.rawRequest == null) {\n                  FileLog.e(\"tmessages\",\"rawRequest is null\");\n                }\n else {\n                  FileLog.e(\"tmessages\",\"***** RPC error: invalid response class \" + resultContainer.result + \" (\"+ request.rawRequest.responseClass()+ \" expected)\");\n                }\n                implicitError=new TLRPC.TL_error();\n                implicitError.code=-1000;\n              }\n            }\n            if (!discardResponse) {\n              if (implicitError != null || resultContainer.result instanceof TLRPC.TL_error) {\n                isError=true;\n                request.completionBlock.run(null,implicitError != null ? implicitError : (TLRPC.TL_error)resultContainer.result);\n              }\n else {\n                request.completionBlock.run(resultContainer.result,null);\n              }\n            }\n            if (implicitError != null && implicitError.code == 401) {\n              isError=true;\n              if (datacenter.datacenterId == currentDatacenterId || datacenter.datacenterId == movingToDatacenterId) {\n                if ((request.flags & RPCRequest.RPCRequestClassGeneric) != 0) {\n                  if (UserConfig.clientActivated) {\n                    UserConfig.clearConfig();\n                    Utilities.RunOnUIThread(new Runnable(){\n                      @Override public void run(){\n                        NotificationCenter.getInstance().postNotificationName(1234);\n                      }\n                    }\n);\n                  }\n                }\n              }\n else {\n                datacenter.authorized=false;\n                saveSession();\n                discardResponse=true;\n                if ((request.flags & RPCRequest.RPCRequestClassDownloadMedia) != 0 || (request.flags & RPCRequest.RPCRequestClassUploadMedia) != 0) {\n                  retryRequestsFromDatacenter=datacenter.datacenterId;\n                  retryRequestsClass=request.flags;\n                }\n              }\n            }\n          }\n          if (!discardResponse) {\n            if (request.initRequest && !isError) {\n              if (datacenter.lastInitVersion != currentAppVersion) {\n                datacenter.lastInitVersion=currentAppVersion;\n                saveSession();\n                FileLog.e(\"tmessages\",\"init connection completed\");\n              }\n else {\n                FileLog.e(\"tmessages\",\"rpc is init, but init connection already completed\");\n              }\n            }\n            rpcCompleted(resultMid);\n          }\n else {\n            request.runningMessageId=0;\n            request.runningMessageSeqNo=0;\n            request.transportChannelToken=0;\n          }\n          break;\n        }\n      }\n      resultContainer.freeResources();\n      if (!found) {\n        FileLog.d(\"tmessages\",\"Response received, but request wasn't found.\");\n        rpcCompleted(resultMid);\n      }\n      messagesConfirmed(resultMid);\n    }\n    if (retryRequestsFromDatacenter >= 0) {\n      processRequestQueue(retryRequestsClass,retryRequestsFromDatacenter);\n    }\n else {\n      processRequestQueue(0,0);\n    }\n  }\n else   if (message instanceof TLRPC.TL_msgs_ack) {\n  }\n else   if (message instanceof TLRPC.TL_ping) {\n  }\n else   if (message instanceof TLRPC.TL_bad_msg_notification) {\n    TLRPC.TL_bad_msg_notification badMsgNotification=(TLRPC.TL_bad_msg_notification)message;\n    FileLog.e(\"tmessages\",String.format(\"***** Bad message: %d\",badMsgNotification.error_code));\n    if (badMsgNotification.error_code == 16 || badMsgNotification.error_code == 17 || badMsgNotification.error_code == 19 || badMsgNotification.error_code == 32 || badMsgNotification.error_code == 33 || badMsgNotification.error_code == 64) {\n      long realId=messageId != 0 ? messageId : containerMessageId;\n      if (realId == 0) {\n        realId=innerMsgId;\n      }\n      if (realId != 0) {\n        long time=getTimeFromMsgId(messageId);\n        long currentTime=System.currentTimeMillis();\n        timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      }\n      recreateSession(datacenter.authSessionId,datacenter);\n      saveSession();\n      lastOutgoingMessageId=0;\n      clearRequestsForRequestClass(connection.transportRequestClass,datacenter);\n    }\n  }\n else   if (message instanceof TLRPC.TL_bad_server_salt) {\n    if (messageId != 0) {\n      long time=getTimeFromMsgId(messageId);\n      long currentTime=System.currentTimeMillis();\n      timeDifference=(int)((time - currentTime) / 1000 - currentPingTime / 2.0);\n      lastOutgoingMessageId=Math.max(messageId,lastOutgoingMessageId);\n    }\n    datacenter.clearServerSalts();\n    ServerSalt serverSaltDesc=new ServerSalt();\n    serverSaltDesc.validSince=getCurrentTime();\n    serverSaltDesc.validUntil=getCurrentTime() + 30 * 60;\n    serverSaltDesc.value=messageSalt;\n    datacenter.addServerSalt(serverSaltDesc);\n    saveSession();\n    refillSaltSet(datacenter);\n    if (datacenter.authKey != null) {\n      processRequestQueue(RPCRequest.RPCRequestClassTransportMask,datacenter.datacenterId);\n    }\n  }\n else   if (message instanceof TLRPC.MsgDetailedInfo) {\n    TLRPC.MsgDetailedInfo detailedInfo=(TLRPC.MsgDetailedInfo)message;\n    boolean requestResend=false;\n    if (detailedInfo instanceof TLRPC.TL_msg_detailed_info) {\n      long requestMid=((TLRPC.TL_msg_detailed_info)detailedInfo).msg_id;\n      for (      RPCRequest request : runningRequests) {\n        if (request.respondsToMessageId(requestMid)) {\n          requestResend=true;\n          break;\n        }\n      }\n    }\n else {\n      if (!isMessageIdProcessed(sessionId,messageId)) {\n        requestResend=true;\n      }\n    }\n    if (requestResend) {\n      TLRPC.TL_msg_resend_req resendReq=new TLRPC.TL_msg_resend_req();\n      resendReq.msg_ids.add(detailedInfo.answer_msg_id);\n      NetworkMessage networkMessage=new NetworkMessage();\n      networkMessage.protoMessage=wrapMessage(resendReq,sessionId,false);\n      ArrayList<NetworkMessage> arr=new ArrayList<NetworkMessage>();\n      arr.add(networkMessage);\n      sendMessagesToTransport(arr,connection,sessionId,false,true);\n    }\n else {\n      ArrayList<Long> set=messagesIdsForConfirmation.get(sessionId);\n      if (set == null) {\n        set=new ArrayList<Long>();\n        messagesIdsForConfirmation.put(sessionId,set);\n      }\n      set.add(detailedInfo.answer_msg_id);\n    }\n  }\n else   if (message instanceof TLRPC.TL_gzip_packed) {\n    TLRPC.TL_gzip_packed packet=(TLRPC.TL_gzip_packed)message;\n    TLObject result=Utilities.decompress(packet.packed_data,getRequestWithMessageId(messageId));\n    processMessage(result,messageId,messageSeqNo,messageSalt,connection,sessionId,innerMsgId,containerMessageId);\n  }\n else   if (message instanceof TLRPC.Updates) {\n    MessagesController.getInstance().processUpdates((TLRPC.Updates)message,false);\n  }\n else {\n    FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n  }\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 2332,
      "astHeight" : 35
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 72,
        "startLineNumber" : 2263,
        "startColumnNumber" : 12,
        "endLineNumber" : 2263,
        "endColumnNumber" : 84
      },
      "nodeContext" : "FileLog.e(\"tmessages\",\"***** Error: unknown message class \" + message);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    },
    "tokenLength" : 1,
    "type" : "org.telegram.messenger.TLObject"
  } ],
  "positionList" : [ {
    "charLength" : 7,
    "startLineNumber" : 1833,
    "startColumnNumber" : 12,
    "endLineNumber" : 1833,
    "endColumnNumber" : 19
  }, {
    "charLength" : 7,
    "startLineNumber" : 1839,
    "startColumnNumber" : 12,
    "endLineNumber" : 1839,
    "endColumnNumber" : 19
  }, {
    "charLength" : 7,
    "startLineNumber" : 1840,
    "startColumnNumber" : 84,
    "endLineNumber" : 1840,
    "endColumnNumber" : 91
  }, {
    "charLength" : 7,
    "startLineNumber" : 1878,
    "startColumnNumber" : 19,
    "endLineNumber" : 1878,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 1885,
    "startColumnNumber" : 78,
    "endLineNumber" : 1885,
    "endColumnNumber" : 85
  }, {
    "charLength" : 7,
    "startLineNumber" : 1902,
    "startColumnNumber" : 19,
    "endLineNumber" : 1902,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 1903,
    "startColumnNumber" : 48,
    "endLineNumber" : 1903,
    "endColumnNumber" : 55
  }, {
    "charLength" : 7,
    "startLineNumber" : 1929,
    "startColumnNumber" : 19,
    "endLineNumber" : 1929,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 1930,
    "startColumnNumber" : 69,
    "endLineNumber" : 1930,
    "endColumnNumber" : 76
  }, {
    "charLength" : 7,
    "startLineNumber" : 1946,
    "startColumnNumber" : 19,
    "endLineNumber" : 1946,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 1947,
    "startColumnNumber" : 67,
    "endLineNumber" : 1947,
    "endColumnNumber" : 74
  }, {
    "charLength" : 7,
    "startLineNumber" : 1958,
    "startColumnNumber" : 19,
    "endLineNumber" : 1958,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 1959,
    "startColumnNumber" : 71,
    "endLineNumber" : 1959,
    "endColumnNumber" : 78
  }, {
    "charLength" : 7,
    "startLineNumber" : 2169,
    "startColumnNumber" : 19,
    "endLineNumber" : 2169,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 2171,
    "startColumnNumber" : 19,
    "endLineNumber" : 2171,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 2173,
    "startColumnNumber" : 19,
    "endLineNumber" : 2173,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 2174,
    "startColumnNumber" : 94,
    "endLineNumber" : 2174,
    "endColumnNumber" : 101
  }, {
    "charLength" : 7,
    "startLineNumber" : 2196,
    "startColumnNumber" : 19,
    "endLineNumber" : 2196,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 2219,
    "startColumnNumber" : 19,
    "endLineNumber" : 2219,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 2220,
    "startColumnNumber" : 72,
    "endLineNumber" : 2220,
    "endColumnNumber" : 79
  }, {
    "charLength" : 7,
    "startLineNumber" : 2256,
    "startColumnNumber" : 19,
    "endLineNumber" : 2256,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 2257,
    "startColumnNumber" : 64,
    "endLineNumber" : 2257,
    "endColumnNumber" : 71
  }, {
    "charLength" : 7,
    "startLineNumber" : 2260,
    "startColumnNumber" : 19,
    "endLineNumber" : 2260,
    "endColumnNumber" : 26
  }, {
    "charLength" : 7,
    "startLineNumber" : 2261,
    "startColumnNumber" : 75,
    "endLineNumber" : 2261,
    "endColumnNumber" : 82
  }, {
    "charLength" : 7,
    "startLineNumber" : 2263,
    "startColumnNumber" : 75,
    "endLineNumber" : 2263,
    "endColumnNumber" : 82
  } ],
  "layoutRelationDataList" : [ {
    "firstKey" : 0,
    "secondKey" : 1,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 2,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 3,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 4,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 5,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 6,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 7,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 8,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 9,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 10,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 11,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 12,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 13,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 14,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 15,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 16,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 18,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 19,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 20,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 21,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 22,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 23,
    "layout" : 2
  }, {
    "firstKey" : 0,
    "secondKey" : 24,
    "layout" : 2
  }, {
    "firstKey" : 1,
    "secondKey" : 0,
    "layout" : 2
  }, {
    "firstKey" : 1,
    "secondKey" : 2,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 3,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 4,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 5,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 6,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 7,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 8,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 9,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 10,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 11,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 12,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 13,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 14,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 15,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 16,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 17,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 1,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 2,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 2,
    "secondKey" : 1,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 2,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 3,
    "secondKey" : 0,
    "layout" : 3
  }, {
    "firstKey" : 3,
    "secondKey" : 1,
    "layout" : 2
  }, {
    "firstKey" : 3,
    "secondKey" : 2,
    "layout" : 2
  }, {
    "firstKey" : 3,
    "secondKey" : 4,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 5,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 6,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 7,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 8,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 9,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 10,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 11,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 12,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 13,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 14,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 15,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 16,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 17,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 3,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 4,
    "secondKey" : 0,
    "layout" : 6
  }, {
    "firstKey" : 4,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 4,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 4,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 4,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 5,
    "secondKey" : 0,
    "layout" : 4
  }, {
    "firstKey" : 5,
    "secondKey" : 1,
    "layout" : 3
  }, {
    "firstKey" : 5,
    "secondKey" : 2,
    "layout" : 3
  }, {
    "firstKey" : 5,
    "secondKey" : 3,
    "layout" : 2
  }, {
    "firstKey" : 5,
    "secondKey" : 4,
    "layout" : 2
  }, {
    "firstKey" : 5,
    "secondKey" : 6,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 7,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 8,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 9,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 10,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 11,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 12,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 13,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 14,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 15,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 16,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 17,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 5,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 6,
    "secondKey" : 0,
    "layout" : 7
  }, {
    "firstKey" : 6,
    "secondKey" : 1,
    "layout" : 6
  }, {
    "firstKey" : 6,
    "secondKey" : 2,
    "layout" : 6
  }, {
    "firstKey" : 6,
    "secondKey" : 3,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 6,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 6,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 7,
    "secondKey" : 0,
    "layout" : 5
  }, {
    "firstKey" : 7,
    "secondKey" : 1,
    "layout" : 4
  }, {
    "firstKey" : 7,
    "secondKey" : 2,
    "layout" : 4
  }, {
    "firstKey" : 7,
    "secondKey" : 3,
    "layout" : 3
  }, {
    "firstKey" : 7,
    "secondKey" : 4,
    "layout" : 3
  }, {
    "firstKey" : 7,
    "secondKey" : 5,
    "layout" : 2
  }, {
    "firstKey" : 7,
    "secondKey" : 6,
    "layout" : 2
  }, {
    "firstKey" : 7,
    "secondKey" : 8,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 9,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 10,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 11,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 12,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 13,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 14,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 15,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 16,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 17,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 7,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 8,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 8,
    "secondKey" : 1,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 2,
    "layout" : 7
  }, {
    "firstKey" : 8,
    "secondKey" : 3,
    "layout" : 6
  }, {
    "firstKey" : 8,
    "secondKey" : 4,
    "layout" : 6
  }, {
    "firstKey" : 8,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 8,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 8,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 8,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 9,
    "secondKey" : 0,
    "layout" : 6
  }, {
    "firstKey" : 9,
    "secondKey" : 1,
    "layout" : 5
  }, {
    "firstKey" : 9,
    "secondKey" : 2,
    "layout" : 5
  }, {
    "firstKey" : 9,
    "secondKey" : 3,
    "layout" : 4
  }, {
    "firstKey" : 9,
    "secondKey" : 4,
    "layout" : 4
  }, {
    "firstKey" : 9,
    "secondKey" : 5,
    "layout" : 3
  }, {
    "firstKey" : 9,
    "secondKey" : 6,
    "layout" : 3
  }, {
    "firstKey" : 9,
    "secondKey" : 7,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 8,
    "layout" : 2
  }, {
    "firstKey" : 9,
    "secondKey" : 10,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 11,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 12,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 13,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 14,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 15,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 16,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 17,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 9,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 10,
    "secondKey" : 0,
    "layout" : 9
  }, {
    "firstKey" : 10,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 10,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 10,
    "secondKey" : 3,
    "layout" : 7
  }, {
    "firstKey" : 10,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 10,
    "secondKey" : 5,
    "layout" : 6
  }, {
    "firstKey" : 10,
    "secondKey" : 6,
    "layout" : 6
  }, {
    "firstKey" : 10,
    "secondKey" : 7,
    "layout" : 5
  }, {
    "firstKey" : 10,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 10,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 10,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 11,
    "secondKey" : 0,
    "layout" : 7
  }, {
    "firstKey" : 11,
    "secondKey" : 1,
    "layout" : 6
  }, {
    "firstKey" : 11,
    "secondKey" : 2,
    "layout" : 6
  }, {
    "firstKey" : 11,
    "secondKey" : 3,
    "layout" : 5
  }, {
    "firstKey" : 11,
    "secondKey" : 4,
    "layout" : 5
  }, {
    "firstKey" : 11,
    "secondKey" : 5,
    "layout" : 4
  }, {
    "firstKey" : 11,
    "secondKey" : 6,
    "layout" : 4
  }, {
    "firstKey" : 11,
    "secondKey" : 7,
    "layout" : 3
  }, {
    "firstKey" : 11,
    "secondKey" : 8,
    "layout" : 3
  }, {
    "firstKey" : 11,
    "secondKey" : 9,
    "layout" : 2
  }, {
    "firstKey" : 11,
    "secondKey" : 10,
    "layout" : 2
  }, {
    "firstKey" : 11,
    "secondKey" : 12,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 13,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 14,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 15,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 16,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 17,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 11,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 12,
    "secondKey" : 0,
    "layout" : 10
  }, {
    "firstKey" : 12,
    "secondKey" : 1,
    "layout" : 9
  }, {
    "firstKey" : 12,
    "secondKey" : 2,
    "layout" : 9
  }, {
    "firstKey" : 12,
    "secondKey" : 3,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 12,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 12,
    "secondKey" : 7,
    "layout" : 6
  }, {
    "firstKey" : 12,
    "secondKey" : 8,
    "layout" : 6
  }, {
    "firstKey" : 12,
    "secondKey" : 9,
    "layout" : 5
  }, {
    "firstKey" : 12,
    "secondKey" : 10,
    "layout" : 5
  }, {
    "firstKey" : 12,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 12,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 0,
    "layout" : 8
  }, {
    "firstKey" : 13,
    "secondKey" : 1,
    "layout" : 7
  }, {
    "firstKey" : 13,
    "secondKey" : 2,
    "layout" : 7
  }, {
    "firstKey" : 13,
    "secondKey" : 3,
    "layout" : 6
  }, {
    "firstKey" : 13,
    "secondKey" : 4,
    "layout" : 6
  }, {
    "firstKey" : 13,
    "secondKey" : 5,
    "layout" : 5
  }, {
    "firstKey" : 13,
    "secondKey" : 6,
    "layout" : 5
  }, {
    "firstKey" : 13,
    "secondKey" : 7,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 8,
    "layout" : 4
  }, {
    "firstKey" : 13,
    "secondKey" : 9,
    "layout" : 3
  }, {
    "firstKey" : 13,
    "secondKey" : 10,
    "layout" : 3
  }, {
    "firstKey" : 13,
    "secondKey" : 11,
    "layout" : 2
  }, {
    "firstKey" : 13,
    "secondKey" : 12,
    "layout" : 2
  }, {
    "firstKey" : 13,
    "secondKey" : 14,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 15,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 16,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 17,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 13,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 0,
    "layout" : 9
  }, {
    "firstKey" : 14,
    "secondKey" : 1,
    "layout" : 8
  }, {
    "firstKey" : 14,
    "secondKey" : 2,
    "layout" : 8
  }, {
    "firstKey" : 14,
    "secondKey" : 3,
    "layout" : 7
  }, {
    "firstKey" : 14,
    "secondKey" : 4,
    "layout" : 7
  }, {
    "firstKey" : 14,
    "secondKey" : 5,
    "layout" : 6
  }, {
    "firstKey" : 14,
    "secondKey" : 6,
    "layout" : 6
  }, {
    "firstKey" : 14,
    "secondKey" : 7,
    "layout" : 5
  }, {
    "firstKey" : 14,
    "secondKey" : 8,
    "layout" : 5
  }, {
    "firstKey" : 14,
    "secondKey" : 9,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 10,
    "layout" : 4
  }, {
    "firstKey" : 14,
    "secondKey" : 11,
    "layout" : 3
  }, {
    "firstKey" : 14,
    "secondKey" : 12,
    "layout" : 3
  }, {
    "firstKey" : 14,
    "secondKey" : 13,
    "layout" : 2
  }, {
    "firstKey" : 14,
    "secondKey" : 15,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 16,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 17,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 14,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 15,
    "secondKey" : 0,
    "layout" : 10
  }, {
    "firstKey" : 15,
    "secondKey" : 1,
    "layout" : 9
  }, {
    "firstKey" : 15,
    "secondKey" : 2,
    "layout" : 9
  }, {
    "firstKey" : 15,
    "secondKey" : 3,
    "layout" : 8
  }, {
    "firstKey" : 15,
    "secondKey" : 4,
    "layout" : 8
  }, {
    "firstKey" : 15,
    "secondKey" : 5,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 6,
    "layout" : 7
  }, {
    "firstKey" : 15,
    "secondKey" : 7,
    "layout" : 6
  }, {
    "firstKey" : 15,
    "secondKey" : 8,
    "layout" : 6
  }, {
    "firstKey" : 15,
    "secondKey" : 9,
    "layout" : 5
  }, {
    "firstKey" : 15,
    "secondKey" : 10,
    "layout" : 5
  }, {
    "firstKey" : 15,
    "secondKey" : 11,
    "layout" : 4
  }, {
    "firstKey" : 15,
    "secondKey" : 12,
    "layout" : 4
  }, {
    "firstKey" : 15,
    "secondKey" : 13,
    "layout" : 3
  }, {
    "firstKey" : 15,
    "secondKey" : 14,
    "layout" : 2
  }, {
    "firstKey" : 15,
    "secondKey" : 16,
    "layout" : 1
  }, {
    "firstKey" : 15,
    "secondKey" : 17,
    "layout" : 1
  }, {
    "firstKey" : 15,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 15,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 15,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 15,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 15,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 15,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 15,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 16,
    "secondKey" : 0,
    "layout" : 13
  }, {
    "firstKey" : 16,
    "secondKey" : 1,
    "layout" : 12
  }, {
    "firstKey" : 16,
    "secondKey" : 2,
    "layout" : 12
  }, {
    "firstKey" : 16,
    "secondKey" : 3,
    "layout" : 11
  }, {
    "firstKey" : 16,
    "secondKey" : 4,
    "layout" : 11
  }, {
    "firstKey" : 16,
    "secondKey" : 5,
    "layout" : 10
  }, {
    "firstKey" : 16,
    "secondKey" : 6,
    "layout" : 10
  }, {
    "firstKey" : 16,
    "secondKey" : 7,
    "layout" : 9
  }, {
    "firstKey" : 16,
    "secondKey" : 8,
    "layout" : 9
  }, {
    "firstKey" : 16,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 16,
    "secondKey" : 10,
    "layout" : 8
  }, {
    "firstKey" : 16,
    "secondKey" : 11,
    "layout" : 7
  }, {
    "firstKey" : 16,
    "secondKey" : 12,
    "layout" : 7
  }, {
    "firstKey" : 16,
    "secondKey" : 13,
    "layout" : 6
  }, {
    "firstKey" : 16,
    "secondKey" : 14,
    "layout" : 5
  }, {
    "firstKey" : 16,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 19,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 16,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 17,
    "secondKey" : 0,
    "layout" : 11
  }, {
    "firstKey" : 17,
    "secondKey" : 1,
    "layout" : 10
  }, {
    "firstKey" : 17,
    "secondKey" : 2,
    "layout" : 10
  }, {
    "firstKey" : 17,
    "secondKey" : 3,
    "layout" : 9
  }, {
    "firstKey" : 17,
    "secondKey" : 4,
    "layout" : 9
  }, {
    "firstKey" : 17,
    "secondKey" : 5,
    "layout" : 8
  }, {
    "firstKey" : 17,
    "secondKey" : 6,
    "layout" : 8
  }, {
    "firstKey" : 17,
    "secondKey" : 7,
    "layout" : 7
  }, {
    "firstKey" : 17,
    "secondKey" : 8,
    "layout" : 7
  }, {
    "firstKey" : 17,
    "secondKey" : 9,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 10,
    "layout" : 6
  }, {
    "firstKey" : 17,
    "secondKey" : 11,
    "layout" : 5
  }, {
    "firstKey" : 17,
    "secondKey" : 12,
    "layout" : 5
  }, {
    "firstKey" : 17,
    "secondKey" : 13,
    "layout" : 4
  }, {
    "firstKey" : 17,
    "secondKey" : 14,
    "layout" : 3
  }, {
    "firstKey" : 17,
    "secondKey" : 15,
    "layout" : 2
  }, {
    "firstKey" : 17,
    "secondKey" : 16,
    "layout" : 2
  }, {
    "firstKey" : 17,
    "secondKey" : 18,
    "layout" : 1
  }, {
    "firstKey" : 17,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 17,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 17,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 17,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 17,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 17,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 18,
    "secondKey" : 0,
    "layout" : 12
  }, {
    "firstKey" : 18,
    "secondKey" : 1,
    "layout" : 11
  }, {
    "firstKey" : 18,
    "secondKey" : 2,
    "layout" : 11
  }, {
    "firstKey" : 18,
    "secondKey" : 3,
    "layout" : 10
  }, {
    "firstKey" : 18,
    "secondKey" : 4,
    "layout" : 10
  }, {
    "firstKey" : 18,
    "secondKey" : 5,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 6,
    "layout" : 9
  }, {
    "firstKey" : 18,
    "secondKey" : 7,
    "layout" : 8
  }, {
    "firstKey" : 18,
    "secondKey" : 8,
    "layout" : 8
  }, {
    "firstKey" : 18,
    "secondKey" : 9,
    "layout" : 7
  }, {
    "firstKey" : 18,
    "secondKey" : 10,
    "layout" : 7
  }, {
    "firstKey" : 18,
    "secondKey" : 11,
    "layout" : 6
  }, {
    "firstKey" : 18,
    "secondKey" : 12,
    "layout" : 6
  }, {
    "firstKey" : 18,
    "secondKey" : 13,
    "layout" : 5
  }, {
    "firstKey" : 18,
    "secondKey" : 14,
    "layout" : 4
  }, {
    "firstKey" : 18,
    "secondKey" : 15,
    "layout" : 3
  }, {
    "firstKey" : 18,
    "secondKey" : 16,
    "layout" : 3
  }, {
    "firstKey" : 18,
    "secondKey" : 17,
    "layout" : 2
  }, {
    "firstKey" : 18,
    "secondKey" : 19,
    "layout" : 1
  }, {
    "firstKey" : 18,
    "secondKey" : 20,
    "layout" : 1
  }, {
    "firstKey" : 18,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 18,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 18,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 18,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 19,
    "secondKey" : 0,
    "layout" : 15
  }, {
    "firstKey" : 19,
    "secondKey" : 1,
    "layout" : 14
  }, {
    "firstKey" : 19,
    "secondKey" : 2,
    "layout" : 14
  }, {
    "firstKey" : 19,
    "secondKey" : 3,
    "layout" : 13
  }, {
    "firstKey" : 19,
    "secondKey" : 4,
    "layout" : 13
  }, {
    "firstKey" : 19,
    "secondKey" : 5,
    "layout" : 12
  }, {
    "firstKey" : 19,
    "secondKey" : 6,
    "layout" : 12
  }, {
    "firstKey" : 19,
    "secondKey" : 7,
    "layout" : 11
  }, {
    "firstKey" : 19,
    "secondKey" : 8,
    "layout" : 11
  }, {
    "firstKey" : 19,
    "secondKey" : 9,
    "layout" : 10
  }, {
    "firstKey" : 19,
    "secondKey" : 10,
    "layout" : 10
  }, {
    "firstKey" : 19,
    "secondKey" : 11,
    "layout" : 9
  }, {
    "firstKey" : 19,
    "secondKey" : 12,
    "layout" : 9
  }, {
    "firstKey" : 19,
    "secondKey" : 13,
    "layout" : 8
  }, {
    "firstKey" : 19,
    "secondKey" : 14,
    "layout" : 7
  }, {
    "firstKey" : 19,
    "secondKey" : 15,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 16,
    "layout" : 6
  }, {
    "firstKey" : 19,
    "secondKey" : 17,
    "layout" : 5
  }, {
    "firstKey" : 19,
    "secondKey" : 18,
    "layout" : 4
  }, {
    "firstKey" : 19,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 19,
    "secondKey" : 21,
    "layout" : 4
  }, {
    "firstKey" : 19,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 19,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 19,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 0,
    "layout" : 13
  }, {
    "firstKey" : 20,
    "secondKey" : 1,
    "layout" : 12
  }, {
    "firstKey" : 20,
    "secondKey" : 2,
    "layout" : 12
  }, {
    "firstKey" : 20,
    "secondKey" : 3,
    "layout" : 11
  }, {
    "firstKey" : 20,
    "secondKey" : 4,
    "layout" : 11
  }, {
    "firstKey" : 20,
    "secondKey" : 5,
    "layout" : 10
  }, {
    "firstKey" : 20,
    "secondKey" : 6,
    "layout" : 10
  }, {
    "firstKey" : 20,
    "secondKey" : 7,
    "layout" : 9
  }, {
    "firstKey" : 20,
    "secondKey" : 8,
    "layout" : 9
  }, {
    "firstKey" : 20,
    "secondKey" : 9,
    "layout" : 8
  }, {
    "firstKey" : 20,
    "secondKey" : 10,
    "layout" : 8
  }, {
    "firstKey" : 20,
    "secondKey" : 11,
    "layout" : 7
  }, {
    "firstKey" : 20,
    "secondKey" : 12,
    "layout" : 7
  }, {
    "firstKey" : 20,
    "secondKey" : 13,
    "layout" : 6
  }, {
    "firstKey" : 20,
    "secondKey" : 14,
    "layout" : 5
  }, {
    "firstKey" : 20,
    "secondKey" : 15,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 16,
    "layout" : 4
  }, {
    "firstKey" : 20,
    "secondKey" : 17,
    "layout" : 3
  }, {
    "firstKey" : 20,
    "secondKey" : 18,
    "layout" : 2
  }, {
    "firstKey" : 20,
    "secondKey" : 19,
    "layout" : 2
  }, {
    "firstKey" : 20,
    "secondKey" : 21,
    "layout" : 1
  }, {
    "firstKey" : 20,
    "secondKey" : 22,
    "layout" : 1
  }, {
    "firstKey" : 20,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 20,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 21,
    "secondKey" : 0,
    "layout" : 16
  }, {
    "firstKey" : 21,
    "secondKey" : 1,
    "layout" : 15
  }, {
    "firstKey" : 21,
    "secondKey" : 2,
    "layout" : 15
  }, {
    "firstKey" : 21,
    "secondKey" : 3,
    "layout" : 14
  }, {
    "firstKey" : 21,
    "secondKey" : 4,
    "layout" : 14
  }, {
    "firstKey" : 21,
    "secondKey" : 5,
    "layout" : 13
  }, {
    "firstKey" : 21,
    "secondKey" : 6,
    "layout" : 13
  }, {
    "firstKey" : 21,
    "secondKey" : 7,
    "layout" : 12
  }, {
    "firstKey" : 21,
    "secondKey" : 8,
    "layout" : 12
  }, {
    "firstKey" : 21,
    "secondKey" : 9,
    "layout" : 11
  }, {
    "firstKey" : 21,
    "secondKey" : 10,
    "layout" : 11
  }, {
    "firstKey" : 21,
    "secondKey" : 11,
    "layout" : 10
  }, {
    "firstKey" : 21,
    "secondKey" : 12,
    "layout" : 10
  }, {
    "firstKey" : 21,
    "secondKey" : 13,
    "layout" : 9
  }, {
    "firstKey" : 21,
    "secondKey" : 14,
    "layout" : 8
  }, {
    "firstKey" : 21,
    "secondKey" : 15,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 16,
    "layout" : 7
  }, {
    "firstKey" : 21,
    "secondKey" : 17,
    "layout" : 6
  }, {
    "firstKey" : 21,
    "secondKey" : 18,
    "layout" : 5
  }, {
    "firstKey" : 21,
    "secondKey" : 19,
    "layout" : 5
  }, {
    "firstKey" : 21,
    "secondKey" : 20,
    "layout" : 4
  }, {
    "firstKey" : 21,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 21,
    "secondKey" : 23,
    "layout" : 4
  }, {
    "firstKey" : 21,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 22,
    "secondKey" : 0,
    "layout" : 14
  }, {
    "firstKey" : 22,
    "secondKey" : 1,
    "layout" : 13
  }, {
    "firstKey" : 22,
    "secondKey" : 2,
    "layout" : 13
  }, {
    "firstKey" : 22,
    "secondKey" : 3,
    "layout" : 12
  }, {
    "firstKey" : 22,
    "secondKey" : 4,
    "layout" : 12
  }, {
    "firstKey" : 22,
    "secondKey" : 5,
    "layout" : 11
  }, {
    "firstKey" : 22,
    "secondKey" : 6,
    "layout" : 11
  }, {
    "firstKey" : 22,
    "secondKey" : 7,
    "layout" : 10
  }, {
    "firstKey" : 22,
    "secondKey" : 8,
    "layout" : 10
  }, {
    "firstKey" : 22,
    "secondKey" : 9,
    "layout" : 9
  }, {
    "firstKey" : 22,
    "secondKey" : 10,
    "layout" : 9
  }, {
    "firstKey" : 22,
    "secondKey" : 11,
    "layout" : 8
  }, {
    "firstKey" : 22,
    "secondKey" : 12,
    "layout" : 8
  }, {
    "firstKey" : 22,
    "secondKey" : 13,
    "layout" : 7
  }, {
    "firstKey" : 22,
    "secondKey" : 14,
    "layout" : 6
  }, {
    "firstKey" : 22,
    "secondKey" : 15,
    "layout" : 5
  }, {
    "firstKey" : 22,
    "secondKey" : 16,
    "layout" : 5
  }, {
    "firstKey" : 22,
    "secondKey" : 17,
    "layout" : 4
  }, {
    "firstKey" : 22,
    "secondKey" : 18,
    "layout" : 3
  }, {
    "firstKey" : 22,
    "secondKey" : 19,
    "layout" : 3
  }, {
    "firstKey" : 22,
    "secondKey" : 20,
    "layout" : 2
  }, {
    "firstKey" : 22,
    "secondKey" : 21,
    "layout" : 2
  }, {
    "firstKey" : 22,
    "secondKey" : 23,
    "layout" : 1
  }, {
    "firstKey" : 22,
    "secondKey" : 24,
    "layout" : 1
  }, {
    "firstKey" : 23,
    "secondKey" : 0,
    "layout" : 17
  }, {
    "firstKey" : 23,
    "secondKey" : 1,
    "layout" : 16
  }, {
    "firstKey" : 23,
    "secondKey" : 2,
    "layout" : 16
  }, {
    "firstKey" : 23,
    "secondKey" : 3,
    "layout" : 15
  }, {
    "firstKey" : 23,
    "secondKey" : 4,
    "layout" : 15
  }, {
    "firstKey" : 23,
    "secondKey" : 5,
    "layout" : 14
  }, {
    "firstKey" : 23,
    "secondKey" : 6,
    "layout" : 14
  }, {
    "firstKey" : 23,
    "secondKey" : 7,
    "layout" : 13
  }, {
    "firstKey" : 23,
    "secondKey" : 8,
    "layout" : 13
  }, {
    "firstKey" : 23,
    "secondKey" : 9,
    "layout" : 12
  }, {
    "firstKey" : 23,
    "secondKey" : 10,
    "layout" : 12
  }, {
    "firstKey" : 23,
    "secondKey" : 11,
    "layout" : 11
  }, {
    "firstKey" : 23,
    "secondKey" : 12,
    "layout" : 11
  }, {
    "firstKey" : 23,
    "secondKey" : 13,
    "layout" : 10
  }, {
    "firstKey" : 23,
    "secondKey" : 14,
    "layout" : 9
  }, {
    "firstKey" : 23,
    "secondKey" : 15,
    "layout" : 8
  }, {
    "firstKey" : 23,
    "secondKey" : 16,
    "layout" : 8
  }, {
    "firstKey" : 23,
    "secondKey" : 17,
    "layout" : 7
  }, {
    "firstKey" : 23,
    "secondKey" : 18,
    "layout" : 6
  }, {
    "firstKey" : 23,
    "secondKey" : 19,
    "layout" : 6
  }, {
    "firstKey" : 23,
    "secondKey" : 20,
    "layout" : 5
  }, {
    "firstKey" : 23,
    "secondKey" : 21,
    "layout" : 5
  }, {
    "firstKey" : 23,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 23,
    "secondKey" : 24,
    "layout" : 4
  }, {
    "firstKey" : 24,
    "secondKey" : 0,
    "layout" : 17
  }, {
    "firstKey" : 24,
    "secondKey" : 1,
    "layout" : 16
  }, {
    "firstKey" : 24,
    "secondKey" : 2,
    "layout" : 16
  }, {
    "firstKey" : 24,
    "secondKey" : 3,
    "layout" : 15
  }, {
    "firstKey" : 24,
    "secondKey" : 4,
    "layout" : 15
  }, {
    "firstKey" : 24,
    "secondKey" : 5,
    "layout" : 14
  }, {
    "firstKey" : 24,
    "secondKey" : 6,
    "layout" : 14
  }, {
    "firstKey" : 24,
    "secondKey" : 7,
    "layout" : 13
  }, {
    "firstKey" : 24,
    "secondKey" : 8,
    "layout" : 13
  }, {
    "firstKey" : 24,
    "secondKey" : 9,
    "layout" : 12
  }, {
    "firstKey" : 24,
    "secondKey" : 10,
    "layout" : 12
  }, {
    "firstKey" : 24,
    "secondKey" : 11,
    "layout" : 11
  }, {
    "firstKey" : 24,
    "secondKey" : 12,
    "layout" : 11
  }, {
    "firstKey" : 24,
    "secondKey" : 13,
    "layout" : 10
  }, {
    "firstKey" : 24,
    "secondKey" : 14,
    "layout" : 9
  }, {
    "firstKey" : 24,
    "secondKey" : 15,
    "layout" : 8
  }, {
    "firstKey" : 24,
    "secondKey" : 16,
    "layout" : 8
  }, {
    "firstKey" : 24,
    "secondKey" : 17,
    "layout" : 7
  }, {
    "firstKey" : 24,
    "secondKey" : 18,
    "layout" : 6
  }, {
    "firstKey" : 24,
    "secondKey" : 19,
    "layout" : 6
  }, {
    "firstKey" : 24,
    "secondKey" : 20,
    "layout" : 5
  }, {
    "firstKey" : 24,
    "secondKey" : 21,
    "layout" : 5
  }, {
    "firstKey" : 24,
    "secondKey" : 22,
    "layout" : 4
  }, {
    "firstKey" : 24,
    "secondKey" : 23,
    "layout" : 4
  } ]
}