{
  "id" : 479,
  "expression" : "message.subSequence(0,150)",
  "projectName" : "DrKLO@Telegram",
  "commitID" : "11fbfb1329df700b203e1852a71c4c11b5ab12f4",
  "filePath" : "/TMessagesProj/src/main/java/org/telegram/ui/MessageStatisticActivity.java",
  "occurrences" : 1,
  "isArithmeticExpression" : 0,
  "isGetTypeMethod" : 0,
  "expressionList" : [ {
    "nodeContext" : "message.subSequence(0,150)",
    "nodeType" : "MethodInvocation",
    "nodePosition" : {
      "charLength" : 27,
      "startLineNumber" : 405,
      "startColumnNumber" : 26,
      "endLineNumber" : 405,
      "endColumnNumber" : 53
    },
    "astNodeNumber" : 5,
    "astHeight" : 2,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 37,
        "startLineNumber" : 405,
        "startColumnNumber" : 16,
        "endLineNumber" : 405,
        "endColumnNumber" : 53
      },
      "nodeContext" : "message=message.subSequence(0,150)",
      "nodeType" : "Assignment",
      "astNodeNumber" : 7,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 38,
        "startLineNumber" : 405,
        "startColumnNumber" : 16,
        "endLineNumber" : 405,
        "endColumnNumber" : 54
      },
      "nodeContext" : "message=message.subSequence(0,150);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 70,
        "startLineNumber" : 404,
        "startColumnNumber" : 40,
        "endLineNumber" : 406,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  message=message.subSequence(0,150);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 9,
      "astHeight" : 5
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 98,
        "startLineNumber" : 404,
        "startColumnNumber" : 12,
        "endLineNumber" : 406,
        "endColumnNumber" : 13
      },
      "nodeContext" : "if (message.length() > 150) {\n  message=message.subSequence(0,150);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 15,
      "astHeight" : 6
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 328,
        "startLineNumber" : 402,
        "startColumnNumber" : 75,
        "endLineNumber" : 408,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  message=messageObject.messageText;\n  if (message.length() > 150) {\n    message=message.subSequence(0,150);\n  }\n  message=Emoji.replaceEmoji(message,avatarContainer.getSubtitleTextView().getTextPaint().getFontMetricsInt(),AndroidUtilities.dp(17),false);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 41,
      "astHeight" : 8
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 454,
        "startLineNumber" : 402,
        "startColumnNumber" : 15,
        "endLineNumber" : 410,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (!TextUtils.isEmpty(messageObject.messageOwner.message)) {\n  message=messageObject.messageText;\n  if (message.length() > 150) {\n    message=message.subSequence(0,150);\n  }\n  message=Emoji.replaceEmoji(message,avatarContainer.getSubtitleTextView().getTextPaint().getFontMetricsInt(),AndroidUtilities.dp(17),false);\n}\n else {\n  message=messageObject.messageText;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 58,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 563,
        "startLineNumber" : 400,
        "startColumnNumber" : 8,
        "endLineNumber" : 410,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (!TextUtils.isEmpty(messageObject.caption)) {\n  message=messageObject.caption;\n}\n else if (!TextUtils.isEmpty(messageObject.messageOwner.message)) {\n  message=messageObject.messageText;\n  if (message.length() > 150) {\n    message=message.subSequence(0,150);\n  }\n  message=Emoji.replaceEmoji(message,avatarContainer.getSubtitleTextView().getTextPaint().getFontMetricsInt(),AndroidUtilities.dp(17),false);\n}\n else {\n  message=messageObject.messageText;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 73,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 12172,
        "startLineNumber" : 236,
        "startColumnNumber" : 44,
        "endLineNumber" : 462,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  actionBar.setBackButtonImage(R.drawable.ic_ab_back);\n  fragmentView=new FrameLayout(context);\n  fragmentView.setBackgroundColor(Theme.getColor(Theme.key_windowBackgroundGray));\n  FrameLayout frameLayout=(FrameLayout)fragmentView;\n  emptyView=new EmptyTextProgressView(context);\n  emptyView.setText(LocaleController.getString(\"NoResult\",R.string.NoResult));\n  emptyView.setVisibility(View.GONE);\n  progressLayout=new LinearLayout(context);\n  progressLayout.setOrientation(LinearLayout.VERTICAL);\n  imageView=new RLottieImageView(context);\n  imageView.setAutoRepeat(true);\n  imageView.setAnimation(R.raw.statistic_preload,120,120);\n  imageView.playAnimation();\n  TextView loadingTitle=new TextView(context);\n  loadingTitle.setTextSize(20);\n  loadingTitle.setTypeface(AndroidUtilities.getTypeface(\"fonts/rmedium.ttf\"));\n  loadingTitle.setTextColor(Theme.getColor(Theme.key_player_actionBarTitle));\n  loadingTitle.setTag(Theme.key_player_actionBarTitle);\n  loadingTitle.setText(LocaleController.getString(\"LoadingStats\",R.string.LoadingStats));\n  loadingTitle.setGravity(Gravity.CENTER_HORIZONTAL);\n  TextView loadingSubtitle=new TextView(context);\n  loadingSubtitle.setTextSize(15);\n  loadingSubtitle.setTextColor(Theme.getColor(Theme.key_player_actionBarSubtitle));\n  loadingSubtitle.setTag(Theme.key_player_actionBarSubtitle);\n  loadingSubtitle.setText(LocaleController.getString(\"LoadingStatsDescription\",R.string.LoadingStatsDescription));\n  loadingSubtitle.setGravity(Gravity.CENTER_HORIZONTAL);\n  progressLayout.addView(imageView,LayoutHelper.createLinear(120,120,Gravity.CENTER_HORIZONTAL,0,0,0,20));\n  progressLayout.addView(loadingTitle,LayoutHelper.createLinear(LayoutHelper.WRAP_CONTENT,LayoutHelper.WRAP_CONTENT,Gravity.CENTER_HORIZONTAL,0,0,0,10));\n  progressLayout.addView(loadingSubtitle,LayoutHelper.createLinear(LayoutHelper.WRAP_CONTENT,LayoutHelper.WRAP_CONTENT,Gravity.CENTER_HORIZONTAL));\n  progressLayout.setAlpha(0);\n  frameLayout.addView(progressLayout,LayoutHelper.createFrame(240,LayoutHelper.WRAP_CONTENT,Gravity.CENTER,0,0,0,30));\n  listView=new RecyclerListView(context);\n  listView.setLayoutManager(layoutManager=new LinearLayoutManager(context,LinearLayoutManager.VERTICAL,false));\n  ((SimpleItemAnimator)listView.getItemAnimator()).setSupportsChangeAnimations(false);\n  listView.setAdapter(listViewAdapter=new ListAdapter(context));\n  listView.setVerticalScrollbarPosition(LocaleController.isRTL ? RecyclerListView.SCROLLBAR_POSITION_LEFT : RecyclerListView.SCROLLBAR_POSITION_RIGHT);\n  listView.setOnItemClickListener((view,position) -> {\n    if (position >= startRow && position < endRow) {\n      TLRPC.Message message=messages.get(position - startRow);\n      int did=(int)MessageObject.getDialogId(message);\n      Bundle args=new Bundle();\n      if (did > 0) {\n        args.putInt(\"user_id\",did);\n      }\n else {\n        args.putInt(\"chat_id\",-did);\n      }\n      args.putInt(\"message_id\",message.id);\n      args.putBoolean(\"need_remove_previous_same_chat_activity\",false);\n      if (getMessagesController().checkCanOpenChat(args,this)) {\n        presentFragment(new ChatActivity(args));\n      }\n    }\n  }\n);\n  listView.setOnScrollListener(new RecyclerView.OnScrollListener(){\n    @Override public void onScrollStateChanged(    RecyclerView recyclerView,    int newState){\n    }\n    @Override public void onScrolled(    RecyclerView recyclerView,    int dx,    int dy){\n      int firstVisibleItem=layoutManager.findFirstVisibleItemPosition();\n      int visibleItemCount=firstVisibleItem == RecyclerView.NO_POSITION ? 0 : Math.abs(layoutManager.findLastVisibleItemPosition() - firstVisibleItem) + 1;\n      int totalItemCount=recyclerView.getAdapter().getItemCount();\n      if (visibleItemCount > 0) {\n        if (!endReached && !loading && !messages.isEmpty()&& firstVisibleItem + visibleItemCount >= totalItemCount - 5 && statsLoaded) {\n          loadChats(100);\n        }\n      }\n    }\n  }\n);\n  emptyView.showTextView();\n  listContainer=new FrameLayout(context);\n  listContainer.addView(listView,LayoutHelper.createFrame(LayoutHelper.MATCH_PARENT,LayoutHelper.MATCH_PARENT));\n  listContainer.addView(emptyView,LayoutHelper.createFrame(LayoutHelper.MATCH_PARENT,LayoutHelper.MATCH_PARENT));\n  listContainer.setVisibility(View.GONE);\n  frameLayout.addView(listContainer,LayoutHelper.createFrame(LayoutHelper.MATCH_PARENT,LayoutHelper.MATCH_PARENT));\n  AndroidUtilities.runOnUIThread(showProgressbar,300);\n  updateRows();\n  listView.setEmptyView(emptyView);\n  avatarContainer=new ChatAvatarContainer(context,null,false){\n    @Override protected void dispatchDraw(    Canvas canvas){\n      super.dispatchDraw(canvas);\n      thumbImage.setImageCoords(avatarContainer.getSubtitleTextView().getX(),avatarContainer.getSubtitleTextView().getY(),AndroidUtilities.dp(18),AndroidUtilities.dp(18));\n      thumbImage.draw(canvas);\n      if (drawPlay) {\n        int x=(int)(thumbImage.getCenterX() - Theme.dialogs_playDrawable.getIntrinsicWidth() / 2);\n        int y=(int)(thumbImage.getCenterY() - Theme.dialogs_playDrawable.getIntrinsicHeight() / 2);\n        Theme.dialogs_playDrawable.setBounds(x,y,x + Theme.dialogs_playDrawable.getIntrinsicWidth(),y + Theme.dialogs_playDrawable.getIntrinsicHeight());\n        Theme.dialogs_playDrawable.draw(canvas);\n      }\n    }\n    @Override protected void onAttachedToWindow(){\n      super.onAttachedToWindow();\n      thumbImage.onAttachedToWindow();\n    }\n    @Override protected void onDetachedFromWindow(){\n      super.onDetachedFromWindow();\n      thumbImage.onDetachedFromWindow();\n    }\n  }\n;\n  thumbImage=new ImageReceiver();\n  thumbImage.setParentView(avatarContainer);\n  thumbImage.setRoundRadius(AndroidUtilities.dp(2));\n  actionBar.addView(avatarContainer,0,LayoutHelper.createFrame(LayoutHelper.WRAP_CONTENT,LayoutHelper.MATCH_PARENT,Gravity.TOP | Gravity.LEFT,!inPreviewMode ? 56 : 0,0,40,0));\n  TLRPC.Chat chatLocal=getMessagesController().getChat(chatId);\n  if (chatLocal != null) {\n    avatarContainer.setChatAvatar(chatLocal);\n    avatarContainer.setTitle(chatLocal.title);\n  }\n  boolean hasThumb=false;\n  if (!messageObject.needDrawBluredPreview() && (messageObject.isPhoto() || messageObject.isNewGif() || messageObject.isVideo())) {\n    String type=messageObject.isWebpage() ? messageObject.messageOwner.media.webpage.type : null;\n    if (!(\"app\".equals(type) || \"profile\".equals(type) || \"article\".equals(type))) {\n      TLRPC.PhotoSize smallThumb=FileLoader.getClosestPhotoSizeWithSize(messageObject.photoThumbs,40);\n      TLRPC.PhotoSize bigThumb=FileLoader.getClosestPhotoSizeWithSize(messageObject.photoThumbs,AndroidUtilities.getPhotoSize());\n      if (smallThumb == bigThumb) {\n        bigThumb=null;\n      }\n      if (smallThumb != null) {\n        hasThumb=true;\n        drawPlay=messageObject.isVideo();\n        String fileName=FileLoader.getAttachFileName(bigThumb);\n        if (messageObject.mediaExists || DownloadController.getInstance(currentAccount).canDownloadMedia(messageObject) || FileLoader.getInstance(currentAccount).isLoadingFile(fileName)) {\n          int size;\n          if (messageObject.type == MessageObject.TYPE_PHOTO) {\n            size=bigThumb != null ? bigThumb.size : 0;\n          }\n else {\n            size=0;\n          }\n          thumbImage.setImage(ImageLocation.getForObject(bigThumb,messageObject.photoThumbsObject),\"20_20\",ImageLocation.getForObject(smallThumb,messageObject.photoThumbsObject),\"20_20\",size,null,messageObject,0);\n        }\n else {\n          thumbImage.setImage(null,null,ImageLocation.getForObject(smallThumb,messageObject.photoThumbsObject),\"20_20\",null,messageObject,0);\n        }\n      }\n    }\n  }\n  CharSequence message;\n  if (!TextUtils.isEmpty(messageObject.caption)) {\n    message=messageObject.caption;\n  }\n else   if (!TextUtils.isEmpty(messageObject.messageOwner.message)) {\n    message=messageObject.messageText;\n    if (message.length() > 150) {\n      message=message.subSequence(0,150);\n    }\n    message=Emoji.replaceEmoji(message,avatarContainer.getSubtitleTextView().getTextPaint().getFontMetricsInt(),AndroidUtilities.dp(17),false);\n  }\n else {\n    message=messageObject.messageText;\n  }\n  if (hasThumb) {\n    SpannableStringBuilder builder=new SpannableStringBuilder(message);\n    builder.insert(0,\" \");\n    builder.setSpan(new DialogCell.FixedWidthSpan(AndroidUtilities.dp(18 + 6)),0,1,Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);\n    avatarContainer.setSubtitle(builder);\n  }\n else {\n    avatarContainer.setSubtitle(messageObject.messageText);\n  }\n  actionBar.setBackButtonDrawable(new BackDrawable(false));\n  actionBar.setActionBarMenuOnItemClick(new ActionBar.ActionBarMenuOnItemClick(){\n    @Override public void onItemClick(    final int id){\n      if (id == -1) {\n        finishFragment();\n      }\n else       if (id == 1) {\n        Bundle args=new Bundle();\n        if (messageObject.messageOwner.fwd_from == null) {\n          args.putInt(\"chat_id\",messageObject.getChatId());\n        }\n else {\n          args.putInt(\"chat_id\",-messageObject.getFromChatId());\n        }\n        presentFragment(new StatisticActivity(args));\n      }\n    }\n  }\n);\n  avatarContainer.setTitleColors(Theme.getColor(Theme.key_player_actionBarTitle),Theme.getColor(Theme.key_player_actionBarSubtitle));\n  avatarContainer.getSubtitleTextView().setLinkTextColor(Theme.getColor(Theme.key_player_actionBarSubtitle));\n  actionBar.setItemsColor(Theme.getColor(Theme.key_windowBackgroundWhiteGrayText2),false);\n  actionBar.setItemsBackgroundColor(Theme.getColor(Theme.key_actionBarActionModeDefaultSelector),false);\n  actionBar.setBackgroundColor(Theme.getColor(Theme.key_windowBackgroundWhite));\n  avatarContainer.setOnClickListener(view -> {\n    if (getParentLayout().fragmentsStack.size() > 1) {\n      BaseFragment previousFragemnt=getParentLayout().fragmentsStack.get(getParentLayout().fragmentsStack.size() - 2);\n      if (previousFragemnt instanceof ChatActivity && ((ChatActivity)previousFragemnt).getCurrentChat().id == chatId) {\n        finishFragment();\n        return;\n      }\n    }\n    Bundle args=new Bundle();\n    args.putInt(\"chat_id\",chatId);\n    args.putInt(\"message_id\",messageId);\n    args.putBoolean(\"need_remove_previous_same_chat_activity\",false);\n    ChatActivity a=new ChatActivity(args);\n    presentFragment(a);\n  }\n);\n  updateMenu();\n  return fragmentView;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 1444,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 12226,
        "startLineNumber" : 235,
        "startColumnNumber" : 4,
        "endLineNumber" : 462,
        "endColumnNumber" : 5
      },
      "nodeContext" : "@Override public View createView(Context context){\n  actionBar.setBackButtonImage(R.drawable.ic_ab_back);\n  fragmentView=new FrameLayout(context);\n  fragmentView.setBackgroundColor(Theme.getColor(Theme.key_windowBackgroundGray));\n  FrameLayout frameLayout=(FrameLayout)fragmentView;\n  emptyView=new EmptyTextProgressView(context);\n  emptyView.setText(LocaleController.getString(\"NoResult\",R.string.NoResult));\n  emptyView.setVisibility(View.GONE);\n  progressLayout=new LinearLayout(context);\n  progressLayout.setOrientation(LinearLayout.VERTICAL);\n  imageView=new RLottieImageView(context);\n  imageView.setAutoRepeat(true);\n  imageView.setAnimation(R.raw.statistic_preload,120,120);\n  imageView.playAnimation();\n  TextView loadingTitle=new TextView(context);\n  loadingTitle.setTextSize(20);\n  loadingTitle.setTypeface(AndroidUtilities.getTypeface(\"fonts/rmedium.ttf\"));\n  loadingTitle.setTextColor(Theme.getColor(Theme.key_player_actionBarTitle));\n  loadingTitle.setTag(Theme.key_player_actionBarTitle);\n  loadingTitle.setText(LocaleController.getString(\"LoadingStats\",R.string.LoadingStats));\n  loadingTitle.setGravity(Gravity.CENTER_HORIZONTAL);\n  TextView loadingSubtitle=new TextView(context);\n  loadingSubtitle.setTextSize(15);\n  loadingSubtitle.setTextColor(Theme.getColor(Theme.key_player_actionBarSubtitle));\n  loadingSubtitle.setTag(Theme.key_player_actionBarSubtitle);\n  loadingSubtitle.setText(LocaleController.getString(\"LoadingStatsDescription\",R.string.LoadingStatsDescription));\n  loadingSubtitle.setGravity(Gravity.CENTER_HORIZONTAL);\n  progressLayout.addView(imageView,LayoutHelper.createLinear(120,120,Gravity.CENTER_HORIZONTAL,0,0,0,20));\n  progressLayout.addView(loadingTitle,LayoutHelper.createLinear(LayoutHelper.WRAP_CONTENT,LayoutHelper.WRAP_CONTENT,Gravity.CENTER_HORIZONTAL,0,0,0,10));\n  progressLayout.addView(loadingSubtitle,LayoutHelper.createLinear(LayoutHelper.WRAP_CONTENT,LayoutHelper.WRAP_CONTENT,Gravity.CENTER_HORIZONTAL));\n  progressLayout.setAlpha(0);\n  frameLayout.addView(progressLayout,LayoutHelper.createFrame(240,LayoutHelper.WRAP_CONTENT,Gravity.CENTER,0,0,0,30));\n  listView=new RecyclerListView(context);\n  listView.setLayoutManager(layoutManager=new LinearLayoutManager(context,LinearLayoutManager.VERTICAL,false));\n  ((SimpleItemAnimator)listView.getItemAnimator()).setSupportsChangeAnimations(false);\n  listView.setAdapter(listViewAdapter=new ListAdapter(context));\n  listView.setVerticalScrollbarPosition(LocaleController.isRTL ? RecyclerListView.SCROLLBAR_POSITION_LEFT : RecyclerListView.SCROLLBAR_POSITION_RIGHT);\n  listView.setOnItemClickListener((view,position) -> {\n    if (position >= startRow && position < endRow) {\n      TLRPC.Message message=messages.get(position - startRow);\n      int did=(int)MessageObject.getDialogId(message);\n      Bundle args=new Bundle();\n      if (did > 0) {\n        args.putInt(\"user_id\",did);\n      }\n else {\n        args.putInt(\"chat_id\",-did);\n      }\n      args.putInt(\"message_id\",message.id);\n      args.putBoolean(\"need_remove_previous_same_chat_activity\",false);\n      if (getMessagesController().checkCanOpenChat(args,this)) {\n        presentFragment(new ChatActivity(args));\n      }\n    }\n  }\n);\n  listView.setOnScrollListener(new RecyclerView.OnScrollListener(){\n    @Override public void onScrollStateChanged(    RecyclerView recyclerView,    int newState){\n    }\n    @Override public void onScrolled(    RecyclerView recyclerView,    int dx,    int dy){\n      int firstVisibleItem=layoutManager.findFirstVisibleItemPosition();\n      int visibleItemCount=firstVisibleItem == RecyclerView.NO_POSITION ? 0 : Math.abs(layoutManager.findLastVisibleItemPosition() - firstVisibleItem) + 1;\n      int totalItemCount=recyclerView.getAdapter().getItemCount();\n      if (visibleItemCount > 0) {\n        if (!endReached && !loading && !messages.isEmpty()&& firstVisibleItem + visibleItemCount >= totalItemCount - 5 && statsLoaded) {\n          loadChats(100);\n        }\n      }\n    }\n  }\n);\n  emptyView.showTextView();\n  listContainer=new FrameLayout(context);\n  listContainer.addView(listView,LayoutHelper.createFrame(LayoutHelper.MATCH_PARENT,LayoutHelper.MATCH_PARENT));\n  listContainer.addView(emptyView,LayoutHelper.createFrame(LayoutHelper.MATCH_PARENT,LayoutHelper.MATCH_PARENT));\n  listContainer.setVisibility(View.GONE);\n  frameLayout.addView(listContainer,LayoutHelper.createFrame(LayoutHelper.MATCH_PARENT,LayoutHelper.MATCH_PARENT));\n  AndroidUtilities.runOnUIThread(showProgressbar,300);\n  updateRows();\n  listView.setEmptyView(emptyView);\n  avatarContainer=new ChatAvatarContainer(context,null,false){\n    @Override protected void dispatchDraw(    Canvas canvas){\n      super.dispatchDraw(canvas);\n      thumbImage.setImageCoords(avatarContainer.getSubtitleTextView().getX(),avatarContainer.getSubtitleTextView().getY(),AndroidUtilities.dp(18),AndroidUtilities.dp(18));\n      thumbImage.draw(canvas);\n      if (drawPlay) {\n        int x=(int)(thumbImage.getCenterX() - Theme.dialogs_playDrawable.getIntrinsicWidth() / 2);\n        int y=(int)(thumbImage.getCenterY() - Theme.dialogs_playDrawable.getIntrinsicHeight() / 2);\n        Theme.dialogs_playDrawable.setBounds(x,y,x + Theme.dialogs_playDrawable.getIntrinsicWidth(),y + Theme.dialogs_playDrawable.getIntrinsicHeight());\n        Theme.dialogs_playDrawable.draw(canvas);\n      }\n    }\n    @Override protected void onAttachedToWindow(){\n      super.onAttachedToWindow();\n      thumbImage.onAttachedToWindow();\n    }\n    @Override protected void onDetachedFromWindow(){\n      super.onDetachedFromWindow();\n      thumbImage.onDetachedFromWindow();\n    }\n  }\n;\n  thumbImage=new ImageReceiver();\n  thumbImage.setParentView(avatarContainer);\n  thumbImage.setRoundRadius(AndroidUtilities.dp(2));\n  actionBar.addView(avatarContainer,0,LayoutHelper.createFrame(LayoutHelper.WRAP_CONTENT,LayoutHelper.MATCH_PARENT,Gravity.TOP | Gravity.LEFT,!inPreviewMode ? 56 : 0,0,40,0));\n  TLRPC.Chat chatLocal=getMessagesController().getChat(chatId);\n  if (chatLocal != null) {\n    avatarContainer.setChatAvatar(chatLocal);\n    avatarContainer.setTitle(chatLocal.title);\n  }\n  boolean hasThumb=false;\n  if (!messageObject.needDrawBluredPreview() && (messageObject.isPhoto() || messageObject.isNewGif() || messageObject.isVideo())) {\n    String type=messageObject.isWebpage() ? messageObject.messageOwner.media.webpage.type : null;\n    if (!(\"app\".equals(type) || \"profile\".equals(type) || \"article\".equals(type))) {\n      TLRPC.PhotoSize smallThumb=FileLoader.getClosestPhotoSizeWithSize(messageObject.photoThumbs,40);\n      TLRPC.PhotoSize bigThumb=FileLoader.getClosestPhotoSizeWithSize(messageObject.photoThumbs,AndroidUtilities.getPhotoSize());\n      if (smallThumb == bigThumb) {\n        bigThumb=null;\n      }\n      if (smallThumb != null) {\n        hasThumb=true;\n        drawPlay=messageObject.isVideo();\n        String fileName=FileLoader.getAttachFileName(bigThumb);\n        if (messageObject.mediaExists || DownloadController.getInstance(currentAccount).canDownloadMedia(messageObject) || FileLoader.getInstance(currentAccount).isLoadingFile(fileName)) {\n          int size;\n          if (messageObject.type == MessageObject.TYPE_PHOTO) {\n            size=bigThumb != null ? bigThumb.size : 0;\n          }\n else {\n            size=0;\n          }\n          thumbImage.setImage(ImageLocation.getForObject(bigThumb,messageObject.photoThumbsObject),\"20_20\",ImageLocation.getForObject(smallThumb,messageObject.photoThumbsObject),\"20_20\",size,null,messageObject,0);\n        }\n else {\n          thumbImage.setImage(null,null,ImageLocation.getForObject(smallThumb,messageObject.photoThumbsObject),\"20_20\",null,messageObject,0);\n        }\n      }\n    }\n  }\n  CharSequence message;\n  if (!TextUtils.isEmpty(messageObject.caption)) {\n    message=messageObject.caption;\n  }\n else   if (!TextUtils.isEmpty(messageObject.messageOwner.message)) {\n    message=messageObject.messageText;\n    if (message.length() > 150) {\n      message=message.subSequence(0,150);\n    }\n    message=Emoji.replaceEmoji(message,avatarContainer.getSubtitleTextView().getTextPaint().getFontMetricsInt(),AndroidUtilities.dp(17),false);\n  }\n else {\n    message=messageObject.messageText;\n  }\n  if (hasThumb) {\n    SpannableStringBuilder builder=new SpannableStringBuilder(message);\n    builder.insert(0,\" \");\n    builder.setSpan(new DialogCell.FixedWidthSpan(AndroidUtilities.dp(18 + 6)),0,1,Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);\n    avatarContainer.setSubtitle(builder);\n  }\n else {\n    avatarContainer.setSubtitle(messageObject.messageText);\n  }\n  actionBar.setBackButtonDrawable(new BackDrawable(false));\n  actionBar.setActionBarMenuOnItemClick(new ActionBar.ActionBarMenuOnItemClick(){\n    @Override public void onItemClick(    final int id){\n      if (id == -1) {\n        finishFragment();\n      }\n else       if (id == 1) {\n        Bundle args=new Bundle();\n        if (messageObject.messageOwner.fwd_from == null) {\n          args.putInt(\"chat_id\",messageObject.getChatId());\n        }\n else {\n          args.putInt(\"chat_id\",-messageObject.getFromChatId());\n        }\n        presentFragment(new StatisticActivity(args));\n      }\n    }\n  }\n);\n  avatarContainer.setTitleColors(Theme.getColor(Theme.key_player_actionBarTitle),Theme.getColor(Theme.key_player_actionBarSubtitle));\n  avatarContainer.getSubtitleTextView().setLinkTextColor(Theme.getColor(Theme.key_player_actionBarSubtitle));\n  actionBar.setItemsColor(Theme.getColor(Theme.key_windowBackgroundWhiteGrayText2),false);\n  actionBar.setItemsBackgroundColor(Theme.getColor(Theme.key_actionBarActionModeDefaultSelector),false);\n  actionBar.setBackgroundColor(Theme.getColor(Theme.key_windowBackgroundWhite));\n  avatarContainer.setOnClickListener(view -> {\n    if (getParentLayout().fragmentsStack.size() > 1) {\n      BaseFragment previousFragemnt=getParentLayout().fragmentsStack.get(getParentLayout().fragmentsStack.size() - 2);\n      if (previousFragemnt instanceof ChatActivity && ((ChatActivity)previousFragemnt).getCurrentChat().id == chatId) {\n        finishFragment();\n        return;\n      }\n    }\n    Bundle args=new Bundle();\n    args.putInt(\"chat_id\",chatId);\n    args.putInt(\"message_id\",messageId);\n    args.putBoolean(\"need_remove_previous_same_chat_activity\",false);\n    ChatActivity a=new ChatActivity(args);\n    presentFragment(a);\n  }\n);\n  updateMenu();\n  return fragmentView;\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 1455,
      "astHeight" : 19
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 38,
        "startLineNumber" : 405,
        "startColumnNumber" : 16,
        "endLineNumber" : 405,
        "endColumnNumber" : 54
      },
      "nodeContext" : "message=message.subSequence(0,150);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 8,
      "astHeight" : 4
    },
    "tokenLength" : 4,
    "type" : "java.lang.CharSequence"
  } ],
  "positionList" : [ {
    "charLength" : 27,
    "startLineNumber" : 405,
    "startColumnNumber" : 26,
    "endLineNumber" : 405,
    "endColumnNumber" : 53
  } ],
  "layoutRelationDataList" : [ ]
}