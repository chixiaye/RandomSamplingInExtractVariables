{
  "id" : 281,
  "expression" : "INSERT_OR_UPDATE",
  "projectName" : "thingsboard@thingsboard",
  "commitID" : "7c2b3a9fbf84cc58aa7546029c5c7c10a662c55a",
  "filePath" : "/dao/src/main/java/org/thingsboard/server/dao/sqlts/insert/latest/psql/PsqlLatestInsertTsRepository.java",
  "occurrences" : 1,
  "isArithmeticExpression" : 0,
  "isGetTypeMethod" : 0,
  "expressionList" : [ {
    "nodeContext" : "INSERT_OR_UPDATE",
    "nodeType" : "SimpleName",
    "nodePosition" : {
      "charLength" : 16,
      "startLineNumber" : 61,
      "startColumnNumber" : 96,
      "endLineNumber" : 61,
      "endColumnNumber" : 112
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.VariableDeclarationFragment,initializer]",
      "nodePosition" : {
        "charLength" : 67,
        "startLineNumber" : 61,
        "startColumnNumber" : 45,
        "endLineNumber" : 61,
        "endColumnNumber" : 112
      },
      "nodeContext" : "updateByLatestTs ? INSERT_OR_UPDATE_BY_LATEST_TS : INSERT_OR_UPDATE",
      "nodeType" : "ConditionalExpression",
      "astNodeNumber" : 4,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.VariableDeclarationStatement,fragments]",
      "nodePosition" : {
        "charLength" : 89,
        "startLineNumber" : 61,
        "startColumnNumber" : 23,
        "endLineNumber" : 61,
        "endColumnNumber" : 112
      },
      "nodeContext" : "insertOrUpdateQuery=updateByLatestTs ? INSERT_OR_UPDATE_BY_LATEST_TS : INSERT_OR_UPDATE",
      "nodeType" : "VariableDeclarationFragment",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 97,
        "startLineNumber" : 61,
        "startColumnNumber" : 16,
        "endLineNumber" : 61,
        "endColumnNumber" : 113
      },
      "nodeContext" : "String insertOrUpdateQuery=updateByLatestTs ? INSERT_OR_UPDATE_BY_LATEST_TS : INSERT_OR_UPDATE;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 9,
      "astHeight" : 4
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 5093,
        "startLineNumber" : 59,
        "startColumnNumber" : 82,
        "endLineNumber" : 167,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  String batchUpdateQuery=updateByLatestTs ? BATCH_UPDATE_BY_LATEST_TS : BATCH_UPDATE;\n  String insertOrUpdateQuery=updateByLatestTs ? INSERT_OR_UPDATE_BY_LATEST_TS : INSERT_OR_UPDATE;\n  int[] result=jdbcTemplate.batchUpdate(batchUpdateQuery,new BatchPreparedStatementSetter(){\n    @Override public void setValues(    PreparedStatement ps,    int i) throws SQLException {\n      TsKvLatestEntity tsKvLatestEntity=entities.get(i);\n      ps.setLong(1,tsKvLatestEntity.getTs());\n      if (tsKvLatestEntity.getBooleanValue() != null) {\n        ps.setBoolean(2,tsKvLatestEntity.getBooleanValue());\n      }\n else {\n        ps.setNull(2,Types.BOOLEAN);\n      }\n      ps.setString(3,replaceNullChars(tsKvLatestEntity.getStrValue()));\n      if (tsKvLatestEntity.getLongValue() != null) {\n        ps.setLong(4,tsKvLatestEntity.getLongValue());\n      }\n else {\n        ps.setNull(4,Types.BIGINT);\n      }\n      if (tsKvLatestEntity.getDoubleValue() != null) {\n        ps.setDouble(5,tsKvLatestEntity.getDoubleValue());\n      }\n else {\n        ps.setNull(5,Types.DOUBLE);\n      }\n      ps.setString(6,replaceNullChars(tsKvLatestEntity.getJsonValue()));\n      ps.setObject(7,tsKvLatestEntity.getEntityId());\n      ps.setInt(8,tsKvLatestEntity.getKey());\n      if (updateByLatestTs) {\n        ps.setLong(9,tsKvLatestEntity.getTs());\n      }\n    }\n    @Override public int getBatchSize(){\n      return entities.size();\n    }\n  }\n);\n  int updatedCount=0;\n  for (int i=0; i < result.length; i++) {\n    if (result[i] == 0) {\n      updatedCount++;\n    }\n  }\n  List<TsKvLatestEntity> insertEntities=new ArrayList<>(updatedCount);\n  for (int i=0; i < result.length; i++) {\n    if (result[i] == 0) {\n      insertEntities.add(entities.get(i));\n    }\n  }\n  jdbcTemplate.batchUpdate(insertOrUpdateQuery,new BatchPreparedStatementSetter(){\n    @Override public void setValues(    PreparedStatement ps,    int i) throws SQLException {\n      TsKvLatestEntity tsKvLatestEntity=insertEntities.get(i);\n      ps.setObject(1,tsKvLatestEntity.getEntityId());\n      ps.setInt(2,tsKvLatestEntity.getKey());\n      ps.setLong(3,tsKvLatestEntity.getTs());\n      ps.setLong(9,tsKvLatestEntity.getTs());\n      if (updateByLatestTs) {\n        ps.setLong(15,tsKvLatestEntity.getTs());\n      }\n      if (tsKvLatestEntity.getBooleanValue() != null) {\n        ps.setBoolean(4,tsKvLatestEntity.getBooleanValue());\n        ps.setBoolean(10,tsKvLatestEntity.getBooleanValue());\n      }\n else {\n        ps.setNull(4,Types.BOOLEAN);\n        ps.setNull(10,Types.BOOLEAN);\n      }\n      ps.setString(5,replaceNullChars(tsKvLatestEntity.getStrValue()));\n      ps.setString(11,replaceNullChars(tsKvLatestEntity.getStrValue()));\n      if (tsKvLatestEntity.getLongValue() != null) {\n        ps.setLong(6,tsKvLatestEntity.getLongValue());\n        ps.setLong(12,tsKvLatestEntity.getLongValue());\n      }\n else {\n        ps.setNull(6,Types.BIGINT);\n        ps.setNull(12,Types.BIGINT);\n      }\n      if (tsKvLatestEntity.getDoubleValue() != null) {\n        ps.setDouble(7,tsKvLatestEntity.getDoubleValue());\n        ps.setDouble(13,tsKvLatestEntity.getDoubleValue());\n      }\n else {\n        ps.setNull(7,Types.DOUBLE);\n        ps.setNull(13,Types.DOUBLE);\n      }\n      ps.setString(8,replaceNullChars(tsKvLatestEntity.getJsonValue()));\n      ps.setString(14,replaceNullChars(tsKvLatestEntity.getJsonValue()));\n    }\n    @Override public int getBatchSize(){\n      return insertEntities.size();\n    }\n  }\n);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 515,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.AnonymousClassDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 5185,
        "startLineNumber" : 58,
        "startColumnNumber" : 12,
        "endLineNumber" : 167,
        "endColumnNumber" : 13
      },
      "nodeContext" : "@Override protected void doInTransactionWithoutResult(TransactionStatus status){\n  String batchUpdateQuery=updateByLatestTs ? BATCH_UPDATE_BY_LATEST_TS : BATCH_UPDATE;\n  String insertOrUpdateQuery=updateByLatestTs ? INSERT_OR_UPDATE_BY_LATEST_TS : INSERT_OR_UPDATE;\n  int[] result=jdbcTemplate.batchUpdate(batchUpdateQuery,new BatchPreparedStatementSetter(){\n    @Override public void setValues(    PreparedStatement ps,    int i) throws SQLException {\n      TsKvLatestEntity tsKvLatestEntity=entities.get(i);\n      ps.setLong(1,tsKvLatestEntity.getTs());\n      if (tsKvLatestEntity.getBooleanValue() != null) {\n        ps.setBoolean(2,tsKvLatestEntity.getBooleanValue());\n      }\n else {\n        ps.setNull(2,Types.BOOLEAN);\n      }\n      ps.setString(3,replaceNullChars(tsKvLatestEntity.getStrValue()));\n      if (tsKvLatestEntity.getLongValue() != null) {\n        ps.setLong(4,tsKvLatestEntity.getLongValue());\n      }\n else {\n        ps.setNull(4,Types.BIGINT);\n      }\n      if (tsKvLatestEntity.getDoubleValue() != null) {\n        ps.setDouble(5,tsKvLatestEntity.getDoubleValue());\n      }\n else {\n        ps.setNull(5,Types.DOUBLE);\n      }\n      ps.setString(6,replaceNullChars(tsKvLatestEntity.getJsonValue()));\n      ps.setObject(7,tsKvLatestEntity.getEntityId());\n      ps.setInt(8,tsKvLatestEntity.getKey());\n      if (updateByLatestTs) {\n        ps.setLong(9,tsKvLatestEntity.getTs());\n      }\n    }\n    @Override public int getBatchSize(){\n      return entities.size();\n    }\n  }\n);\n  int updatedCount=0;\n  for (int i=0; i < result.length; i++) {\n    if (result[i] == 0) {\n      updatedCount++;\n    }\n  }\n  List<TsKvLatestEntity> insertEntities=new ArrayList<>(updatedCount);\n  for (int i=0; i < result.length; i++) {\n    if (result[i] == 0) {\n      insertEntities.add(entities.get(i));\n    }\n  }\n  jdbcTemplate.batchUpdate(insertOrUpdateQuery,new BatchPreparedStatementSetter(){\n    @Override public void setValues(    PreparedStatement ps,    int i) throws SQLException {\n      TsKvLatestEntity tsKvLatestEntity=insertEntities.get(i);\n      ps.setObject(1,tsKvLatestEntity.getEntityId());\n      ps.setInt(2,tsKvLatestEntity.getKey());\n      ps.setLong(3,tsKvLatestEntity.getTs());\n      ps.setLong(9,tsKvLatestEntity.getTs());\n      if (updateByLatestTs) {\n        ps.setLong(15,tsKvLatestEntity.getTs());\n      }\n      if (tsKvLatestEntity.getBooleanValue() != null) {\n        ps.setBoolean(4,tsKvLatestEntity.getBooleanValue());\n        ps.setBoolean(10,tsKvLatestEntity.getBooleanValue());\n      }\n else {\n        ps.setNull(4,Types.BOOLEAN);\n        ps.setNull(10,Types.BOOLEAN);\n      }\n      ps.setString(5,replaceNullChars(tsKvLatestEntity.getStrValue()));\n      ps.setString(11,replaceNullChars(tsKvLatestEntity.getStrValue()));\n      if (tsKvLatestEntity.getLongValue() != null) {\n        ps.setLong(6,tsKvLatestEntity.getLongValue());\n        ps.setLong(12,tsKvLatestEntity.getLongValue());\n      }\n else {\n        ps.setNull(6,Types.BIGINT);\n        ps.setNull(12,Types.BIGINT);\n      }\n      if (tsKvLatestEntity.getDoubleValue() != null) {\n        ps.setDouble(7,tsKvLatestEntity.getDoubleValue());\n        ps.setDouble(13,tsKvLatestEntity.getDoubleValue());\n      }\n else {\n        ps.setNull(7,Types.DOUBLE);\n        ps.setNull(13,Types.DOUBLE);\n      }\n      ps.setString(8,replaceNullChars(tsKvLatestEntity.getJsonValue()));\n      ps.setString(14,replaceNullChars(tsKvLatestEntity.getJsonValue()));\n    }\n    @Override public int getBatchSize(){\n      return insertEntities.size();\n    }\n  }\n);\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 525,
      "astHeight" : 15
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 97,
        "startLineNumber" : 61,
        "startColumnNumber" : 16,
        "endLineNumber" : 61,
        "endColumnNumber" : 113
      },
      "nodeContext" : "String insertOrUpdateQuery=updateByLatestTs ? INSERT_OR_UPDATE_BY_LATEST_TS : INSERT_OR_UPDATE;\n",
      "nodeType" : "VariableDeclarationStatement",
      "astNodeNumber" : 9,
      "astHeight" : 4
    },
    "tokenLength" : 3,
    "type" : "java.lang.String"
  } ],
  "positionList" : [ {
    "charLength" : 16,
    "startLineNumber" : 61,
    "startColumnNumber" : 96,
    "endLineNumber" : 61,
    "endColumnNumber" : 112
  } ],
  "layoutRelationDataList" : [ ]
}