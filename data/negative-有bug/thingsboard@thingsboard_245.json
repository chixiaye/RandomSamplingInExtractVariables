{
  "id" : 245,
  "expression" : "\"unassignedCustomerId\"",
  "projectName" : "thingsboard@thingsboard",
  "commitID" : "7c2b3a9fbf84cc58aa7546029c5c7c10a662c55a",
  "filePath" : "/application/src/main/java/org/thingsboard/server/service/action/EntityActionService.java",
  "occurrences" : 1,
  "isArithmeticExpression" : 0,
  "isGetTypeMethod" : 0,
  "expressionList" : [ {
    "nodeContext" : "\"unassignedCustomerId\"",
    "nodeType" : "StringLiteral",
    "nodePosition" : {
      "charLength" : 22,
      "startLineNumber" : 137,
      "startColumnNumber" : 38,
      "endLineNumber" : 137,
      "endColumnNumber" : 60
    },
    "astNodeNumber" : 1,
    "astHeight" : 1,
    "parentDataList" : [ {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.ExpressionStatement,expression]",
      "nodePosition" : {
        "charLength" : 56,
        "startLineNumber" : 137,
        "startColumnNumber" : 20,
        "endLineNumber" : 137,
        "endColumnNumber" : 76
      },
      "nodeContext" : "metaData.putValue(\"unassignedCustomerId\",strCustomerId)",
      "nodeType" : "MethodInvocation",
      "astNodeNumber" : 5,
      "astHeight" : 2
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 57,
        "startLineNumber" : 137,
        "startColumnNumber" : 20,
        "endLineNumber" : 137,
        "endColumnNumber" : 77
      },
      "nodeContext" : "metaData.putValue(\"unassignedCustomerId\",strCustomerId);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 6,
      "astHeight" : 3
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 369,
        "startLineNumber" : 134,
        "startColumnNumber" : 78,
        "endLineNumber" : 139,
        "endColumnNumber" : 17
      },
      "nodeContext" : "{\n  String strCustomerId=extractParameter(String.class,1,additionalInfo);\n  String strCustomerName=extractParameter(String.class,2,additionalInfo);\n  metaData.putValue(\"unassignedCustomerId\",strCustomerId);\n  metaData.putValue(\"unassignedCustomerName\",strCustomerName);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 37,
      "astHeight" : 7
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,elseStatement]",
      "nodePosition" : {
        "charLength" : 2050,
        "startLineNumber" : 134,
        "startColumnNumber" : 23,
        "endLineNumber" : 159,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (actionType == ActionType.UNASSIGNED_FROM_CUSTOMER) {\n  String strCustomerId=extractParameter(String.class,1,additionalInfo);\n  String strCustomerName=extractParameter(String.class,2,additionalInfo);\n  metaData.putValue(\"unassignedCustomerId\",strCustomerId);\n  metaData.putValue(\"unassignedCustomerName\",strCustomerName);\n}\n else if (actionType == ActionType.ASSIGNED_FROM_TENANT) {\n  String strTenantId=extractParameter(String.class,0,additionalInfo);\n  String strTenantName=extractParameter(String.class,1,additionalInfo);\n  metaData.putValue(\"assignedFromTenantId\",strTenantId);\n  metaData.putValue(\"assignedFromTenantName\",strTenantName);\n}\n else if (actionType == ActionType.ASSIGNED_TO_TENANT) {\n  String strTenantId=extractParameter(String.class,0,additionalInfo);\n  String strTenantName=extractParameter(String.class,1,additionalInfo);\n  metaData.putValue(\"assignedToTenantId\",strTenantId);\n  metaData.putValue(\"assignedToTenantName\",strTenantName);\n}\n else if (actionType == ActionType.ASSIGNED_TO_EDGE) {\n  String strEdgeId=extractParameter(String.class,1,additionalInfo);\n  String strEdgeName=extractParameter(String.class,2,additionalInfo);\n  metaData.putValue(\"assignedEdgeId\",strEdgeId);\n  metaData.putValue(\"assignedEdgeName\",strEdgeName);\n}\n else if (actionType == ActionType.UNASSIGNED_FROM_EDGE) {\n  String strEdgeId=extractParameter(String.class,1,additionalInfo);\n  String strEdgeName=extractParameter(String.class,2,additionalInfo);\n  metaData.putValue(\"unassignedEdgeId\",strEdgeId);\n  metaData.putValue(\"unassignedEdgeName\",strEdgeName);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 215,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2472,
        "startLineNumber" : 129,
        "startColumnNumber" : 16,
        "endLineNumber" : 159,
        "endColumnNumber" : 17
      },
      "nodeContext" : "if (actionType == ActionType.ASSIGNED_TO_CUSTOMER) {\n  String strCustomerId=extractParameter(String.class,1,additionalInfo);\n  String strCustomerName=extractParameter(String.class,2,additionalInfo);\n  metaData.putValue(\"assignedCustomerId\",strCustomerId);\n  metaData.putValue(\"assignedCustomerName\",strCustomerName);\n}\n else if (actionType == ActionType.UNASSIGNED_FROM_CUSTOMER) {\n  String strCustomerId=extractParameter(String.class,1,additionalInfo);\n  String strCustomerName=extractParameter(String.class,2,additionalInfo);\n  metaData.putValue(\"unassignedCustomerId\",strCustomerId);\n  metaData.putValue(\"unassignedCustomerName\",strCustomerName);\n}\n else if (actionType == ActionType.ASSIGNED_FROM_TENANT) {\n  String strTenantId=extractParameter(String.class,0,additionalInfo);\n  String strTenantName=extractParameter(String.class,1,additionalInfo);\n  metaData.putValue(\"assignedFromTenantId\",strTenantId);\n  metaData.putValue(\"assignedFromTenantName\",strTenantName);\n}\n else if (actionType == ActionType.ASSIGNED_TO_TENANT) {\n  String strTenantId=extractParameter(String.class,0,additionalInfo);\n  String strTenantName=extractParameter(String.class,1,additionalInfo);\n  metaData.putValue(\"assignedToTenantId\",strTenantId);\n  metaData.putValue(\"assignedToTenantName\",strTenantName);\n}\n else if (actionType == ActionType.ASSIGNED_TO_EDGE) {\n  String strEdgeId=extractParameter(String.class,1,additionalInfo);\n  String strEdgeName=extractParameter(String.class,2,additionalInfo);\n  metaData.putValue(\"assignedEdgeId\",strEdgeId);\n  metaData.putValue(\"assignedEdgeName\",strEdgeName);\n}\n else if (actionType == ActionType.UNASSIGNED_FROM_EDGE) {\n  String strEdgeId=extractParameter(String.class,1,additionalInfo);\n  String strEdgeName=extractParameter(String.class,2,additionalInfo);\n  metaData.putValue(\"unassignedEdgeId\",strEdgeId);\n  metaData.putValue(\"unassignedEdgeName\",strEdgeName);\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 258,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.TryStatement,body]",
      "nodePosition" : {
        "charLength" : 5981,
        "startLineNumber" : 120,
        "startColumnNumber" : 16,
        "endLineNumber" : 209,
        "endColumnNumber" : 13
      },
      "nodeContext" : "{\n  TbMsgMetaData metaData=new TbMsgMetaData();\n  if (user != null) {\n    metaData.putValue(\"userId\",user.getId().toString());\n    metaData.putValue(\"userName\",user.getName());\n  }\n  if (customerId != null && !customerId.isNullUid()) {\n    metaData.putValue(\"customerId\",customerId.toString());\n  }\n  if (actionType == ActionType.ASSIGNED_TO_CUSTOMER) {\n    String strCustomerId=extractParameter(String.class,1,additionalInfo);\n    String strCustomerName=extractParameter(String.class,2,additionalInfo);\n    metaData.putValue(\"assignedCustomerId\",strCustomerId);\n    metaData.putValue(\"assignedCustomerName\",strCustomerName);\n  }\n else   if (actionType == ActionType.UNASSIGNED_FROM_CUSTOMER) {\n    String strCustomerId=extractParameter(String.class,1,additionalInfo);\n    String strCustomerName=extractParameter(String.class,2,additionalInfo);\n    metaData.putValue(\"unassignedCustomerId\",strCustomerId);\n    metaData.putValue(\"unassignedCustomerName\",strCustomerName);\n  }\n else   if (actionType == ActionType.ASSIGNED_FROM_TENANT) {\n    String strTenantId=extractParameter(String.class,0,additionalInfo);\n    String strTenantName=extractParameter(String.class,1,additionalInfo);\n    metaData.putValue(\"assignedFromTenantId\",strTenantId);\n    metaData.putValue(\"assignedFromTenantName\",strTenantName);\n  }\n else   if (actionType == ActionType.ASSIGNED_TO_TENANT) {\n    String strTenantId=extractParameter(String.class,0,additionalInfo);\n    String strTenantName=extractParameter(String.class,1,additionalInfo);\n    metaData.putValue(\"assignedToTenantId\",strTenantId);\n    metaData.putValue(\"assignedToTenantName\",strTenantName);\n  }\n else   if (actionType == ActionType.ASSIGNED_TO_EDGE) {\n    String strEdgeId=extractParameter(String.class,1,additionalInfo);\n    String strEdgeName=extractParameter(String.class,2,additionalInfo);\n    metaData.putValue(\"assignedEdgeId\",strEdgeId);\n    metaData.putValue(\"assignedEdgeName\",strEdgeName);\n  }\n else   if (actionType == ActionType.UNASSIGNED_FROM_EDGE) {\n    String strEdgeId=extractParameter(String.class,1,additionalInfo);\n    String strEdgeName=extractParameter(String.class,2,additionalInfo);\n    metaData.putValue(\"unassignedEdgeId\",strEdgeId);\n    metaData.putValue(\"unassignedEdgeName\",strEdgeName);\n  }\n  ObjectNode entityNode;\n  if (entity != null) {\n    entityNode=json.valueToTree(entity);\n    if (entityId.getEntityType() == EntityType.DASHBOARD) {\n      entityNode.put(\"configuration\",\"\");\n    }\n  }\n else {\n    entityNode=json.createObjectNode();\n    if (actionType == ActionType.ATTRIBUTES_UPDATED) {\n      String scope=extractParameter(String.class,0,additionalInfo);\n      @SuppressWarnings(\"unchecked\") List<AttributeKvEntry> attributes=extractParameter(List.class,1,additionalInfo);\n      metaData.putValue(DataConstants.SCOPE,scope);\n      if (attributes != null) {\n        for (        AttributeKvEntry attr : attributes) {\n          addKvEntry(entityNode,attr);\n        }\n      }\n    }\n else     if (actionType == ActionType.ATTRIBUTES_DELETED) {\n      String scope=extractParameter(String.class,0,additionalInfo);\n      @SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,1,additionalInfo);\n      metaData.putValue(DataConstants.SCOPE,scope);\n      ArrayNode attrsArrayNode=entityNode.putArray(\"attributes\");\n      if (keys != null) {\n        keys.forEach(attrsArrayNode::add);\n      }\n    }\n else     if (actionType == ActionType.TIMESERIES_UPDATED) {\n      @SuppressWarnings(\"unchecked\") List<TsKvEntry> timeseries=extractParameter(List.class,0,additionalInfo);\n      addTimeseries(entityNode,timeseries);\n    }\n else     if (actionType == ActionType.TIMESERIES_DELETED) {\n      @SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,0,additionalInfo);\n      if (keys != null) {\n        ArrayNode timeseriesArrayNode=entityNode.putArray(\"timeseries\");\n        keys.forEach(timeseriesArrayNode::add);\n      }\n      entityNode.put(\"startTs\",extractParameter(Long.class,1,additionalInfo));\n      entityNode.put(\"endTs\",extractParameter(Long.class,2,additionalInfo));\n    }\n  }\n  TbMsg tbMsg=TbMsg.newMsg(msgType,entityId,customerId,metaData,TbMsgDataType.JSON,json.writeValueAsString(entityNode));\n  if (tenantId.isNullUid()) {\n    if (entity instanceof HasTenantId) {\n      tenantId=((HasTenantId)entity).getTenantId();\n    }\n  }\n  tbClusterService.pushMsgToRuleEngine(tenantId,entityId,tbMsg,null);\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 623,
      "astHeight" : 14
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 6128,
        "startLineNumber" : 120,
        "startColumnNumber" : 12,
        "endLineNumber" : 211,
        "endColumnNumber" : 13
      },
      "nodeContext" : "try {\n  TbMsgMetaData metaData=new TbMsgMetaData();\n  if (user != null) {\n    metaData.putValue(\"userId\",user.getId().toString());\n    metaData.putValue(\"userName\",user.getName());\n  }\n  if (customerId != null && !customerId.isNullUid()) {\n    metaData.putValue(\"customerId\",customerId.toString());\n  }\n  if (actionType == ActionType.ASSIGNED_TO_CUSTOMER) {\n    String strCustomerId=extractParameter(String.class,1,additionalInfo);\n    String strCustomerName=extractParameter(String.class,2,additionalInfo);\n    metaData.putValue(\"assignedCustomerId\",strCustomerId);\n    metaData.putValue(\"assignedCustomerName\",strCustomerName);\n  }\n else   if (actionType == ActionType.UNASSIGNED_FROM_CUSTOMER) {\n    String strCustomerId=extractParameter(String.class,1,additionalInfo);\n    String strCustomerName=extractParameter(String.class,2,additionalInfo);\n    metaData.putValue(\"unassignedCustomerId\",strCustomerId);\n    metaData.putValue(\"unassignedCustomerName\",strCustomerName);\n  }\n else   if (actionType == ActionType.ASSIGNED_FROM_TENANT) {\n    String strTenantId=extractParameter(String.class,0,additionalInfo);\n    String strTenantName=extractParameter(String.class,1,additionalInfo);\n    metaData.putValue(\"assignedFromTenantId\",strTenantId);\n    metaData.putValue(\"assignedFromTenantName\",strTenantName);\n  }\n else   if (actionType == ActionType.ASSIGNED_TO_TENANT) {\n    String strTenantId=extractParameter(String.class,0,additionalInfo);\n    String strTenantName=extractParameter(String.class,1,additionalInfo);\n    metaData.putValue(\"assignedToTenantId\",strTenantId);\n    metaData.putValue(\"assignedToTenantName\",strTenantName);\n  }\n else   if (actionType == ActionType.ASSIGNED_TO_EDGE) {\n    String strEdgeId=extractParameter(String.class,1,additionalInfo);\n    String strEdgeName=extractParameter(String.class,2,additionalInfo);\n    metaData.putValue(\"assignedEdgeId\",strEdgeId);\n    metaData.putValue(\"assignedEdgeName\",strEdgeName);\n  }\n else   if (actionType == ActionType.UNASSIGNED_FROM_EDGE) {\n    String strEdgeId=extractParameter(String.class,1,additionalInfo);\n    String strEdgeName=extractParameter(String.class,2,additionalInfo);\n    metaData.putValue(\"unassignedEdgeId\",strEdgeId);\n    metaData.putValue(\"unassignedEdgeName\",strEdgeName);\n  }\n  ObjectNode entityNode;\n  if (entity != null) {\n    entityNode=json.valueToTree(entity);\n    if (entityId.getEntityType() == EntityType.DASHBOARD) {\n      entityNode.put(\"configuration\",\"\");\n    }\n  }\n else {\n    entityNode=json.createObjectNode();\n    if (actionType == ActionType.ATTRIBUTES_UPDATED) {\n      String scope=extractParameter(String.class,0,additionalInfo);\n      @SuppressWarnings(\"unchecked\") List<AttributeKvEntry> attributes=extractParameter(List.class,1,additionalInfo);\n      metaData.putValue(DataConstants.SCOPE,scope);\n      if (attributes != null) {\n        for (        AttributeKvEntry attr : attributes) {\n          addKvEntry(entityNode,attr);\n        }\n      }\n    }\n else     if (actionType == ActionType.ATTRIBUTES_DELETED) {\n      String scope=extractParameter(String.class,0,additionalInfo);\n      @SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,1,additionalInfo);\n      metaData.putValue(DataConstants.SCOPE,scope);\n      ArrayNode attrsArrayNode=entityNode.putArray(\"attributes\");\n      if (keys != null) {\n        keys.forEach(attrsArrayNode::add);\n      }\n    }\n else     if (actionType == ActionType.TIMESERIES_UPDATED) {\n      @SuppressWarnings(\"unchecked\") List<TsKvEntry> timeseries=extractParameter(List.class,0,additionalInfo);\n      addTimeseries(entityNode,timeseries);\n    }\n else     if (actionType == ActionType.TIMESERIES_DELETED) {\n      @SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,0,additionalInfo);\n      if (keys != null) {\n        ArrayNode timeseriesArrayNode=entityNode.putArray(\"timeseries\");\n        keys.forEach(timeseriesArrayNode::add);\n      }\n      entityNode.put(\"startTs\",extractParameter(Long.class,1,additionalInfo));\n      entityNode.put(\"endTs\",extractParameter(Long.class,2,additionalInfo));\n    }\n  }\n  TbMsg tbMsg=TbMsg.newMsg(msgType,entityId,customerId,metaData,TbMsgDataType.JSON,json.writeValueAsString(entityNode));\n  if (tenantId.isNullUid()) {\n    if (entity instanceof HasTenantId) {\n      tenantId=((HasTenantId)entity).getTenantId();\n    }\n  }\n  tbClusterService.pushMsgToRuleEngine(tenantId,entityId,tbMsg,null);\n}\n catch (Exception e) {\n  log.warn(\"[{}] Failed to push entity action to rule engine: {}\",entityId,actionType,e);\n}\n",
      "nodeType" : "TryStatement",
      "astNodeNumber" : 638,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 6152,
        "startLineNumber" : 119,
        "startColumnNumber" : 43,
        "endLineNumber" : 212,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  try {\n    TbMsgMetaData metaData=new TbMsgMetaData();\n    if (user != null) {\n      metaData.putValue(\"userId\",user.getId().toString());\n      metaData.putValue(\"userName\",user.getName());\n    }\n    if (customerId != null && !customerId.isNullUid()) {\n      metaData.putValue(\"customerId\",customerId.toString());\n    }\n    if (actionType == ActionType.ASSIGNED_TO_CUSTOMER) {\n      String strCustomerId=extractParameter(String.class,1,additionalInfo);\n      String strCustomerName=extractParameter(String.class,2,additionalInfo);\n      metaData.putValue(\"assignedCustomerId\",strCustomerId);\n      metaData.putValue(\"assignedCustomerName\",strCustomerName);\n    }\n else     if (actionType == ActionType.UNASSIGNED_FROM_CUSTOMER) {\n      String strCustomerId=extractParameter(String.class,1,additionalInfo);\n      String strCustomerName=extractParameter(String.class,2,additionalInfo);\n      metaData.putValue(\"unassignedCustomerId\",strCustomerId);\n      metaData.putValue(\"unassignedCustomerName\",strCustomerName);\n    }\n else     if (actionType == ActionType.ASSIGNED_FROM_TENANT) {\n      String strTenantId=extractParameter(String.class,0,additionalInfo);\n      String strTenantName=extractParameter(String.class,1,additionalInfo);\n      metaData.putValue(\"assignedFromTenantId\",strTenantId);\n      metaData.putValue(\"assignedFromTenantName\",strTenantName);\n    }\n else     if (actionType == ActionType.ASSIGNED_TO_TENANT) {\n      String strTenantId=extractParameter(String.class,0,additionalInfo);\n      String strTenantName=extractParameter(String.class,1,additionalInfo);\n      metaData.putValue(\"assignedToTenantId\",strTenantId);\n      metaData.putValue(\"assignedToTenantName\",strTenantName);\n    }\n else     if (actionType == ActionType.ASSIGNED_TO_EDGE) {\n      String strEdgeId=extractParameter(String.class,1,additionalInfo);\n      String strEdgeName=extractParameter(String.class,2,additionalInfo);\n      metaData.putValue(\"assignedEdgeId\",strEdgeId);\n      metaData.putValue(\"assignedEdgeName\",strEdgeName);\n    }\n else     if (actionType == ActionType.UNASSIGNED_FROM_EDGE) {\n      String strEdgeId=extractParameter(String.class,1,additionalInfo);\n      String strEdgeName=extractParameter(String.class,2,additionalInfo);\n      metaData.putValue(\"unassignedEdgeId\",strEdgeId);\n      metaData.putValue(\"unassignedEdgeName\",strEdgeName);\n    }\n    ObjectNode entityNode;\n    if (entity != null) {\n      entityNode=json.valueToTree(entity);\n      if (entityId.getEntityType() == EntityType.DASHBOARD) {\n        entityNode.put(\"configuration\",\"\");\n      }\n    }\n else {\n      entityNode=json.createObjectNode();\n      if (actionType == ActionType.ATTRIBUTES_UPDATED) {\n        String scope=extractParameter(String.class,0,additionalInfo);\n        @SuppressWarnings(\"unchecked\") List<AttributeKvEntry> attributes=extractParameter(List.class,1,additionalInfo);\n        metaData.putValue(DataConstants.SCOPE,scope);\n        if (attributes != null) {\n          for (          AttributeKvEntry attr : attributes) {\n            addKvEntry(entityNode,attr);\n          }\n        }\n      }\n else       if (actionType == ActionType.ATTRIBUTES_DELETED) {\n        String scope=extractParameter(String.class,0,additionalInfo);\n        @SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,1,additionalInfo);\n        metaData.putValue(DataConstants.SCOPE,scope);\n        ArrayNode attrsArrayNode=entityNode.putArray(\"attributes\");\n        if (keys != null) {\n          keys.forEach(attrsArrayNode::add);\n        }\n      }\n else       if (actionType == ActionType.TIMESERIES_UPDATED) {\n        @SuppressWarnings(\"unchecked\") List<TsKvEntry> timeseries=extractParameter(List.class,0,additionalInfo);\n        addTimeseries(entityNode,timeseries);\n      }\n else       if (actionType == ActionType.TIMESERIES_DELETED) {\n        @SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,0,additionalInfo);\n        if (keys != null) {\n          ArrayNode timeseriesArrayNode=entityNode.putArray(\"timeseries\");\n          keys.forEach(timeseriesArrayNode::add);\n        }\n        entityNode.put(\"startTs\",extractParameter(Long.class,1,additionalInfo));\n        entityNode.put(\"endTs\",extractParameter(Long.class,2,additionalInfo));\n      }\n    }\n    TbMsg tbMsg=TbMsg.newMsg(msgType,entityId,customerId,metaData,TbMsgDataType.JSON,json.writeValueAsString(entityNode));\n    if (tenantId.isNullUid()) {\n      if (entity instanceof HasTenantId) {\n        tenantId=((HasTenantId)entity).getTenantId();\n      }\n    }\n    tbClusterService.pushMsgToRuleEngine(tenantId,entityId,tbMsg,null);\n  }\n catch (  Exception e) {\n    log.warn(\"[{}] Failed to push entity action to rule engine: {}\",entityId,actionType,e);\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 639,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 6187,
        "startLineNumber" : 119,
        "startColumnNumber" : 8,
        "endLineNumber" : 212,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (!StringUtils.isEmpty(msgType)) {\n  try {\n    TbMsgMetaData metaData=new TbMsgMetaData();\n    if (user != null) {\n      metaData.putValue(\"userId\",user.getId().toString());\n      metaData.putValue(\"userName\",user.getName());\n    }\n    if (customerId != null && !customerId.isNullUid()) {\n      metaData.putValue(\"customerId\",customerId.toString());\n    }\n    if (actionType == ActionType.ASSIGNED_TO_CUSTOMER) {\n      String strCustomerId=extractParameter(String.class,1,additionalInfo);\n      String strCustomerName=extractParameter(String.class,2,additionalInfo);\n      metaData.putValue(\"assignedCustomerId\",strCustomerId);\n      metaData.putValue(\"assignedCustomerName\",strCustomerName);\n    }\n else     if (actionType == ActionType.UNASSIGNED_FROM_CUSTOMER) {\n      String strCustomerId=extractParameter(String.class,1,additionalInfo);\n      String strCustomerName=extractParameter(String.class,2,additionalInfo);\n      metaData.putValue(\"unassignedCustomerId\",strCustomerId);\n      metaData.putValue(\"unassignedCustomerName\",strCustomerName);\n    }\n else     if (actionType == ActionType.ASSIGNED_FROM_TENANT) {\n      String strTenantId=extractParameter(String.class,0,additionalInfo);\n      String strTenantName=extractParameter(String.class,1,additionalInfo);\n      metaData.putValue(\"assignedFromTenantId\",strTenantId);\n      metaData.putValue(\"assignedFromTenantName\",strTenantName);\n    }\n else     if (actionType == ActionType.ASSIGNED_TO_TENANT) {\n      String strTenantId=extractParameter(String.class,0,additionalInfo);\n      String strTenantName=extractParameter(String.class,1,additionalInfo);\n      metaData.putValue(\"assignedToTenantId\",strTenantId);\n      metaData.putValue(\"assignedToTenantName\",strTenantName);\n    }\n else     if (actionType == ActionType.ASSIGNED_TO_EDGE) {\n      String strEdgeId=extractParameter(String.class,1,additionalInfo);\n      String strEdgeName=extractParameter(String.class,2,additionalInfo);\n      metaData.putValue(\"assignedEdgeId\",strEdgeId);\n      metaData.putValue(\"assignedEdgeName\",strEdgeName);\n    }\n else     if (actionType == ActionType.UNASSIGNED_FROM_EDGE) {\n      String strEdgeId=extractParameter(String.class,1,additionalInfo);\n      String strEdgeName=extractParameter(String.class,2,additionalInfo);\n      metaData.putValue(\"unassignedEdgeId\",strEdgeId);\n      metaData.putValue(\"unassignedEdgeName\",strEdgeName);\n    }\n    ObjectNode entityNode;\n    if (entity != null) {\n      entityNode=json.valueToTree(entity);\n      if (entityId.getEntityType() == EntityType.DASHBOARD) {\n        entityNode.put(\"configuration\",\"\");\n      }\n    }\n else {\n      entityNode=json.createObjectNode();\n      if (actionType == ActionType.ATTRIBUTES_UPDATED) {\n        String scope=extractParameter(String.class,0,additionalInfo);\n        @SuppressWarnings(\"unchecked\") List<AttributeKvEntry> attributes=extractParameter(List.class,1,additionalInfo);\n        metaData.putValue(DataConstants.SCOPE,scope);\n        if (attributes != null) {\n          for (          AttributeKvEntry attr : attributes) {\n            addKvEntry(entityNode,attr);\n          }\n        }\n      }\n else       if (actionType == ActionType.ATTRIBUTES_DELETED) {\n        String scope=extractParameter(String.class,0,additionalInfo);\n        @SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,1,additionalInfo);\n        metaData.putValue(DataConstants.SCOPE,scope);\n        ArrayNode attrsArrayNode=entityNode.putArray(\"attributes\");\n        if (keys != null) {\n          keys.forEach(attrsArrayNode::add);\n        }\n      }\n else       if (actionType == ActionType.TIMESERIES_UPDATED) {\n        @SuppressWarnings(\"unchecked\") List<TsKvEntry> timeseries=extractParameter(List.class,0,additionalInfo);\n        addTimeseries(entityNode,timeseries);\n      }\n else       if (actionType == ActionType.TIMESERIES_DELETED) {\n        @SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,0,additionalInfo);\n        if (keys != null) {\n          ArrayNode timeseriesArrayNode=entityNode.putArray(\"timeseries\");\n          keys.forEach(timeseriesArrayNode::add);\n        }\n        entityNode.put(\"startTs\",extractParameter(Long.class,1,additionalInfo));\n        entityNode.put(\"endTs\",extractParameter(Long.class,2,additionalInfo));\n      }\n    }\n    TbMsg tbMsg=TbMsg.newMsg(msgType,entityId,customerId,metaData,TbMsgDataType.JSON,json.writeValueAsString(entityNode));\n    if (tenantId.isNullUid()) {\n      if (entity instanceof HasTenantId) {\n        tenantId=((HasTenantId)entity).getTenantId();\n      }\n    }\n    tbClusterService.pushMsgToRuleEngine(tenantId,entityId,tbMsg,null);\n  }\n catch (  Exception e) {\n    log.warn(\"[{}] Failed to push entity action to rule engine: {}\",entityId,actionType,e);\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 645,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 8375,
        "startLineNumber" : 61,
        "startColumnNumber" : 105,
        "endLineNumber" : 213,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  String msgType=null;\nswitch (actionType) {\ncase ADDED:    msgType=DataConstants.ENTITY_CREATED;\n  break;\ncase DELETED:msgType=DataConstants.ENTITY_DELETED;\nbreak;\ncase UPDATED:msgType=DataConstants.ENTITY_UPDATED;\nbreak;\ncase ASSIGNED_TO_CUSTOMER:msgType=DataConstants.ENTITY_ASSIGNED;\nbreak;\ncase UNASSIGNED_FROM_CUSTOMER:msgType=DataConstants.ENTITY_UNASSIGNED;\nbreak;\ncase ATTRIBUTES_UPDATED:msgType=DataConstants.ATTRIBUTES_UPDATED;\nbreak;\ncase ATTRIBUTES_DELETED:msgType=DataConstants.ATTRIBUTES_DELETED;\nbreak;\ncase ALARM_ACK:msgType=DataConstants.ALARM_ACK;\nbreak;\ncase ALARM_CLEAR:msgType=DataConstants.ALARM_CLEAR;\nbreak;\ncase ALARM_DELETE:msgType=DataConstants.ALARM_DELETE;\nbreak;\ncase ASSIGNED_FROM_TENANT:msgType=DataConstants.ENTITY_ASSIGNED_FROM_TENANT;\nbreak;\ncase ASSIGNED_TO_TENANT:msgType=DataConstants.ENTITY_ASSIGNED_TO_TENANT;\nbreak;\ncase PROVISION_SUCCESS:msgType=DataConstants.PROVISION_SUCCESS;\nbreak;\ncase PROVISION_FAILURE:msgType=DataConstants.PROVISION_FAILURE;\nbreak;\ncase TIMESERIES_UPDATED:msgType=DataConstants.TIMESERIES_UPDATED;\nbreak;\ncase TIMESERIES_DELETED:msgType=DataConstants.TIMESERIES_DELETED;\nbreak;\ncase ASSIGNED_TO_EDGE:msgType=DataConstants.ENTITY_ASSIGNED_TO_EDGE;\nbreak;\ncase UNASSIGNED_FROM_EDGE:msgType=DataConstants.ENTITY_UNASSIGNED_FROM_EDGE;\nbreak;\n}\nif (!StringUtils.isEmpty(msgType)) {\ntry {\nTbMsgMetaData metaData=new TbMsgMetaData();\nif (user != null) {\nmetaData.putValue(\"userId\",user.getId().toString());\nmetaData.putValue(\"userName\",user.getName());\n}\nif (customerId != null && !customerId.isNullUid()) {\nmetaData.putValue(\"customerId\",customerId.toString());\n}\nif (actionType == ActionType.ASSIGNED_TO_CUSTOMER) {\nString strCustomerId=extractParameter(String.class,1,additionalInfo);\nString strCustomerName=extractParameter(String.class,2,additionalInfo);\nmetaData.putValue(\"assignedCustomerId\",strCustomerId);\nmetaData.putValue(\"assignedCustomerName\",strCustomerName);\n}\n else if (actionType == ActionType.UNASSIGNED_FROM_CUSTOMER) {\nString strCustomerId=extractParameter(String.class,1,additionalInfo);\nString strCustomerName=extractParameter(String.class,2,additionalInfo);\nmetaData.putValue(\"unassignedCustomerId\",strCustomerId);\nmetaData.putValue(\"unassignedCustomerName\",strCustomerName);\n}\n else if (actionType == ActionType.ASSIGNED_FROM_TENANT) {\nString strTenantId=extractParameter(String.class,0,additionalInfo);\nString strTenantName=extractParameter(String.class,1,additionalInfo);\nmetaData.putValue(\"assignedFromTenantId\",strTenantId);\nmetaData.putValue(\"assignedFromTenantName\",strTenantName);\n}\n else if (actionType == ActionType.ASSIGNED_TO_TENANT) {\nString strTenantId=extractParameter(String.class,0,additionalInfo);\nString strTenantName=extractParameter(String.class,1,additionalInfo);\nmetaData.putValue(\"assignedToTenantId\",strTenantId);\nmetaData.putValue(\"assignedToTenantName\",strTenantName);\n}\n else if (actionType == ActionType.ASSIGNED_TO_EDGE) {\nString strEdgeId=extractParameter(String.class,1,additionalInfo);\nString strEdgeName=extractParameter(String.class,2,additionalInfo);\nmetaData.putValue(\"assignedEdgeId\",strEdgeId);\nmetaData.putValue(\"assignedEdgeName\",strEdgeName);\n}\n else if (actionType == ActionType.UNASSIGNED_FROM_EDGE) {\nString strEdgeId=extractParameter(String.class,1,additionalInfo);\nString strEdgeName=extractParameter(String.class,2,additionalInfo);\nmetaData.putValue(\"unassignedEdgeId\",strEdgeId);\nmetaData.putValue(\"unassignedEdgeName\",strEdgeName);\n}\nObjectNode entityNode;\nif (entity != null) {\nentityNode=json.valueToTree(entity);\nif (entityId.getEntityType() == EntityType.DASHBOARD) {\nentityNode.put(\"configuration\",\"\");\n}\n}\n else {\nentityNode=json.createObjectNode();\nif (actionType == ActionType.ATTRIBUTES_UPDATED) {\nString scope=extractParameter(String.class,0,additionalInfo);\n@SuppressWarnings(\"unchecked\") List<AttributeKvEntry> attributes=extractParameter(List.class,1,additionalInfo);\nmetaData.putValue(DataConstants.SCOPE,scope);\nif (attributes != null) {\nfor (AttributeKvEntry attr : attributes) {\naddKvEntry(entityNode,attr);\n}\n}\n}\n else if (actionType == ActionType.ATTRIBUTES_DELETED) {\nString scope=extractParameter(String.class,0,additionalInfo);\n@SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,1,additionalInfo);\nmetaData.putValue(DataConstants.SCOPE,scope);\nArrayNode attrsArrayNode=entityNode.putArray(\"attributes\");\nif (keys != null) {\nkeys.forEach(attrsArrayNode::add);\n}\n}\n else if (actionType == ActionType.TIMESERIES_UPDATED) {\n@SuppressWarnings(\"unchecked\") List<TsKvEntry> timeseries=extractParameter(List.class,0,additionalInfo);\naddTimeseries(entityNode,timeseries);\n}\n else if (actionType == ActionType.TIMESERIES_DELETED) {\n@SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,0,additionalInfo);\nif (keys != null) {\nArrayNode timeseriesArrayNode=entityNode.putArray(\"timeseries\");\nkeys.forEach(timeseriesArrayNode::add);\n}\nentityNode.put(\"startTs\",extractParameter(Long.class,1,additionalInfo));\nentityNode.put(\"endTs\",extractParameter(Long.class,2,additionalInfo));\n}\n}\nTbMsg tbMsg=TbMsg.newMsg(msgType,entityId,customerId,metaData,TbMsgDataType.JSON,json.writeValueAsString(entityNode));\nif (tenantId.isNullUid()) {\nif (entity instanceof HasTenantId) {\ntenantId=((HasTenantId)entity).getTenantId();\n}\n}\ntbClusterService.pushMsgToRuleEngine(tenantId,entityId,tbMsg,null);\n}\n catch (Exception e) {\nlog.warn(\"[{}] Failed to push entity action to rule engine: {}\",entityId,actionType,e);\n}\n}\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 816,
      "astHeight" : 18
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 8598,
        "startLineNumber" : 60,
        "startColumnNumber" : 4,
        "endLineNumber" : 213,
        "endColumnNumber" : 5
      },
      "nodeContext" : "public void pushEntityActionToRuleEngine(EntityId entityId,HasName entity,TenantId tenantId,CustomerId customerId,ActionType actionType,User user,Object... additionalInfo){\n  String msgType=null;\nswitch (actionType) {\ncase ADDED:    msgType=DataConstants.ENTITY_CREATED;\n  break;\ncase DELETED:msgType=DataConstants.ENTITY_DELETED;\nbreak;\ncase UPDATED:msgType=DataConstants.ENTITY_UPDATED;\nbreak;\ncase ASSIGNED_TO_CUSTOMER:msgType=DataConstants.ENTITY_ASSIGNED;\nbreak;\ncase UNASSIGNED_FROM_CUSTOMER:msgType=DataConstants.ENTITY_UNASSIGNED;\nbreak;\ncase ATTRIBUTES_UPDATED:msgType=DataConstants.ATTRIBUTES_UPDATED;\nbreak;\ncase ATTRIBUTES_DELETED:msgType=DataConstants.ATTRIBUTES_DELETED;\nbreak;\ncase ALARM_ACK:msgType=DataConstants.ALARM_ACK;\nbreak;\ncase ALARM_CLEAR:msgType=DataConstants.ALARM_CLEAR;\nbreak;\ncase ALARM_DELETE:msgType=DataConstants.ALARM_DELETE;\nbreak;\ncase ASSIGNED_FROM_TENANT:msgType=DataConstants.ENTITY_ASSIGNED_FROM_TENANT;\nbreak;\ncase ASSIGNED_TO_TENANT:msgType=DataConstants.ENTITY_ASSIGNED_TO_TENANT;\nbreak;\ncase PROVISION_SUCCESS:msgType=DataConstants.PROVISION_SUCCESS;\nbreak;\ncase PROVISION_FAILURE:msgType=DataConstants.PROVISION_FAILURE;\nbreak;\ncase TIMESERIES_UPDATED:msgType=DataConstants.TIMESERIES_UPDATED;\nbreak;\ncase TIMESERIES_DELETED:msgType=DataConstants.TIMESERIES_DELETED;\nbreak;\ncase ASSIGNED_TO_EDGE:msgType=DataConstants.ENTITY_ASSIGNED_TO_EDGE;\nbreak;\ncase UNASSIGNED_FROM_EDGE:msgType=DataConstants.ENTITY_UNASSIGNED_FROM_EDGE;\nbreak;\n}\nif (!StringUtils.isEmpty(msgType)) {\ntry {\nTbMsgMetaData metaData=new TbMsgMetaData();\nif (user != null) {\nmetaData.putValue(\"userId\",user.getId().toString());\nmetaData.putValue(\"userName\",user.getName());\n}\nif (customerId != null && !customerId.isNullUid()) {\nmetaData.putValue(\"customerId\",customerId.toString());\n}\nif (actionType == ActionType.ASSIGNED_TO_CUSTOMER) {\nString strCustomerId=extractParameter(String.class,1,additionalInfo);\nString strCustomerName=extractParameter(String.class,2,additionalInfo);\nmetaData.putValue(\"assignedCustomerId\",strCustomerId);\nmetaData.putValue(\"assignedCustomerName\",strCustomerName);\n}\n else if (actionType == ActionType.UNASSIGNED_FROM_CUSTOMER) {\nString strCustomerId=extractParameter(String.class,1,additionalInfo);\nString strCustomerName=extractParameter(String.class,2,additionalInfo);\nmetaData.putValue(\"unassignedCustomerId\",strCustomerId);\nmetaData.putValue(\"unassignedCustomerName\",strCustomerName);\n}\n else if (actionType == ActionType.ASSIGNED_FROM_TENANT) {\nString strTenantId=extractParameter(String.class,0,additionalInfo);\nString strTenantName=extractParameter(String.class,1,additionalInfo);\nmetaData.putValue(\"assignedFromTenantId\",strTenantId);\nmetaData.putValue(\"assignedFromTenantName\",strTenantName);\n}\n else if (actionType == ActionType.ASSIGNED_TO_TENANT) {\nString strTenantId=extractParameter(String.class,0,additionalInfo);\nString strTenantName=extractParameter(String.class,1,additionalInfo);\nmetaData.putValue(\"assignedToTenantId\",strTenantId);\nmetaData.putValue(\"assignedToTenantName\",strTenantName);\n}\n else if (actionType == ActionType.ASSIGNED_TO_EDGE) {\nString strEdgeId=extractParameter(String.class,1,additionalInfo);\nString strEdgeName=extractParameter(String.class,2,additionalInfo);\nmetaData.putValue(\"assignedEdgeId\",strEdgeId);\nmetaData.putValue(\"assignedEdgeName\",strEdgeName);\n}\n else if (actionType == ActionType.UNASSIGNED_FROM_EDGE) {\nString strEdgeId=extractParameter(String.class,1,additionalInfo);\nString strEdgeName=extractParameter(String.class,2,additionalInfo);\nmetaData.putValue(\"unassignedEdgeId\",strEdgeId);\nmetaData.putValue(\"unassignedEdgeName\",strEdgeName);\n}\nObjectNode entityNode;\nif (entity != null) {\nentityNode=json.valueToTree(entity);\nif (entityId.getEntityType() == EntityType.DASHBOARD) {\nentityNode.put(\"configuration\",\"\");\n}\n}\n else {\nentityNode=json.createObjectNode();\nif (actionType == ActionType.ATTRIBUTES_UPDATED) {\nString scope=extractParameter(String.class,0,additionalInfo);\n@SuppressWarnings(\"unchecked\") List<AttributeKvEntry> attributes=extractParameter(List.class,1,additionalInfo);\nmetaData.putValue(DataConstants.SCOPE,scope);\nif (attributes != null) {\nfor (AttributeKvEntry attr : attributes) {\naddKvEntry(entityNode,attr);\n}\n}\n}\n else if (actionType == ActionType.ATTRIBUTES_DELETED) {\nString scope=extractParameter(String.class,0,additionalInfo);\n@SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,1,additionalInfo);\nmetaData.putValue(DataConstants.SCOPE,scope);\nArrayNode attrsArrayNode=entityNode.putArray(\"attributes\");\nif (keys != null) {\nkeys.forEach(attrsArrayNode::add);\n}\n}\n else if (actionType == ActionType.TIMESERIES_UPDATED) {\n@SuppressWarnings(\"unchecked\") List<TsKvEntry> timeseries=extractParameter(List.class,0,additionalInfo);\naddTimeseries(entityNode,timeseries);\n}\n else if (actionType == ActionType.TIMESERIES_DELETED) {\n@SuppressWarnings(\"unchecked\") List<String> keys=extractParameter(List.class,0,additionalInfo);\nif (keys != null) {\nArrayNode timeseriesArrayNode=entityNode.putArray(\"timeseries\");\nkeys.forEach(timeseriesArrayNode::add);\n}\nentityNode.put(\"startTs\",extractParameter(Long.class,1,additionalInfo));\nentityNode.put(\"endTs\",extractParameter(Long.class,2,additionalInfo));\n}\n}\nTbMsg tbMsg=TbMsg.newMsg(msgType,entityId,customerId,metaData,TbMsgDataType.JSON,json.writeValueAsString(entityNode));\nif (tenantId.isNullUid()) {\nif (entity instanceof HasTenantId) {\ntenantId=((HasTenantId)entity).getTenantId();\n}\n}\ntbClusterService.pushMsgToRuleEngine(tenantId,entityId,tbMsg,null);\n}\n catch (Exception e) {\nlog.warn(\"[{}] Failed to push entity action to rule engine: {}\",entityId,actionType,e);\n}\n}\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 848,
      "astHeight" : 19
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 57,
        "startLineNumber" : 137,
        "startColumnNumber" : 20,
        "endLineNumber" : 137,
        "endColumnNumber" : 77
      },
      "nodeContext" : "metaData.putValue(\"unassignedCustomerId\",strCustomerId);\n",
      "nodeType" : "ExpressionStatement",
      "astNodeNumber" : 6,
      "astHeight" : 3
    },
    "tokenLength" : 1,
    "type" : "java.lang.String"
  } ],
  "positionList" : [ {
    "charLength" : 22,
    "startLineNumber" : 137,
    "startColumnNumber" : 38,
    "endLineNumber" : 137,
    "endColumnNumber" : 60
  } ],
  "layoutRelationDataList" : [ ]
}