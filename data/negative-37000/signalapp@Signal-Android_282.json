{
  "id" : 282,
  "expression" : "thumbnailsCreated < thumbnailCount",
  "projectName" : "signalapp@Signal-Android",
  "commitID" : "7e91132e7ed62a58b5f347de252ab1eda3f43b90",
  "filePath" : "/app/src/main/java/org/thoughtcrime/securesms/video/videoconverter/VideoThumbnailsExtractor.java",
  "occurrences" : 1,
  "isArithmeticExpression" : 0,
  "isGetTypeMethod" : 0,
  "expressionList" : [ {
    "nodeContext" : "thumbnailsCreated < thumbnailCount",
    "nodeType" : "InfixExpression",
    "nodePosition" : {
      "charLength" : 34,
      "startLineNumber" : 177,
      "startColumnNumber" : 14,
      "endLineNumber" : 177,
      "endColumnNumber" : 48
    },
    "astNodeNumber" : 3,
    "astHeight" : 2,
    "parentDataList" : [ {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 688,
        "startLineNumber" : 177,
        "startColumnNumber" : 10,
        "endLineNumber" : 189,
        "endColumnNumber" : 11
      },
      "nodeContext" : "if (thumbnailsCreated < thumbnailCount) {\n  pixelBuf.rewind();\n  GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n  final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n  pixelBuf.rewind();\n  bitmap.copyPixelsFromBuffer(pixelBuf);\n  if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n    break;\n  }\n  Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 78,
      "astHeight" : 9
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 826,
        "startLineNumber" : 173,
        "startColumnNumber" : 26,
        "endLineNumber" : 191,
        "endColumnNumber" : 9
      },
      "nodeContext" : "{\n  outputSurface.awaitNewImage();\n  outputSurface.drawImage();\n  if (thumbnailsCreated < thumbnailCount) {\n    pixelBuf.rewind();\n    GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n    final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n    pixelBuf.rewind();\n    bitmap.copyPixelsFromBuffer(pixelBuf);\n    if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n      break;\n    }\n    Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n  }\n  thumbnailsCreated++;\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 90,
      "astHeight" : 10
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 844,
        "startLineNumber" : 173,
        "startColumnNumber" : 8,
        "endLineNumber" : 191,
        "endColumnNumber" : 9
      },
      "nodeContext" : "if (shouldRender) {\n  outputSurface.awaitNewImage();\n  outputSurface.drawImage();\n  if (thumbnailsCreated < thumbnailCount) {\n    pixelBuf.rewind();\n    GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n    final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n    pixelBuf.rewind();\n    bitmap.copyPixelsFromBuffer(pixelBuf);\n    if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n      break;\n    }\n    Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n  }\n  thumbnailsCreated++;\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 92,
      "astHeight" : 11
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.IfStatement,thenStatement]",
      "nodePosition" : {
        "charLength" : 1182,
        "startLineNumber" : 165,
        "startColumnNumber" : 31,
        "endLineNumber" : 192,
        "endColumnNumber" : 7
      },
      "nodeContext" : "{\n  if ((info.flags & MediaCodec.BUFFER_FLAG_END_OF_STREAM) != 0) {\n    outputDone=true;\n  }\n  final boolean shouldRender=(info.size != 0);\n  decoder.releaseOutputBuffer(outputBufIndex,shouldRender);\n  if (shouldRender) {\n    outputSurface.awaitNewImage();\n    outputSurface.drawImage();\n    if (thumbnailsCreated < thumbnailCount) {\n      pixelBuf.rewind();\n      GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n      final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n      pixelBuf.rewind();\n      bitmap.copyPixelsFromBuffer(pixelBuf);\n      if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n        break;\n      }\n      Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n    }\n    thumbnailsCreated++;\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 126,
      "astHeight" : 12
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 1207,
        "startLineNumber" : 165,
        "startColumnNumber" : 6,
        "endLineNumber" : 192,
        "endColumnNumber" : 7
      },
      "nodeContext" : "if (outputBufIndex >= 0) {\n  if ((info.flags & MediaCodec.BUFFER_FLAG_END_OF_STREAM) != 0) {\n    outputDone=true;\n  }\n  final boolean shouldRender=(info.size != 0);\n  decoder.releaseOutputBuffer(outputBufIndex,shouldRender);\n  if (shouldRender) {\n    outputSurface.awaitNewImage();\n    outputSurface.drawImage();\n    if (thumbnailsCreated < thumbnailCount) {\n      pixelBuf.rewind();\n      GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n      final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n      pixelBuf.rewind();\n      bitmap.copyPixelsFromBuffer(pixelBuf);\n      if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n        break;\n      }\n      Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n    }\n    thumbnailsCreated++;\n  }\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 130,
      "astHeight" : 13
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.WhileStatement,body]",
      "nodePosition" : {
        "charLength" : 2324,
        "startLineNumber" : 144,
        "startColumnNumber" : 24,
        "endLineNumber" : 193,
        "endColumnNumber" : 5
      },
      "nodeContext" : "{\n  if (!inputDone) {\n    int inputBufIndex=decoder.dequeueInputBuffer(TIMEOUT_USEC);\n    if (inputBufIndex >= 0) {\n      final ByteBuffer inputBuf=decoderInputBuffers[inputBufIndex];\n      final int sampleSize=extractor.readSampleData(inputBuf,0);\n      if (sampleSize < 0 || samplesExtracted >= thumbnailCount) {\n        decoder.queueInputBuffer(inputBufIndex,0,0,0L,MediaCodec.BUFFER_FLAG_END_OF_STREAM);\n        inputDone=true;\n        Log.i(TAG,\"input done\");\n      }\n else {\n        final long presentationTimeUs=extractor.getSampleTime();\n        decoder.queueInputBuffer(inputBufIndex,0,sampleSize,presentationTimeUs,0);\n        samplesExtracted++;\n        extractor.seekTo(duration * samplesExtracted / thumbnailCount,MediaExtractor.SEEK_TO_CLOSEST_SYNC);\n        Log.i(TAG,\"seek to \" + duration * samplesExtracted / thumbnailCount + \", actual \" + extractor.getSampleTime());\n      }\n    }\n  }\n  int outputBufIndex=decoder.dequeueOutputBuffer(info,TIMEOUT_USEC);\n  if (outputBufIndex >= 0) {\n    if ((info.flags & MediaCodec.BUFFER_FLAG_END_OF_STREAM) != 0) {\n      outputDone=true;\n    }\n    final boolean shouldRender=(info.size != 0);\n    decoder.releaseOutputBuffer(outputBufIndex,shouldRender);\n    if (shouldRender) {\n      outputSurface.awaitNewImage();\n      outputSurface.drawImage();\n      if (thumbnailsCreated < thumbnailCount) {\n        pixelBuf.rewind();\n        GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n        final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n        pixelBuf.rewind();\n        bitmap.copyPixelsFromBuffer(pixelBuf);\n        if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n          break;\n        }\n        Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n      }\n      thumbnailsCreated++;\n    }\n  }\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 257,
      "astHeight" : 15
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 2344,
        "startLineNumber" : 144,
        "startColumnNumber" : 4,
        "endLineNumber" : 193,
        "endColumnNumber" : 5
      },
      "nodeContext" : "while (!outputDone) {\n  if (!inputDone) {\n    int inputBufIndex=decoder.dequeueInputBuffer(TIMEOUT_USEC);\n    if (inputBufIndex >= 0) {\n      final ByteBuffer inputBuf=decoderInputBuffers[inputBufIndex];\n      final int sampleSize=extractor.readSampleData(inputBuf,0);\n      if (sampleSize < 0 || samplesExtracted >= thumbnailCount) {\n        decoder.queueInputBuffer(inputBufIndex,0,0,0L,MediaCodec.BUFFER_FLAG_END_OF_STREAM);\n        inputDone=true;\n        Log.i(TAG,\"input done\");\n      }\n else {\n        final long presentationTimeUs=extractor.getSampleTime();\n        decoder.queueInputBuffer(inputBufIndex,0,sampleSize,presentationTimeUs,0);\n        samplesExtracted++;\n        extractor.seekTo(duration * samplesExtracted / thumbnailCount,MediaExtractor.SEEK_TO_CLOSEST_SYNC);\n        Log.i(TAG,\"seek to \" + duration * samplesExtracted / thumbnailCount + \", actual \" + extractor.getSampleTime());\n      }\n    }\n  }\n  int outputBufIndex=decoder.dequeueOutputBuffer(info,TIMEOUT_USEC);\n  if (outputBufIndex >= 0) {\n    if ((info.flags & MediaCodec.BUFFER_FLAG_END_OF_STREAM) != 0) {\n      outputDone=true;\n    }\n    final boolean shouldRender=(info.size != 0);\n    decoder.releaseOutputBuffer(outputBufIndex,shouldRender);\n    if (shouldRender) {\n      outputSurface.awaitNewImage();\n      outputSurface.drawImage();\n      if (thumbnailsCreated < thumbnailCount) {\n        pixelBuf.rewind();\n        GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n        final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n        pixelBuf.rewind();\n        bitmap.copyPixelsFromBuffer(pixelBuf);\n        if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n          break;\n        }\n        Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n      }\n      thumbnailsCreated++;\n    }\n  }\n}\n",
      "nodeType" : "WhileStatement",
      "astNodeNumber" : 260,
      "astHeight" : 16
    }, {
      "locationInParent" : "ChildProperty[org.eclipse.jdt.core.dom.MethodDeclaration,body]",
      "nodePosition" : {
        "charLength" : 2937,
        "startLineNumber" : 129,
        "startColumnNumber" : 2,
        "endLineNumber" : 195,
        "endColumnNumber" : 3
      },
      "nodeContext" : "{\n  final int TIMEOUT_USEC=10000;\n  final ByteBuffer[] decoderInputBuffers=decoder.getInputBuffers();\n  final MediaCodec.BufferInfo info=new MediaCodec.BufferInfo();\n  int samplesExtracted=0;\n  int thumbnailsCreated=0;\n  Log.i(TAG,\"doExtract started\");\n  final ByteBuffer pixelBuf=ByteBuffer.allocateDirect(outputWidth * outputHeight * 4);\n  pixelBuf.order(ByteOrder.LITTLE_ENDIAN);\n  boolean outputDone=false;\n  boolean inputDone=false;\n  while (!outputDone) {\n    if (!inputDone) {\n      int inputBufIndex=decoder.dequeueInputBuffer(TIMEOUT_USEC);\n      if (inputBufIndex >= 0) {\n        final ByteBuffer inputBuf=decoderInputBuffers[inputBufIndex];\n        final int sampleSize=extractor.readSampleData(inputBuf,0);\n        if (sampleSize < 0 || samplesExtracted >= thumbnailCount) {\n          decoder.queueInputBuffer(inputBufIndex,0,0,0L,MediaCodec.BUFFER_FLAG_END_OF_STREAM);\n          inputDone=true;\n          Log.i(TAG,\"input done\");\n        }\n else {\n          final long presentationTimeUs=extractor.getSampleTime();\n          decoder.queueInputBuffer(inputBufIndex,0,sampleSize,presentationTimeUs,0);\n          samplesExtracted++;\n          extractor.seekTo(duration * samplesExtracted / thumbnailCount,MediaExtractor.SEEK_TO_CLOSEST_SYNC);\n          Log.i(TAG,\"seek to \" + duration * samplesExtracted / thumbnailCount + \", actual \" + extractor.getSampleTime());\n        }\n      }\n    }\n    int outputBufIndex=decoder.dequeueOutputBuffer(info,TIMEOUT_USEC);\n    if (outputBufIndex >= 0) {\n      if ((info.flags & MediaCodec.BUFFER_FLAG_END_OF_STREAM) != 0) {\n        outputDone=true;\n      }\n      final boolean shouldRender=(info.size != 0);\n      decoder.releaseOutputBuffer(outputBufIndex,shouldRender);\n      if (shouldRender) {\n        outputSurface.awaitNewImage();\n        outputSurface.drawImage();\n        if (thumbnailsCreated < thumbnailCount) {\n          pixelBuf.rewind();\n          GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n          final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n          pixelBuf.rewind();\n          bitmap.copyPixelsFromBuffer(pixelBuf);\n          if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n            break;\n          }\n          Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n        }\n        thumbnailsCreated++;\n      }\n    }\n  }\n  Log.i(TAG,\"doExtract finished\");\n}\n",
      "nodeType" : "Block",
      "astNodeNumber" : 343,
      "astHeight" : 17
    }, {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.TypeDeclaration,bodyDeclarations]",
      "nodePosition" : {
        "charLength" : 3365,
        "startLineNumber" : 123,
        "startColumnNumber" : 2,
        "endLineNumber" : 195,
        "endColumnNumber" : 3
      },
      "nodeContext" : "private static void doExtract(final @NonNull MediaExtractor extractor,final @NonNull MediaCodec decoder,final @NonNull OutputSurface outputSurface,final int outputWidth,int outputHeight,long duration,int thumbnailCount,final @NonNull Callback callback) throws TranscodingException {\n  final int TIMEOUT_USEC=10000;\n  final ByteBuffer[] decoderInputBuffers=decoder.getInputBuffers();\n  final MediaCodec.BufferInfo info=new MediaCodec.BufferInfo();\n  int samplesExtracted=0;\n  int thumbnailsCreated=0;\n  Log.i(TAG,\"doExtract started\");\n  final ByteBuffer pixelBuf=ByteBuffer.allocateDirect(outputWidth * outputHeight * 4);\n  pixelBuf.order(ByteOrder.LITTLE_ENDIAN);\n  boolean outputDone=false;\n  boolean inputDone=false;\n  while (!outputDone) {\n    if (!inputDone) {\n      int inputBufIndex=decoder.dequeueInputBuffer(TIMEOUT_USEC);\n      if (inputBufIndex >= 0) {\n        final ByteBuffer inputBuf=decoderInputBuffers[inputBufIndex];\n        final int sampleSize=extractor.readSampleData(inputBuf,0);\n        if (sampleSize < 0 || samplesExtracted >= thumbnailCount) {\n          decoder.queueInputBuffer(inputBufIndex,0,0,0L,MediaCodec.BUFFER_FLAG_END_OF_STREAM);\n          inputDone=true;\n          Log.i(TAG,\"input done\");\n        }\n else {\n          final long presentationTimeUs=extractor.getSampleTime();\n          decoder.queueInputBuffer(inputBufIndex,0,sampleSize,presentationTimeUs,0);\n          samplesExtracted++;\n          extractor.seekTo(duration * samplesExtracted / thumbnailCount,MediaExtractor.SEEK_TO_CLOSEST_SYNC);\n          Log.i(TAG,\"seek to \" + duration * samplesExtracted / thumbnailCount + \", actual \" + extractor.getSampleTime());\n        }\n      }\n    }\n    int outputBufIndex=decoder.dequeueOutputBuffer(info,TIMEOUT_USEC);\n    if (outputBufIndex >= 0) {\n      if ((info.flags & MediaCodec.BUFFER_FLAG_END_OF_STREAM) != 0) {\n        outputDone=true;\n      }\n      final boolean shouldRender=(info.size != 0);\n      decoder.releaseOutputBuffer(outputBufIndex,shouldRender);\n      if (shouldRender) {\n        outputSurface.awaitNewImage();\n        outputSurface.drawImage();\n        if (thumbnailsCreated < thumbnailCount) {\n          pixelBuf.rewind();\n          GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n          final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n          pixelBuf.rewind();\n          bitmap.copyPixelsFromBuffer(pixelBuf);\n          if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n            break;\n          }\n          Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n        }\n        thumbnailsCreated++;\n      }\n    }\n  }\n  Log.i(TAG,\"doExtract finished\");\n}\n",
      "nodeType" : "MethodDeclaration",
      "astNodeNumber" : 391,
      "astHeight" : 18
    } ],
    "currentLineData" : {
      "locationInParent" : "ChildListProperty[org.eclipse.jdt.core.dom.Block,statements]",
      "nodePosition" : {
        "charLength" : 688,
        "startLineNumber" : 177,
        "startColumnNumber" : 10,
        "endLineNumber" : 189,
        "endColumnNumber" : 11
      },
      "nodeContext" : "if (thumbnailsCreated < thumbnailCount) {\n  pixelBuf.rewind();\n  GLES20.glReadPixels(0,0,outputWidth,outputHeight,GLES20.GL_RGBA,GLES20.GL_UNSIGNED_BYTE,pixelBuf);\n  final Bitmap bitmap=Bitmap.createBitmap(outputWidth,outputHeight,Bitmap.Config.ARGB_8888);\n  pixelBuf.rewind();\n  bitmap.copyPixelsFromBuffer(pixelBuf);\n  if (!callback.publishProgress(thumbnailsCreated,bitmap)) {\n    break;\n  }\n  Log.i(TAG,\"publishProgress for frame \" + thumbnailsCreated + \" at \"+ info.presentationTimeUs+ \" (target \"+ duration * thumbnailsCreated / thumbnailCount + \")\");\n}\n",
      "nodeType" : "IfStatement",
      "astNodeNumber" : 78,
      "astHeight" : 9
    },
    "tokenLength" : 3,
    "type" : "boolean"
  } ],
  "positionList" : [ {
    "charLength" : 34,
    "startLineNumber" : 177,
    "startColumnNumber" : 14,
    "endLineNumber" : 177,
    "endColumnNumber" : 48
  } ],
  "layoutRelationDataList" : [ ]
}